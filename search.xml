<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>[博客维护]基于Hexo框架搭建个人网站的实现记录</title>
    <url>/2022/02/10/1-blog_setup_notes/</url>
    <content><![CDATA[<h1>序言</h1>
<p>从很久以前就想搭一个自己的网站，分享并且记录自己的一些日常工作和学习的过程和成果，此篇作为我的第一篇文章，就先分享一下我跟随<a href="https://zhuanlan.zhihu.com/p/102592286?tdsourcetag=s_pctim_aiomsg" title="从零开始搭建个人博客（超详细)">枫叶</a>的详细教功搭建本博客网站的一些心得体会。</p>
<h1>正文</h1>
<p>本网站的搭建过程与枫叶教程中的基本一致，下面我就分篇讲一讲我作为一个“网络”小白在读教程的过程中遇到的一些问题，以及查询资料后我的理解。</p>
<h2 id="关于第二篇Git安装的问题">关于第二篇Git安装的问题</h2>
<p>Git本身是一个免费开源的分布式版本控制系统(Distributed version control system), Git的主要作用是我们通过此版本控制系统提交文件至仓库，由该系统为提交的文件打上版本号，然后每次提交仓库时根据版本号知道哪些文件需要更新哪些可以不用改动。需要记录的几个定义，需要强调的是以下基于我查到的资料和我自己的理解，有理解不对的地方还请大神指正：</p>
<ul>
<li>本地仓库与远程仓库：分别指建立在本地和互联网服务器内的文件夹</li>
<li>分布式与集中式版本控制系统：分布式系统（如Git）同时具有本地及远程仓库，提交文件时先提交至本地仓库，有网络时再提交至服务器上的远程仓库。集中式系统（如SVN）只配有远程仓库，提交文件时直接提交到远程仓库。</li>
<li>在此步骤中，GitHub既是远程仓库，是一个网络文件夹。我们主要使用Git作为同步本地仓库和远程仓库的工具。</li>
</ul>
<h2 id="关于第三篇绑定GitHub并提交文件">关于第三篇绑定GitHub并提交文件</h2>
<p>跟随步骤进行时有两点需要注意：</p>
<h3 id="Git的username和email的配置">Git的username和email的配置</h3>
<p>首次提交文件时需要向远程仓库声明本机器的名字和Email地址，即使用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config --global user.name <span class="string">&quot;yourusername&quot;</span></span><br><span class="line">$ git config --global user.email <span class="string">&quot;youremailaddress@xxx.com&quot;</span></span><br></pre></td></tr></table></figure>
<p>根据<a href="https://careerkarma.com/blog/git-config/" title="How to Set Up Git Using git config">这篇文章</a>的描述，这个username可以是任何你想要附在你的提交文件上的一个“标记”，它不需要和你的版本控制用户名（例如你的GitHub用户名）一致。之所以要在首次提交之前输入这个信息就是为了给你的提交打上“标记&quot;, 一旦你的提交被创建，它的“著作权”就已经和你填写的这两条信息绑定，不能再被更改。</p>
<p>此处以我自己的理解是该名字和Email地址其实对于我们真正要做的事情并没有实质作用或影响，只不过是向远程仓库提交了一个象征这个本地仓库的一个符号，提交后即可以使用下方命令查看配置是否成功上传。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git config -l</span><br></pre></td></tr></table></figure>
<p>之所以强调要查看这个配置的原因是因为在枫叶的教程中给出的代码有<strong>少许错误</strong>：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220210235741955.png" alt="教程中的代码没有带空格"></p>
<p>没有这个空格不会有任何报错，同时也不会有任何效果，我当时因为不知道这个小错误，还以为username与email都成功设置了，导致Git一直无法成功commit而找不到原因，需要注意。</p>
<h3 id="从Master换成Main的掩耳盗铃">从Master换成Main的掩耳盗铃</h3>
<p>枫叶教程中多次提及的GitHub的默认分支Master，<a href="https://blog.csdn.net/j3T9Z7H/article/details/108898310" title="今天开始，GitHub将启用main作为默认分支名，master将成为历史！">查询</a>后发现原来这个默认的Master分支已经在2020年10月1日起被GitHub改成了Main，其原因竟是因为要避讳可能引起人们联想到奴隶制的词汇，为了这种自欺欺人的原因导致多少人的麻烦。</p>
<h4 id="push文件时的命令">push文件时的命令</h4>
<p>回到正题，因为分支名的改动，文件commit至本地仓库后应使用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git push origin main</span><br></pre></td></tr></table></figure>
<p>将本地仓库提交至远程仓库，这其中origin是远程主机(即GitHub)的名字,而main则是我们仓库的默认分支名。</p>
<h4 id="初始化本地仓库时要做的修改">初始化本地仓库时要做的修改</h4>
<p>在实际操作中我还发现了这个改动导致git隐藏的一个地雷，那就是当我们用枫叶第三篇博客中提到的第二种git方法提交文件时，使用<code>git init</code>将不会初始化到我们想要的main分支，而是默认创建了master分支。这将直接导致我们之后使用<code>git push origin main</code>推至远程仓库时会报错，因为我们的本地仓库根本就不是main。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220213115508276.png" alt="image-20220213115508276"></p>
<p>这时我们要将这个本地仓库分支名改成我们想要推至的远程仓库，并且最好顺道把<code>git init</code>的默认分支也改成main，毕竟GitHub的默认分支都已经改成main了。然后你就可以继续按照教程快乐上传各种文件了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ git branch -M main <span class="comment">#这个命令可以将你当前所在的本地仓库分支名改成-M后面这个参数&quot;main&quot;</span></span><br><span class="line">$ git config --global init.defaultBranch main <span class="comment">#将默认分支名改成main，可以用git config -l查看是否更改成功</span></span><br></pre></td></tr></table></figure>
<h3 id="为什么要提交到GitHub">为什么要提交到GitHub?</h3>
<p>我们之所以要将文件提交至GitHub的远程仓库其实是因为其提供的一项服务<a href="https://docs.github.com/en/pages" title="GitHub Pages Documentation">GitHub Pages</a>， 这项服务使用户可以创建和托管其自己的个人网站，每个GitHub账号只允许创建一个网站，这也是我们要用创建名称为<code>“用户名.github.io”</code>的仓库这样的方式来启用这项服务的原因。</p>
<h2 id="关于第五篇安装node-js和Hexo">关于第五篇安装node.js和Hexo</h2>
<p>node.js简单来说就是JavaScript的一种运行环境，而npm则是node.js的包管理器 (package manager)，使用npm可以自动根据各个需要模块的依赖关系快速下载安装需要的所有依赖的包并管理，本篇中安装node.js的直观原因就是为了能在命令行中使用npm。</p>
<h3 id="设置文件夹权限">设置文件夹权限</h3>
<p>本篇中需要注意的一点是，设置npm的路径和环境变量时在nodejs文件夹中创建的两个node_cache和node_global文件夹需要在各自的属性中给与用户所有权限，否则会导致npm报错。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220211002517309.png" alt="给予用户完全控制权限"></p>
<h3 id="Hexo是什么？">Hexo是什么？</h3>
<p>根据Hexo的<a href="https://hexo.io/docs/" title="Hexo Documentation">官方文档</a>，Node.js与Git都是使用Hexo的必要条件，而Hexo本身则是一个免费的博客框架，换句话说既是已经写好的“网站积木”，有了Hexo我们就不需要完全重新设计搭建网站，被古老的html语言折磨，而可以用已有的积木搭出我们想要的网站的样子，主流的博客框架除了Hexo还有与GitHub Pages绑定的Jekyll，尽管看到不少网友鼓吹Jekyll的便捷，但我看着网上大部分由Hexo搭建的博客网站想想大概人类的本质就是口嫌体直罢。</p>
<p>关于Hexo相关的命令有：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo init [folder] <span class="comment"># 该命令在提供的文件夹下初始化一个网站，如果没有提供文件夹路径则在当前路径初始化。完成导入hexo-starter到目标文件夹并安装依赖包。</span></span><br><span class="line">$ hexo g <span class="comment"># 等同于 hexo generate，该命令将文件夹中的资源文件生成部署网站用的静态文件，这也是我们刚刚提到的Hexo最重要的作用，将积木搭成城堡的一步。</span></span><br><span class="line">$ hexo s <span class="comment"># 等同于hexo server，启动本地服务器。该命令用于预览已经做出的更改，但不会推送至远程仓库部署，使用该命令不需要hexo g即可默认从http://localhost:4000/本地预览网站的样子。</span></span><br><span class="line">$ hexo clean <span class="comment"># 该命令用于清除缓存文件db.json和已经生成的静态文件Public, hexo g之前最好先运行此命令以免造成generate的文件出现难以预估的问题。</span></span><br><span class="line">$ hexo d <span class="comment">#等同于hexo deploy，使用此命令将目前文件夹中的静态文件部署到设定的仓库（网站）。</span></span><br></pre></td></tr></table></figure>
<h1>最后</h1>
<p>感谢枫叶大佬的详细介绍才使得我一个完全没有接触过类似东西的人得以在几天内忙里偷闲搭起了这样一个网站，像是有了一个小小的自己的空间，非常感激。即使第六篇之后，也就是网站的主题选择我没有像枫叶大佬一样选择Next主题，而是用了目前看起来更新更符合我审美的<a href="https://butterfly.js.org/" title="Butterfly Documentation">Butterfly</a>，我也依然在配置Hexo的主题文件等等问题上很大程度上参考了大部分第八篇的内容。</p>
<p>另外必须给大家推荐我现在使用的这个主题, 这是最符合我审美并且自由度相当高的一款主题，网站上有相当详细的文档，大家配置主题的时候跟着文档走就可以完成大部分的网站配置了。</p>
<p>[第1篇]</p>
]]></content>
      <categories>
        <category>博客维护</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>GitHub</tag>
        <tag>Git</tag>
        <tag>日常学习</tag>
      </tags>
  </entry>
  <entry>
    <title>[数据分析]常用数据库类型对比介绍</title>
    <url>/2022/03/09/10-introduction-to-different-db/</url>
    <content><![CDATA[<h1>序言</h1>
<p>由于我本科并不是学的计算机，所以其实很多计算机基础的知识我都不太了解。最近在做一些数据库相关的工作的时候发现公司数据库系统使用的<code>IBM DB2</code>在操作和逻辑上似乎和之前用过的<code>Oracle</code>有一些差异，因此也发现我原来连这些不同数据库之间到底有些什么联系或者差异都不知道。所以今天想要系统地了解一下不同的数据库之间的关系和差异。</p>
<h1>正文</h1>
<p>接下来我会先从数据库的<code>基本特性</code>的概念开始介绍，因为正是因为这些特性很多不可以兼得，所以才衍生出各种各样不同的数据库类型。之后再看一看各个有名的数据库各自有什么特点，最后再讲讲公司用的<code>DB2数据库</code>在实际操作中与<code>Oracle</code>到底有什么细节上的区别和联系。</p>
<h2 id="影响数据库选择的因素">影响数据库选择的因素</h2>
<p>知乎的<a href="https://www.zhihu.com/question/414923789" title="[知乎] 数据库种类有哪些，各有什么特点？">民工哥</a>在他的回答中列出了几项影响数据库选择的因素，因为这些因素可能不能同时达成，或者达成有额外成本，因此不同的数据库可能为满足不同的生产需求对这些因素的实现程度和效率都有区别。他的总结是下面这些点：</p>
<ul>
<li><code>数据量：</code>是否海量数据，单表数据量太大会考验数据库的性能</li>
<li><code>数据结构：</code>结构化 (每条记录的结构都一样) 还是非结构化的 (不同记录的结构可以不一样)</li>
<li><code>是否宽表：</code>一条记录是 10 个域，还是成百上千个域</li>
<li><code>数据属性：</code>是基本数据 (比如用户信息)、业务数据 (比如用户行为)、辅助数据 (比如日志)、缓存数据</li>
<li><code>是否要求事务性：</code>一个事务由多个操作组成，必须全部成功或全部回滚，不允许部分成功</li>
<li><code>实时性：</code>对写延迟，或读延迟有没有要求，比如有的业务允许写延迟高但要求读延迟低</li>
<li><code>查询量：</code>比如有的业务要求查询大量记录的少数列，有的要求查询少数记录的所有列</li>
<li><code>排序要求：</code>比如有的业务是针对时间序列操作的</li>
<li><code>可靠性要求：</code>对数据丢失的容忍度</li>
<li><code>一致性要求：</code>是否要求读到的一定是最新写入的数据</li>
<li><code>对增删查改的要求：</code>有的业务要能快速的对单条数据做增删查改 (比如用户信息)，有的要求批量导入，有的不需要修改删除单条记录 (比如日志、用户行为)，有的要求检索少量数据 (比如日志)，有的要求快速读取大量数据 (比如展示报表)，有的要求大量读取并计算数据 (比如分析用户行为)</li>
<li><code>是否需要支持多表操作</code></li>
</ul>
<h2 id="关系型数据库和非关系型数据库-参考资料">关系型数据库和非关系型数据库(<a href="https://www.altexsoft.com/blog/business/comparing-database-management-systems-mysql-postgresql-mssql-server-mongodb-elasticsearch-and-others/" title="Comparing Database Management Systems: MySQL, PostgreSQL, MSSQL Server, MongoDB, Elasticsearch, and others">参考资料</a>)</h2>
<p><code>关系型数据库(Relational or SQL)</code>和<code>非关系型数据库(Non-relational or NoSQL)</code>是目前数据库系统的两个大类，虽然目前工作中有机会接触到的主要都是关系型数据库，但作为新兴的大数据工具以及与关系型数据库功能互补的非关系型数据库，<code>NoSQL</code>现在在数据库业界的势头也非常之猛，因此这里也简单了解一下。</p>
<h3 id="关系型数据库-Relational-DBMS">关系型数据库(Relational DBMS)</h3>
<p><code>关系型数据库</code>的特点顾名思义就是用<code>相互联系的表(tables)</code>来存储数据，<code>结构化查询语言(Structured Query Language, 也即SQL)</code>是这套数据库系统的核心，人们用这套语言来管理关系型数据库，也因此这类数据库就被称为<code>SQL database</code>。关系型数据库需要提前定义<code>模式(Schema)</code>，也就是说数据库中存储的数据的<code>属性(attributes)</code>及其数据格式需要被严格定义，而每条<code>数据(records)</code>都在相应属性上有一个值，也就是说不同数据之间的关系非常明确。</p>
<h4 id="可扩展性-Scalability">可扩展性(Scalability)</h4>
<p>关系型数据库一般只能<code>纵向扩展</code>，也就是说在同一个服务器中增加更多算力和空间(CPU,GPU,RAM等)，而如果要将关系型数据库分布在多个服务器上的话则需要改变数据结构等复杂操作。</p>
<h4 id="性能-Performance">性能(Performance)</h4>
<p>关系型数据库在处理<code>中小型数据规模</code>时性能较好，如果在数据库中加入<code>索引(index)</code>还能更加增强数据库<code>查询(QUERY)</code>和<code>连接(JOIN)</code>的效率。但如果数据量和用户访问量更大时，这类数据库性能就可能不足。</p>
<h4 id="安全性-Security">安全性(Security)</h4>
<p>由于数据高度结构化，关系型数据库的安全性保障不需要太麻烦。由于关系型数据库拥有<code>ACID</code>四大特性，分别是<code>原子性(Atomicity)</code>，<code>一致性(Consistency)</code>，<code>隔离性(Isolation)</code>和<code>持久性(Durability)</code>。这几个特性使得储存在关系型数据库中的数据有较高的<code>完整性(Integrity)</code>，这类数据库非常适合应用在金融电商等对数据完整性要求较高的应用场景。</p>
<h3 id="非关系型数据库-NoSQL">非关系型数据库(NoSQL)</h3>
<p><code>非关系型数据库</code>是各种非表结构数据库的共称，这类数据库有一些代表性的模型：</p>
<ul>
<li><code>文档类(Document-oriented)：</code>用JSON格式的文档存储，提取，管理数据。<code>代表有MongoDB</code>。</li>
<li><code>键值类(Key-value)：</code>这类数据库通常有一个哈希表，表中有一个特定的键和一个指针指向特定的数据，也就是说每一个值都与一个数据一一对应。代表有<code>Redis</code>。</li>
<li><code>图形类(Graph)：</code>使用图结构存储数据，将数据以边缘节点的形式存储，其中节点(node)代表的是数据，而边缘(edge)则代表数据之间的关系，这类数据库主要用来构建数据间的关系图谱。代表有<code>Neo4J</code>。</li>
<li><code>列存储类(Wide-column)：</code>将数据存储在非常多的列中，每一条数据都由键指向可能不同的列中，也即每条数据都可能拥有不同的属性。代表有<code>Cassandra</code>。</li>
</ul>
<h4 id="可扩展性-Scalability-2">可扩展性(Scalability)</h4>
<p><code>非关系型数据库</code>在数据量和访问量增加时，可以通过<code>横向扩容</code>(即增加更多服务器)来扩展容量。这些服务器共享数据，每个服务器仅储存一部分数据，这样每个服务器需要处理的平均访问次数也会减少。由于他们没有结构性的表，因此扩展不需要额外的操作。</p>
<h4 id="性能-Performance-2">性能(Performance)</h4>
<p>由于<code>非关系型数据库</code>的分布式特性，其性能普遍较高。这类数据库可以无限制地储存各种类型和格式的数据，改变已有的数据格式也会比较方便。</p>
<h4 id="安全性-Security-2">安全性(Security)</h4>
<p>安全性是<code>非关系型数据库</code>的一个主要弱点，更高的自由度就是以数据的完整性为代价。</p>
<h2 id="主要关系型数据库对比">主要关系型数据库对比</h2>
<p>由于非关系型数据库目前不在我的业务范围内，我就侧重对比研究一下关系型数据库的几个代表：<code>Oracle</code>, <code>MySQL</code>, <code>MS SQL Server</code>, <code>PostgreSQL</code>和<code>IBM DB2</code>。<a href="https://db-engines.com/en/ranking_trend" title="DB-Engines Ranking - Trend Popularity">DB-Engines网站</a>对各大数据库的流行趋势针对其在公共网络(如搜索引擎，开放职位描述，技术论坛等)上的出现频次进行打分排名：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220314010452079.png" alt="Oracle,MySQL,MS SQL Server, PostgreSQL,IBM DB2近年流行趋势对比"></p>
<p>可以看到尽管有下降趋势，<code>Oracle</code>, <code>MySQL</code>和<code>MS SQL Server</code>依然有绝对的热度，而相对的<code>PostgreSQL</code>近年趋势猛升，而<code>IBM DB2</code>作为关系型数据库的开拓者，其在近年的主要客户群体仅集中在金融行业(以银行，证券，保险，基金公司等，行业代表有花旗，渣打，汇丰，摩根斯坦利以及我司等，哈哈)，因此在大众的讨论热度比其他数据库要低。</p>
<h3 id="Oracle">Oracle</h3>
<p>大名鼎鼎的甲骨文公司，说他们开发的数据库管理系统是业界最著名应该也不会有太多人有异议。其目前支持将各种关系型及非关系型数据库在同一个数据库中管理。基本支持所有主流操作平台，性能好，功能强，稳定性好，安全性强但价格昂贵(免费版功能有限)。目前甲骨文开发的主要关注点在云计算方面。</p>
<p>其主要优点包括<code>创新力强，技术支持及文档资源完备，具备存储处理海量数据的能力</code>。主要缺点就是<code>贵(标准版单价17,500美元，企业版单价47,000美元)，且匹配其高性能其也需要较高的硬件和人员支持才能稳定运行</code>。</p>
<p>如果你有数以亿计的OLTP或数据仓库数据需要储存和处理且预算充足的话，Oracle是一个可以考虑的选择。</p>
<h3 id="MySQL">MySQL</h3>
<p>MySQL如今也是甲骨文公司的明星产品，是现在最知名的关系型数据库之一，与Oracle不同，MySQL是开源的。MySQL由C和C++编写而成，是网页开发组合LAMP的一大组成部分，其名字<code>LAMP</code>分别指<code>Linux(操作系统)</code>, <code>Apache(网页服务器)</code>, <code>MySQL(数据库)</code>和<code>PHP(脚本语言)</code>。可以在大部分主流平台运行。</p>
<p>其主要优点包括<code>免费安装，使用简单，结构不复杂，易于调试且支持云服务</code>。主要缺点在于<code>其底层代码逻辑不适于大型数据库，非完全开源导致一些特定功能不能被免费实现，另外有一些SQL标准操作不被MySQL支持</code>。</p>
<p>如果你只是想做一些小型的网页数据库，或者是数据量不大，复杂度不高的数据管理系统。</p>
<h3 id="MS-SQL-Server">MS SQL Server</h3>
<p>MS SQL Server是微软早期为与IBM在数据库领域竞争而开发的关系型数据库产品，它的主要特点继承了微软的发家秘诀，即可视化，易操作但只能在Windows环境中运行。操作MS SQL Server数据的语言是在SQL标准上发展的<code>Transact-SQL</code>语言。</p>
<p>其主要优点包括<code>针对不同应用场景的涵盖不同功能的各种版本，提供各种商业所需的数据相关附加服务，丰富的文档和社区支持以及云服务</code>等。主要缺点包括<code>贵，支持平台单一，调试复杂</code>。</p>
<p>如果你的的公司订阅了微软的其他产品服务，选择MS SQL Server可能是个不错的选择，微软对其不同产品之间的互动集成做得还是不错的，有助于增强用户体验。</p>
<h3 id="PostgreSQL">PostgreSQL</h3>
<p>PostgreSQL是开源的对象-关系数据库(object-relational database),其相较其他普通关系数据库的差别在于用户可以在PostgreSQL中编程实现自定义对象以实现存储更复杂的数据结构。PostgreSQL与MySQL有许多共同点并在此之上加强了扩展性与合规性，也因此它可以适用于各种不同的数据规模。可以在微软, iOS, 安卓等平台上运行。</p>
<p>其主要优点包括<code>可扩展性高，支持JSON, XML, H-Store等用户自定义的数据格式，拥有易于使用的第三方增强工具，完全开源</code>等。主要缺点在于<code>其文档没有统一标准，且数据库缺少完整性检查工具</code>。</p>
<p>如果你希望自己的数据库存储格式可以定制化并实现一定的数据分析功能，PostgreSQL可以是较好的选择。其在金融电信行业使用较多。</p>
<h3 id="IBM-DB2">IBM DB2</h3>
<p>尽管现在的热度不高，但DB2被认为是关系型数据库的开山鼻祖。其由C和C++编写，可以在UNIX，Linux，Windows服务器版本等多种环境下执行。</p>
<p>DB2的主要优点在于他<code>经过多年大量的实用测试没有出过大的问题，是一个非常值得信赖稳定的的数据库系统，其适用大规模数据且性能也较高</code>。主要缺点可能包括<code>文档和用户界面陈旧对新手不友好，操作较为复杂</code>。</p>
<p>目前DB2的主要用户都是金融公司，这些公司创建数据库比较早，但对技术变革不敏感，且依赖数据库的安全性和稳定性，因此留存为DB2用户。</p>
<h2 id="DB2与Oracle-SQL语法差别（参考资料）">DB2与Oracle SQL语法差别（<a href="https://www.cnblogs.com/wuxl360/p/5563019.html" title="DB2、ORACLE SQL写法的主要区别">参考资料</a>）</h2>
<p>由于我自己学的是Oracle的语法，但现在工作需要使用DB2的语法，因此找了一下网上大神们整理的这两者的区别汇总，发现<code>邬兴亮大神</code>的总结就是我想找的：</p>
<h3 id="数据类型转换函数">数据类型转换函数</h3>
<table>
<thead>
<tr>
<th></th>
<th>整形转字符</th>
<th>字符转整形</th>
<th>字符转浮点</th>
<th>浮点转字符</th>
<th>字符转日期</th>
<th>字符转时间</th>
<th>日期转字符</th>
</tr>
</thead>
<tbody>
<tr>
<td>Oracle</td>
<td>to_char(1)</td>
<td>to_number(‘1’)</td>
<td>to_number(‘1.1’)</td>
<td>to_char(1.1)</td>
<td>to_date(‘2007-04-26’,‘yyyy-mm-dd’)</td>
<td>to_date(‘2007-04-26 08:08:08’,‘yyyy-mm-dd hh25:mi:ss’)</td>
<td>to_char(to_date(‘2007-04-29’,‘yyyy-mm-dd’),‘yyyy-mm-dd’)</td>
</tr>
<tr>
<td>DB2</td>
<td>char(1)</td>
<td>int(‘1’)</td>
<td>double(‘1.1’)</td>
<td>char(1.1)</td>
<td>date(‘2007-04-26’)</td>
<td>to_date(‘2007-04-26 08:08:08’,‘yyyy-mm-dd hh25:mi:ss’)</td>
<td>char(date(‘2007-04-29’))</td>
</tr>
<tr>
<td>兼容写法</td>
<td>cast(1 as char)</td>
<td>cast(‘1’ as int)</td>
<td>无</td>
<td>无</td>
<td>无</td>
<td>相同</td>
<td>无</td>
</tr>
</tbody>
</table>
<h3 id="Where条件弱类型判断">Where条件弱类型判断</h3>
<p>在<code>Oracle</code>中使用<code>&quot;Where 字符型字段 in (整型)&quot;</code>是允许的，<code>DB2</code>则会报错：</p>
<blockquote>
<p>SELECT ‘abc’ FROM XXX WHERE ‘1’ in (1) 在Oracle下可通过，在DB2中会报错。</p>
</blockquote>
<p>在<code>Oracle中</code>使用<code>&quot;Where 字符型字段=整型&quot;</code>是允许的，<code>DB2</code>则会报错：</p>
<blockquote>
<p>SELECT ‘abc’ FROM XXX WHERE ‘1’=1 在Oracle下可通过，在DB2中会报错。</p>
</blockquote>
<h3 id="DATE数据类型">DATE数据类型</h3>
<p><code>Oracle</code>中<code>DATE型</code>带有<code>时分秒</code>，但<code>DB2</code>下<code>DATE型</code>只带有<code>年月日</code>且可以作为字符串直接操作，<code>DB2</code>中要记录<code>时分秒</code>必须使用<code>时间戳型(TIMESTAMP)</code>, DB2的日期和时间戳都可以被直接用字符串指定。</p>
<h3 id="Decode函数">Decode函数</h3>
<p><code>Oracle</code>中使用<code>decode()</code>函数来做判断语句：</p>
<blockquote>
<p>decode(sex,0,‘男’,1.‘女’) 即为将sex域中的0换为男，1换为女。</p>
</blockquote>
<p>在<code>DB2</code>中要实现这个功能需要用<code>CASE WHEN</code>写法：</p>
<blockquote>
<p>CASE sex WHEN  0 THEN ‘男’ WHEN 1 THEN ‘女’ ELSE ‘其他’ END</p>
</blockquote>
<h3 id="NVL函数">NVL函数</h3>
<p>在<code>Oracle</code>中<code>NVL</code>函数主要用来处理空值，即将域中空值替换为指定值：</p>
<blockquote>
<p>SELECT NVL(F_AREAID,‘空’) FROM MASA_USER</p>
</blockquote>
<p>在<code>DB2</code>中需要使用兼容性写法<code>COALESCE</code></p>
<blockquote>
<p>SELECT COALESCE(F_AREAID,‘空’,F_AREAID) FROM MASA_USER</p>
</blockquote>
<h3 id="获取系统当前日期">获取系统当前日期</h3>
<p>在<code>Oracle</code>中使用<code>SYSDATE</code>,而在<code>DB2</code>中使用<code>CURRENT DATE</code></p>
<h3 id="获取特定数量的数据">获取特定数量的数据</h3>
<p>在<code>Oracle</code>中使用<code>ROWNUM</code>:</p>
<blockquote>
<p>SELECT * FROM TABLE WHERE ROWNUM &lt;= 10</p>
</blockquote>
<p>在<code>DB2</code>中使用<code>FETCH</code>：</p>
<blockquote>
<p>SELECT * FROM TABLE FETCH FIRST 10 ROWS ONLY</p>
</blockquote>
<h1>最后</h1>
<p>这一篇写了很久，主要是确实对数据库的理解不深，需要看的资料比较多，最后主要学到的对我来说有用的东西可能还是<code>操作层面</code>的<code>SQL语法</code>，如果以后的工作中还发现新的区别再来这里补充。</p>
]]></content>
      <categories>
        <category>数据分析</category>
      </categories>
      <tags>
        <tag>Database</tag>
        <tag>工作学习</tag>
      </tags>
  </entry>
  <entry>
    <title>[金融分析] CFA一级考试学习计划</title>
    <url>/2022/03/31/12-CFA-level-1-overview/</url>
    <content><![CDATA[<h1>序言</h1>
<p>虽然知道CFA考试对我目前的工作没有帮助，但考虑到作为&quot;数据科学家&quot;以后可能从事的行业并不单一，加之我各种金融相关的学术背景，还是准备几个认可度较高的证考一考相比其其他证性价比会更高一些，也开拓一下今后的发展空间。今天开始准备CFA一级的考试，先在这里做个计划，首先定下目标是通过2022年11月份的CFA一级考试，同时将日语与英语的学习时间以每周4:2:1的比例分配。</p>
<h1>正文</h1>
<p>CFA考试对我来说算是比较陌生的，虽然听考过的同学说一级基本都是大学学过的内容，但具体这是什么东西，要考哪些内容以及考试的形式等等都需要先了解一下。而从现在3月31日至11月之间还有7个月的时间，相比起盲目复习，还是有必要在开始之前规划一下每段时间的学习计划。</p>
<h2 id="成为持证人">成为持证人</h2>
<p>要成为一名认证的CFA持证人需要4步：</p>
<ol>
<li><code>通过CFA考试：</code>CFA计划由三级课程组成，每一级拥有各自的考试，通过三级考试是成为持证人的必要条件。</li>
<li><code>获得认证的工作经验：</code>工作经验可以在加入CFA计划前后的任何阶段完成，但工作经验必须与投资决策过程与投资相关。</li>
<li><code>提交介绍信：</code>要成为持证人还需要提供2-3封专业人员的介绍信，介绍你的工作经验和专业性。</li>
<li><code>提交申请：</code>最后要提交申请成为CFA协会成员，经核准后可以成为CFA持证人。</li>
</ol>
<h2 id="CFA考试介绍">CFA考试介绍</h2>
<p>本节的内容我都引自<a href="https://www.cfainstitute.org/" title="CFA Institute">CFA官网</a>，先弄清楚关于CFA考试的一些基本概念。CFA全称<code>特许金融分析师(Charted Financial Analyst)</code>，CFA协会是一家全球性投资专业人士会员组织，其为投资业发表研究成果，开展职业发展项目和制定自愿的、以道德为基础的专业和投资表现报告标准。其组织在全球160多个国家和地区拥有超过165000名CFA持证人。</p>
<h3 id="考试级别">考试级别</h3>
<p>CFA考试一共分为三级，分别为levelⅠ，levelⅡ和levelⅢ，他们的对比如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>levelⅠ</th>
<th>levelⅡ</th>
<th>levelⅢ</th>
</tr>
</thead>
<tbody>
<tr>
<td>必要条件</td>
<td>CFA登记入门要求</td>
<td>通过levelⅠ考试</td>
<td>通过levelⅡ考试</td>
</tr>
<tr>
<td>问题形式</td>
<td>单项选择题</td>
<td>基于案例的单项选择题</td>
<td>基于案例的简答题和单项选择题</td>
</tr>
<tr>
<td>结果通知时间</td>
<td>考试结束60天内</td>
<td>考试结束60天内</td>
<td>考试结束90天内</td>
</tr>
<tr>
<td>10年平均通过率</td>
<td>42%</td>
<td>45%</td>
<td>54%</td>
</tr>
</tbody>
</table>
<h3 id="考试形式">考试形式</h3>
<p>从2021年起CFA考试形式从笔试改为机考。选定考试月份后，可以根据自己需求选择考试时间和地点，选定后如果要更改时间需要多花250美元费用。CFA一级考试总题量180个，考试时间长度共4.5小时：</p>
<ul>
<li>30分钟宣誓，指导和调研</li>
<li>135分钟完成第一部分</li>
<li>中途休息30分钟</li>
<li>135分钟完成第二部分</li>
</ul>
<p>考试可以允许使用计算器，但计算器只能是Texas Instruments BA II Plus 或 Hewlett Packard 12C。同一个参试者两次考试中间间隔时间不能短于6个月，也即不论是未通过考试重考或是通过考试参加下级考试都必须预约6个月以后的考试。</p>
<h3 id="考试内容">考试内容</h3>
<p>考试一共涵盖十个科目，每级考试中各个科目内容的比重不同，首先介绍一些这些科目的大致内容：</p>
<h4 id="道德和职业标准-Ethical-and-Professional-Standards">道德和职业标准(Ethical and Professional Standards)</h4>
<p>这科重点内容包括道德，道德行为相关的挑战以及投资行业的职业道德标准。</p>
<h4 id="量化方法-Quantitative-Methods">量化方法(Quantitative Methods)</h4>
<p>这科内容主要包括金融分析和投资决策中使用的量化方法与技术。将投资回报分布的重要特征包括集中趋势，位置，和分散度等重要的数据属性以描述性的统计数字方式展示。内容还包括概率论及其在投资决策中的风险量化中的应用。</p>
<h4 id="经济学-Economics">经济学(Economics)</h4>
<p>在这部分中，我们首先会介绍单一消费者和公司供需关系的基本概念分析。我们还会涵盖公司运营的不同市场结构，宏观经济学原理和概念，包括总产量，收入水平衡量，总供需分析，以及经济增长因素分析等。最后还有一些商业周期和他们对经济活动的影响等。</p>
<h4 id="财务报表分析-Financial-Statement-Analysis">财务报表分析(Financial Statement Analysis)</h4>
<p>该科目在2020年叫<code>财务报告和分析</code>，在本部分我们提供财务报告过程和财务披露标准的解释，其中主要强调基本的财务报表知识以及一些不同的会计方法会对财务报表产生的影响及分析方法。我们主要考察主要财务报表并提供财务报表分析的基本方法。</p>
<h4 id="公司发行人-Corporate-Issuers">公司发行人(Corporate Issuers)</h4>
<p>该科目在2020年叫<code>公司金融</code>，这部分中我们主要介绍公司治理和投资金融决策等。我们会介绍分析和理解公司治理和股东管理的主要知识，并且介绍环境和社会观点对投资越来越大的冲击。我们还会介绍公司使用对资产负债结构的调整来实现他们的短期运营需要。</p>
<h4 id="股权投资-Equity-Investments">股权投资(Equity Investments)</h4>
<p>我们在这部分主要涵盖了股权投资，证券市场，和指数交易等等内容，并且介绍如何分析行业，公司，股票证券以及基本的股权估值模型。投资全球性的资产对于长期投资回报与多样化目标非常重要。</p>
<h4 id="固定收益-Fixed-Income">固定收益(Fixed Income)</h4>
<p>在这部分我们主要介绍固定收益证券产品和他们的市场，回报衡量，风险因子，估值方式和驱动因子等等。我们还会介绍回报和固收证券的计算方法，资产的证券化，债券回报和风险的基本知识以及信用风险的基本原理和分析。</p>
<h4 id="衍生品-Derivatives">衍生品(Derivatives)</h4>
<p>在这科中我们主要介绍一些基础金融衍生品以及衍生品市场的框架知识，然后我们会介绍诸如期货，期权，远期，互换交易和或有债权等衍生品的重要特征以及定价原理等等。最后我们会研究金融衍生品使用无风险套利模型定价的方法。</p>
<h4 id="另类投资-Alternative-Investments">另类投资(Alternative Investments)</h4>
<p>这部分内容介绍包括对冲基金，私人资产，房地产，货物和基础设施等另类投资。我们主要讨论如何使用另类投资做投资多样化并实现更高的投资回报。</p>
<h4 id="投资组合管理及理财-Portfolio-Management-and-Wealth-Planning">投资组合管理及理财(Portfolio Management and Wealth Planning)</h4>
<p>在此科目中我们会他讨论投资组合和风险管理的基础知识，包括投资回报，风险指标，投资组合规划和搭建。我们主要考察个体和机构投资者在可用的投资解决方案中满足他们的需要。我们使用资本资产定价模型(CAPM)来优化组合风险。</p>
<p>看过各科目介绍后发现确实除了<code>道德标准</code>和<code>另类投资</code>两科以外，其他都是本科和一硕反复学反复考的内容，同学说裸考通过我也不是很奇怪了。这几科内容在三级考试中的占比各有不同：</p>
<table>
<thead>
<tr>
<th></th>
<th>levelⅠ</th>
<th>levelⅡ</th>
<th>levelⅢ</th>
</tr>
</thead>
<tbody>
<tr>
<td>道德和职业标准</td>
<td>15-20</td>
<td>10-15</td>
<td>10-15</td>
</tr>
<tr>
<td>量化方法</td>
<td>8-12</td>
<td>5-10</td>
<td>0</td>
</tr>
<tr>
<td>经济学</td>
<td>8-12</td>
<td>5-10</td>
<td>5-10</td>
</tr>
<tr>
<td>财务报表分析</td>
<td>13-17</td>
<td>10-15</td>
<td>0</td>
</tr>
<tr>
<td>公司发行人</td>
<td>8-12</td>
<td>5-10</td>
<td>0</td>
</tr>
<tr>
<td>股权投资</td>
<td>10-12</td>
<td>10-15</td>
<td>10-15</td>
</tr>
<tr>
<td>固定收益</td>
<td>10-12</td>
<td>10-15</td>
<td>15-20</td>
</tr>
<tr>
<td>衍生品</td>
<td>5-8</td>
<td>5-10</td>
<td>5-10</td>
</tr>
<tr>
<td>另类投资</td>
<td>5-8</td>
<td>5-10</td>
<td>5-10</td>
</tr>
<tr>
<td>投资组合管理及理财</td>
<td>5-8</td>
<td>10-15</td>
<td>35-40</td>
</tr>
</tbody>
</table>
<p>能够看出来考试不同阶段对考生不同方面的能力要求是有变化的，前两级对各个科目的能力都有考察，而级别越低其对基本知识和能力的考察越多，到第三级则侧重考研参试者的实战投资组合管理等能力。</p>
<h3 id="考试费用">考试费用</h3>
<p>第一次参加考试的人员需要缴纳450美元的注册费，在此之上2023年2月之前的考试，每次考试的考试费为1000美元，如果提前6个月预约考试可以得到300美元折扣，即700美元的早鸟考试费。从2023年2月的考试开始，注册费会调整为350美金，而早鸟考试费和标准考试费会分别上涨到900美元和1200美元。</p>
<h2 id="学习计划">学习计划</h2>
<p>参考网上各位大神的经验，我计划分两轮复习，第一轮从4月1日至7月31日，第二轮从8月1日至9月30日，剩下一个月时间主要做题目模考，查漏补缺。</p>
<p>关于第一轮复习时间安排，我计划先从自己以前学得不牢但分数占比较高的部分学起：</p>
<table>
<thead>
<tr>
<th>月份</th>
<th>主要学习科目</th>
</tr>
</thead>
<tbody>
<tr>
<td>4月</td>
<td>财务报表分析</td>
</tr>
<tr>
<td>5月</td>
<td>公司发行人，经济学</td>
</tr>
<tr>
<td>6月</td>
<td>股权投资，固定收益，衍生品，另类投资</td>
</tr>
<tr>
<td>7月</td>
<td>量化方法，投资组合管理及理财，道德和职业标准</td>
</tr>
</tbody>
</table>
<h1>最后</h1>
<p>CFA不是我唯一的学习目标，所以我不会拿出所有的精力学它，我每周安排四天，每天1-2小时的学习时间，每周的其他3天我将安排日语和英语的学习。上面的这份学习计划，我会根据实际情况调整。</p>
]]></content>
      <categories>
        <category>金融分析</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>CFA一级</tag>
      </tags>
  </entry>
  <entry>
    <title>[MS Office]使用 MS Access 开发文档管理查询工具</title>
    <url>/2022/03/27/11-MSAccess-documentation-tool/</url>
    <content><![CDATA[<h1>序言</h1>
<p>初次来到这家公司就发现公司的<code>文档记录</code>不太完备，很多<code>数据概念</code>和<code>数据库定义</code>要么模棱两可要么需要询问老员工，这乍看起来是个不影响干活的小事但实际上这不仅可能造成工作效率低下的结果，甚至可能导致<code>严重的问题</code>(类似于报告口径不一，数据结果错误导致决策错误或公司声誉受损等等)，因此这其实是一个<code>风险暴露</code>。我也因此决定至少给我们自己团队做一个<code>文档数据库</code>来设立一个可以参考标准口径，避免一些不必要的风险，同时加强同事日常工作和交接的效率与质量。</p>
<p>我虽然不是第一次接触VBA但其实这是我第一次接触<code>Access数据库</code>的应用开发，整个工具开发花了我接近七八天的时间，学到的东西也不少。在这篇文章中我会首先介绍一下工具本身的功能，然后是我学习到的Access应用开发的一些基本知识，以及介绍我在实现一些功能时用到的一些VBA代码。</p>
<h1>正文</h1>
<p>本文会直接介绍<code>工具的功能</code>及<code>开发中学习到的知识</code>，以及一些功能的<code>代码实现方法</code>。关于Access中各对象基本定义及功能的介绍可以去我的另一篇文章<a href="http://raylei.space/2022/02/25/6-MSAccess_database_split/">分割 MS Access 数据库为前端和后端</a>看看。</p>
<h2 id="工具结构">工具结构</h2>
<p>目前这个文档工具有3个主要的文档数据库：</p>
<ol>
<li><code>Key Measurements SQL：</code>记录了日常业务中可能涉及的主要术语与指标的定义及其SQL样例。</li>
<li><code>Database Documentation：</code>记录了团队经常使用的数据库表及相应各个字段的详细信息。</li>
<li><code>Marco Polo Dashboards：</code>记录了公司Tableau平台上的Dashboards的网址, 详细信息及使用方法。</li>
</ol>
<p>其中前两个文档只需要实现名字的查询即可，而第三个<code>Tableau Dashboard</code>我则希望可以实现信息关键词的查询，因为团队中有些同事的数据查询需求其实已经在<code>Tableau</code>上有查询模板，我希望增加这个功能可以使用户通过他们需求的关键字可以查询到能帮助他们的<code>Dashboard</code>。</p>
<p>另外我为工具设置了<code>两个主要入口</code>，一个供<code>数据维护者</code>使用，使用<code>分割窗体(Split form)</code>，用户可以在界面中进行数据的<code>增删改查</code>，包括对工具本身的版本记录进行修改。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/1.gif" alt="维护端界面演示"></p>
<p>另一个则是供<code>其他同事</code>使用，界面更为简洁，用户从下拉菜单中选择要查询的数据，并且可以通过不同的方式筛选出要<code>查询</code>的数据，但没有增删改已有数据的权限。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/2.gif" alt="用户端界面演示"></p>
<h2 id="Access表单工具开发基础知识">Access表单工具开发基础知识</h2>
<p>Access的基本概念和定义我已经在第6篇博文中介绍过，在本节中我会注重介绍一些开发表单工具可能需要知道的基础知识，有了这些基本知识，稍加摸索尝试就可以很快上道了。</p>
<h3 id="四种视图">四种视图</h3>
<p>要做Access的<code>表单(Form)工具</code>开发首先要搞清楚的是四种不同的<code>视图(View)</code>各自的作用及用法。在表单下通过<code>开始(Home)选项卡</code>中<code>视图(View)组</code>中的视图切换视图，四种不同的视图的用法和用处各有不同：</p>
<ul>
<li><code>窗体视图(Form View)：</code>该视图下表单即为用户正常使用的状态，没有开发者选项，开发者可以在该视图下测试表单是否如预期运行。</li>
<li><code>数据表视图(Datasheet View)：</code>该视图下表单主要显示该表单的数据信息，呈现方式与表(Table)中相同，开发者可以用该视图检视表单的数据信息。</li>
<li><code>布局视图(Layout View)：</code>该视图下表单可以呈现窗体视图外观的同时不触发控件事件，在该视图下开发者依然可以通过属性栏配置表单。通常使用这个视图调整一些与表单外观有关的功能会得到比较直观的反馈。</li>
<li><code>设计视图(Design View)：</code>该视图下的表单会呈现出更多更详细的信息，例如表单的高度宽度尺，格线，页眉和页脚，该视图下可以调整的参数会多于布局视图但修改可能不会太直观。</li>
</ul>
<h3 id="属性表">属性表</h3>
<p>Access中对表单的各方面配置都可以在<code>属性表(Property Sheet)</code>中完成，在<code>布局或设计视图</code>下右键单击表单，选择<code>属性(Property)</code>便会弹出当前控件的可调整属性，其中拥有自己属性的对象除了各种<code>控件(Control)</code>以外，还有<code>表单(Form)</code>，<code>页眉(Header)</code>，<code>页脚(Footer)</code>和<code>主体(Detail)</code>。</p>
<p>属性表中会显示当前选择的对象的类型（<code>控件类型或窗体(Form)或节(Section)</code>）及名称，而每个对象的配置参数又分为4个<code>选项卡</code>：<br>
<code>格式(Format)：</code>在该选项卡中可以调整对象的外观参数以及一些控件的显示。</p>
<p><code>数据(Data)：</code>该选项卡内容涉及数据显示相关设置，如数据源，默认值，数据验证或其他数据相关的配置。</p>
<p><code>事件(Event)：</code>该选项卡主要涉及各种触发事件，开发者可以在不同的事件中加入宏或VBA代码来实现各种功能。</p>
<p><code>其他(Other)：</code>基本上其他类找不到的参数设置就在这里找。</p>
<h3 id="宏和VBA代码">宏和VBA代码</h3>
<p>Access中有<code>宏(Macro)</code>和<code>VBA代码(Code)</code>的<code>生成器(Builder)</code>，在控件的事件选项卡中点击<code>...</code>按键就可以进入生成器选择窗口，而宏和代码都可以一定程度上完成对某个事件的编程，他们的区别在于功能性和复杂度上。<code>宏</code>使用已经定义好的动作模块来设定事件动作，<code>简单快捷但自由度受限</code>，而<code>VBA代码</code>则需要开发者更高的代码能力，但能够实现更加<code>复杂的事件任务</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/macro.jpg" alt="宏界面"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/vba_code.jpg" alt="vba界面"></p>
<p>在我们的工具中一些功能的实现结合了宏和VBA代码两种方式的使用。</p>
<h2 id="部分功能的代码实现">部分功能的代码实现</h2>
<p>我们的工具中每一个<code>按钮控件(Button Control)</code>都会涉及一个或多个代码块，但有些功能确实很简单我就不详细说了，这里我挑几个我觉得需要注意或者花了我一些功夫才写好的功能，那就由简及难一一介绍一下吧。</p>
<h3 id="控制分割窗体的宽度">控制分割窗体的宽度</h3>
<p>当我们设置表单的格式为<code>分割窗体(Split form)</code>时，我们无论在视图中如何调节它的宽度它在被打开时都会自动占满屏幕，这会减弱我们做出来的工具在不同设备上呈现的一致性，让我非常不爽。查了一下之后发现原来分割窗口的宽度可以用<code>MoveSize方式</code>调整。根据微软的官方文档，<code>MoveSize</code>的使用方法如下，其中数值的单位为<code>twip</code>：</p>
<blockquote>
<p><em>expression</em>.<strong>MoveSize</strong> (<em>Right</em>, <em>Down</em>, <em>Width</em>, <em>Height</em>)</p>
</blockquote>
<p>那么我们只需要在表单的<code>加载(On Load)</code>事件中加上这个表达就可以实现打开表单时自动调整宽度。</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form_Load()</span><br><span class="line">	DoCmd.MoveSize , , <span class="number">7</span> * <span class="number">1600</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<h3 id="设置打开Zoombox按钮">设置打开Zoombox按钮</h3>
<p>我的文档工具中因为涉及较长文本的输入，而且会有比较多的主动换行，因此直接在窗口文本框输入可能不太方便编辑，一般情况下用户可以在文本框中按<code>Shift+F2</code>的快捷键组合来打开当前文本框的<code>Zoombox</code>，用户可以在这个更大的窗口中编辑文字，查询时内容展示也更加清晰明了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/3.gif" alt="Zoombox按钮演示"></p>
<p>但显然快捷键组合对于普通用户来说有些过于繁琐了，因此我加了一个按钮，可以使用户在选择文本框后点击该按钮来打开这个文本框的<code>Zoombox</code>，只是在代码实现上稍微一些小小的注意事项，因为按钮本身是不具备<code>启动Zoombox</code>这个属性的，因此我们要将<code>focus</code>设定在点击按钮前的一个控件上，我的代码如下：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Text_zoom_Click()</span><br><span class="line">    <span class="keyword">Const</span> NOT_ZOOMABLE = <span class="number">2046</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    Screen.PreviousControl.SetFocus</span><br><span class="line">    RunCommand acCmdZoomBox</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Select</span> <span class="keyword">Case</span> Err.Number</span><br><span class="line">        <span class="keyword">Case</span> <span class="number">0</span></span><br><span class="line">        <span class="comment">&#x27; no error</span></span><br><span class="line">        <span class="keyword">Case</span> NOT_ZOOMABLE</span><br><span class="line">        MsgBox (<span class="string">&quot;Please select a TextBox before zoom in!&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">Case</span> <span class="keyword">Else</span></span><br><span class="line">        <span class="comment">&#x27;unanticipated error - inform user</span></span><br><span class="line">        MsgBox Err.Description, vbExclamation, <span class="string">&quot;Error&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>简单来说就是点击按钮后对点击前的控件执行<code>acCmdZoomBox</code>即<code>打开Zoombox</code>的命令，而如果在按按钮前点击的控件不具备这个功能，程序会返回<code>错误代码2046</code>，如果捕捉到这个错误代码就弹出<code>“请先选择一个要放大的文本框”</code>提示。</p>
<h3 id="查找筛选符合条件的数据">查找筛选符合条件的数据</h3>
<p>为了方便用户<code>查改数据</code>，我需要给表单加入<code>搜索</code>的功能，比较方便的方法就是使用表单中的<code>筛选功能</code>，通过<code>关键字搭配通配符</code>在不同的<code>字段</code>筛选便可以找出符合条件的数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/4.gif" alt="关键字筛选演示"></p>
<p>而对于工具的数据维护界面我使用的是<code>分割表单</code>，因此只要将需要的数据筛选出来，用户就可以在分割窗口中选择自己想要编辑的记录来操作。代码块如下：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> find_record_Click()</span><br><span class="line">    <span class="keyword">Dim</span> category_search_term <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> dashboard_search_term <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> category_null <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> dashboard_null <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; for each null input, filter for every entry by sending * or IS NULL</span></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">If</span> IsNull(category_search) <span class="keyword">Then</span></span><br><span class="line">        category_search_term = <span class="string">&quot;&quot;</span></span><br><span class="line">        category_null = <span class="string">&quot; OR [MP Category] IS NULL&quot;</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        category_search_term = category_search.Value</span><br><span class="line">        category_null = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">If</span> IsNull(dashboard_search) <span class="keyword">Then</span></span><br><span class="line">        dashboard_search_term = <span class="string">&quot;&quot;</span></span><br><span class="line">        dashboard_null = <span class="string">&quot; OR [MP Dashboard] IS NULL&quot;</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        dashboard_search_term = dashboard_search.Value</span><br><span class="line">        dashboard_null = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Me</span>.Filter = <span class="string">&quot;([MP Category] LIKE &#x27;*&quot;</span> &amp; category_search_term &amp; <span class="string">&quot;*&#x27; &quot;</span> &amp; category_null &amp; <span class="string">&quot;) AND &quot;</span> _</span><br><span class="line">    &amp; <span class="string">&quot;([MP Dashboard] LIKE &#x27;*&quot;</span> &amp; dashboard_search_term &amp; <span class="string">&quot;*&#x27; &quot;</span> &amp; dashboard_null &amp; <span class="string">&quot;)&quot;</span></span><br><span class="line">    <span class="keyword">Me</span>.FilterOn = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Select</span> <span class="keyword">Case</span> Err.Number</span><br><span class="line">        <span class="keyword">Case</span> <span class="number">0</span></span><br><span class="line">        <span class="comment">&#x27; no error</span></span><br><span class="line">        <span class="keyword">Case</span> <span class="keyword">Else</span></span><br><span class="line">        <span class="comment">&#x27;unanticipated error - inform user</span></span><br><span class="line">        MsgBox Err.Description, vbExclamation, <span class="string">&quot;Error&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>需要注意的一点是，因为<code>筛选</code>需要使用表单上的<code>文本框</code>输入内容，因此在直接使用<code>TextBox.Value</code>获取内容时可能会出现<code>空值报错</code>，而同时如果仅仅只将筛选值以<code>&quot;&quot;</code>形式传给筛选条件的话，筛选会以<code>&quot;Field LIKE '**'&quot;</code>的条件筛选，这时筛选出的内容会<code>不包括内容为空的记录</code>，这在用户端可能无所谓，毕竟如果指针列的字段都为空很可能说明这条记录本身就没有完成，所以筛选出来也没有意义。但在维护端如果筛选不出字段为空的记录的话就会导致未完成的记录再也不能被筛选出来。</p>
<p>因此我在筛选器的语句中除了加入要筛选的内容外，还多了一重判断<code>“若输入为空，则在筛选条件中加入语句OR Field IS NULL”</code>以此筛选出该字段为空的记录。筛选器设置好后再用<code>Me.FilterOn = True</code>的语句将该设置应用在表单上筛选才会生效。这样就完成了记录筛选查找功能。</p>
<h3 id="通过关键字限制组合框内容">通过关键字限制组合框内容</h3>
<p>在维护端要筛选出符合特定条件的记录可以直接筛选后在分割窗口中选择想要操作的数据，但在客户端我不希望使用分割窗体这么<code>&quot;复杂&quot;</code>的功能，我希望给用户更加简单易懂的操作界面。因此出现了我在这个工具开发中想出来的最有意思的一段代码和功能。那就是通过关键字搜索来限制<code>组合框(ComboBox)</code>中的显示内容，并且通过组合框的中值的选择来定位记录。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/5.gif" alt="组合框选择记录演示"></p>
<p>最开始实现这个功能我是希望可以将在上一节的筛选后的<code>记录集(RecordSet)</code>填入组合框的<code>行来源(Row Source)</code>，结果找了半天也没有发现<code>Access VBA</code>有这个操作方法。因此我想到的办法是在<code>查找记录</code>控件的筛选记录功能之上再加入一个获取筛选出的记录的索引并<code>新建一个表</code>，然后直接将<code>行来源</code>的引用关联到这个新建的表中不就可以实现实时控制组合框内容了吗？测试了一下真的挺好用。代码如下：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> search_dashboard_Click()</span><br><span class="line">    <span class="keyword">Dim</span> category_search_term <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> dashboard_search_term <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; for each null input, filter for every entry by sending *</span></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="keyword">If</span> IsNull(category_search) <span class="keyword">Then</span></span><br><span class="line">        category_search_term = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        category_search_term = category_search.Value</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">If</span> IsNull(dashboard_search) <span class="keyword">Then</span></span><br><span class="line">        dashboard_search_term = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        dashboard_search_term = dashboard_search.Value</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; Disconnect the combobox with the list table before deleting it.</span></span><br><span class="line">    <span class="keyword">If</span> <span class="built_in">Not</span> Combo_Dashboard_Lookup.RowSource = <span class="string">&quot;&quot;</span> <span class="keyword">Then</span></span><br><span class="line">        Combo_Dashboard_Lookup.RowSource = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; Delete the combobox list table if it exists</span></span><br><span class="line">    <span class="keyword">If</span> TableExists(<span class="string">&quot;combo_dashboard&quot;</span>) <span class="keyword">Then</span></span><br><span class="line">        DoCmd.DeleteObject acTable, <span class="string">&quot;combo_dashboard&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27;make a table that store the index for this search and fill in the combobox row source with the result</span></span><br><span class="line">    strSQL = <span class="string">&quot;SELECT ID,[MP Category], [MP Dashboard] INTO combo_dashboard FROM Marco_Polo_Dashboards &quot;</span> &amp; _</span><br><span class="line">    <span class="string">&quot;WHERE [MP Category] LIKE &#x27;*&quot;</span> &amp; category_search_term &amp; <span class="string">&quot;*&#x27; &quot;</span> &amp; _</span><br><span class="line">    <span class="string">&quot;AND [MP Dashboard] LIKE &#x27;*&quot;</span> &amp; dashboard_search_term &amp; <span class="string">&quot;*&#x27; &quot;</span> &amp; _</span><br><span class="line">    <span class="string">&quot;ORDER BY [MP Category], [MP Dashboard];&quot;</span></span><br><span class="line">    CurrentDb.Execute strSQL</span><br><span class="line">    Combo_Dashboard_Lookup.RowSource = <span class="string">&quot;SELECT ID,[MP Category], [MP Dashboard] FROM combo_dashboard ORDER BY [MP Category], [MP Dashboard]; &quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; filter the records based on search terms too</span></span><br><span class="line">    <span class="keyword">Me</span>.Filter = <span class="string">&quot;[MP Category] LIKE &#x27;*&quot;</span> &amp; category_search_term &amp; <span class="string">&quot;*&#x27; AND &quot;</span> _</span><br><span class="line">    &amp; <span class="string">&quot;[MP Dashboard] LIKE &#x27;*&quot;</span> &amp; dashboard_search_term &amp; <span class="string">&quot;*&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">Me</span>.FilterOn = <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Select</span> <span class="keyword">Case</span> Err.Number</span><br><span class="line">        <span class="keyword">Case</span> <span class="number">0</span></span><br><span class="line">        <span class="comment">&#x27; no error</span></span><br><span class="line">        <span class="keyword">Case</span> <span class="keyword">Else</span></span><br><span class="line">        <span class="comment">&#x27;unanticipated error - inform user</span></span><br><span class="line">        MsgBox Err.Description, vbExclamation, <span class="string">&quot;Error&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>这段代码中需要注意的点有几个：</p>
<ol>
<li>与维护端相比，用户端中我<code>去掉了筛选出空值记录</code>的功能，因为如果内容为空那么大概率这条记录还没有完成，不需要被用户查到。</li>
<li>关于<code>组合框</code>的<code>行来源</code>，我在表的<code>加载(On Load)</code>事件中加入了向<code>组合框行来源</code>中添加原表中所有引索的SQL语句，然后在<code>关闭(On close)</code>事件中加入了<code>清除行来源</code>并删除临时表的代码。这样可以保证为了查找引索而创建的临时表只在表单被打开的时候存在。</li>
<li>临时表中的<code>引索</code>和<code>记录集</code>中的记录被以同样的方式<code>排序</code>和<code>筛选</code>，以此保证筛选出来的记录与组合框中的待选记录在顺序和内容上都相同。</li>
<li>最后要实现组合框中的数据控制显示的记录有两种方式，一种比较简单的是通过<code>控件向导</code>添加<code>组合框</code>，其中有选择是否使用<code>组合框</code>控制记录显示。而第二种则是直接写<code>宏或代码</code>，因为其实控件向导实现这个功能的方法也就是在<code>“更新后(On Update)”</code>事件中添加一个<code>以当前组合框选择的记录ID</code>来查找记录的宏。</li>
</ol>
<h3 id="多关键字查询筛选记录">多关键字查询筛选记录</h3>
<p>完成了基本的查询功能之后，我还希望在<code>Tableau Dashboard</code>的文档工具中再加上一个<code>多关键字查询</code>的功能，我的设想是使用多个<code>AND条件</code>在<code>Description字段</code>中筛选用空格隔开的<code>每一个关键词</code>，这样如果用户想要找到一张可以看到<code>“CCBA YoY GWP”</code>的<code>Dashboard</code>，他只需要输入后就可以找到<code>Description</code>中同时出现了这几个关键词的记录，从而帮助用户快速定位他们需要的<code>Dashboard</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/6.gif" alt="关键词搜索演示"></p>
<p>而代码的实现逻辑也非常简单，即使利用上节中使用的限制组合框筛选数据的原理，只不过对于提取新建引索表的SQL语句需要根据输入框中的关键词循环一下，其中第一个词前用<code>WHERE DESCRIPTION LIKE '*FIRSTWORD*'</code>的格式而后面其他词则用<code>AND</code>替代<code>WHERE</code>。具体代码如下：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> search_keywords_Click()</span><br><span class="line">    <span class="keyword">Dim</span> keywords_search_term <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> arrKeywords</span><br><span class="line">    <span class="keyword">Dim</span> varKeyword</span><br><span class="line">    <span class="keyword">Dim</span> strSQL <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> strFilter <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; for each null input, filter for every entry by sending *</span></span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    <span class="comment">&#x27; if the key words are empty, select all records.</span></span><br><span class="line">    <span class="keyword">If</span> IsNull(keywords_search) <span class="keyword">Then</span></span><br><span class="line">        strSQL = <span class="string">&quot;SELECT ID,[MP Category], [MP Dashboard] INTO combo_dashboard FROM Marco_Polo_Dashboards &quot;</span> &amp; _</span><br><span class="line">            <span class="string">&quot;ORDER BY [MP Category], [MP Dashboard];&quot;</span></span><br><span class="line">        strFilter = <span class="string">&quot;Description LIKE &#x27;**&#x27;&quot;</span></span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">    <span class="comment">&#x27; looping the keywords input add &quot;AND&quot; criterias for each keyword.</span></span><br><span class="line">        strSQL = <span class="string">&quot;SELECT ID,[MP Category], [MP Dashboard] INTO combo_dashboard FROM Marco_Polo_Dashboards &quot;</span></span><br><span class="line">        arrKeywords = Split(keywords_search.Value, <span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">Dim</span> loopOne <span class="keyword">As</span> <span class="type">Boolean</span></span><br><span class="line">        loopOne = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">For</span> <span class="keyword">Each</span> varKeyword <span class="keyword">In</span> arrKeywords</span><br><span class="line">            <span class="comment">&#x27; In the first loop, use WHERE and afterwards use AND to complete the SQL sentence.</span></span><br><span class="line">            <span class="keyword">If</span> <span class="built_in">Not</span> varKeyword = <span class="string">&quot;&quot;</span> <span class="built_in">And</span> loopOne <span class="keyword">Then</span></span><br><span class="line">                strSQL = strSQL &amp; <span class="string">&quot; WHERE Description LIKE &#x27;*&quot;</span> &amp; varKeyword &amp; <span class="string">&quot;*&#x27;&quot;</span></span><br><span class="line">                strFilter = <span class="string">&quot;Description LIKE &#x27;*&quot;</span> &amp; varKeyword &amp; <span class="string">&quot;*&#x27;&quot;</span></span><br><span class="line">                loopOne = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">ElseIf</span> <span class="built_in">Not</span> varKeyword = <span class="string">&quot;&quot;</span> <span class="built_in">And</span> <span class="built_in">Not</span> loopOne <span class="keyword">Then</span></span><br><span class="line">                strSQL = strSQL &amp; <span class="string">&quot; AND Description LIKE &#x27;*&quot;</span> &amp; varKeyword &amp; <span class="string">&quot;*&#x27;&quot;</span></span><br><span class="line">                strFilter = strFilter &amp; <span class="string">&quot; AND Description LIKE &#x27;*&quot;</span> &amp; varKeyword &amp; <span class="string">&quot;*&#x27;&quot;</span></span><br><span class="line">            <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">        <span class="keyword">Next</span></span><br><span class="line">        <span class="comment">&#x27; sort the records in ascending order</span></span><br><span class="line">        strSQL = strSQL &amp; <span class="string">&quot; ORDER BY [MP Category], [MP Dashboard];&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; Disconnect the combobox with the list table before deleting it.</span></span><br><span class="line">    <span class="keyword">If</span> <span class="built_in">Not</span> Combo_Dashboard_Lookup.RowSource = <span class="string">&quot;&quot;</span> <span class="keyword">Then</span></span><br><span class="line">        Combo_Dashboard_Lookup.RowSource = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&#x27; Delete the combobox list table if it exists</span></span><br><span class="line">    <span class="keyword">If</span> TableExists(<span class="string">&quot;combo_dashboard&quot;</span>) <span class="keyword">Then</span></span><br><span class="line">        DoCmd.DeleteObject acTable, <span class="string">&quot;combo_dashboard&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    CurrentDb.Execute strSQL</span><br><span class="line">    Combo_Dashboard_Lookup.RowSource = <span class="string">&quot;SELECT ID,[MP Category], [MP Dashboard] FROM combo_dashboard ORDER BY [MP Category], [MP Dashboard]; &quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; filter the records based on search terms too</span></span><br><span class="line">    <span class="keyword">Me</span>.Filter = strFilter</span><br><span class="line">    <span class="keyword">Me</span>.FilterOn = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Select</span> <span class="keyword">Case</span> Err.Number</span><br><span class="line">        <span class="keyword">Case</span> <span class="number">0</span></span><br><span class="line">        <span class="comment">&#x27; no error</span></span><br><span class="line">        <span class="keyword">Case</span> <span class="keyword">Else</span></span><br><span class="line">        <span class="comment">&#x27;unanticipated error - inform user</span></span><br><span class="line">        MsgBox Err.Description, vbExclamation, <span class="string">&quot;Error&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>到这里基本上这个小工具中值得讲的东西就都讲完了。</p>
<h2 id="工具下载">工具下载</h2>
<p>我把一个只有测试内容的<code>副本</code>放在这里，有兴趣的可以打开看看每个部分功能具体是怎么实现的：</p>
<p>下载链接：<a href="/attachment/BancaDB_Documentation.accdb">点击这里</a></p>
<p>因为是第一次接触<code>Access</code>的VBA编程，我其实也发现了一些不好的编程习惯导致的不方便的情况，比如看网上大家的代码，有一个<code>约定俗成的规矩</code>是大家会在不同控件名称前加上这个控件的<code>类型简称</code>，比如<code>表A</code>命名为<code>tblA</code>,但我刚开始编的时候并没有意识到这个对读改代码有多重要，现在再改又比较麻烦了，各位先担待着，下次不会这样了。</p>
<h1>最后</h1>
<p>个人觉得通过这样一个小小的项目在一定程度上掌握了<code>数据库小应用的开发</code>是非常好的，以后面对某些难题又多了一个可能的解决方案，例如需要向客户定期收集资料时，可以做一个<code>Access前端</code>然后将表放在<code>SharePoint List</code>上，这样客户在前端收集到的资料就可以第一时间传送到云上的数据库中，这会比邮件沟通更大程度地增加<code>效率</code>和<code>用户体验</code>。</p>
<p>[第11篇]</p>
]]></content>
      <categories>
        <category>MS Office</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Access</tag>
        <tag>VBA</tag>
      </tags>
  </entry>
  <entry>
    <title>[金融分析] CFA一级《财务报表分析》学习笔记</title>
    <url>/2022/04/06/13-CFA-level1-financial-statement-analysis/</url>
    <content><![CDATA[<h1>概览</h1>
<p>财务报表分析一共包括4个Session的12个Reading，各个Reading的内容如下表：</p>
<table>
    <tr>
        <th>Sessions</th>
        <th>Readings</th>
        <th>Contents</th>
    </tr>
    <tr>
        <td rowspan="2">SS6</td>
        <td>R19</td>
        <td>Introduction to Financial  Statement Analysis</td>
    </tr>
    <tr>
        <td>R20</td>
        <td>Financial Reporting Standards</td>
    </tr>
    <tr>
        <td rowspan="4">SS7</td>
        <td>R21</td>
        <td>Understanding the I/S</td>
    </tr>
    <tr>
        <td>R22</td>
        <td>Understanding the B/S</td>
    </tr>
    <tr>
        <td>R23</td>
        <td>Understanding the C/F</td>
    </tr>
    <tr>
        <td>R24</td>
        <td>Financial Analysis Techniques</td>
    </tr>
    <tr>
        <td rowspan="4">SS8</td>
        <td>R25</td>
        <td>Inventories</td>
    </tr>
    <tr>
        <td>R26</td>
        <td>Long-Lived Assets</td>
    </tr>
    <tr>
        <td>R27</td>
        <td>Income Taxes</td>
    </tr>
    <tr>
        <td>R28</td>
        <td>Long-Term Liabilities and Leases</td>
    </tr>
    <tr>
        <td rowspan="2">SS9</td>
        <td>R29</td>
        <td>Financial Reporting Quality</td>
    </tr>
    <tr>
        <td>R30</td>
        <td>Financial Statement Analysis: Applications</td>
    </tr>
</table>
<p>其中该科目的重要考点主要集中在Session7和Session8,占考点总数的80-90%。从下面开始我会把每个Reading的知识点和重要考点一一整理记录下来。</p>
<h1>Session 6</h1>
<p>本Session中主要涉及的是财务报表分析的一些概况型知识，其中R19主要介绍公司财务各财务各报表的大致作用以及特性，财务报表分析可能关注的信息类型等。R20主要介绍财务报告标准。</p>
<h2 id="Reading-19-介绍财务报表分析">Reading 19 介绍财务报表分析</h2>
<h3 id="财务报表分析的作用">财务报表分析的作用</h3>
<p>公司编制财务报表用来向其投资者，债权人以及其他相关方展示其财务状况。而财务报表分析则是利用公司财务报表中的信息，以及其他相关信息做决策。</p>
<h3 id="财务报表内容">财务报表内容</h3>
<p>一般公司的财务报表有五张，其中最重要的三张分别是：</p>
<p><code>Balance sheet(B/S):</code> 该报表主要报告某个<code>时间点</code>公司的<code>财务状况(financial position)</code>。该报表有3个主要<code>elements</code>，分别为<code>Assets(资产)</code>,<code>Liabilities(负债)</code>和<code>Owner's equity(所有者权益)</code>。资产为公司所有的所有资源，负债为债权人所有的资金，所有者权益为股东所有的资金。该报表为<code>Accrual basis(权责发生制)</code>。会计恒等式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>L</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>e</mi><mi>s</mi><mo>+</mo><mi>O</mi><mi>w</mi><mi>n</mi><mi>e</mi><msup><mi>r</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>E</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">Asset = Liabilities + Owner&#x27; Equity
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">iabi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">es</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9963em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">Ow</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.03588em;">Eq</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span></span></p>
<p><code>Income statement(I/S):</code>该报表主要报告公司在<code>一段时间内</code>的的财务表现。其中<code>主要elements</code>包括<code>Revenue(收入)</code>，<code>Expenses(支出)</code>和<code>Other income(其他收入)</code>。该报表为<code>Accrual basis(权责发生制)</code>。</p>
<p><code>Cash flow statement(C/F):</code>该报表主要报告公司在<code>一段时间内</code>的现金收入与支付。各个<code>Cashflow(现金流)</code>被划分为<code>Operating cash flows</code>(主要指与公司正常经营相关的现金流), <code>Investing cash flows</code>(主要指买卖固定资产或参与其他公司投资相关的现金流)或者<code>Financing cash flows</code>(主要指与金融行为相关如发行或回收公司债务或权益证券也包括付给股东的分红等现金流)。该报表为<code>Cash basis(收付实现制)</code>。</p>
<p>而另外两张财务报表分别是：</p>
<p><code>The statement of comprehensive income:</code>该报表主要报告<code>Other comprehensive income(OCI)</code>的变动，<code>OCI</code>指根据会计准则的4项不计入<code>I/S</code>中而直接计入<code>B/S</code>的<code>equity</code>中的收入。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>h</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>v</mi><mi>e</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>N</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>I</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mo>+</mo><mi>O</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>r</mi><mi>e</mi><mi>h</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>v</mi><mi>e</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Comprehensive\ income = Net\ Income + Other\ comprehensive\ income
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Ot</span><span class="mord mathnormal">h</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">re</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span></span></span></span></span></p>
<p><code>The statement of changes in equity:</code>该报表主要报告<code>一段时间内</code>equity的变动来源和数额。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mi>C</mi><mi>a</mi><mi>p</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>l</mi><mo>+</mo><mi>R</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>E</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>s</mi><mo>+</mo><mi>O</mi><mi>C</mi><mi>I</mi></mrow><annotation encoding="application/x-tex">Equity = Capital + Retained\ Earnings + OCI
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Eq</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ain</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">nin</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">OC</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span></span></p>
<h3 id="主要报表间关系">主要报表间关系</h3>
<p>公司的三张主要报表之间各有关联，每张表中有数字变动都会导致另外两张表中的数字相应变动，他们之间的关系两两来看。</p>
<h4 id="B-S与I-S关系">B/S与I/S关系</h4>
<p><code>Income statement</code>的主要信息为<code>Revenue - Expense = Net Income</code>，而公司每年的<code>Net Income</code>除了付出的<code>Dividend</code>，剩下的部分要被计入<code>Balance sheet</code>中的<code>Equity</code>的<code>Retained Earnings(留存收益)</code>科目中。即 <code>Net income - Dividend = Retained Earnings</code>。</p>
<h4 id="B-S与C-F关系">B/S与C/F关系</h4>
<p><code>Cash flow statement</code>中的主要信息为<code>Total CF = Operating CF + Investing CF + Financing CF</code>,而其中的Total CF则是当年现金流的净值，反映在<code>Balance sheet</code>中的<code>Asset</code>中的<code>Cash</code>科目中。即<code>年末Cash - 年初Cash = Total CF</code>。</p>
<h4 id="I-S与C-F关系">I/S与C/F关系</h4>
<p>Income statement 与 Cash flow statement的主要差别在于非现金交易，在<code>Income statement</code>的<code>Net income</code>中减去当年<code>非现金收入</code>并加上当年<code>非现金支出</code>便可以得到当年的<code>Total CF</code>。即 <code>Net income - Non-cash revenue + Non-cash Expense = Total Cash flow</code>。(疑问，receivable和payable属于noncash?)</p>
<h3 id="Elements-元素-与Accounts-科目">Elements(元素)与Accounts(科目)</h3>
<p>财务报表中<code>Elements(元素)</code>为主要分类，分为资产，负债，所有者权益，收入，支出。而每一个Elements中都有不同的<code>Accounts(科目)</code>。例如<code>资产元素</code>中有现金，固定资产，无形资产等科目。<code>负债元素</code>中有应付账款，银行借款等科目。</p>
<h4 id="Contra-Accounts">Contra Accounts</h4>
<p><code>Contra accounts(备抵科目)</code>为资产科目，其特征为<code>负数</code>，该科目用来抵减资产金额。例如：应收账款的坏账，固定资产的减值等。</p>
<h4 id="Measurement-of-financial-elements">Measurement of financial elements</h4>
<ul>
<li><code>Historical cost(历史成本):</code> 用来计量<code>短期资产</code>(变现时间少于一年)，资产价值等于付出的成本。</li>
<li><code>Amortized cost(摊余成本):</code> 用来计量长期资产(变现时间大于一年)，资产价值以<code>摊销(amortization)</code>，<code>折旧(depreciation)</code>，<code>减值(impairment)</code>，<code>耗减(depletion)</code>后的历史成本记账。</li>
<li><code>Fair value(公允价值):</code>一般用来计算金融资产，需要有活跃报价。以两个<code>无信息差(knowledgeable)</code>，<code>自愿(willing)</code>，<code>非关联(arm's length)</code>的交易双方同意交易的价格计量。</li>
</ul>
<h3 id="Other-Relevant-information-其他相关信息">Other Relevant information(其他相关信息)</h3>
<p>除了公司财务报表以外，金融分析师还需要从其他渠道获取补充信息，主要有六种，分别为<code>Financial statement notes(footnotes)</code>，<code>Management's commentary(MD&amp;A)</code>，<code>Proxy statement</code>, <code>Interim reports</code>, <code>Interim reports</code>,  <code>Earnings announcement</code>和<code>External sources</code>。其中考得比较多的是<code>footnote, MD&amp;A和Proxy</code>。</p>
<p><code>Financial statement notes：</code>用来解释说明财务报表中的细节， 如会计方法，假设，估计，固定资产的折旧年限等等，如果需要了解财务报表中数字细节就要看这个财报附注。</p>
<p><code>Management's commentary：</code>财务报表只能反映过去无法反映将来，<code>MD&amp;A</code>是公司管理层对公司经营状况的解读，其中会包含公司经营目标，过去表现，重要事件，未来可能有的不确定性以及表外事项等。</p>
<p><code>Proxy statements：</code>临时股东大会通告出现说明公司出现需要临时召集股东投票的重大事件，事项可能包括调整管理层薪资，董事会成员选举，重大股权激励等等。</p>
<p><code>Interim report：</code>中期报告是未经审计的半年或季度财务报告，可以提供更高时效性的公司财务信息。</p>
<p><code>Earning announcements：</code>业绩预告是比中期报告有更高时效性的公司表现报告，但也是未经审计可能调整。</p>
<p><code>External sources：</code>分析师还需要从公司外部获取相关信息，可能来源包括研究报告，整体经济状况，行业状况，相关新闻等。</p>
<h3 id="Audit-审计">Audit(审计)</h3>
<h4 id="审计原因">审计原因</h4>
<p>公司财务报告需要审计的原因是<code>Principal-agent relationship</code>，也即<code>委托代理冲突</code>。其根本原因在于现代公司治理体系下公司所有者与公司管理者分治导致公司管理者可能为自己利益欺瞒公司所有者(即股东)。因此除董事会监督外，还需要由外部审计对公司管理者出具的公司财务报告进行审计。</p>
<h4 id="审计概念">审计概念</h4>
<ol>
<li>审计本身提供对公司财务报表的<code>独立</code>审核，审计师不能与公司内部关联。</li>
<li>审计师对公司财务报告的正确性提供<code>合理</code>保证(非100%)，保证公司财报没有<code>重大</code>误差。</li>
<li>审计师除了对财报进行审计外还对公司内控程序进行审计，以此判定财报数字的可信度。</li>
</ol>
<h4 id="审计Opinion">审计Opinion</h4>
<p>审计师完成财报审计后提供审计意见，共有4种<code>意见(Opinions)</code>:</p>
<p><code>Unqualified opinion：</code>无保留意见，表示公司财务报表没有重大误差。</p>
<p><code>Qualified opinion：</code>保留意见，表示公司财务报表中有个别性质不严重的偏差。</p>
<p><code>Adverse opinion：</code>否定意见，表示公司财务报表中存在重大或大量误差。</p>
<p><code>Disclaimer of opinion：</code>无法表示意见，表示因审计师活动受限以致无法出具审计意见。</p>
<h3 id="Accounting-Equation-会计恒等式">Accounting Equation(会计恒等式)</h3>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mo>=</mo><mi>L</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>+</mo><mi>E</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>E</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mi>C</mi><mi>a</mi><mi>p</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>l</mi><mo>+</mo><mi>R</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>E</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>s</mi><mo>+</mo><mi>O</mi><mi>C</mi><mi>I</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>R</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mi>E</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>E</mi><mi>n</mi><mi>d</mi></mrow></msub><mo>=</mo><mi>R</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>E</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><msub><mi>g</mi><mrow><mi>B</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>n</mi></mrow></msub><mo>+</mo><mi>N</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>I</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mo>−</mo><mi>D</mi><mi>i</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>d</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>N</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>I</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>R</mi><mi>e</mi><mi>v</mi><mi>e</mi><mi>n</mi><mi>u</mi><mi>e</mi><mo>−</mo><mi>E</mi><mi>x</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>e</mi></mrow></mstyle></mtd></mtr></mtable></mrow><mspace width="14.2264em"/></mrow><annotation encoding="application/x-tex">\begin{cases}
Asset = Liability + Equity\\
Equity = Capital + Retained Earnings + OCI\\
Retained Earnings_{End} = Retained\ Earning_{Begin}+Net\ Income - Dividend\\
Net\ Income = Revenue - Expense
\end{cases}\hspace{5cm}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.76em;vertical-align:-2.63em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-1.6em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-1.592em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.916em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.916em' style='width:0.8889em' viewBox='0 0 888.89 916' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V916 H384z M384 0 H504 V916 H384z'/></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.916em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.8889em' height='0.916em' style='width:0.8889em' viewBox='0 0 888.89 916' preserveAspectRatio='xMinYMin'><path d='M384 0 H504 V916 H384z M384 0 H504 V916 H384z'/></svg></span></span><span style="top:-5.2em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.13em;"><span style="top:-5.13em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">iabi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Eq</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.69em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Eq</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ain</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">nin</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">OC</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ain</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">nin</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ain</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">nin</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span></span></span><span style="top:-0.81em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">se</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.63em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:14.2264em;"></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>⇓</mo><mspace width="34.1433em"/></mrow><annotation encoding="application/x-tex">\Darr\hspace{12cm}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mrel">⇓</span><span class="mspace" style="margin-right:34.1433em;"></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>L</mi><mi>i</mi><mi>a</mi><mi>b</mi><mi>i</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>b</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>C</mi><mi>a</mi><mi>p</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>l</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>R</mi><mi>e</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>E</mi><mi>a</mi><mi>r</mi><mi>n</mi><mi>i</mi><mi>n</mi><mi>g</mi><msub><mi>s</mi><mrow><mi>B</mi><mi>e</mi><mi>g</mi><mi>i</mi><mi>n</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>R</mi><mi>e</mi><mi>v</mi><mi>e</mi><mi>n</mi><mi>u</mi><mi>e</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>−</mo><mi>E</mi><mi>x</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>e</mi><mi>s</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>−</mo><mi>D</mi><mi>i</mi><mi>v</mi><mi>i</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>O</mi><mi>C</mi><mi>I</mi></mrow></mstyle></mtd></mtr></mtable><mspace width="28.4528em"/></mrow><annotation encoding="application/x-tex">\begin{align*}
Asset&amp;=Liability\\
&amp;+Contributed Capital\\
&amp;+Retained\ Earnings_{Begin}\\
&amp;+Revenue\\
&amp;-Expenses\\
&amp;-Dividend declared\\
&amp;+OCI
\end{align*}\hspace{10cm}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:10.5em;vertical-align:-5em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5em;"><span style="top:-7.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span></span></span><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:1.34em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:5.5em;"><span style="top:-7.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">iabi</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">ib</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ain</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">nin</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">g</span><span class="mord mathnormal mtight">in</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">x</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">ses</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">dd</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span></span></span><span style="top:1.34em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">OC</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:5em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:28.4528em;"></span></span></span></span></span></p>
<h3 id="Accrual-Accounting-权责发生制">Accrual Accounting(权责发生制)</h3>
<p>当每笔交易都是现款现货交易时，权责发生制与收付实现制记账结果一致，因此当收发货时间与收付款时间不一致时就会产生差异，不同情况下权责发生制的记账方式如下：</p>
<h4 id="Cash-received-in-advance">Cash received in advance</h4>
<p>交易未完成，现金已收到：已收到现金，因此在<code>资产</code>中记入一笔<code>现金</code>，同时在<code>负债</code>中计入<code>Unearned revenue(预收账款)</code>。</p>
<h4 id="Cash-paid-in-advance">Cash paid in advance</h4>
<p>交易未完成，现金已支付：已支付现金，因此在<code>资产</code>中扣除一笔<code>现金</code>，同时在<code>资产</code>中扣去<code>Prepaid expense(预付账款)</code>。</p>
<h4 id="Cash-received-in-arrears">Cash received in arrears</h4>
<p>交易已完成，现金未收到：已完成交易因此<code>收入</code>增加一笔<code>Accrued revenue(应计收入)</code>，反映在<code>Equity</code>中。同时在资产中计入<code>Account Receivable(应收账款)</code>。</p>
<h4 id="Cash-paid-in-arrears">Cash paid in arrears</h4>
<p>交易已完成，现金未支付：已完成交易，因此在<code>支出</code>扣除一笔<code>Accrued expense(应计费用)</code>，反映在<code>Equity</code>中。同时在负债中计入<code>Account Payable(应付账款)</code>。</p>
<h2 id="Reading-20-财务报表标准">Reading 20 财务报表标准</h2>
<h3 id="合格报表的六个特点-Characteristics">合格报表的六个特点(Characteristics)</h3>
<h4 id="2个基本特征">2个基本特征</h4>
<p>两个基本特征是每个合格报表都需要满足的：</p>
<p><code>Relevance(相关性)：</code>公司在财务报表上披露的信息必须与投资者的投资决策相关。相关的信息会帮助财务报表的使用者评估公司过去，现在以及将来可能发生的事件，有影响投资决策的可能性。</p>
<p><code>Faithful representation(信息正式性)：</code>信息需要<code>完整(Complete)</code>,<code>中性(Neutral)</code>并且<code>没有错误(free from error)</code>。符合这三个要件我们就可以说报表是faithfully presented。</p>
<h4 id="4个增强特征">4个增强特征</h4>
<p>4个增强特征不一定需要满足，但可以增强2个基本特征：</p>
<p><code>Comparability(可比性)：</code>财务报表展示方法和口径在不同公司和不同时间两个维度上都是一致的。</p>
<p><code>Verifiability(可验证性)：</code>不同的观察者用相同的方法读财报可以得出相似的结论。</p>
<p><code>Timeliness(及时性)：</code>报表信息需要被及时披露，上市公司法定至少每年披露一次。</p>
<p><code>Understandability(可理解性)：</code>只需要有基本的商业和财务知识就可以读懂，不能太过晦涩。</p>
<h3 id="会计准则的十个要求-General-features">会计准则的十个要求(General features)</h3>
<p>会计准则对报表编制的十个基本要求如下：</p>
<p><code>Going concern basis(持续经营)：</code> 财务报表的编制需要在假设公司会持续长期经营的前提下。</p>
<p><code>Accrual basis of accounting(权责发生制)：</code>除现金流表外，所有财务报表均以权责发生制的基础编制。</p>
<p><code>Fair presentation(真实表达)：</code>财务报表披露的信息不能有重大错误，需要真实表达。</p>
<p><code>Consistency(一致性)：</code>不同时间使用的会计方法需要一致。</p>
<p><code>Materiality(重大性)：</code>财务报表在对可能影响投资者决策的信息上要没有错误或遗漏。</p>
<p><code>Comparative information(可比性)：</code>当期财务报表中至少应当提供所有列报项目上一个可比会计期间的比较数据。</p>
<p><code>Aggregation(汇总)：</code>财务报表中类似的项目要被汇总，不同项目要被分开。</p>
<p><code>No offsetting(不可抵消)：</code>不同项目中相反的科目数额不可以直接抵消。</p>
<p><code>Reporting frequency(及时性)：</code>财务报表需要至少每年报告。</p>
<p><code>Classified balance sheet(资产负债分类)：</code>报表中需要根据资产和负债的流动性的不同将其分类为<code>短期(current)</code>和<code>长期(non-current)</code>。</p>
<p><code>Minimum information(最少信息)： </code>财务报表及其附注中有其规定的最少需要披露的信息。</p>
<h3 id="IFRS-国际会计准则-与US-GAAP-美国会计准则-的主要区别">IFRS(国际会计准则)与US GAAP(美国会计准则)的主要区别</h3>
<p>US GAAP倾向于使用历史成本估计价值，而IFRS倾向于使用公允价值估计价值。另外，IFRS为<code>Principles-based approach</code>,即以宽泛的框架为准则，对每家公司会计的具体要求较少。而US GAAP为<code>Rules-based approach</code>，对准则的指定较为精细而具体。</p>
<h1>Session 7</h1>
<p>本节中主要分别介绍公司主要的三大财务报表，以及分析的具体方法。其中R21-R23分别介绍利润表，资产负债表和现金流表，R24主要介绍财务分析技术。</p>
<h2 id="Reading-21-理解利润表">Reading 21 理解利润表</h2>
<h3 id="利润表的两种列式方法">利润表的两种列式方法</h3>
<p>通常利润表有两种记账列式方式，一般会计准则规定的是<code>By function格式(按会计科目列式，也称Multi-step format)</code>，也有按发生的费用的性质列式的<code>By Nature格式(按费用性质列式，也称Single-step format)</code>，通常上市公司发布的利润表都会按会计科目列式，但各项费用的性质一般会列在附注中。需要注意一点的是利润表中第一项的Revenue实际上是Net Revenue，也就是去掉预计商品<code>退货(Returns)</code>和<code>违约(Allowances)</code>的实际成交的收入。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220415193138021.png" alt="image-20220415193138021"></p>
<h4 id="变更会计方法">变更会计方法</h4>
<p>当需要变更会计方法时，若变更的是会计政策(Accounting Principle),可能需要<code>追溯调整(retrospective)</code>。若变更的是<code>会计估计(Accounting estimate)</code>，<code>不需要追溯调整(Prospective)</code>。若发生错误，必须追溯更改。</p>
<h4 id="少数股东权益-Non-Controlling-Interest-Minority-Interest">少数股东权益(Non Controlling Interest/Minority Interest)</h4>
<p>被公司持股超过51%的公司被称为<code>绝对控股(Majority shareholder)</code>，被绝对控股的公司属于控股公司的子公司，其财务报表需要与母公司合并，其中不属于母公司股份的利润在利润表中被列为<code>少数股东权益</code>扣除。</p>
<h3 id="第三种列式方式">第三种列式方式</h3>
<p>如上图中所示，除了上节提到的两种记账方式，还有另一种格式会在By function格式的基础上，在EBT后加上增加两个利于投资者计算公司正常经营能力的<code>非经常性项目(Nonrecurring Items)</code>和<code>中止经营项目(Discontinued operations)</code>。</p>
<h4 id="非经常性项目">非经常性项目</h4>
<p><code>非经常性项目</code>通常在<code>税前</code>计算，用来计算售卖资产或部分业务所得利润等不常发生的项目，去掉这部分利润后可以反映公司真实的经营情况<code>(Normalization adjustment)</code>。</p>
<h4 id="中止经营项目">中止经营项目</h4>
<p><code>中止经营项目</code>通常在<code>税后</code>计算，用来计算中止业务时的<code>淡出期(phase out period)</code>中，要被中止的这块业务产生的利润，去掉这部分利润可以反映公司未来的经营情况<code>(Pro-forma adjustment)</code>。</p>
<h3 id="收入与成本确认-Revenue-Expense-recognition">收入与成本确认(Revenue &amp; Expense recognition)</h3>
<h4 id="收入确认">收入确认</h4>
<p>利润表的编制基于权责发生制，因此仅在交易完成后才会确认收入。作为卖方要确认收入需要满足以下几点：</p>
<ul>
<li>
<p>买卖双方需要存在买卖合同。</p>
</li>
<li>
<p>合同中要明确规定买卖双方各自的<code>责任与义务(performance obligations)</code>，用以确认合同是否已经履行。</p>
</li>
<li>
<p>合同要明确交易价格。</p>
</li>
<li>
<p>合同中规定的交易价格可以被按照责任义务履行的进度分配。</p>
</li>
<li>
<p>当双方都已满足合同规定的各自义务时可以确认收入。</p>
<p>对于最后一点双方是否满足合同规定的义务的判断，会计准则规定当客户实际获得资产的控制权时交易完成。需满足以下任意一点：</p>
</li>
<li>
<p>当卖方有权要求卖方付款时。</p>
</li>
<li>
<p>买方已经获得法律上的所有权认可。</p>
</li>
<li>
<p>买方已经实质上拥有资产。</p>
</li>
<li>
<p>与商品相关的风险与收益已经从卖方转移给买方。(使用较多)</p>
</li>
<li>
<p>买方已经接受资产。</p>
</li>
</ul>
<h4 id="成本确认">成本确认</h4>
<p>根据Matching principle(配比原则)，与收入直接相关的成本要在同一时间段内确认。当合同期限大于一年，需要按时间分配收入时，可以按成本在不同时间的分配计算业务进度，并以进度百分比计算相应收入。</p>
<h4 id="毛净收入（Gross-and-net-reporting-of-revenue）">毛净收入（Gross and net reporting of revenue）</h4>
<p>对于代理行业而言，其直接从客户手中收取的费用被称为<code>毛收入(Gross revenue)</code>, 毛收入与其成本之间的差值为其<code>净收入(Net revenue)</code>。US GAAP准则规定公司仅在同时满足以下四点时可以以毛收入记收入(基本不可能满足):</p>
<ul>
<li>公司必须是合同的主要义务方(primary obligor)。</li>
<li>公司可以独立选择其供应商。</li>
<li>公司承担存货和信用风险。</li>
<li>公司具有实际定价权。</li>
</ul>
<h3 id="Earnings-per-share-每股净利润">Earnings per share(每股净利润)</h3>
<p>每股净利润简称EPS，一般需要了解了两个概念分别为<code>Basic EPS(基本每股收益)</code>和<code>Diluted EPS(稀释每股收益)</code>。</p>
<h4 id="Basic-EPS">Basic EPS</h4>
<p><code>基本每股收益</code>为公司净利润减去优先股红利后，以该会计核算时间中的加权平均普通股数量平分的利润。以下式表示：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>B</mi><mi>a</mi><mi>s</mi><mi>i</mi><mi>c</mi><mtext> </mtext><mi>E</mi><mi>P</mi><mi>S</mi><mo>=</mo><mfrac><mrow><mi>N</mi><mi>I</mi><mo>−</mo><mi>d</mi><mi>i</mi><msub><mi>v</mi><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi></mrow></msub></mrow><mrow><mi>w</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>a</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>s</mi><mtext> </mtext><mi>o</mi><mi>u</mi><mi>t</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Basic\ EPS = \frac{NI-div_{preferred\ stock}}{weighted\ average\ number\ of\ common\ shares\ outstanding}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05764em;">EPS</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">mb</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal">mm</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">res</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">erre</span><span class="mord mathnormal mtight">d</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">oc</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>由于会计核算时间段内普通股数量可能发生变化，因此需要计算该段时间内的加权平均普通股数量。普通股数量变化的四种情况及各自的计算方法如下表：</p>
<table>
<thead>
<tr>
<th>事件</th>
<th>数量变化</th>
<th>计算方法</th>
<th>举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>股票增发(new issue)</td>
<td>增加</td>
<td>按时间加权</td>
<td>存在时间占比x增发数量</td>
</tr>
<tr>
<td>股票回购(repurchase)</td>
<td>减少</td>
<td>按时间加权</td>
<td>存在时间占比x回购数量</td>
</tr>
<tr>
<td>股票激励(stock dividend)</td>
<td>增加</td>
<td>直接追溯调整</td>
<td>事件发生前所有股数按比增加</td>
</tr>
<tr>
<td>股票分割(stock split)</td>
<td>增加</td>
<td>直接追溯调整</td>
<td>事件发生前所有股数翻倍</td>
</tr>
</tbody>
</table>
<h4 id="Diluted-EPS">Diluted EPS</h4>
<p><code>稀释后每股收益</code>为公司所有<code>可转债(Convertible debt)</code>，<code>可转换优先股(Convertible preferred stock)</code>，和<code>股票期权(Stock option/warrant)</code>全部转换为公司普通股后的每股收益。以下式表示：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>i</mi><mi>l</mi><mi>u</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>E</mi><mi>P</mi><mi>S</mi><mo>=</mo><mfrac><mrow><mi>a</mi><mi>d</mi><mi>j</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mtext> </mtext><mi>a</mi><mi>v</mi><mi>a</mi><mi>i</mi><mi>l</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mtext> </mtext><mi>f</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>w</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>a</mi><mi>v</mi><mi>g</mi><mi mathvariant="normal">.</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>m</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi mathvariant="normal">&amp;</mi><mtext> </mtext><mi>p</mi><mi>o</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>s</mi><mtext> </mtext><mi>o</mi><mi>u</mi><mi>t</mi></mrow></mfrac><mspace linebreak="newline"></mspace><mo>=</mo><mfrac><mrow><mo stretchy="false">[</mo><mi>N</mi><mi>I</mi><mo>−</mo><mi>d</mi><mi>i</mi><msub><mi>v</mi><mrow><mi>p</mi><mi>r</mi><mi>e</mi><mi>f</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub><mo stretchy="false">]</mo><mo>+</mo><mo stretchy="false">[</mo><mi>d</mi><mi>i</mi><msub><mi>v</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>e</mi><mi>d</mi><mi>e</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow></msub><mo stretchy="false">]</mo><mo>+</mo><mo stretchy="false">[</mo><mi>i</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>s</mi><msub><mi>t</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>b</mi><mi>l</mi><mi>e</mi><mtext> </mtext><mi>d</mi><mi>e</mi><mi>b</mi><mi>t</mi></mrow></msub><mo stretchy="false">]</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><mrow><mi>W</mi><mi>A</mi><mi>C</mi><mi>S</mi><mi>O</mi><mo>+</mo><mo stretchy="false">[</mo><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi mathvariant="normal">.</mi><mtext> </mtext><mi>p</mi><mi>f</mi><mi>d</mi><mi mathvariant="normal">.</mi><mtext> </mtext><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>s</mi></mrow></msub><mo stretchy="false">]</mo><mo>+</mo><mo stretchy="false">[</mo><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><msub><mi>s</mi><mrow><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi mathvariant="normal">.</mi><mtext> </mtext><mi>d</mi><mi>e</mi><mi>b</mi><mi>t</mi></mrow></msub><mo stretchy="false">]</mo><mo>+</mo><mo stretchy="false">[</mo><mi>s</mi><mi>h</mi><mi>a</mi><mi>r</mi><mi>e</mi><msub><mi>s</mi><mrow><mi>i</mi><mi>n</mi><mi>s</mi><mi>u</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mtext> </mtext><mi>f</mi><mi>r</mi><mi>o</mi><mi>m</mi><mtext> </mtext><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mtext> </mtext><mi>o</mi><mi>p</mi><mi>t</mi><mi mathvariant="normal">.</mi></mrow></msub><mo stretchy="false">]</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">Diluted EPS = \frac{adjusted\ income\ available\ for\ common\ shares}{weighted\ avg.\ comon\ \&amp;\ potential\ common\ shares\ out}\\
=\frac{[NI-div_{preferred}]+[div_{convrtible\ prederred}]+[interest_{convertible\ debt}](1-t)}{WACSO+[shares_{conversion\ of\ conv.\ pfd.\ shares}]+[shares_{conversion\ of\ conv.\ debt}]+[shares_{insuable\ from\ stock\ opt.}]}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05764em;">EPS</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">vg</span><span class="mord">.</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord">&amp;</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ia</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal">mm</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">res</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">ai</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ab</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal">mm</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">res</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3991em;vertical-align:-0.9721em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">CSO</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[</span><span class="mord mathnormal">s</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">re</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">ers</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mtight">.</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">fd</span><span class="mord mtight">.</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">ha</span><span class="mord mathnormal mtight">res</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[</span><span class="mord mathnormal">s</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">re</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">ers</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mtight">.</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[</span><span class="mord mathnormal">s</span><span class="mord mathnormal">ha</span><span class="mord mathnormal">re</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">in</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">ab</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">m</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">oc</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">pt</span><span class="mord mtight">.</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight">erre</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ib</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">erre</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">[</span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mord mathnormal">eres</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">co</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">er</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">ib</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>上方公式实际就是在基本每股收益的计算式中分别在分子与分母中加上三种可转证券转换为普通股后的影响：</p>
<ul>
<li><code>可转债(Convertible debt):</code>由于可转债在转换之前为债权，因此公司要付出利息，因此可转债转换为普通股后要将本需要付出的利息<code>扣税后</code>加回分子，并将转换的普通股数量加入分母。</li>
<li><code>可转换优先股(Convertible preferred stock)：</code>由于优先股有固定的分红，因此可转换优先股转换为普通股后要将本需扣除的优先股分红加回分子，并将转换的普通股数量加入分母。</li>
<li><code>股票期权(Stock option/warrant)：</code>假设公司发行的看涨期权(Call option)被行权，公司将期权持有者用于以合约价格购买股票的收入假设以市场全年均价买回后，仍然不足的部分以增发股数加入分母。</li>
</ul>
<h4 id="Anti-dilution">Anti-dilution</h4>
<p>由于可转债和可转换优先股对基本每股收益的影响不一定是负面的，可能由于其转换导致每股净利润增加，这种情况叫做<code>反稀释(anti-dilution)</code>。在这种情况下基本每股收益才是稀释后每股收益，即稀释后每股收益为<code>转换后每股收益</code>与<code>基本每股收益</code>中<code>较小</code>者。</p>
<h3 id="Common-size-I-S">Common-size I/S</h3>
<p>出于对公司各项收入成本利润占比结构情况的直观表现，我们有时会使用各项目占Revenue的百分比的格式展示利润表。</p>
<h3 id="Comprehensive-Income-综合收益">Comprehensive Income(综合收益)</h3>
<p>综合收益包括留存收益和其他综合收益，其中其他综合收益是四项由会计准则规定不计入利润表而直接反映在资产负债表的所有者权益项中。这四项被国际会计准则和美国会计准则认定为其他综合收益的项目分别是：</p>
<ul>
<li>Foreign currency translation gain/losses(外币报表折算产生的外汇损益)</li>
<li>Adjustments for minimum pension liability(精算假设变动导致最小养老金负债的调整)</li>
<li>Unrealized G/L on available-for-sale securities(可供出售金融资产价格波动导致的浮盈浮亏 )</li>
<li>Unrealized G/L from cash flow hedging derivatives(对冲用金融衍生品价格波动导致的浮盈浮亏)</li>
</ul>
<p>最后在美国会计准则之外，<code>国际会计准则</code>还规定了<code>第五项</code>不计入利润表的其他综合收益：</p>
<ul>
<li>使用重估模型计算长期资产价值时，其公允价值与历史成本的差异。若有<code>收益(Gain)</code>则计入资产负债表中的其他综合收益科目，若有<code>损失(Loss)</code>则计入利润表。</li>
</ul>
<h2 id="Reading-22-理解资产负债表">Reading 22 理解资产负债表</h2>
<p>在<code>Reading22</code>中的资产负债表部分较为简单，关于资产负债表的主要的较难的内容会在<code>Session8</code>中详细覆盖。</p>
<h3 id="资产负债表的格式和组成部分">资产负债表的格式和组成部分</h3>
<ul>
<li><code>资产(Assets)</code>反映公司资金去向，资产的主要定义是会为公司提供<code>未来经济利益的流入(probable future economic benefits)</code>。包括<code>Current and Non-current assets（短期和长期资产）</code>。</li>
<li><code>负债(Liabilities)</code>为公司债权人所有资金，负债的主要定义是会导致公司<code>未来经济利益的流出(an outflow of economic benefits in the future)</code>。包括<code>Current and Non-current liabilities（短期和长期负债）</code>。</li>
<li>所有者权益(Stockholders’ equity)是属于公司股东的资金，权益的主要定义是公司资产减去负债后的<code>剩余权益(residual interest)</code>。</li>
</ul>
<p>资产负债表主要对投资者提供的信息是公司的<code>流动性(liquidity)</code>，<code>偿债能力(solvency)</code>与<code>对股东利润分配的能力(ability to make distribution to shareholders)</code>。资产负债表在<code>IFRS</code>和<code>US GAAP</code>准则下都是<code>分类表(Classified balance sheet)</code>，即将资产负债分为短期与长期，用以衡量公司流动性。<code>IFRS</code>准则下资产负债表为<code>Liquidity-based presentation</code>，即将各科目按流动性从高到低排列。</p>
<h4 id="资产">资产</h4>
<table>
    <!--标题-->
    <tr>
        <th>大类</th>
        <th>常见科目</th>
        <th>解释</th>
    </tr>
    <!--Current assets-->
    <tr>
        <td rowspan="6">Current Assets</td>
        <td>Cash and equivalents</td>
        <td>现金和现金等价物，通常无风险变现时间在30天以内的固收证券可以作为现金等价物。</td>
    </tr>
    <tr>
        <td>Accounts receivable</td>
        <td>应收账款，该科目需要扣除坏账准备(bad debt allowance)，以帐龄计算。</td>
    </tr>
    <tr>
        <td>Inventory</td>
        <td>存货，对制造业公司来说该部分是最重要科目，分Raw materials, work-in-progress和finish good三个部分核算，具体会在Session8中详解。</td>
    </tr>
    <tr>
        <td>Prepaid expenses</td>
        <td>预付账款，已经付了钱但还没有收到货，预计未来某天会收到该数额的货物。</td>
    </tr>
    <tr>
        <td>Short-term investments</td>
        <td>短期投资，变现时间少于一年的金融资产</td>
    </tr>
    <tr>
        <td>Other current assets</td>
        <td>其他变现时间少于一年的资产</td>
    </tr>
    <!--Non current assets-->
    <tr>
        <td rowspan="5">Non Current Assets</td>
        <td>Property, Plant and Equipment(PP&E)</td>
        <td>固定资产，主要涉及内容是折旧计算，例如直线法，加速法使用cost model或revaluation model等方式折旧等。具体会在Session8中详解。</td>
    </tr>
        <tr>
        <td>Intanible assets</td>
        <td>无形资产，例如专利等，计算方法与固定资产非常相似，但计算内容是摊销(amortization)，没有残值。</td>
    </tr>
    <tr>
        <td>Long-term investments</td>
        <td>长期投资，变现时间大于一年的金融资产</td>
    </tr>
    <tr>
        <td>Deferred tax assets</td>
        <td>递延所得税资产，由于税收以现金收付制计算，而资产负债表以权责发生制计算，因此税收与资产负债表存在差异，此科目用以记录该部分差值。</td>
    </tr>
    <tr>
        <td>Pension assets</td>
        <td>养老金资产，按美国DB plan计算，员工每工作一年就按其退休前公司的1%给付其养老金，该科目是 按精算假设计算未来可能给付员工的养老准备金数额。</td>
    </tr>
</table>
<h4 id="负债">负债</h4>
<table>
    <!--标题-->
    <tr>
        <th>大类</th>
        <th>常见科目</th>
        <th>解释</th>
    </tr>
    <!--Current liabilities-->
    <tr>
        <td rowspan="6">Current Liabilities</td>
        <td>Bank overdraft</td>
        <td>透支，向银行的短期借款</td>
    </tr>
    <tr>
        <td>Accounts payable</td>
        <td>应付账款，已收到货物但还未付款</td>
    </tr>
    <tr>
        <td>Accrued expenses</td>
        <td>预提费用，与应付账款类似科目，是还未付款的，但预提费用不是与产品本身成本相关，而是管理费用。</td>
    </tr>
    <tr>
        <td>Unearned revenue</td>
        <td>预收账款，已收到货款还未交货，因此欠交易方货物</td>
    </tr>
    <tr>
        <td>The current portion of long-term debt</td>
        <td>当期偿还的长期债务，指长期债务中在当一年内需要偿还的金额</td>
    </tr>
    <tr>
        <td>Current taxes payable</td>
        <td>应交税金， 当年需要缴付的税金 </td>
    </tr>
    <!--Non current liabilities-->
    <tr>
        <td rowspan="5">Non Current Liabilities</td>
        <td>Notes payable</td>
        <td>应付债券(1-10年)</td>
    </tr>
    <tr>
        <td>Bonds payable</td>
        <td>应付债券(10年以上)</td>
    </tr>
    <tr>
        <td>Capital/Financial lease obligations</td>
        <td>应付融资租赁款</td>
    </tr>
    <tr>
        <td>Pension liabilities</td>
        <td>养老金负债，与养老金资产类似，需要缴付的部分就是养老金负债。</td>
    </tr>
    <tr>
        <td>Deferred tax liabilities</td>
        <td>递延所得税负债，与递延所得税资产类似，税收与资产负债表差异部分记账。</td>
    </tr>
</table>
<h4 id="所有者权益">所有者权益</h4>
<table>
    <!--标题-->
    <tr>
        <th>常见科目</th>
        <th>解释</th>
    </tr>
    <tr>
        <td>Capital</td>
        <td>股本面值，发售的股票的面值部分。</td>
    </tr>
    <tr>
        <td>Additional paid-in-capital</td>
        <td>股本溢价，发售的股票的溢价部分，与股本面值的和为实收股本。</td>
    </tr>
    <tr>
        <td>Treasury stock</td>
        <td>库存股，公司已经回购但还未注销的部分，一般为负数，用于抵减股本。</td>
    </tr>
    <tr>
        <td>Retained earnings</td>
        <td>留存收益，每年的净利润扣除股利后为当年留存收益的变化值。</td>
    </tr>
    <tr>
        <td>Accumulated other comprehensive income</td>
        <td>其他综合收益，该部分为不计入利润表的4+1项特殊收入Comprehensive Income(综合收益)。</td>
    </tr>
    <tr>
        <td>Minority interest</td>
        <td>子公司资产负债表中按控股比例不属于控股公司的部分。</td>
    </tr>
</table>
<h3 id="Common-size-B-S">Common size B/S</h3>
<p>与<code>Common size I/S</code>相似，为以比例形式展示资产负债表，将资产负债表中每个数字除以总资产。</p>
<h3 id="金融资产-Financial-instruments">金融资产(Financial instruments)</h3>
 <table>
    <!--标题-->
    <tr>
        <th colspan="2">USGAAP</th>
        <th colspan="2">IFRS</th>
    </tr>
    <tr>
        <td>Held-to-maturity</td>
        <td>持有至到期</td>
        <td>Amortized cost(AC)</td>
        <td>以摊余成本进行计量的金融资产</td>
    </tr>
    <tr>
        <td>Trading security</td>
        <td>交易性金融资产</td>
        <td>Fair value through profit or loss (FVTPL)</td>
        <td>以公允价值计量且变动计入当期损益的金融资产</td>
    </tr>
    <tr>
        <td>Available-for-sale</td>
        <td>可供出售金融资产</td>
        <td>Fair value through other comprehensive income (FVTOCI)</td>
        <td>以公允价值计量且变动计入其他综合收益的金融资产</td>
    </tr>
</table>
<h4 id="Held-to-maturity">Held-to-maturity</h4>
<p>持有至到期的金融资产通常为债券，债券的摊销核算方法如下：</p>
<ol>
<li>首先把债券每年的现金流和本金按无风险利率折价为现值。</li>
<li>然后每年<code>年末的资产价值</code>为为当年<code>年初的现值</code>+<code>该现值的无风险利息收益</code>-<code>票面利息</code>。</li>
<li>当年的<code>摊销费用</code>为<code>年末价值</code>-<code>年初价值</code>。</li>
</ol>
<p>其中<code>年末及年初的资产价值</code>计入<code>资产负债表</code>，<code>无风险利息收益</code>计入<code>利润表</code>，<code>票面利息</code>计入<code>现金流表</code>。</p>
<h4 id="Trading-security">Trading security</h4>
<p>交易性资产为公司以短线交易为目的而持有的金融资产，该类资产的<code>浮盈浮亏(Unrealized G/L)</code>计入<code>利润表</code>。</p>
<h4 id="Available-for-sale">Available-for-sale</h4>
<p>交易性金融资产在IFRS准则下，即可以是债券投资，也可以是股票投资。但在US GAAP准则下可供出售的金融资产只可能是债券。该资产以公允价值计量且变动计入<code>资产负债表的其他综合收益</code>。</p>
<h2 id="Reading-23-理解现金流量表">Reading 23 理解现金流量表</h2>
<p>现金流量表通常用于反映公司在会计年度中支付和受到的现金，且其现金在不同活动中的组成结构等，所有非现金活动均不体现在现金流量表中。现金流主要分为3类，<code>经营活动现金流CFO</code>, <code>投资活动现金流CFI</code>和<code>融资活动现金流CFF</code>。现金流量表可以帮助判断公司的<code>流动性</code>，<code>偿债能力</code>和<code>财务灵活度(financial flexibility)</code>。</p>
<h3 id="现金流量表科目分类-US-GAAP-vs-IFRS">现金流量表科目分类 US GAAP vs IFRS</h3>
<table>
    <!--标题-->
    <tr>
        <th colspan="2", align = "center">US GAAP</th>
    </tr>
    <tr>
        <th colspan="2", align = "center">Cash flows from Operating Activities经营活动现金流</th>
    </tr>
    <tr>
        <th align = "center">Inflows</th>
        <th align = "center">Outflows</th>
    </tr>
    <tr>
        <td>从客户处获得的现金</td>
        <td>付给员工和供应商的现金</td>
    </tr>
    <tr>
        <td>卖出交易性金融资产获得的金额</td>
        <td>买入交易性金融资产付出的金额</td>
    </tr>
    <tr>
        <td></td>
        <td>经营活动费用支出</td>
    </tr>
    <tr>
        <td><font color="red">收到的利息</font></td>
        <td><font color="red">支出的利息</font></td>
    </tr>
    <tr>
        <td><font color="red">收到的股利</font></td>
        <td></td>
    </tr>
    <tr>
        <td></td>
        <td>支出的税金</td>
    </tr>
    <tr>
        <th colspan="2", align = "center">Cash flows from Investing Activities投资活动现金流</th>
    </tr>
    <tr>
        <th align = "center">Inflows</th>
        <th align = "center">Outflows</th>
    </tr>
    <tr>
        <td>卖出长期资产收入金额</td>
        <td>获取长期资产付出金额</td>
    </tr>
    <tr>
        <td>卖出股票债券资产收入金额</td>
        <td>买入股票债券资产付出金额</td>
    </tr>
    <tr>
        <td>收回借给别人的借款金额</td>
        <td>借款给别人的金额</td>
    </tr>
    <tr>
        <th colspan="2", align = "center">Cash flows from Financing Activities融资活动现金流</th>
    </tr>
    <tr>
        <th align = "center">Inflows</th>
        <th align = "center">Outflows</th>
    </tr>
    <tr>
        <td>发行债券获取的金额</td>
        <td>偿还债券付出的金额</td>
    </tr>
    <tr>
        <td>发行股票获取的金额</td>
        <td>回购股票付出的金额</td>
    </tr>
    <tr>
        <td></td>
        <td><font color="red">付出的股利</font></td>
    </tr>
</table>
在US GAAP准则下，利息的收入和支出都属于CFO，而收到的股利属于CFO但支出的股利属于CFF。而在IFRS准则下，利息和股利的收入都可以计入CFI或CFO，利息和股利的支出都可以计入CFF或CFO。另外US GAAP准则下的税金计入CFO中，但IFRS准则下不同活动产生额税金计入不同的现金流量科目中。
<h3 id="现金流计算">现金流计算</h3>
<h4 id="经营活动现金流CFO计算">经营活动现金流CFO计算</h4>
<p>现金流的计算方法有两种，<code>直接法</code>将各个活 动的收入与支出金额相加最后得出总现金流。 <code>间接法</code>将利润表中的净收入做相关调整后计算出总现金流。直接法不如间接法准确，但可以看到各个经营活动现金流的构成，因此会计准则鼓励公司使用直接法制现金流量表。</p>
<p>现金流计算时，负债的增加意味着现金增加，资产的增加意味着现金的流出。</p>
<h5 id="间接法">间接法</h5>
<table>
    <tr>
    	<th colspan="2", align = "center">间接法计算CFO</th>
    </tr>    
    <tr>
        <td>净利润</td>
        <td></td>
    </tr>
    <tr>
        <td>+ 非现金费用或损失</td>
        <td rowspan="3">利润表项目</td>
    </tr>
    <tr>
        <td>- 非现金收入或获利</td>
    </tr>
    <tr>
        <td>+ 营业外获利或损失</td>
    </tr>
    <tr>
        <td>- 不包含现金的短期资产增加量(存货，应收账款)</td>
        <td rowspan="2">资产负债表项目(营运资本Working capital)</td>
    </tr>
    <tr>
        <td>+ 不含付息债务的短期负债增加量(应付账款)</td></td>
    </tr>
    <tr>
        <td>=CFO</td>
        <td></td>
    </tr>
</table>
<p>需要注意几点：在考试中通常只对非现金费用进行调整，因为实务中非现金收入最终都会转为现金收入，但非现金费用例如折旧永远都属于非现金费用；一级考试中通常营业外获利或损失为0；CFA一级考试中通常直接用净利润+非现金费用-营运资本计算CFO，营运资本=不含现金的流动资产-不含付息债务的流动负债。</p>
<h5 id="直接法">直接法</h5>
<table>
    <tr>
    	<th colspan="2", align = "center">直接法计算CFO</th>
    </tr>    
    <tr>
        <td>从客户处收入的现金</td>
        <td>初始应收款项+净收入-结算应收款项=净收入-应收款项增量</td>
    </tr>
    <tr>
        <td>- 支付给供应商的现金</td>
        <td>支付现金=期末存货-期初存货+货物营业成本-应付账款增量</td>
    </tr>
    <tr>
        <td>- 支付给员工的现金</td>
        <td>支付给员工的现金=工资费用-应付工资增量</td>
    </tr>
    <tr>
        <td>- 支付给债权人的利息</td>
        <td>支付给债权人的利息=利息费用-应付利息增量</td>
    </tr>
    <tr>
        <td>- 支付的税金</td>
        <td>支付的税金=税金费用-应付税金增量</td>
    </tr>
    <tr>
        <td>=CFO</td>
        <td></td>
    </tr>
</table>
<p>主要注意的点有：CFA一级的重点考试内容是从客户出收入的现金和支付给供应商的现金，其中支付给供应商的现金中，货物营业成本通常默认不包括折旧费用 ，若题目表示该数额包含折旧费用，则需要加回。</p>
<h4 id="投资活动现金流CFI计算">投资活动现金流CFI计算</h4>
<p>投资活动的主要两个类别是<code>买卖长期资产</code>,<code>买卖金融资产</code>和<code>借款</code>，考试中主要考察的是长期资产买卖。考试中两个公式可能需要同时使用。</p>
<h5 id="购买固定资产的现金支出">购买固定资产的现金支出</h5>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>期末账面价值</mtext><mo>=</mo><mtext>期初账面价值</mtext><mo>+</mo><mtext>购买支出</mtext><mo>−</mo><mtext>处置资产账面价值</mtext><mo>−</mo><mtext>减值</mtext></mrow><annotation encoding="application/x-tex">期末账面价值=期初账面价值+购买支出-处置资产账面价值-减值
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">期末账面价值</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">期初账面价值</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">购买支出</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">处置资产账面价值</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">减值</span></span></span></span></span></p>
<h5 id="卖出固定资产的现金收入">卖出固定资产的现金收入</h5>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>获利或损失</mtext><mo>=</mo><mtext>收到金额</mtext><mo>−</mo><mtext>处置资产账面价值</mtext></mrow><annotation encoding="application/x-tex">获利或损失=收到金额-处置资产账面价值
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">获利或损失</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">收到金额</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">处置资产账面价值</span></span></span></span></span></p>
<h4 id="融资活动现金流CFI计算">融资活动现金流CFI计算</h4>
<p>融资活动的现金流主要考察的是股利的现金流计算，需要掌握的公式只有一个：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>支付的股利</mtext><mo>=</mo><mtext>宣告支付的股利</mtext><mo>−</mo><mtext>应付股利</mtext></mrow><annotation encoding="application/x-tex">支付的股利=宣告支付的股利-应付股利
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">支付的股利</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">宣告支付的股利</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">应付股利</span></span></span></span></span></p>
<h3 id="Common-Size-C-F">Common Size C/F</h3>
<p>现金流量表的Common size有两种计算方法：</p>
<ol>
<li>将现金流的各个科目除以总收入；</li>
<li>将现金流入和流出科目分别除以现金总流入和总流出。</li>
</ol>
<h3 id="自由现金流-Free-Cash-Flow">自由现金流(Free Cash Flow)</h3>
<p>该部分内容在CFA一级中涉及较少，但是CFA二级重点考察的内容。一级中考察的主要是根据公司财务报表计算公司自由现金流的方法。自由现金流的定义为，满足公司的所有生产经营活动后盈余的现金流，其又分为<code>公司自由现金流(Free cash flow to the firm FCFF)</code>和<code>股权自由现金流(Free cash flow to equity FCFE)</code>。</p>
<h4 id="股权自由现金流">股权自由现金流</h4>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>股权自由现金流</mtext><mo>=</mo><mtext>公司自由现金流</mtext><mo>−</mo><mtext>利息</mtext><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mtext>税率</mtext><mo stretchy="false">)</mo><mo>+</mo><mtext>净借款</mtext></mrow><annotation encoding="application/x-tex">股权自由现金流=公司自由现金流-利息\times(1-税率)+净借款
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">股权自由现金流</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">公司自由现金流</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">利息</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">税率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">净借款</span></span></span></span></span></p>
<h4 id="公司自由现金流">公司自由现金流</h4>
<p>共有三种方式计算公司自由现金流：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mtext>公司自由现金流</mtext><mo>=</mo><mtext>息税前利润</mtext><mo stretchy="false">(</mo><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mtext>税率</mtext><mo stretchy="false">)</mo><mo>+</mo><mtext>非现金支出</mtext><mo>−</mo><mtext>固定资本投入</mtext><mo>−</mo><mtext>营运资本投入</mtext></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(1)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">公司自由现金流=息税前利润(EBIT)\times(1-税率)+非现金支出-固定资本投入-营运资本投入\tag{1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">公司自由现金流</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">息税前利润</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">税率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">非现金支出</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">固定资本投入</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">营运资本投入</span></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mtext>公司自由现金流</mtext><mo>=</mo><mtext>净利润</mtext><mo stretchy="false">(</mo><mi>N</mi><mi>I</mi><mo stretchy="false">)</mo><mo>+</mo><mtext>利息</mtext><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mtext>税率</mtext><mo stretchy="false">)</mo><mo>+</mo><mtext>非现金支出</mtext><mo>−</mo><mtext>固定资本投入</mtext><mo>−</mo><mtext>营运资本投入</mtext><mspace linebreak="newline"></mspace></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(2)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">公司自由现金流=净利润(NI)+利息\times(1-税率)+非现金支出-固定资本投入-营运资本投入\tag{2}\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">公司自由现金流</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">净利润</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">利息</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">税率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">非现金支出</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">固定资本投入</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">营运资本投入</span></span><span class="mspace newline"></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable width="100%"><mtr><mtd width="50%"></mtd><mtd><mrow><mtext>公司自由现金流</mtext><mo>=</mo><mtext>经营活动现金流</mtext><mo stretchy="false">(</mo><mi>C</mi><mi>F</mi><mi>O</mi><mo stretchy="false">)</mo><mo>+</mo><mtext>利息</mtext><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mtext>税率</mtext><mo stretchy="false">)</mo><mo>−</mo><mtext>固定资本投入</mtext><mspace linebreak="newline"></mspace></mrow></mtd><mtd width="50%"></mtd><mtd><mtext>(3)</mtext></mtd></mtr></mtable><annotation encoding="application/x-tex">公司自由现金流=经营活动现金流(CFO)+利息\times(1-税率)-固定资本投入\tag{3}\\
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">公司自由现金流</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">经营活动现金流</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">CFO</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">利息</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">税率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">固定资本投入</span></span><span class="mspace newline"></span><span class="tag"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">3</span></span><span class="mord">)</span></span></span></span></span></span></p>
<h2 id="Reading-24-财务分析技术">Reading 24 财务分析技术</h2>
<h3 id="财务比率分析-Ratio-analysis">财务比率分析(Ratio analysis)</h3>
<h4 id="Profitability-ratio">Profitability ratio</h4>
<p>用于衡量公司从收入中产生利润的能力，主要基于利润表计算。</p>
<p><code>Return on assets(总资产收益率, ROA)：</code>(净利润+税后利息)/平均总资产(Average total assets)。 反映公司为公司所有者的盈利能力。</p>
<p><code>Return on Equity(净资产收益率, ROE)：</code>净利润/平均总权益(Average total equity)。反映公司为股东盈利的能力。</p>
<p><code>Operating return on assets：</code>EBIT/平均总资产。与ROA的区别在于ROA为税后此指标为税前。</p>
<p><code>Return on total capital(ROTC)：</code>EBIT/平均总资本(Average total capital)。资本比资产少计不付息的负债部分。</p>
<p><code>Return on common equity：</code>(净利润-优先股股利)/平均普通股权(Average common equity)。反映公司为普通股股东盈利能力。</p>
<h4 id="Activity-ratio">Activity ratio</h4>
<p>用于衡量公司使用资产产生收入的效率，主要有六个<code>周转率(turnover)</code>指标。</p>
<p><code>Total asset turnover(总资产周转率)：</code>净收入/平均总资产 。计算每一份资产可以产生的收入，反映资产使用效率。</p>
<p><code>Fixed asset turnover(固定资产周转率)：</code>净收入/平均净固定资产(Average net fixed assets)。反映固定资产使用效率。</p>
<p><code>Working capital turnover(营运资本周转率)：</code>净收入/平均营运资本。营运资本是不包含现金的流动资产减去不包含付息债务的流动负债，是日常经营占用的资金。</p>
<p><code>Inventory turnover(存货周转率) ：</code> COGS(货物成本)/ 平均存货(average inventory)。用365除周转率为存货周转周期。对比存货周转率时要在相同行业/商业模式的公司间比较。</p>
<p><code>Receivable turnover(应收账款周转率)：</code>净收入(Net revenue)/平均应收账款(average A/R)。用365除周转率为平均收回账款周期。收款周期是否过长应该对比公司行业的平均账期。</p>
<p><code>Payables turnover(应付账款周转率)：</code>购买(Purchase)/平均应付账款(average A/P)。用365除周转率为平均付款周期。付款周期应该对比应付账款在付款时的现值与提前付款的优惠。</p>
<p>最后，<code>经营周期(Operating Cycle)=平均收款周期+存货周转周期</code>，<code>现金循环周期(Cash converison cycle)=平均收款周期+存货周转周期-平均付款周期</code>。</p>
<h4 id="Liquidity-ratio">Liquidity ratio</h4>
<p>衡量公司偿付短期债务的能力，反映公司财务流动性水平，主要有4个指标。</p>
<p><code>Current ratio(流动比率)：</code>Current assets(流动资产)/Current liability(流动负债)。流动比率越高流动性越强，但流动资产中可能拥有滞销存货，因此可以使用其他比率更好衡量流动性。</p>
<p><code>Quick ratio(速动比率)：</code>(现金+交易性证券+应收账款)/流动负债≈(流动资产-存货)/流动负债。</p>
<p><code>Cash ratio(现金比率)：</code>(现金+交易性证券)/流动负债</p>
<p><code>Defensive interval(防御区间)：</code>(现金+交易性证券+应收账款)/平均日开支。用来衡量公司流动资产能够覆盖日常开支的天数，通常需要大于45天。</p>
<h4 id="Solvency-ratio">Solvency ratio</h4>
<p>衡量公司偿付长期债务的能力。</p>
<p><code>Financial leverage(财务杠杆比率)：</code>资产(Assets)/权益(Equity)。财务杠杆越大表示负债越多，风险越大，收益率越高。</p>
<p><code>Interest coverage(利息保障倍数)：</code>EBIT(息税前利润)/利息。该比率大于1时代表公司盈利，反之代表亏损。</p>
<p><code>Fixed charge coverage(固定支出保障倍数)：</code>(EBIT+租金)/(利息+租金)。该比率大于1时代表公司盈利足够支付固定支出。</p>
<h4 id="Valuation-ratio">Valuation ratio</h4>
<p>公司投资估值的指标，反应公司股票是被高估还是被低估。主要指标为<code>市盈率(P/E)</code>，<code>市现率(P/CF)</code>，<code>市销率(P/S)</code>，<code>市净率(P/BV)</code>四个指标。估值指标需要与<code>市场基准(Benchmark)</code>比较才能知道高低，基准通常为可比公司或板块平均基准。关于估值指标的具体计算和应用会在股票科中详解。</p>
<h3 id="杜邦分析-Dupont-system-of-analysis">杜邦分析(Dupont system of analysis)</h3>
<p>使用杜邦分析法可以将净资产收益率(Return on equity)拆分分析，从而得出结论是公司的哪部分表现变化导致了净资产收益率的变化。</p>
<h4 id="三因子分析-three-part-approach">三因子分析(three-part approach)</h4>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mi>O</mi><mi>E</mi><mo stretchy="false">(</mo><mtext>净资产收益率</mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>N</mi><mi>I</mi></mrow><mrow><mi>S</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>s</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>净利率</mtext><mo stretchy="false">)</mo><mo>×</mo><mfrac><mrow><mi>S</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>总资产周转率</mtext><mo stretchy="false">)</mo><mo>×</mo><mfrac><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi></mrow><mrow><mi>E</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>财务杠杆</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ROE(净资产收益率)=\frac{NI}{Sales}(净利率)\times\frac{Sales}{Assets}(总资产周转率)\times\frac{Assets}{Equity}(财务杠杆)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">ROE</span><span class="mopen">(</span><span class="mord cjk_fallback">净资产收益率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">es</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">净利率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">es</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">总资产周转率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Eq</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">财务杠杆</span><span class="mclose">)</span></span></span></span></span></p>
<p>三因子分析中，净利润表示公司盈利能力，总资产周转率反映公司管理效率，财务杠杆反映公司财务风险。</p>
<h4 id="五因子分析-five-part-approach">五因子分析(five-part approach)</h4>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mi>O</mi><mi>E</mi><mo stretchy="false">(</mo><mtext>净资产收益率</mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>N</mi><mi>I</mi></mrow><mrow><mi>E</mi><mi>B</mi><mi>T</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>税负比率</mtext><mo stretchy="false">)</mo><mo>×</mo><mfrac><mrow><mi>E</mi><mi>B</mi><mi>T</mi></mrow><mrow><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>利息负担比率</mtext><mo stretchy="false">)</mo><mo>×</mo><mfrac><mrow><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow><mrow><mi>S</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>s</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>经营利润</mtext><mo stretchy="false">)</mo><mo>×</mo><mfrac><mrow><mi>S</mi><mi>a</mi><mi>l</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>总资产周转率</mtext><mo stretchy="false">)</mo><mo>×</mo><mfrac><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi><mi>s</mi></mrow><mrow><mi>E</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>t</mi><mi>y</mi></mrow></mfrac><mo stretchy="false">(</mo><mtext>财务杠杆</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">ROE(净资产收益率)=\frac{NI}{EBT}(税负比率)\times\frac{EBT}{EBIT}(利息负担比率)\times\frac{EBIT}{Sales}(经营利润)\times\frac{Sales}{Assets}(总资产周转率)\times\frac{Assets}{Equity}(财务杠杆)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">ROE</span><span class="mopen">(</span><span class="mord cjk_fallback">净资产收益率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">EBT</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">税负比率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">EBT</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">利息负担比率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">es</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">经营利润</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">es</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">总资产周转率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Eq</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal">sse</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord cjk_fallback">财务杠杆</span><span class="mclose">)</span></span></span></span></span></p>
<p>五因子分析将净利润进一步拆解出税负比率和利息负担比率，由此看出税负和利息对公司净资产收益率的影响。</p>
<h2 id="净盈余假设-Clean-surplus-relationship">净盈余假设(Clean surplus relationship)</h2>
<p>假设股东权益的增加只与留存收益的增加有关，一个公司的<code>长期净增长率</code>为<code>净资产收益率</code>乘<code>留存率</code>。表示为下式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>g</mi><mo stretchy="false">(</mo><mi>s</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>b</mi><mi>l</mi><mi>e</mi><mtext> </mtext><mi>g</mi><mi>r</mi><mi>o</mi><mi>w</mi><mi>t</mi><mi>h</mi><mtext> </mtext><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo stretchy="false">)</mo><mo>=</mo><mi>R</mi><mi>O</mi><mi>E</mi><mo>×</mo><mi>R</mi><mi>R</mi><mo>=</mo><mi>R</mi><mi>O</mi><mi>E</mi><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mfrac><mrow><mi>d</mi><mi>i</mi><mi>v</mi><mtext> </mtext><mi>d</mi><mi>e</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>r</mi><mi>e</mi><mi>d</mi></mrow><mrow><mi>O</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>n</mi><mi>g</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mtext> </mtext><mi>a</mi><mi>f</mi><mi>t</mi><mi>e</mi><mi>r</mi><mtext> </mtext><mi>t</mi><mi>a</mi><mi>x</mi><mi>e</mi><mi>s</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g(sustainable\ growth\ rate)=ROE\times RR=ROE \times(1-\frac{div\ declared}{Operating\ income\ after\ taxes})
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ainab</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">wt</span><span class="mord mathnormal">h</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">ROE</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">RR</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">ROE</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Op</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace"> </span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mord mathnormal">es</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">ec</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">re</span><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p>
<h1>Session 8</h1>
<h2 id="Reading-25-存货">Reading 25 存货</h2>
<p>资产负债表中计算存货的主要公式为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>O</mi><mi>G</mi><mi>S</mi><mo stretchy="false">(</mo><mtext>已售货物成本</mtext><mo stretchy="false">)</mo><mo>=</mo><mtext>初始存货</mtext><mo>+</mo><mtext>采购</mtext><mo>−</mo><mtext>年终存货</mtext></mrow><annotation encoding="application/x-tex">COGS(已售货物成本) = 初始存货+采购-年终存货
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">COGS</span><span class="mopen">(</span><span class="mord cjk_fallback">已售货物成本</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">初始存货</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">采购</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">年终存货</span></span></span></span></span></p>
<h3 id="资本化成本vs费用化成本">资本化成本vs费用化成本</h3>
<p>公司在生产过程中发生的成本可以被计入产品成本或生产费用，计入产品成本的成本被计入资产负债表中，该成本被<code>资本化(capitalized)</code>，计入生产费用的成本被计入利润表中，该成本被<code>费用化(expensed)</code>。成本资本化或费用化的标准以其成本发生时间在产品达到可销售状态前后为分界线。</p>
<p><code>资本化成本：</code>原料采购成本，转化成本(工厂人工与费用等)，俗称料工费。成本资本化可以将成本发生时间递延，产品销售时才确认成本。</p>
<p><code>费用化成本：</code>产品仓储成本，管理成本，销售成本，<code>生产过程中发生的非正常浪费</code>。</p>
<h3 id="存货计价方法">存货计价方法</h3>
<p>在IFRS准则下，存货的计价方法有<code>个别计价法(Specific identification)</code>，<code>先进先出法(FIFO)</code>，<code>加权平均法(Weighted average cost)</code>等三种方法，在US GAAP准则下除了这三种计价方法外还有一种<code>后进先出法(LIFO)</code>。</p>
<table>
<thead>
<tr>
<th>个别计价法</th>
<th>先进先出法</th>
<th>加权平均法</th>
<th>后进先出法</th>
</tr>
</thead>
<tbody>
<tr>
<td>每件商品以其实际的成本计算，其成本与存货价值计算最为准确，但操作成本较高。该方法通常用于销量少单价高的商品，例如珠宝奢侈品等。</td>
<td>大部分公司使用的计价方法，卖出的存货总以库存中最老的存货成本计算。通常导致成本被低估，但存货价值较为准确。</td>
<td>存货价值以库存存货的平均价值计算，该方法使用也较少。</td>
<td>只有US GAAP 准则中可以使用，卖出的存货总以库存中最新的存货成本计算。通常可以使货物成本被准确反映，但存货价值被低估。</td>
</tr>
</tbody>
</table>
<p><code>先进先出法</code>和<code>后进先出法</code>由于前者导致<code>成本被低估</code>，通常相较后者会导致更高的息税前利润与更高的赋税，从而导致更低的经营性现金流，以及更低的存货周转率等。当我们改变计价方法时，其他方法<code>改为后进先出法不需要追溯调整</code>，但其他改变都需要追溯调整。</p>
<h3 id="存货的核算体系-Periodic-vs-Perpetual">存货的核算体系(Periodic vs Perpetual)</h3>
<p>存货的核算体系有<code>定期盘存制(Periodic)</code>和<code>永续盘存制(Perpetual)</code>的区别之分。定期盘存制通常在每个会计月末进行库存和成本的核算，而永续盘存制则是一直以最新的价值来核算库存和成本。<code>先进先出法和个别计价法</code>在两个核算体系下算出的库存和成本价值<code>结果相同</code>，<code>后进先出法和加权平均法则不一样</code>。</p>
<h3 id="后进先出法转为先进先出法">后进先出法转为先进先出法</h3>
<p>为了对比使用FIFO和LIFO的两家公司的财务报表数据，金融分析师通常需要将LIFO的核算结果调整为FIFO。其转换的最关键的概念则是<code>LIFO Reserve</code>，当美国公司基于US GAAP准则以LIFO方法核算成本与库存时，他们需要同时披露<code>LIFO Reserve</code>的数值，该数值为<code>FIFO口径下的存货与LIFO口径下存货价值的差异</code>。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>存</mtext><msub><mtext>货</mtext><mrow><mi>F</mi><mi>I</mi><mi>F</mi><mi>O</mi></mrow></msub><mo>=</mo><mtext>存</mtext><msub><mtext>货</mtext><mrow><mi>L</mi><mi>I</mi><mi>F</mi><mi>O</mi></mrow></msub><mo>+</mo><mi>L</mi><mi>I</mi><mi>F</mi><mi>O</mi><mtext> </mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mspace linebreak="newline"></mspace><mi>C</mi><mi>O</mi><mi>G</mi><msub><mi>S</mi><mrow><mi>F</mi><mi>I</mi><mi>F</mi><mi>O</mi></mrow></msub><mo>=</mo><mi>C</mi><mi>O</mi><mi>G</mi><msub><mi>S</mi><mrow><mi>L</mi><mi>I</mi><mi>F</mi><mi>O</mi></mrow></msub><mo>−</mo><mi mathvariant="normal">Δ</mi><mi>L</mi><mi>I</mi><mi>F</mi><mi>O</mi><mtext> </mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mtext>（</mtext><mi>L</mi><mi>I</mi><mi>F</mi><mi>O</mi><mtext> </mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mtext>为时点数，在利润表需要记为变动值）</mtext><mspace linebreak="newline"></mspace><mi>N</mi><msub><mi>I</mi><mrow><mi>F</mi><mi>I</mi><mi>F</mi><mi>O</mi></mrow></msub><mo>=</mo><mi>N</mi><msub><mi>I</mi><mrow><mi>L</mi><mi>I</mi><mi>F</mi><mi>O</mi></mrow></msub><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>L</mi><mi>I</mi><mi>F</mi><mi>O</mi><mtext> </mtext><mi>R</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>T</mi><mi>a</mi><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">存货_{FIFO}=存货_{LIFO}+LIFO\ Reserve\\
COGS_{FIFO}=COGS_{LIFO}-\Delta LIFO\ Reserve（LIFO\ Reserve为时点数，在利润表需要记为变动值）\\
NI_{FIFO}=NI_{LIFO}+\Delta LIFO\ Reserve\times (1-Tax)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord cjk_fallback">存</span><span class="mord"><span class="mord cjk_fallback">货</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">FO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord cjk_fallback">存</span><span class="mord"><span class="mord cjk_fallback">货</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">FO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">FO</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.02778em;">eser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">COG</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">FO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal">COG</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">FO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">FO</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.02778em;">eser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">（</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">FO</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.02778em;">eser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord cjk_fallback">为时点数，在利润表需要记为变动值）</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">FO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">L</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">FO</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">Δ</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">FO</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.02778em;">eser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p>
<h3 id="后进先出法的清算-LIFO-Liquidation">后进先出法的清算(LIFO Liquidation)</h3>
<p>使用后进先出法计算COGS时可能由于公司生产效率下降使库存中的更便宜的旧存货慢慢被消耗导致在物价上涨阶段反而出现产品成本下降的现象，这个现象被称为<code>LIFO Liquidation</code>。如果一家公司出现该现象，首先说明当前COGS没有反映真实成本，其次LIFO Reserve会出现下降(因为库存量会有下降)。</p>
<h3 id="存货的减值-Inventory-Impairment">存货的减值(Inventory Impairment)</h3>
<p>存货的价值为历史成本估算，但可能出现特殊情况导致存货账面价值不能反映其真实价值，这时需要对其进行减值计算。</p>
<table>
<thead>
<tr>
<th>US GAAP</th>
<th>IFRS</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>账面价值</code>与<code>市场价值</code>中取其低者。<br />市场价值既是存货的<code>重置成本(replacement cost)</code>，且重置成本最低为<code>可实现净值-normal profit margin</code>，最高为可实现净值。</td>
<td><code>账面价值</code>与<code>可实现净值</code>中取其低者。<br /><code>可实现净值(Net realizable value) = 售价-销售成本</code></td>
</tr>
<tr>
<td>当存货账面价值高于市场价值时，存货应当在资产负债表中被减值为市场价值，减值以Loss计入利润表，减值后<code>不可以</code>转回。</td>
<td>当存货账面价值高于其可实现净值时，存货应当在资产负债表中被减值为可实现净值，减值以Loss计入利润表，IFRS准则中可以被最多重新转回至账面价值，转回以Gain计入利润表。</td>
</tr>
</tbody>
</table>
<h2 id="Reading-26-长期资产">Reading 26 长期资产</h2>
<h3 id="长期资产的资本化vs费用化">长期资产的资本化vs费用化</h3>
<p>长期资产与存货类似，需要对其成本进行资本化与费用化的分类，资本化的长期资产成本会记入<code>有形或无形资本(Tangible/Intangible Assets)</code>逐年减值或摊销。与存货相似，被资本化的费用计入资产负债表，费用化的费用计入利润表。另外存货的资本化与费用化不影响现金流量表，但长期资产的资本化费用被计入投资性现金流，费用化的费用被计入运营性现金流。</p>
<h4 id="资本化和费用化对报表的影响">资本化和费用化对报表的影响</h4>
<p>长期资产资本化或费用化对报表的影响主要体现在费用化会使账面<code>总资产</code>和<code>股东权益</code>更<code>高</code>，而其费用被作为减值或摊销成本摊至每年，因此会使每年的<code>净利润更加平稳</code>，并且会使<code>投资性现金流减少</code>（因为费用被计入CFI）。需要注意的是存货的资本化和费用化会影响公司的缴税数额，但<code>长期资产</code>的资本化和费用化<code>不会影响赋税</code>，因为存货部分税务报表与财务报表相同，因此只有存货的费用化影响的净利润会造成缴税数额的变化。</p>
<h4 id="资本化和费用化的认定">资本化和费用化的认定</h4>
<p>长期资产的资本化与费用化的分界线为<code>“资产达到可使用状态”</code>，即资产达到可使用状态前的成本资本化，反之则费用化。</p>
<p><code>资本化成本：</code>购买价格，税收，保险，运输费，安装测试费，<code>资产改良支出(该支出在可使用之后发生但成本资本化)</code>等。</p>
<p><code>费用化成本：</code>设备减值，修理维护费用，员工训练成本等。</p>
<h4 id="资本化的利息计算">资本化的利息计算</h4>
<p>正常情况下借款的利息成本都应该费用化计入利润表，但以构建固定资产为目的借款所产生的的利息应该被资本化计入资产负债表。</p>
<h3 id="无形资产-Intangible-Assets">无形资产(Intangible Assets)</h3>
<p>没有物理形态的长期资产，如技术、专利、品牌、口碑等都可被归类为无形资产。会计准则中无形资产分为三类：</p>
<p><code>可辨认的无形资产(Indentifiable IA)：</code>可以被直接买卖的如<code>专利(Patents)</code>、<code>商标(Trademarks)</code>、<code>版权(Copyright)</code>等有有限或无限使用期限的无形资产，计入资产负债表。</p>
<p><code>不可辨认的无形资产(Unidentifiable IA)：</code>不可以被直接购买的无形资产，比如<code>商誉(Goodwill)</code>，通常是购买资产时对方品牌的溢价部分，计入资产负债表。</p>
<p><code>自主研发的无形资产(Internally generated)：</code>研发费用中<code>研究(Research)</code>费用被费用化，<code>开发(Development)</code>费用在IFRS准则中满足特定条件后可以费用化，在US GAAP准则中除<code>内部使用的软件的开发</code>以外开发费用也要被费用化。</p>
<p>有使用期限的无形资产按年限摊销，没有使用期限的无形资产要每年进行<code>减值测试(Annual impairment test)</code>。</p>
<h3 id="折旧摊销方法">折旧摊销方法</h3>
<p>所谓折旧摊销就是将长期资产的成本在其使用期间进行系统性的成本分摊，分析师需要注意报表上的折旧费用可能与实际的设备折旧损耗不同。折旧摊销主要有三种计算方法：</p>
<p><code>直线法(Straight line)：</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>每年花费</mtext><mo>=</mo><mo stretchy="false">(</mo><mtext>原值</mtext><mo>−</mo><mtext>残值</mtext><mo stretchy="false">)</mo><mi mathvariant="normal">/</mi><mtext>使用寿命</mtext></mrow><annotation encoding="application/x-tex">每年花费=(原值-残值)/使用寿命</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">每年花费</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">原值</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">残值</span><span class="mclose">)</span><span class="mord">/</span><span class="mord cjk_fallback">使用寿命</span></span></span></span></p>
<p><code>双倍余额递减法(Double declining balance)：</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>每年花费</mtext><mo>=</mo><mtext>（</mtext><mn>2</mn><mi mathvariant="normal">/</mi><mtext>使用寿命）</mtext><mo>×</mo><mtext>当年初的资产净值</mtext></mrow><annotation encoding="application/x-tex">每年花费=（2/使用寿命）\times 当年初的资产净值</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">每年花费</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">（</span><span class="mord">2/</span><span class="mord cjk_fallback">使用寿命）</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">当年初的资产净值</span></span></span></span></p>
<p><code>生产单位折旧法(Units-of-production)：</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>每年花费</mtext><mo>=</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mtext>原值</mtext><mo>−</mo><mtext>残值</mtext><mo stretchy="false">)</mo><mo>×</mo><mtext>期限内产值</mtext><mo stretchy="false">]</mo><mi mathvariant="normal">/</mi><mtext>设备总产值</mtext></mrow><annotation encoding="application/x-tex">每年花费=[(原值-残值)\times 期限内产值]/设备总产值</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">每年花费</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[(</span><span class="mord cjk_fallback">原值</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">残值</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">期限内产值</span><span class="mclose">]</span><span class="mord">/</span><span class="mord cjk_fallback">设备总产值</span></span></span></span></p>
<p>双倍余额递减法又称加速折旧法，相较与直线法其特点是前期折旧速度块，后期折旧速度慢，因此<code>前期</code>加速法会导致<code>更高的减值成本和更低的净利润</code>从而影响其他指标，后期相反。但两种方法均<code>不影响赋税数额</code>。</p>
<p>由于资产的折旧与摊销中的<code>使用年限</code>和<code>资产残值</code>都基于主观估计，因此常被公司用于调整财务报表。</p>
<h3 id="资产的减值-Impairment">资产的减值(Impairment)</h3>
<h4 id="IFRS准则下的减值">IFRS准则下的减值</h4>
<p>当资产的<code>账面价值(Carrying value)</code>大于资产的<code>可回收价值(Recoverable amount)</code>时，对资产进行减值同时在利润表中计入减值损失。资产的可回收价值取<code>处置价值(即公允价值-处置成本)</code>和<code>使用价值(即未来可产生现金流的现值)</code>中的孰高值。</p>
<h4 id="US-GAAP准则下的减值">US GAAP准则下的减值</h4>
<p>美国准则下的资产减值分为两步，第一步为<code>定性判断</code>，若资产的<code>账面价值</code>大于该资产未来产生的<code>不折现</code>现金流，则不需要减值。若定性为需要减值，则第二步计算<code>减值金额为资产账面价值减去资产的市场公允价值或未来现金流的现值</code>。</p>
<h4 id="资产减值对财务报表的影响">资产减值对财务报表的影响</h4>
<p>资产减值对现金流没有影响，但会导致资产负债表中资产减少，同时利润表计入了减值损失，从而影响其他财务数字。主要注意的是，减值虽然会<code>减少当年的净利润</code>，但会<code>增加未来年度的净利润</code>，因为资产减值会使未来的折旧数额减少。</p>
<h4 id="减值的转回">减值的转回</h4>
<p>与存货类似，US GAAP准则下大部分减值<code>不允许</code>转回，<code>用于销售的资产(Held for sale)</code>除外。IFRS准则下大部分减值<code>允许</code>转回，<code>商誉(Goodwill)</code>除外。</p>
<h3 id="长期资产的重估-Revaluation">长期资产的重估(Revaluation)</h3>
<p>在计算长期资产的<code>净值(Net Book Value)</code>时，US GAAP通常使用<code>历史成本模型(Historical cost model)</code>,即原值减去减值和折旧后得到净值，但IFRS准则下除了使用成本模型，还可以使用重估模型计算资产净值。如果公司使用重估模型对资产估值时，发生的损失计入利润表，发生的利润计入资产负债表的其他综合收益(OCI)，但需要特别注意当发生价值转回时，<code>先抵原账户</code>，即之前若之前重估导致利润表发生损失，转回时先将这部分计回利润表，其他多出部分才计入其他综合收益；同理若之前重估导致其他综合收益计入收益，损失掉时先扣除OCI中这部分，剩下才计入利润表。</p>
<p>另外需要注意，重估模型下资产依然要进行折旧摊销，每年的折旧费用根据其重估后的价值计算。</p>
<h3 id="资产的核销-De-recognition">资产的核销(De-recognition)</h3>
<p>长期资产会在被<code>售卖(sold)</code>、<code>丢弃(abandoned)</code>和<code>交换(exchnaged)</code>三种情况下会被从资产负债表中消除。</p>
<h3 id="投资性房地产-Investment-Property">投资性房地产(Investment Property)</h3>
<p>当公司所有的房产以自用为目的时计入固定资产，但若<code>以出租为目的</code>时计入<code>投资性房地产</code>，若以售卖为目的可以计入存货。在US GAAP准则下，投资性房地产与普通固定资产没有区别，因此这个概念只适用于IFRS准则。</p>
<p>投资性房地产的估值方法也有成本模型和公允价值模型(fair value model)两种方法， 公允价值模型与重估模型虽然都根据公允价值为资产估值，但不同于重估模型的收益计入其他综合收益，公允价值模型中的收益和损失都计入利润表。</p>
<h2 id="Reading-27-递延所得税">Reading 27 递延所得税</h2>
<p><code>递延所得税(Deffered Income tax)</code>是由于基于会计准则编制的财务报表与基于税法编制的税务报表的规定或计算不同导致的缴税款与实际公司财务记账金额不同时产生的科目，本年度相较财务报表数额实际<code>多/少</code>缴的税款需要计入递延所得税<code>资产/负债</code>。</p>
<h3 id="财务报表术语vs税务报表术语">财务报表术语vs税务报表术语</h3>
<table>
<thead>
<tr>
<th></th>
<th>财务报表</th>
<th>税务报表</th>
</tr>
</thead>
<tbody>
<tr>
<td>利润</td>
<td>Accounting Profit(会计利润)</td>
<td>Taxable income(应纳税所得额)</td>
</tr>
<tr>
<td>所得税</td>
<td>Income tax expense(所得税费用)</td>
<td>Taxes payable(应交税金)</td>
</tr>
<tr>
<td>资产/负债</td>
<td>Carrying value(账面价值)</td>
<td>Tax base(税基)</td>
</tr>
</tbody>
</table>
<p>关于财务报表与税务报表的科目区别，除了以上的对应科目以外，还有一些各自专属的科目：</p>
<p><code>递延所得税负债和递延所得税资产(Deferred tax liabilities&amp;Deferred tax assets)：</code>在会计报表的资产负债表中计入的本年度财务与税务报表的差距，本年度多缴的税计入递延所得税资产，少缴的税计入递延所得税负债。</p>
<p><code>递延所得税减值(Valuation allowance)：</code>会计报表备抵科目，递延所得税资产可能不能被兑现时计入该资产的减值。</p>
<p><code>以前年度亏损(Tax loss carry forward)：</code>该科目为税务报表科目，若公司以往年度出现过亏损，该亏损可以被带往将来年度抵减税款，一般可抵减年限有限制。</p>
<h3 id="暂时性差异vs永久性差异">暂时性差异vs永久性差异</h3>
<p>递延所得税由财务报表和税务报表的差异造成，但<code>只有暂时性差异可以产生递延所得税</code>。永久性差异例如公司遭受的罚款导致比会计报表中多交的税金或公司购买国债利息收入的免税金额等，不会导致递延所得税。因为永久性差异不会导致公司未来资金的流入或流出。</p>
<h3 id="计算递延所得税">计算递延所得税</h3>
<p>递延所得税的计算方法一般有<code>利润表法</code>和<code>资产负债表法</code>，通常使用利润表法可以快速定性递延所得税是资产还是负债，而当要计算具体金额时，使用资产负债表法会更方便。</p>
<p><code>利润表法：</code>会计报表和税务报表每年的税前收益差异乘上当年税率相加至所需年度，若实际多交税则记递延所得税资产，反之记递延所得税负债。</p>
<p><code>资产负债表法：</code>若需要计算的科目为<code>资产科目</code>，则使用<code>(财务价值-税务价值)*税率</code>；若需要计算的科目为<code>负债科目</code>，则使用<code>(税务价值-财务价值)*税率</code>。最后结果若为<code>正数</code>，则为<code>递延所得税负债</code>；若结果为<code>负数</code>，则为<code>递延所得税资产</code>。</p>
<h3 id="导致递延所得税的常见科目">导致递延所得税的常见科目</h3>
<p><code>固定资产(Fixed assets)：</code>由于财务报表与税务报表的减值口径不同，导致固定资产的账面价值差异造成递延所得税。通常财务报表为展示更多利润，会延长折旧年限等，造成实际交税更少，形成递延所得税负债。</p>
<p><code>无形资产(Intangible assets)：</code>财务报表的研发费用倾向于被费用化，但税务报表允许无形资产研发资本化。因此财务报表利润较税务报表少，因此实际交税较多，形成递延所得税资产。</p>
<p><code>应收账款(Account receivable)：</code>财务报表中的坏账准备金不允许被记入税务报表，因此财务报表中的利润较税务报表少，因此实际交税多，形成递延所得税资产。</p>
<p><code>预收账款(Unearned revenue)：</code>收款时直接计入税务报表，但财务报表要等到交易完成后才能确认，因此税务报表中利润更大，导致实际缴税金额大，形成递延所得税资产。</p>
<p><code>保修费用(Warranty liability)：</code> 对保修的准备金，与坏账准备金类似，税务报表中等到保修费用实际支出时才被确认，因此财务报表中利润较低，实际缴税金额高，形成递延所得税资产。</p>
<h3 id="税率改变的影响">税率改变的影响</h3>
<p>若税率发生改变，而税务与财务差异不变：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>新递延所得税</mtext><mo>=</mo><mtext>旧递延所得税</mtext><mo>×</mo><mfrac><mtext>新税率</mtext><mtext>旧税率</mtext></mfrac></mrow><annotation encoding="application/x-tex">新递延所得税=旧递延所得税 \times \frac{新税率}{旧税率}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">新递延所得税</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">旧递延所得税</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">旧税率</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">新税率</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>若税率和税务与财务表差异同时发生：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>财务口径所得税费用</mtext><mo>=</mo><mtext>当年新增的税法口径应交税金</mtext><mo>+</mo><mtext>当年新增的递延所得税负债</mtext><mo>−</mo><mtext>当年新增的递延所得税资产</mtext></mrow><annotation encoding="application/x-tex">财务口径所得税费用=当年新增的税法口径应交税金+当年新增的递延所得税负债-当年新增的递延所得税资产
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">财务口径所得税费用</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">当年新增的税法口径应交税金</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">当年新增的递延所得税负债</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">当年新增的递延所得税资产</span></span></span></span></span></p>
<h3 id="有效税率-Effective-Tax-Rate">有效税率(Effective Tax Rate)</h3>
<p>实际操作中，公司的有效税率由公司当年实际缴税额除以公司税前利润。有五个可能原因导致有效税率与<code>税法规定税率(Statutory Tax Rate)</code>不同：</p>
<ol>
<li>公司在不同地区所得税税率不同。</li>
<li>永久性差异导致有效税率与法定税率不同。</li>
<li>年内税率改变。</li>
<li>海外子公司获得的利润在当年缴付给当地的税款可能高于母公司所在地的法定税率。</li>
<li>特定地区免税期或其他特定优惠政策等。</li>
</ol>
<h3 id="递延所得税分析">递延所得税分析</h3>
<p>当递延所得税资产有较高概率不能被实现时，计<code>递延所得税减值(Valuation allowance)</code>。若递延所得税负债在未来有较高概率不能被实现，分析师可以将该部分当作<code>股东权益</code>；若可能被实现则当作<code>实际负债</code>；若未来实现的概率不确定，则<code>忽略</code>该科目。</p>
<h2 id="Reading-28-长期负债">Reading 28 长期负债</h2>
<p>本章主要关注应付票据或应付债券等以融资为目的的长期负债以及融资租赁中应付租赁款的核算方法。其中<code>持有至到期债券(Held-to-maturity)</code>的核算方法在Reading 22中已经覆盖过。</p>
<h3 id="债券记账">债券记账</h3>
<p>当公司发行债券时应以债券未来现金流的现值在<code>资产负债表</code>中计入<code>应付债券(Bond Payable)</code>并获得<code>等额现金</code>，每年在<code>利润表</code>中计入<code>以现值计算的利息费用</code>，在<code>现金流量表</code>中计入支付的<code>票面利息(coupon)</code>。</p>
<p><code>市场利率&gt;票面利率：</code>票面利率低因此债券比票面更便宜，每年实际支付的票面利息低于自然利息，因此经营性现金流被高估，投资性现金流被低估。</p>
<p><code>市场利率=票面利率：</code>每年年末价值都等于账面价值。</p>
<p><code>市场利率&lt;票面利率：</code>票面利率高因此债券比票面更值钱，每年实际支付的票面利息高于自然利息，因此经营性现金流被低估，投资性现金流被高估。</p>
<h4 id="零息债券">零息债券</h4>
<p>计算<code>零息债券(Zero coupon bond)</code>时与上方方法一样，只是不付票面利息，可以以市场利率&gt;票面利率的债券计算。</p>
<h4 id="发行成本">发行成本</h4>
<p>在US GAAP准则下，<code>发行成本资本化(Deferred charge)</code>并在债券存续期间摊销。在IFRS准则下，发行成本直接从融资中扣除。</p>
<h4 id="公允价值估值">公允价值估值</h4>
<p>上方提到的记账方法使用的市场利率为债券发行时的市场利率，但公司可以选择使用公允价值来对应付债券估值，这时市场利率的波动和发行公司的信用风险波动都会导致债券市场价格的变动。</p>
<h4 id="债券中止确认-Derecognition-of-Debt">债券中止确认(Derecognition of Debt)</h4>
<p>债券发行公司可能会在债券到期前提前赎回债券。可能原因有：1. 市场利息大幅下跌。2. 公司经营过程中产生盈余现金。3. 公司通过发售股票获得额外资金。</p>
<h4 id="债券条款-Debt-Covenant">债券条款(Debt Covenant)</h4>
<p>债券的常见条款有两类，肯定条款(affirmative covenant)和否定条款(negative covenants)。其中肯定条款包括公司要按时支付本金利息，维持财务指标，维护抵押物等。否定条款包括公司不能使用借款支付股利或回购股票，不能发行更多债券，不能进行公司并购。</p>
<h3 id="融资租赁和经营租赁">融资租赁和经营租赁</h3>
<p>经营租赁和融资租赁的主要区别在于经营租赁为支付租金换取使用权，融资租赁则是分期付款，付完时获得资产。在IFRS准则下只有融资租赁没有经营租赁，而在<code>US GAAP准则下</code>只要满足一下任意一个条件即为融资租赁：</p>
<ol>
<li>租赁期结束时资产的所有权转至承租人。</li>
<li>租赁期结束时承租人可以以较低的价格购买资产。</li>
<li>承租期占资产可使用年限的75%以上。</li>
<li>所付租金的现值占资产公允价值的90%或以上。</li>
<li>定制化资产，租赁资产只能由承租人使用。</li>
</ol>
<h3 id="融资租赁的记账方法">融资租赁的记账方法</h3>
<p>租赁时首先资产计入固定资产，同时负债中计入应付租赁款，这数额以未来租金的现值计算。利润表中计算摊销折旧费用以及负债的利息费用，现金流量表中计入每年实际支付的租金。</p>
<h3 id="养老金">养老金</h3>
<p>美国上市公司给员工的养老金分为<code>Defined conrtibution plan(DC plan)</code>和<code>Defined benefit plan(DB plan)</code>两种，其中DC plan的养老金风险由员工承担，DB plan的养老金风险由公司承担。另外养老金中资产与负债可以互相抵消，以净值计算。</p>
<h1>Session 9</h1>
<h2 id="Reading-29-财务报表质量">Reading 29 财务报表质量</h2>
<p>财务报表质量在CFA二级和三级中是非常重要的部分，但一级中只要知道大致概念即可。</p>
<h3 id="财务报表质量档次">财务报表质量档次</h3>
<p>公司财务报表质量由高到底分别为：</p>
<ol>
<li>真实，可供投资参考，可持续，盈利充足(支付股东资金成本后仍有盈余)。</li>
<li>真实，可供投资参考，不可持续，较低盈利质量。</li>
<li>符合会计准则，但会计方法选择有偏差。</li>
<li>符合会计准则，但有意利用方法操纵利润。</li>
<li>不符合会计准则。</li>
<li>财务报表造假。</li>
</ol>
<h3 id="常见的财务造假方法">常见的财务造假方法</h3>
<table>
<thead>
<tr>
<th>做高利润</th>
<th>做低利润</th>
</tr>
</thead>
<tbody>
<tr>
<td>资本化当期成本</td>
<td>费用当期成本</td>
</tr>
<tr>
<td>调高固定资产使用寿命</td>
<td>调低固定资产使用寿命</td>
</tr>
<tr>
<td>调高固定资产残值</td>
<td>调低固定资产残值</td>
</tr>
<tr>
<td>调整折旧方法(使用直线法)</td>
<td>加速折旧</td>
</tr>
<tr>
<td>推迟确认减值</td>
<td>提前确认减值</td>
</tr>
<tr>
<td>少记坏账准备金</td>
<td>多记坏账准备金</td>
</tr>
<tr>
<td>降低递延所得税减值</td>
<td>提高递延所得税减值</td>
</tr>
</tbody>
</table>
<h3 id="舞弊三角-Fraud-triangle">舞弊三角(Fraud triangle)</h3>
<p>通常判断公司财务造假可能的三个条件，如果公司具有三点其财务造假的可能性较高：</p>
<ol>
<li><strong>造假动机(Motivation)</strong></li>
<li><strong>造假机会(Opportunity)</strong></li>
<li><strong>造假的自我辩护(Rationalization)</strong></li>
</ol>
<h2 id="Reading-30-财务报表分析应用">Reading 30 财务报表分析应用</h2>
<p>分析师可以使用财务报表分析：</p>
<ol>
<li>判断公司的商业模式和盈利模式</li>
<li>对公司进行盈利预测</li>
<li>对比不同口径的财务报表</li>
</ol>
<p>[第13篇]</p>
]]></content>
      <categories>
        <category>金融分析</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>CFA一级</tag>
        <tag>财务报表分析</tag>
      </tags>
  </entry>
  <entry>
    <title>[数据分析] 使用R做EDA分析的基础知识</title>
    <url>/2022/04/09/14-R-EDA-basics/</url>
    <content><![CDATA[<h1>序言</h1>
<p>因为最近想要给公司做一些预测性模型来标注保单的取消风险而提取了一些相关的数据，在使用机器学习模型之前按照惯例需要对数据进行一些<code>探索性分析(EDA, Exploratory Data Analysis)</code>，并可能以此结果来指导机器学习模型的建造。那么在这篇里就先介绍一些EDA分析的例行步骤，以及如何使用<code>R</code>来实现这些步骤。</p>
<h1>正文</h1>
<p>我在查找资料的时候发现了一个针对EDA教学且解释非常细致的教学网站，是<a href="https://datacarpentry.org/R-ecology-lesson/index.html" title="Data Analysis and Visualization in R for Ecologists">Data Carpentry</a>为生态学家使用R分析数据做的基础指南，虽然在标题中表现出相当的特殊性，但实际内容却是针对EDA分析的一般性知识。我会根据他的内容和结构大致介绍如何使用R来进行EDA分析。</p>
<h2 id="读取数据">读取数据</h2>
<p>使用R做数据分析必须要介绍的一个包就是<a href="https://www.tidyverse.org/" title="Tidyverse">Tidyverse</a>，这是一个集合了数据收集，转换，清洗，可视化等一系列满足数据科学需求的包的集合。<code>Tidyverse</code>中包括的<code>reader</code>包就是用来读取数据的工具，通常我们会使用<code>read_csv()</code>包来将<code>csv文件</code>读取为R中的数据框对象。</p>
<p>关于<code>read_csv()</code>的参数设置，如果直接以文件名读取文件而不设置任何参数的话，经常会导致如下图所示，第一列数据表头的读取错误，这时我们需要在函数中加入<code>fileEncoding = &quot;UTF-8-BOM&quot;</code>,因为<code>read_csv()</code>默认解码方式是使用<code>无BOM的UTF-8</code>，这样读取一些带有BOM这种文件头的文件就会被错误解码。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220426214059545.png" alt="第一列列名读取错误"></p>
<p>另外两个我用得比较多的参数是<code>stringsAsFactors</code>和<code>na.strings</code>。<code>stringsAsFactors</code>设置为<code>TRUE</code>时R会将文件中读取的字段按<code>因子(factor)</code>处理，这样当数据中需要作为训练使用的字符串格式字段较多时不需要将他们逐一转换为因子格式。<code>na.strings</code>则被用于认定丢失值，也就是说数据中出现这个参数设置的值时这条数据会被认为<code>NA</code>。<code>read_csv()</code>的使用示例如下 ：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;data_clean.csv&quot;</span><span class="punctuation">,</span> fileEncoding <span class="operator">=</span> <span class="string">&quot;UTF-8-BOM&quot;</span><span class="punctuation">,</span> stringsAsFactors <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>na.strings <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="string">&quot; &quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h2 id="数据检视">数据检视</h2>
<p>数据拿到手的第一件事是查看数据的大致情况，R有一些简单的公式可以让分析师对数据有一些快速简单的了解。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>df.raw<span class="punctuation">)</span> <span class="comment"># 返回对象的类型，例如data.frame</span></span><br><span class="line">str<span class="punctuation">(</span>df.raw<span class="punctuation">)</span> <span class="comment"># 返回对象及内部元素的结构概览</span></span><br><span class="line">view<span class="punctuation">(</span>df.raw<span class="punctuation">)</span> <span class="comment"># 使用Rstudio的Data viewer来检视数据，可以看到所有数据并有简单的查找，筛选，排序等功能。</span></span><br><span class="line">head<span class="punctuation">(</span>df.raw<span class="punctuation">)</span> <span class="comment"># 默认检视对象中的前n条数据，n默认为6。类似的还有tail()，用于检视最后n条数据</span></span><br><span class="line">summary<span class="punctuation">(</span>df.raw<span class="punctuation">)</span> <span class="comment"># 用于获取数据框中每列数据的简单统计情况</span></span><br></pre></td></tr></table></figure>
<h3 id="数据框数据">数据框数据</h3>
<p><code>数据框格式(data frame)</code>数据是数据分析中最常见的数据格式之一，它的特点是将数据以表格的形式储存，每一列都是一个长度相等的<code>向量(vector)</code>，而每一行则代表一条数据，由于列的本质是向量，因此每列中的数据类型都应该相同。数据框数据的引用方法：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">]</span> <span class="comment">#选出第2行第6列的数据，以数据框格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span> <span class="punctuation">]</span> <span class="comment">#选出第2行所有列的数据，以数据框格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">]</span> <span class="comment">#选出所有行第6列的数据，以数据框格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[</span><span class="number">6</span><span class="punctuation">]</span> <span class="comment">#省略逗号时效果同上，选出所有行第6列的数据，以数据框格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment">#选出第1，2，3行第5，6列的所有数据，以数据框格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">5</span><span class="operator">:</span><span class="number">6</span><span class="punctuation">]</span> <span class="comment">#效果同上，1:3表示1至3的整数序列</span></span><br><span class="line">df.raw<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="comment"># 选出所有行第1列数据，以向量格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span> <span class="comment"># 选出第1行第1列数据，以值的格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span> <span class="comment"># 数字前加-号表示去除该坐标，选出其余所有数据，以数据框格式返回</span></span><br><span class="line">df.raw<span class="punctuation">[</span><span class="string">&quot;id&quot;</span><span class="punctuation">]</span> <span class="comment">#还可以以列名的格式选择到列，返回格式为数据框</span></span><br><span class="line">df.raw<span class="operator">$</span>id <span class="comment">#$符号加列名表示以向量格式返回该列数据</span></span><br></pre></td></tr></table></figure>
<h3 id="因子">因子</h3>
<p><code>因子(factors)</code>是R中存储<code>分类数据(categorical data)</code>时所用的一种特色的数据格式，这些数据的特点是它们会从有限数量的可能值中取值。一个因子类的变量一旦被创建，它就只能从预设集中取值，这些预设集被称为<code>水平值(levels)</code>，而因子变量本身则被以与这些水平集中的<code>标签(labels)</code>一一对应的<code>整数</code>储存。因此虽然因子变量看起来像字符变量，但实际上在数据处理时他们是被当成<code>整型向量</code>处理。</p>
<h4 id="将其他类型变量转换为因子类型">将其他类型变量转换为因子类型</h4>
<p>虽然我们在读取数据时已经设置过了将字符串形式数据以因子形式储存，但即使不这样做我们也可以用<code>factor()</code>方程来手动将需要转换的字符型列转换为因子型。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw<span class="operator">$</span>id <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>df.raw<span class="operator">$</span>id<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="将因子变量水平值排序">将因子变量水平值排序</h4>
<p>通常R会按字母顺序排列水平值并编号，但有些时候由于水平值本身有顺序含义(例如大中小)，因此R也提供了手动将水平值排序的功能。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw<span class="operator">$</span>id <span class="operator">&lt;-</span> factor<span class="punctuation">(</span>df.raw<span class="operator">$</span>id<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;第一&quot;</span>，<span class="string">&quot;第二&quot;</span><span class="punctuation">,</span> <span class="string">&quot;第三&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h4 id="因子型变量转换为其他类型">因子型变量转换为其他类型</h4>
<p>如果需要将因子类型转换为数字或字符类型需要注意一点，因为因子类型本身以数字形式储存，所以直接对因子类型数据使用<code>as.numeric()</code>会导致变量被直接转换为因子储存的整数索引值，正确方法应该如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="built_in">as.character</span><span class="punctuation">(</span>sex<span class="punctuation">)</span> <span class="comment">#因子型转换为字符型时可以直接使用as.character</span></span><br><span class="line"><span class="built_in">as.numeric</span><span class="punctuation">(</span><span class="built_in">as.character</span><span class="punctuation">(</span>year_fct<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 若要将因子标签转换为数字型，需要先转换为字符型</span></span><br><span class="line"><span class="built_in">as.numeric</span><span class="punctuation">(</span>levels<span class="punctuation">(</span>year_fct<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">[</span>year_fct<span class="punctuation">]</span> <span class="comment"># 效率更高的方法是先将所有标签一一转换为数字，然后将这些数字对应至变量中</span></span><br></pre></td></tr></table></figure>
<h4 id="因子水平值重命名">因子水平值重命名</h4>
<p>在R中，如果一个因子变量中存在缺失值，这些缺失值会被默认忽视，他们不会有自己的水平值。但事实情况中存在一些留有信息的缺失值，比如因为特定情况导致特定记录的值无法采集，这种情况下如果忽略这些缺失值实际上是丢失了有效信息，因此不同情况下我们也需要把缺失值放入水平值集中并可能需要重命名。</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">sex <span class="operator">&lt;-</span> surveys<span class="operator">$</span>sex</span><br><span class="line">levels<span class="punctuation">(</span>sex<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] &quot;F&quot; &quot;M&quot; NA</span></span><br><span class="line">sex <span class="operator">&lt;-</span> addNA<span class="punctuation">(</span>sex<span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>sex<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] M    M    &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; &lt;NA&gt;</span></span><br><span class="line"><span class="comment">#&gt; Levels: F M &lt;NA&gt;</span></span><br><span class="line">levels<span class="punctuation">(</span>sex<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&quot;undetermined&quot;</span></span><br><span class="line">head<span class="punctuation">(</span>sex<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#&gt; [1] M            M            undetermined undetermined undetermined</span></span><br><span class="line"><span class="comment">#&gt; [6] undetermined</span></span><br><span class="line"><span class="comment">#&gt; Levels: F M undetermined</span></span><br></pre></td></tr></table></figure>
<p>总结下来就是使用<code>addNA()</code>可以将缺失值加入因子型变量中，然后使用<code>levels(sex)[3] &lt;- &quot;undetermined&quot;</code>则可以将<code>undetermined</code>赋值给<code>sex</code>的第<code>3</code>个水平值。</p>
<h2 id="数据清洗">数据清洗</h2>
<p>在这一步中我们需要挑选，调整，创建一系列的变量，来达到获得理想的适合进行数据分析的数据集的结果。我们首先介绍一些<code>tidyverse</code>中<code>dplyr</code>包的功能，这个包中的函数可以实现上面提到的大部分数据操作。</p>
<h3 id="挑选和筛选">挑选和筛选</h3>
<p>要做数据清洗首先需要的第一个功能就是以特定需求挑选所需的数据，<code>dplyr</code>包中的<code>select()</code>和<code>filter()</code>就是分别用来挑选数据列和行的。具体用法如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">select<span class="punctuation">(</span>df.raw<span class="punctuation">,</span> id<span class="punctuation">,</span> sex<span class="punctuation">,</span> age<span class="punctuation">)</span> <span class="comment"># 第一个参数为数据框，其他为需要挑选的列</span></span><br><span class="line">select<span class="punctuation">(</span>df.raw<span class="punctuation">,</span> <span class="operator">-</span>id<span class="punctuation">,</span> <span class="operator">-</span>sex<span class="punctuation">)</span> <span class="comment"># 在列前加-号表示不需要该列</span></span><br><span class="line">filter<span class="punctuation">(</span>df.raw<span class="punctuation">,</span> sex <span class="operator">==</span> <span class="string">&quot;M&quot;</span><span class="punctuation">)</span> <span class="comment"># 筛选符合条件的记录</span></span><br></pre></td></tr></table></figure>
<p>通常在我们处理数据集时要将数据集先后进行各种操作，如果将他们逐一赋值或嵌套会非常混乱且麻烦，因此<code>dplyr</code>也提供了方便的<code>pipe</code>功能，可以将前一步操作的结果直接输入下一步操作的第一个参数。例如我们想要从<code>df.raw</code>中先筛选出性别为<code>M</code>的记录，然后选出他们的<code>age</code>与<code>id</code>作为数据集：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw <span class="operator">%&gt;%</span> <span class="comment">#将df.raw输入到下一步</span></span><br><span class="line">  filter<span class="punctuation">(</span>sex <span class="operator">==</span> <span class="string">&quot;M&quot;</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> <span class="comment"># 筛选，第一个参数为df.raw</span></span><br><span class="line">  select<span class="punctuation">(</span>age<span class="punctuation">,</span> id<span class="punctuation">)</span> <span class="comment"># 挑选，第一个参数为filter(df.raw, sex == &quot;M&quot;)</span></span><br></pre></td></tr></table></figure>
<p>上方步骤中，<code>%&gt;%</code>这个符号是代表<code>pipe</code>的操作符，在<code>Rstudio</code>中可以使用<code>Ctrl + Shift + M</code>来快速输入。</p>
<h4 id="is-na"><a href="http://is.na">is.na</a>()</h4>
<p><code>is.na()</code>公式是在用来判断对象是否为缺失值的公式，可以配合<code>filter()</code>公式使用来排除某列中为空的记录：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw <span class="operator">%&gt;%</span></span><br><span class="line">  filter<span class="punctuation">(</span><span class="operator">!</span><span class="built_in">is.na</span><span class="punctuation">(</span>sex<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 将sex列值缺失的记录筛选出去，!符号代表不需要</span></span><br></pre></td></tr></table></figure>
<h3 id="创建新列">创建新列</h3>
<p>通常如果我们需要在数据集中根据已有列创建新列，就需要使用<code>mutate()</code>函数。他的使用方法非常简单：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">mutate<span class="punctuation">(</span>df.raw<span class="punctuation">,</span> salary_in_k <span class="operator">=</span> salary<span class="operator">/</span><span class="number">1000</span><span class="punctuation">)</span> <span class="comment"># 创建一个名叫salary_in_k的列，内容为salary/1000</span></span><br><span class="line">df.raw <span class="operator">%&gt;%</span></span><br><span class="line">mutate<span class="punctuation">(</span>salary_in_k <span class="operator">=</span> salary<span class="operator">/</span><span class="number">1000</span><span class="punctuation">)</span> <span class="comment"># 以pipe的方式实现上句</span></span><br></pre></td></tr></table></figure>
<p>而我们通常在创建新列的时候除了进行计算，也会做一些例如判断或将连续变量离散化分组的操作，下面介绍的两个函数就可以帮助完成这两个操作。</p>
<h4 id="cut">cut()</h4>
<p><code>cut()</code>函数可以被用来对连续变量进行离散化分组，实际用法如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw <span class="operator">%&gt;%</span></span><br><span class="line">  mutate<span class="punctuation">(</span>Age <span class="operator">=</span> cut<span class="punctuation">(</span>Age<span class="punctuation">,</span> breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">14</span><span class="punctuation">,</span><span class="number">24</span><span class="punctuation">,</span><span class="number">64</span><span class="punctuation">,</span><span class="literal">Inf</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Children&quot;</span><span class="punctuation">,</span><span class="string">&quot;Youth&quot;</span><span class="punctuation">,</span><span class="string">&quot;Adult&quot;</span><span class="punctuation">,</span><span class="string">&quot;Senior&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>include.lowest <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>该函数中，<code>breaks</code>参数既可以取不同取值点，也可以使用整数表示将区间平分为整数个。<code>include.lowest</code>设定为<code>TRUE</code>时分组区间的最左边区间会取双闭区间。其他参数或具体示例可以参考<a href="https://r-coder.com/cut-r/" title="Cut function in R">该网站</a>。</p>
<h4 id="ifelse">ifelse()</h4>
<p><code>ifelse()</code>函数可以用来做各种判断取值，实际用法如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw <span class="operator">%&gt;%</span></span><br><span class="line">  mutate<span class="punctuation">(</span>NOC <span class="operator">=</span> ifelse<span class="punctuation">(</span><span class="built_in">is.na</span><span class="punctuation">(</span>NOC<span class="punctuation">)</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span>NOC<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 若NOC为NA，则使用0，否则使用本身的数值</span></span><br></pre></td></tr></table></figure>
<h3 id="数据分组计算">数据分组计算</h3>
<p>有些情况下我们需要对一些数据进行分组的计算和整理，比如统计某个特定分类的数量或者平均值，或者这个分类中各个更小的分类占这个分类数量的半分比等，就可以用<code>group_by()</code>这个函数实现，以我给公司分析的数据中使用的代码举例：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># check the percentage of renewal for each product at each renewal point ---------------</span></span><br><span class="line"><span class="comment"># count the number of records for each group first</span></span><br><span class="line">Renewal_CNT_table <span class="operator">&lt;-</span> df.LAPSED <span class="operator">%&gt;%</span></span><br><span class="line">  group_by<span class="punctuation">(</span>CNTTYPE<span class="punctuation">,</span> MAX_ZRENNO<span class="punctuation">,</span> Lapased_reason_desc<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  summarise<span class="punctuation">(</span>count <span class="operator">=</span> n<span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># the percentage of each number of renewed times for each product</span></span><br><span class="line">Renewal_percent <span class="operator">&lt;-</span> Renewal_CNT_table <span class="operator">%&gt;%</span> </span><br><span class="line">  group_by<span class="punctuation">(</span>CNTTYPE<span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>Total <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>count<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  mutate<span class="punctuation">(</span>renewed_prcent <span class="operator">=</span> count<span class="operator">/</span>Total<span class="punctuation">)</span> <span class="operator">%&gt;%</span></span><br><span class="line">  na.omit<span class="punctuation">(</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<p>需要注意的一点是在上面代码的第二部分，我们<code>Total = sum(count)</code>的操作虽然是针对所有行，但<code>sum</code>本身却由于前面的<code>group_by(CNTTYPE)</code>只针对<code>CNTTYPE</code>中的每一个<code>factors</code>，以此算出了每个单独的<code>CNTTYPE</code>的和。</p>
<h4 id="arrange">arrange()</h4>
<p><code>arrange()</code>函数可以用来将数据框以特定列的数值排列，用法如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw <span class="operator">%&gt;%</span></span><br><span class="line">  arrange<span class="punctuation">(</span>sex<span class="punctuation">,</span> salary<span class="punctuation">)</span> <span class="operator">%&gt;%</span> <span class="comment"># arrange默认将列按从小到大，从A到Z的顺序排序</span></span><br><span class="line">  arrange<span class="punctuation">(</span>desc<span class="punctuation">(</span>salary<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment"># 若要从大到小，从Z到A排序则需要加desc()函数</span></span><br></pre></td></tr></table></figure>
<h4 id="count">count()</h4>
<p>对数据框对象使用<code>count()</code>函数并指定特定列名，效果等同于以该列分组后计数。实际使用如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">df.raw <span class="operator">%&gt;%</span></span><br><span class="line">    count<span class="punctuation">(</span>sex<span class="punctuation">,</span> sort <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h2 id="数据可视化">数据可视化</h2>
<p>探索性分析的最后一步就是将处理好的数据进行对比展示从而得出所需信息了，<code>tidyverse</code>中使用<code>ggplot2</code>来进行数据可视化。本节我会首先介绍下<code>ggplot2</code>的函数使用的基本格式，然后介绍一些常见的函数和参数，这里最后附上一个<code>ggplot2</code>的详细的<a href="http://www.sthda.com/english/wiki/ggplot2-essentials" title="ggplot2 - Essentials">文档网站</a>。</p>
<h3 id="函数格式">函数格式</h3>
<p>之所以专门要说一说函数的格式是因为<code>ggplot</code>的函数使用格式与其他常见包有较大的区别，当需要在一张图上增加不同功能或元素时不同部分之间使用<code>+</code>号连接。</p>
<blockquote>
<p>ggplot(data = <DATA>, mapping = aes(<MAPPINGS>)) +  &lt;GEOM_FUNCTION&gt;()</p>
</blockquote>
<h3 id="ggplot">ggplot()</h3>
<p><code>ggplot()</code>是<code>ggplot2</code>作图的最基础的模块，在这个函数内指定作图的数据源，同时在这个函数中我们也可以使用<code>aes()</code>函数设置图片可视化的不同维度。使用方法如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line">ggplot<span class="punctuation">(</span>data <span class="operator">=</span> df.raw<span class="punctuation">,</span> <span class="comment"># data参数中指定使用的数据集</span></span><br><span class="line">       mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> sex<span class="punctuation">,</span> <span class="comment"># x轴维度</span></span><br><span class="line">                     y <span class="operator">=</span> salary<span class="punctuation">,</span> <span class="comment"># y轴维度</span></span><br><span class="line">                    fill <span class="operator">=</span> CNTTYPE<span class="punctuation">)</span><span class="punctuation">)</span> <span class="comment">#填充颜色</span></span><br></pre></td></tr></table></figure>
<p>需要强调一下<code>aes()</code>的<a href="https://ggplot2.tidyverse.org/reference/aes.html" title="Construct aesthetic mappings">使用方法</a>，该函数本身用来指定需要制作的图的各个参数，可以在<code>ggplot()</code>中设定，也可以在各层<code>GEOM_FUNCTION</code>中单独设置。其中<code>fill</code>这个参数如果使用特定颜色则表示使用改颜色填充图，若使用某个因子型变量则代表在图中使用不同颜色标明这个变量的不同值。</p>
<h3 id="常用图类型及参数设置">常用图类型及参数设置</h3>
<ul>
<li><code>geom_point()：</code>根据数据绘制点图，<code>size</code>, <code>color</code>, <code>shape</code>三个参数分别可以控制点的<code>大小</code>，<code>颜色</code>和<code>形状</code>。可以增加<code>geom_rug()</code>,<code>geom_density_2d()</code>或<code>stat_ellipse()</code>等功能增强显示，具体参见<a href="http://www.sthda.com/english/wiki/ggplot2-scatter-plots-quick-start-guide-r-software-and-data-visualization" title="ggplot2 scatter plots : Quick start guide - R software and data visualization">此页面</a>。</li>
<li><code>geom_smooth()：</code>对点图绘制回归线，<code>method</code>参数可以选择默认的<code>loess</code>或<code>lm</code>，后者可以通过<code>formula = y ~ poly(x, 3)</code>参数指定回归的次数，<code>se</code>参数设定为<code>TRUE</code>时显示回归线的置信区间，<code>fullrange</code>设定为<code>TRUE</code>时回归线会跨过整个图，<code>level</code>参数是置信水平，默认为<code>0.95</code>。</li>
<li><code>geom_line()：</code>根据数据点绘制线图，可以使用<code>linetype</code>调整线的形状，在<code>group</code>参数中可以对不同的分组绘图。</li>
<li><code>geom_abline()：</code>在图中添加线，<code>intercept</code>和<code>slope</code>参数分别设定线的截距和斜率。除了<code>abline()</code>以外还有<code>vline()</code>, <code>hline()</code>, <code>geom_segment（）</code>。具体使用参见<a href="http://www.sthda.com/english/wiki/ggplot2-add-straight-lines-to-a-plot-horizontal-vertical-and-regression-lines" title="ggplot2 add straight lines to a plot : horizontal, vertical and regression lines">此页面</a>。</li>
<li><code>geom_boxplot()：</code>绘制箱型图，<code>outlier.colour</code>, <code>outlier.shape</code>, <code>outlier.size</code>三个参数分别设置异常值的颜色，形状和大小。另外有一个<code>notch</code>参数设置为<code>TRUE</code>时将绘制展示中位数置信区间的箱型图，用以对比两组数据中位数的差异。可以配合<code>geom_dotplot()</code>或<code>geom_jitter()</code>在箱型图中绘制点分布，具体使用参见<a href="http://www.sthda.com/english/wiki/ggplot2-box-plot-quick-start-guide-r-software-and-data-visualization" title="ggplot2 box plot : Quick start guide - R software and data visualization">此页面</a>。</li>
<li><code>geom_bar()：</code>柱状图，<code>stat</code>参数若为<code>identity</code>则y轴以y值计算，若为<code>bin</code>则y轴以记录数计算，<code>position</code>参数可以为<code>dodge,stake</code>或<code>fill</code>来对比，堆叠或百分比显示柱状图。另外可以使用<code>coord_flip()</code>翻转坐标轴或使用<code>coord_polar(&quot;y&quot;, start=0)</code>来制作饼图。其他更多设置参考<a href="http://www.sthda.com/english/wiki/ggplot2-barplots-quick-start-guide-r-software-and-data-visualization" title="ggplot2 barplots : Quick start guide - R software and data visualization">此页面</a></li>
<li><code>geom_histogram()：</code>直方图，用于展示数据的分布情况。也可以像柱状图一样使用<code>position</code>参数调整不同组数据的展示方式，<code>alpha</code>参数用于调整图像透明度。更多使用方法参考<a href="http://www.sthda.com/english/wiki/ggplot2-histogram-plot-quick-start-guide-r-software-and-data-visualization" title="ggplot2 histogram plot : Quick start guide - R software and data visualization">此页面</a>。</li>
<li><code>geom_density()：</code>概率分布图，与直方图效果类似，但是使用曲线围出的面积为1的概率分布图来描述不同值出现的概率，可以配合直方图展示。</li>
</ul>
<h3 id="其他常用函数">其他常用函数</h3>
<h4 id="多面对比-Faceting">多面对比(Faceting)</h4>
<p><code>facet_wrap(facets = vars(sex))</code>或<code>facet_grid(rows = vars(sex), cols = vars(age))</code>可以分别以两种方式制作多图对比。效果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220426115942939.png" alt="facet_wrap()"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220426115930523.png" alt="facet_grid()"></p>
<p>要将多图对比时也可以使用<code>图1 + 图2 + plot_layout()</code>的表达方式将多图展示，该用法需要先安装<code>patchwork</code>的包，具体参数及用法参见<a href="https://www.rdocumentation.org/packages/patchwork/versions/1.1.1/topics/plot_layout" title="plot_layout: Define the grid to compose plots in">该网站</a>。</p>
<h4 id="设置图标签">设置图标签</h4>
<p><code>geom_text()：</code>该函数可以在图中标出各点的文字信息，用法如<code>geom_text(label=rownames(mtcars))</code>。</p>
<p><code>labs():</code>可以使用该函数修改图片的各个文字标签，主要参数有<code>title</code>修改图标题，<code>x</code>修改x轴标注，<code>y</code>修改y轴标注，<code>fill</code>修改legend标注等。</p>
<h4 id="图片主题">图片主题</h4>
<p><code>theme_gray()：</code>灰色背景与白色格线。</p>
<p><code>theme_bw()：</code>白色背景与灰色格线。</p>
<p><code>theme_linedraw()：</code>在theme_bw()的基础上图界有黑线包裹。</p>
<p><code>theme_light()：</code>浅灰色线与轴，更凸显数据本身。</p>
<p><code>theme_minimal()：</code>几乎没有背景标记。</p>
<p><code>theme_classic()：</code>R的经典图片格式，有图片边框无格线。</p>
<p><code>theme_void()：</code>无任何标记。</p>
<p><code>theme_dark()：</code>暗灰色背景，适用于颜色丰富的图片。</p>
]]></content>
      <categories>
        <category>数据分析</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>R</tag>
      </tags>
  </entry>
  <entry>
    <title>[MS Office]Access报价出单排版打印工具开发记录</title>
    <url>/2022/05/15/15-A_quotation_printing_tool/</url>
    <content><![CDATA[<h1>序言</h1>
<p>公司有个承保同事基于Excel开发过核保报价出单的打印工具，具体用处就是分发给保险代理使用的，填写保单信息如客户信息，承保险种，起止日期，雇员险雇佣地址，同一客户承保各险种所需的保额，费率等信息以及最后的保费计算和保单条款适用等。代理填写完成后按键自动根据填写内容导出格式化的报价单pdf文件。之前同事使用Excel制作这个工具时的思路是使用一张工作表收集所有信息，然后每页pdf使用一个工作表，用公式连接第一张信息表，最后做一个按键根据信息表中的信息打印需要打印的工作表。</p>
<p>这种方法实际上确实可行，但有两个缺点：一是公式太多会使思路简单的信息排版打印甚至打开文件都变得非常慢，二是填写的信息仅仅用于打印一次，若需要保存已经填写的信息需要将整个文件复制保存。另一方面，如果使用Access开发这个工具则可以完美避免这两个缺点，实际上Access可以说就是专门为了完成这些任务而设计出来的， 它的表单(form)用于填写信息，表(table)用于存储信息，报表(Report)用于展示和打印信息。因此我协助核保同事重新以Access设计了这个报价单打印工具，这篇文章主要记录一下实现一些小功能的方法。</p>
<h1>正文</h1>
<h2 id="表单中计算日期">表单中计算日期</h2>
<p>有一个小功能，因为一般险中大部分保单保期都是一年，因此想要在表单中设置选择起保日期后自动将保单失效日期填入一年后日期，例如2020年9月1日起保便自动填入2021年8月31日失效。这个功能看起来非常简单直观，可以使用VBA的<code>DateAdd()</code>函数计算1年后日期减1即可，但似乎Access的日期表单的计算功能有些小漏洞。</p>
<p>稍微介绍一下<code>DateAdd(interval, number, date)</code>函数，其三个参数中<code>interval</code>表示想要增加的日期单位，<code>number</code>表示想要增加的日期数量，<code>date</code>则是要增加的起始日期。其中<code>interval</code>参数的可用值及代表的意思如下：</p>
<table>
<thead>
<tr>
<th>interval参数</th>
<th>yyyy</th>
<th>q</th>
<th>m</th>
<th>y</th>
<th>d</th>
<th>w</th>
<th>ww</th>
<th>h</th>
<th>n</th>
<th>s</th>
</tr>
</thead>
<tbody>
<tr>
<td>意义</td>
<td>年</td>
<td>季度</td>
<td>月份</td>
<td>天数(以年计)</td>
<td>天数</td>
<td>天数(工作天)</td>
<td>周</td>
<td>小时</td>
<td>分钟</td>
<td>秒钟</td>
</tr>
</tbody>
</table>
<p>但是在表单上实现这个简单功能的难点在于Access表单中日期栏位特殊的输入方式，日期可以通过日历表的控件直接选择输入，但如果直接在起保日期的<code>On Change</code>事件中直接写入<code>[End Date] = DateAdd(&quot;yyyy&quot;,1,[Start Date])-1</code>的话，会导致起保日期刚刚输入就被强制执行该公式，其结果就是起保日期的输入不准确，我猜想可能是因为<code>On_Change</code>事件本身是栏位发生任何变化都会触发，但日期的选择输入本身可能包括多个步骤，这导致事件会在日期没有完全输入时就被触发从而引发错误。但同时如果使用<code>After_Update</code>事件会导致日期输入后不能直接触发事件，而需要选择到其他控件才能触发，这两种方式都不适合我们需要的应用。</p>
<p>但知道了问题所在解决方案也就应运而生了，我对这个问题的解决方法是将计算分为两段执行，在起保日期被修改时将<code>Focus</code>设置到失效日期，而在起保日期失去<code>Focus</code>时再执行<code>[End Date] = DateAdd(&quot;yyyy&quot;,1,[Start Date])-1</code>。如此可以保证执行计算操作时起保日期已经被准确输入。实现代码示例如下：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Start_Date_Change()</span><br><span class="line">    [<span class="keyword">End</span> <span class="type">Date</span>].SetFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Start_Date_LostFocus()</span><br><span class="line">    [<span class="keyword">End</span> <span class="type">Date</span>] = DateAdd(<span class="string">&quot;yyyy&quot;</span>, <span class="number">1</span>, [Start <span class="type">Date</span>]) - <span class="number">1</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<h2 id="将报表打印至PDF">将报表打印至PDF</h2>
<p>用户将报价单所需的所有信息通过表单输入数据表中后，我们可以通过表单上的按钮按需求打印已经排版好的报表至pdf，本章我先将这个按钮中的步骤分步讲解，最后再放出完整代码。</p>
<h3 id="打开报表的打印预览模式">打开报表的打印预览模式</h3>
<p>在要调整需要打印的内容之前必须先将需要打印的报表打开：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line">DoCmd.OpenReport <span class="string">&quot;Full Quotation&quot;</span>, acViewPreview, , <span class="string">&quot;[Quotation ID (Access record only)] = Forms![Main-Quotation Info]![Quotation ID (Access record only)]&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>DoCmd.OpenReport</code>本身用于打开报表，其后的参数分别为<code>报表名称</code>，<code>打开方式</code>，<code>筛选名称</code>，<code>WHERE条件</code>，<code>打开窗口模式</code>和<code>OpenArgs</code>。各个参数的具体使用方法<a href="https://docs.microsoft.com/en-us/office/vba/api/access.docmd.openreport" title="DoCmd.OpenReport method (Access)">见此</a>，我这里用到的参数只有<code>报表名称</code>，<code>打开方式</code>和<code>WHERE条件</code>。这里需要说明一点是<code>WHERE条件</code>的使用方法，这里的表达相当于在报表的<code>SELECT QUERY</code>中添加<code>WHERE</code>条件语句，此处加上的<code>[Quotation ID (Access record only)] = Forms![Main-Quotation Info]![Quotation ID (Access record only)]</code>代表报表中只展示<code>ID</code>与表单中当前选择的<code>ID</code>相同的记录，如果没有这条条件打印会展示所有记录。</p>
<h3 id="调整需要展示的页面">调整需要展示的页面</h3>
<p>打开要打印的报表预览页面后才可以根据条件调整需要打印的页面：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">If</span> Reports![Full Quotation]!EC_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!EC_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforEC.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![EC Quotation].Visible = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">If</span> Reports![Full Quotation]!PL_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!PL_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforPL.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![PL Quotation].Visible = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">If</span> Reports![Full Quotation]!BI_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!BI_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforBI.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![BI Quotation].Visible = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">If</span> Reports![Full Quotation]!MAR_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!MAR_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforMAR.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![MAR Quotation].Visible = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br></pre></td></tr></table></figure>
<p>在<code>Full Quotation</code>报表中，按ID连接并放入了不同险种信息的四个<code>子窗体(subform)</code>，当主窗体中关于各个险种的保费计算为0或空使，将相应的子窗体和分页符隐藏，从而可以达到不打印该页面的效果。需要强调的一点是隐藏操作必须在报表被打开的前提下，否则会报错。另外由于我们是在预览模式下操作隐藏对象，而不是在设计模式或布局模式打开，因此这里的隐藏操作是暂时性的，不会影响到报表本身的参数，也就是说这里的隐藏修改在关闭时不会被保存。</p>
<h3 id="输出结果至PDF">输出结果至PDF</h3>
<p>当我们把需要打印的报表按需求在打印预览模式下调整好之后就可以直接使用命令将结果输出至PDF文件了。</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line">fileName = Forms![Main-Quotation Info]![Quotation ID (Access record only)] &amp; <span class="string">&quot;_Quotation&quot;</span></span><br><span class="line">fldrPath = Application.CurrentProject.Path</span><br><span class="line">filePath = fldrPath &amp; <span class="string">&quot;\&quot;</span> &amp; fileName &amp; <span class="string">&quot;.pdf&quot;</span></span><br><span class="line"></span><br><span class="line">DoCmd.OutputTo objecttype:=acOutputReport, objectName:=<span class="string">&quot;Full Quotation&quot;</span>, outputformat:=acFormatPDF, outputFile:=filePath</span><br><span class="line">DoCmd.Close acReport, <span class="string">&quot;Full Quotation&quot;</span>, acSaveNo</span><br><span class="line">MsgBox prompt:=<span class="string">&quot;PDF File exported to: &quot;</span> &amp; vbNewLine &amp; filePath, buttons:=vbInformation, Title:=<span class="string">&quot;Report Exported as PDF&quot;</span></span><br><span class="line"><span class="comment">&#x27; open the output pdf</span></span><br><span class="line">CreateObject(<span class="string">&quot;Shell.Application&quot;</span>).Open (filePath)</span><br></pre></td></tr></table></figure>
<p>这里首先将我们想要保存pdf文件的文件名和地址定义好并合成为完整文件地址，然后使用<code>DoCmd.OutputTo</code>命令将刚刚整理好的报表以PDF的格式保存至定义好的地址，然后关闭报表后打开导出的文件以供用户检视。</p>
<p>其中<code>DoCmd.OutputTo</code>命令中的可用参数分别是<code>对象类型</code>，<code>对象名</code>，<code>输出格式</code>，<code>输出文件路径</code>，<code>自动开始</code>，<code>模板文件</code>，<code>解码方式</code>和<code>输出质量</code>。各参数的具体使用方法可见<a href="https://docs.microsoft.com/en-us/office/vba/api/access.docmd.outputto" title="DoCmd.OutputTo method (Access)">官方文档</a>。我们只需要将<code>对象类型</code>设定为<code>acOutputReport</code>，填好<code>对象名</code>，<code>输出格式</code>设为<code>acFormatPDF</code>并将<code>输出文件路径</code>设定为之前定义好的地址即可完成PDF文件的导出。后面的关闭报表，弹窗信息，打开导出文件操作都非常简单，我就不解释了。</p>
<h3 id="完整代码">完整代码</h3>
<p>综上，这个工具导出报表至pdf的按钮完整代码如下：</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> PrintToPDF_Click()</span><br><span class="line">    <span class="comment">&#x27; Open the report of current quotation</span></span><br><span class="line">    DoCmd.OpenReport <span class="string">&quot;Full Quotation&quot;</span>, acViewPreview, , <span class="string">&quot;[Quotation ID (Access record only)] = Forms![Main-Quotation Info]![Quotation ID (Access record only)]&quot;</span></span><br><span class="line">    <span class="comment">&#x27; Hide the quotation pages with no premiums</span></span><br><span class="line">    <span class="keyword">If</span> Reports![Full Quotation]!EC_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!EC_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforEC.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![EC Quotation].Visible = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> Reports![Full Quotation]!PL_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!PL_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforPL.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![PL Quotation].Visible = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> Reports![Full Quotation]!BI_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!BI_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforBI.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![BI Quotation].Visible = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">If</span> Reports![Full Quotation]!MAR_FINAL.Value = <span class="string">&quot;&quot;</span> <span class="built_in">Or</span> Reports![Full Quotation]!MAR_FINAL.Value = <span class="number">0</span> <span class="keyword">Then</span></span><br><span class="line">    Reports![Full Quotation]!PageBreakforMAR.Visible = <span class="literal">False</span></span><br><span class="line">    Reports![Full Quotation]![MAR Quotation].Visible = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&#x27; Output the report to pdf file</span></span><br><span class="line">    <span class="keyword">Dim</span> fileName <span class="keyword">As</span> <span class="type">String</span>, fldrPath <span class="keyword">As</span> <span class="type">String</span>, filePath <span class="keyword">As</span> <span class="type">String</span></span><br><span class="line">    <span class="keyword">Dim</span> answer <span class="keyword">As</span> <span class="type">Integer</span></span><br><span class="line">    <span class="keyword">Const</span> FILE_OPENED = <span class="number">2501</span></span><br><span class="line">    </span><br><span class="line">    fileName = Forms![Main-Quotation Info]![Quotation ID (Access record only)] &amp; <span class="string">&quot;_Quotation&quot;</span></span><br><span class="line">    fldrPath = Application.CurrentProject.Path</span><br><span class="line">    filePath = fldrPath &amp; <span class="string">&quot;\&quot;</span> &amp; fileName &amp; <span class="string">&quot;.pdf&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">On</span> <span class="keyword">Error</span> <span class="keyword">Resume</span> <span class="keyword">Next</span></span><br><span class="line">    DoCmd.OutputTo objecttype:=acOutputReport, objectName:=<span class="string">&quot;Full Quotation&quot;</span>, outputformat:=acFormatPDF, outputFile:=filePath</span><br><span class="line">    DoCmd.Close acReport, <span class="string">&quot;Full Quotation&quot;</span>, acSaveNo</span><br><span class="line">    MsgBox prompt:=<span class="string">&quot;PDF File exported to: &quot;</span> &amp; vbNewLine &amp; filePath, buttons:=vbInformation, Title:=<span class="string">&quot;Report Exported as PDF&quot;</span></span><br><span class="line">    <span class="comment">&#x27; open the output pdf</span></span><br><span class="line">    CreateObject(<span class="string">&quot;Shell.Application&quot;</span>).Open (filePath)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">Select</span> <span class="keyword">Case</span> Err.Number</span><br><span class="line">        <span class="keyword">Case</span> <span class="number">0</span></span><br><span class="line">        <span class="comment">&#x27; no error</span></span><br><span class="line">        <span class="keyword">Case</span> FILE_OPENED</span><br><span class="line">        MsgBox (<span class="string">&quot;The file is already opened, please close it before replace.&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">Case</span> <span class="keyword">Else</span></span><br><span class="line">        <span class="comment">&#x27;unanticipated error - inform user</span></span><br><span class="line">        MsgBox Err.Description, vbExclamation, <span class="string">&quot;Error&quot;</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>额外想讲解的一点是<code>Select Case</code>语句在这个代码中用于捕捉错误信息的应用，<code>Select Case</code>语句的详解见<a href="https://docs.microsoft.com/en-us/office/vba/language/concepts/getting-started/using-select-case-statements" title="Using Select Case statements">官方文档</a>，其用法与<code>If...Then...Else</code>语句中<code>ElseIf</code>的用法相似，但不同的是<code>ElseIf</code>可以在每个判断中加入不同的判定条件，只需要返回结果是<code>True</code>或<code>False</code>即可，而<code>Select Case</code>语句则需要先在<code>Case</code>后给定要判断的变量，然后在不同的<code>Case</code>下判断<code>该变量</code>是否满足每个条件。</p>
<p>在这里这个语句的应用则是先捕捉错误代码，然后根据捕捉到的不同错误代码的值弹出不同的信息。</p>
<h2 id="将子窗体数据更新至表">将子窗体数据更新至表</h2>
<p>在工具的主窗体上嵌有一个关于各个险种条款的子窗体，子窗体通过<code>ID</code>与主表数据连接，其中内容都是不同条款的<code>复选框(Checkboxes)</code>，选中则代表包括该条款否则不打印。</p>
<p>通常情况下子窗体数据的修改会被同步至其对应的表中，但这里有个特殊情况，就是条款为了方便选择设置过默认选项，而有一些保单确实不需要默认选项以外的条款选择，这就导致有一些情况下用户可能根本就不修改这个子窗体中的内容就打印报表。这就导致子窗体中的数据没有被更新至对应的表中，自然也不会被报表打印出来。</p>
<p>要解决这个问题，一个很自然的想法是使用VBA代码修改表单中的内容后强行保存，这样Access为了保存修改后的内容就会必须在表中存储相应数据，这时再将刚刚修改的内容改回默认值保存，表中就有了这个记录。将这个行为触发定义在输入某个前置控件内容后，便可以实现用户无感更新子窗体数据。</p>
<figure class="highlight vb"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> EC_Quotation_No__WOD_QR__AfterUpdate()</span><br><span class="line">    <span class="comment">&#x27; 先SetFocus至子窗体，这样后面的保存记录指令才可以正确对子窗体数据执行</span></span><br><span class="line">    Forms![Main-Quotation Info]!EC_Clauses.SetFocus</span><br><span class="line">    <span class="comment">&#x27;修改子窗体中数据保存再改回默认值保存，以强制创建更新数据至表</span></span><br><span class="line">    Forms![Main-Quotation Info]!EC_Clauses.Form![Extra-ordinary Weather Condition Clause_EC] = <span class="literal">False</span></span><br><span class="line">    DoCmd.RunCommand acCmdSaveRecord</span><br><span class="line">    Forms![Main-Quotation Info]!EC_Clauses.Form![Extra-ordinary Weather Condition Clause_EC] = <span class="literal">True</span></span><br><span class="line">    DoCmd.RunCommand acCmdSaveRecord</span><br><span class="line">    <span class="keyword">Me</span>![EC Quotation No (WOD/QR)].SetFocus</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<h2 id="更新组合框数据">更新组合框数据</h2>
<p>有一个Access应用开发中常常会用到的功能，就是以表单当前选择的数据信息来筛选组合框中的内容范围，通常在组合框中<code>Row Source</code>栏中的填入筛选出想要显示的数据的<code>SQL Query</code>即可实现，但除此之外还必须对组合框控件进行<code>Requery</code>操作才会使下拉选框中的内容被相应更新。</p>
<p>但Access VBA在这方面似乎有个小BUG，那就是如果你把<code>Requery</code>放在<code>On_click</code>事件上，虽然可以达到点出想要的下拉框的效果，但似乎是由于并行事件太多有很大机率会导致Access直接崩溃重启。经过一些测试我发现如果将<code>Requery</code>绑定在<code>On got focus</code>事件上则可以达到相同的效果但不会导致程序崩溃。</p>
<h1>最后</h1>
<p>本篇文章通过开发报价单打印工具进一步加强了我对Access数据库应用开发的经验，在此记录了一些可能适用范围较广可以在其他项目上借鉴的小技巧。</p>
<p>[第15篇]</p>
]]></content>
      <categories>
        <category>MS Office</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Access</tag>
        <tag>VBA</tag>
      </tags>
  </entry>
  <entry>
    <title>[金融分析] CFA一级《公司金融》学习笔记</title>
    <url>/2022/06/02/16-CFA-level1-Corporate-Issuers/</url>
    <content><![CDATA[<h1>概览</h1>
<p>公司金融一共包括2个Session的5个Reading，各个Reading的内容如下表：</p>
<table>
    <tr>
        <th>Sessions</th>
        <th>Readings</th>
        <th>Contents</th>
    </tr>
    <tr>
        <td rowspan="3">SS10</td>
        <td>R31</td>
        <td>Introduction to Corporate Governance and ESG</td>
    </tr>
    <tr>
        <td>R32</td>
        <td>Capital Budgeting</td>
    </tr>
    <tr>
        <td>R33</td>
        <td>Cost of Capital</td>
    </tr>
    <tr>
        <td rowspan="2">SS11</td>
        <td>R34</td>
        <td>Measures of Leverage</td>
    </tr>
    <tr>
        <td>R35</td>
        <td>Working Capital Management</td>
    </tr>
</table>
<p>公司金融部分主要涉及的内容是以公司首席财务官的角度管理公司财务，主要的关注点就是最优化资金的来源与分配。</p>
<h1>Session 10</h1>
<h2 id="Reading-31-公司治理">Reading 31 公司治理</h2>
<p>第一个Reading考点不多，主要是概念性内容。公司治理有两套主要理论，分别是<code>股东权益最大化(Shareholder theory)</code>和<code>公司利益相关者利益最大化(Stakeholder theory)</code>，前者是2015年前业界认为的公司治理最佳方法，即为公司股东争取最大利益，现在CFA通常认为后者为公司治理的主要目标，也即公司经营目标为包括股东在内的员工、管理者等各个相关方的利益最大化。</p>
<h3 id="管理利益冲突">管理利益冲突</h3>
<p>好的公司治理架构应该要降低<code>代理人冲突(principal-Agent Conflict)</code>，即避免公司管理人员为自己利益放弃股东利益，一个可行的方法是为管理者支付公司股票作为薪酬，以此绑定管理者与股东利益。</p>
<p>中小股东与控股股东利益冲突可以通过设计投票权的方式解决。</p>
<p>股东与债权人利益冲突体现在股东可能倾向于更高风险的项目，债券人希望风险更小。</p>
<h3 id="董事会">董事会</h3>
<p>董事会的重要要求是需要独立于层，好的董事会可以具有下面这些特点：</p>
<ul>
<li><code>独立董事(Independent Director)</code>数量多于<code>执行董事(Executive Director)</code>。</li>
<li>董事会主席不能由公司首席执行官或前任首席执行官担任。</li>
<li>董事会成员与公司经营没有利益关系。</li>
<li>董事会成员经验少于十年。</li>
<li>董事会召开时不应有公司管理层在场。</li>
<li>好的董事会成员应该有专业技能。</li>
<li>分层分级董事会(Staggered boards)</li>
</ul>
<p>董事会下设的专业委员会中审计委员会、薪酬委员会和提名委员会的成员必须全部 是独立董事。</p>
<h3 id="ESG-Consideration">ESG Consideration</h3>
<p>CFA近年强推ESG(环境、社会和管理)影响，建议投资人考虑在ESG方面执行较好的公司投资。主要的执行方法包括<code>负面清单(Negative screening)</code>、<code>正面清单(Positive screening)</code>和<code>行业最好(best-in-class)</code>。</p>
<h2 id="Reading-32-资本预算-Capital-Budgeting">Reading 32 资本预算(Capital Budgeting)</h2>
<p>本节内容主要考虑公司如何判断是否投资某个长期项目，其衡量方法有<code>NPV(净现值)</code>和<code>IRR(内部收益率)</code>等方法。</p>
<h3 id="资本预算的流程">资本预算的流程</h3>
<ol>
<li><code>Idea generation：</code>通过不同渠道获得一个不错的投资想法。</li>
<li><code>Analyzing project proposals：</code>预测项目未来的现金流并评估项目的可盈利性。</li>
<li><code>Create the firm-wide capital budget：</code>考虑项目的现金流时间，公司的资源以及公司整体的发展策略的匹配。</li>
<li><code>Monitoring decisions and conducting a post-audit：</code>最后评估项目投资的结果。</li>
</ol>
<h3 id="项目分类">项目分类</h3>
<p>资本项目有以下四个分类：</p>
<p><code>替代项目(Replacement projects)：</code>用来维持业务运营或减少成本的替换原有资产的投资项目。</p>
<p><code>扩张项目(Expansion projects)：</code>对已有产品或对新产品与服务的扩张性投资项目。</p>
<p><code>强制投资(Mandatory investment)：</code>监管，安全或环境保护的强制性投资，最大特点是可能净现值小于0。</p>
<p><code>其他项目(Other projects)：</code>又叫宠物项目，主要特点是项目现金流难以分析，可能主要是项目负责人喜欢而投资。</p>
<h3 id="资本预算的五大原则">资本预算的五大原则</h3>
<ol>
<li>项目预算的决策取决于项目的<code>增量现金流(incremental cash flow)</code>而不是会计利润。</li>
<li>现金流中的<code>沉没成本(Sunk cost)</code>与<code>融资成本(Interest cost)</code>应该被忽略。</li>
<li>现金流中的<code>外部性(Externalities)</code>与<code>机会成本(Opportunity Costs)</code>应该被考虑。其中外部性包括<code>negative externalities(cannibalization)</code>和<code>positive externalities</code>，即互斥项目中对旧产品的不利影响和互补项目中对旧产品的有利影响都应该被考虑，机会成本则是因为做该项目而导致少赚到的<code>另一个最好(Next Best)</code>的项目收益。</li>
<li>项目现金流出现的时间非常重要，要考虑金钱的时间价值。</li>
<li>所有分析用的现金流都是<code>税后现金流</code>。</li>
</ol>
<h3 id="资本预算的假设条件">资本预算的假设条件</h3>
<p><code>独立项目(Independent projects)</code>是互相之间没有关联的项目，考虑独立项目时只要其净现值大于0便可以投资。<code>互斥项目(Mutually exclusive projects)</code>是多个项目中只能选取其中一个投资时，应该将所有项目的可盈利性排列后选择最好的。</p>
<p>另外有一些项目的投资具有<code>顺序性(project sequencing)</code>，也就是说现在投资的某些项目可能为以后投资另一个项目创造机会。</p>
<p>最后若假设无限资本时只要有利可图的项目都可以投资，但现实情况是公司可以支配投资的资金有限，公司需要使用有限的资金获取尽可能多的投资收益。</p>
<h3 id="项目估值的五大方法">项目估值的五大方法</h3>
<h4 id="净现值方法-Net-present-value">净现值方法(Net present value)</h4>
<p>项目所有相关现金流折现后的加总既是项目的净现值，NPV大于0即可投资。其优点为可以直观看见可盈利的数额；正净现值表示项目可以为公司股东盈利；折现率为现实值。缺点主要是忽略了项目的初始投资规模。</p>
<h4 id="内部回报率方法-Internal-rate-of-return）">内部回报率方法(Internal rate of return）</h4>
<p>IRR是当我们认为投资项目净现值为0时项目的折现率，若IRR大于资金成本就可以投资。<code>当IRR结论与NPV结论冲突时，优先考虑NPV的结果。</code>IRR的主要优点为其反应了收益率，即考虑了收益与初始成本的关系。其缺点在于可能无法计算或算出多个结果(项目现金流的符号变动几次最多就可能有几个IRR的解)；IRR假设了现金流的再投资率就是IRR，这个假设不符合实际。</p>
<h4 id="回收期法-Payback-period">回收期法(Payback period)</h4>
<p>PBP是计算收回初始投资的时间，若PBP低于基准PBP就可以考虑投资。优点是简单且反映了项目的风险与流动性。缺点是忽略了时间成本，且忽略了回收期之后的现金流与项目的盈利能力。</p>
<h4 id="折现回收期法-Discount-payback-period">折现回收期法(Discount payback period)</h4>
<p>DPBP是以折现后的现金流计算收回初始投资的时间，若DPBP低于基准DPBP就可以考虑投资。优点是反映了项目的风险与流动性，且考虑了时间成本。但其缺点依然是忽略了回收期后的现金流以及项目的盈利能力。</p>
<h4 id="盈利指数法-Profitability-index">盈利指数法(Profitability index)</h4>
<p>盈利指数PI是未来现金流的折现现金流之和除初始投资成本，若PI&gt;1则应该考虑投资。它的变形式就是净现值与初始投资数额的比值，大于0就应该考虑投资。其优点是相较于净现值方法考虑了初始投资的规模。其缺点是没有反映盈利的实际金额。</p>
<h3 id="NPV-Profile">NPV Profile</h3>
<p>对比项目的净现值随资本融资成本变化而变化的影响，不同项目因为现金流的时间不同，他们的净现值对融资成本的变化速度有所不同，见下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220609212809914.png" alt="NPV Profile"></p>
<p>这张图的特点有：</p>
<ol>
<li>两条线与X轴的交点为各自的IRR，与Y轴的交点为各自的无折现净值。</li>
<li>两条线的交点处的回报率会导致两项目净现值相等，叫做<code>Crossover Rate</code>。</li>
<li>两条线斜率不同的原因是其大额现金流出现时间不同，大额现金流出现越晚其净现值越容易被折现率影响。</li>
</ol>
<h3 id="项目NPV对公司股票价值的影响">项目NPV对公司股票价值的影响</h3>
<p>理论上我们假设公司的股票价值会随公司新做投资的净现值变化，计算时将项目的净现值平摊至每一股，就是该项目对公司股票价值的影响。</p>
<h2 id="Reading-33-融资成本-Cost-of-Capital">Reading 33 融资成本(Cost of Capital)</h2>
<h3 id="加权平均资本成本-Weighted-Average-Cost-of-Capital-WACC">加权平均资本成本(Weighted Average Cost of Capital, WACC)</h3>
<p>企业的平均融资成本就是WACC，其最大作用是可以被用来折现公司未来的现金流，也即是说这是<code>公司最低要求回报率</code>。其计算公式如下：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>W</mi><mi>A</mi><mi>C</mi><mi>C</mi><mo>=</mo><msub><mi>W</mi><mi>d</mi></msub><mo>×</mo><msub><mi>r</mi><mi>d</mi></msub><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>W</mi><mi>e</mi></msub><mo>×</mo><msub><mi>r</mi><mi>e</mi></msub><mo>+</mo><msub><mi>W</mi><mrow><mi>p</mi><mi>s</mi></mrow></msub><mo>×</mo><msub><mi>r</mi><mrow><mi>p</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">WACC = W_{d}\times r_{d}\times(1-t)+W_{e}\times r_{e}+W_{ps}\times r_{ps}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">CC</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span>代表资产占比，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>代表该部分资产融资成本。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi></mrow><annotation encoding="application/x-tex">d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span>为债务资产，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">e</span></span></span></span>为所有者权益资产，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">ps</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">s</span></span></span></span>为优先股资产。</p>
<h4 id="计算权重W">计算权重<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi></mrow><annotation encoding="application/x-tex">W</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span></span></span></span></h4>
<p>权重的计算方法如下：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>W</mi><mi>d</mi></msub><mo>=</mo><mfrac><mi>D</mi><mrow><mi>D</mi><mo>+</mo><mi>E</mi></mrow></mfrac><mtext>     </mtext><msub><mi>W</mi><mi>e</mi></msub><mo>=</mo><mfrac><mi>E</mi><mrow><mi>D</mi><mo>+</mo><mi>E</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">W_{d} = \frac{D}{D+E}\ \ \ \ \ W_{e} = \frac{E}{D+E}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>即，权重既是该部分资产占总资产数额的占比，计算使用资产的<code>市场价值(Market Value)</code>。若公司披露其未来的<code>目标资本结构(Target Capital Structure)</code>，因为权重计算的是公司未来的现金流折现率，因此以目标结构计算，测算权重时可用的资本结构顺序为<code>目标&gt;预测&gt;目前&gt;其他类似公司</code>。</p>
<h4 id="计算债务成本r-d">计算债务成本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">r_{d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></h4>
<p>计算债务成本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>d</mi></msub></mrow><annotation encoding="application/x-tex">r_{d}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>主要有两种方法：</p>
<ol>
<li><code>持有至到期方法(Yield to maturity approach)：</code> 债券的现金流折现至其目前价值的折现率就是债券的YTM。</li>
<li><code>债务评级法(Debt-rating approach)：</code>如果债券没有公允价值则使用债务评级法估算，以市场上同等级债券的债务成本为相同的参考。</li>
</ol>
<h4 id="计算优先股成本r-ps">计算优先股成本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mrow><mi>p</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">r_{ps}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></h4>
<p>优先股就是永续年金，永续年金的价格为其股利除以其要求回报率，此要求回报率既是优先股成本，其计算方法为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>r</mi><mrow><mi>p</mi><mi>s</mi></mrow></msub><mo>=</mo><mfrac><msub><mi>D</mi><mrow><mi>p</mi><mi>s</mi></mrow></msub><mi>P</mi></mfrac></mrow><annotation encoding="application/x-tex">r_{ps}=\frac{D_{ps}}{P}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>p</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">D_{ps}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>为优先股股利，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>为优先股的<code>市场价格</code>(假设市场价格准确反映其要求回报率)。</p>
<h4 id="计算股票成本r-e">计算股票成本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>e</mi></msub></mrow><annotation encoding="application/x-tex">r_{e}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></h4>
<p>股票融资成本的计算方法比较多，分别有<code>资本资产定价模型(CAPM)</code>，<code>股利折现模型(Dividend discount model)</code>和<code>债券回报率加风险溢价方法</code>。</p>
<h5 id="CAPM模型">CAPM模型</h5>
<ul>
<li>
<p><code>上市公司CAPM：</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>s</mi></msub><mo>=</mo><msub><mi>r</mi><mi>f</mi></msub><mo>+</mo><mi>β</mi><mo stretchy="false">(</mo><msub><mi>r</mi><mi>m</mi></msub><mo>−</mo><msub><mi>r</mi><mi>f</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_{s}=r_{f}+\beta(r_{m}-r_{f})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> ，该公式中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>m</mi></msub></mrow><annotation encoding="application/x-tex">r_{m}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为<code>市场组合收益(market rate of return)</code>，其减去无风险回报率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>f</mi></msub></mrow><annotation encoding="application/x-tex">r_{f}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>的结果为<code>市场组合风险溢价(market risk premium)</code>。<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>为股票收指数的影响程度，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\beta=2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span>代表指数增长1时股票增长2，该数值可以通过回归方程计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi><mo>=</mo><mfrac><mrow><mi>C</mi><mi>o</mi><mi>v</mi><mo stretchy="false">(</mo><mi>i</mi><mo separator="true">,</mo><mi>m</mi><mo stretchy="false">)</mo></mrow><msubsup><mi>σ</mi><mi>m</mi><mn>2</mn></msubsup></mfrac></mrow><annotation encoding="application/x-tex">\beta=\frac{Cov(i,m)}{\sigma^{2}_{m}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.5552em;vertical-align:-0.5452em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.214em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">C</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">m</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5452em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。</p>
</li>
<li>
<p><code>非上市公司CAPM：</code>非上市公司的主要问题在于无法根据市场价格计算<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>，因此计算该值时使用Pure-play method估算非上市公司的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>从而使用CAPM模型计算其回报率。该方法的基本原则是找到一家与目标公司相似的上市公司，假设他们的经营风险相同，分别移除上市公司的财务风险得到其<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mrow><mi>A</mi><mi>s</mi><mi>s</mi><mi>e</mi><mi>t</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\beta_{Asset}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mord mathnormal mtight">sse</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>后加上目标公司的财务风险以估算非上市公司的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>。</p>
<p>这个方法中的一个重要值为<code>财务杠杆影响</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mo stretchy="false">)</mo><mfrac><mi>D</mi><mi>E</mi></mfrac><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[1+(1-t)\frac{D}{E}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">E</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">D</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">]</span></span></span></span>，上市公司<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>除以该财务杠杆即为去杠杆，然后乘上目标公司财务杠杆以得到非上市公司的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>。</p>
</li>
<li>
<p><code>新兴市场国家CAPM：</code>对于新兴市场国家由于其经济不稳定导致其可能市场风险更大，因此在计算这些国家的股东预期收益率时应该加上该国家的<code>国家风险溢价(Country risk premium)</code>。公式写作<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>s</mi></msub><mo>=</mo><msub><mi>r</mi><mi>f</mi></msub><mo>+</mo><mi>β</mi><mo stretchy="false">(</mo><msub><mi>r</mi><mi>m</mi></msub><mo>−</mo><msub><mi>r</mi><mi>f</mi></msub><mo>+</mo><mi>C</mi><mi>R</mi><mi>P</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r_{s}=r_{f}+\beta(r_{m}-r_{f}+CRP)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CRP</span><span class="mclose">)</span></span></span></span>  ，而<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>R</mi><mi>P</mi><mo>=</mo><mi>S</mi><mi>Y</mi><mi>S</mi><mo>×</mo><mfrac><msub><mi>σ</mi><mrow><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi></mrow></msub><msub><mi>σ</mi><mrow><mi>b</mi><mi>o</mi><mi>n</mi><mi>d</mi></mrow></msub></mfrac></mrow><annotation encoding="application/x-tex">CRP=SYS\times \frac{\sigma_{stock}}{\sigma_{bond}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">CRP</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1681em;vertical-align:-0.4509em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7173em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4159em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:-0.0359em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">oc</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4509em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，其中SYS为国债利率利差，即稳定市场国家与新兴市场国家的国债利差。</p>
</li>
</ul>
<h5 id="股利折现模型">股利折现模型</h5>
<p>股利折现模型又称<code>Gordon dividend growth model</code>。其基本原理是假设公司股利每年以g的增速永续增长，而公司的现时价值就等于所有未来股利的现值。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>V</mi><mn>0</mn></msub><mo>=</mo><mfrac><mrow><msub><mi>D</mi><mn>0</mn></msub><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>g</mi><mo stretchy="false">)</mo></mrow><mrow><mi>r</mi><mo>−</mo><mi>g</mi></mrow></mfrac><mo>=</mo><mfrac><msub><mi>D</mi><mn>1</mn></msub><mrow><mi>r</mi><mo>−</mo><mi>g</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">V_{0}=\frac{D_{0}\times (1+g)}{r-g}=\frac{D_{1}}{r-g}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3074em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">D_{0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为股票现值，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">D_{n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为第n次股利，r为股东要求回报率, g为股利增长率(ROE乘股利留存率)。</p>
<p>使用股利折现模型就可以推出股东要求回报率，也即是股票成本的公式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>r</mi><mi>e</mi></msub><mo>=</mo><mfrac><msub><mi>D</mi><mn>1</mn></msub><msub><mi>V</mi><mn>0</mn></msub></mfrac><mo>+</mo><mi>g</mi></mrow><annotation encoding="application/x-tex">r_{e}=\frac{D_{1}}{V_{0}}+g
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span></span></p>
<h5 id="债券回报率加风险溢价方法">债券回报率加风险溢价方法</h5>
<p>顾名思义，该模型认为股票成本为债券要求回报率加风险溢价：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>r</mi><mi>e</mi></msub><mo>=</mo><mi>Y</mi><mi>T</mi><mi>M</mi><mo>+</mo><mi>R</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">r_{e}=YTM+RP
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal" style="margin-right:0.10903em;">TM</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">RP</span></span></span></span></span></p>
<p>其中YTM为公司长期债券的要求回报率，RP为股票和债券回报率间的历史差值。</p>
<h4 id="最优资本预算">最优资本预算</h4>
<ul>
<li>WACC是公司整体的资本成本，只有当项目风险与公司已有的项目风险相同时，项目现值才可以使用公司WACC计算折现。</li>
<li>对于项目投资来说，投资的收益(IRR)会随着投资数目的增加而减少，边际融资成本(MCC)会随着投资数目的增加而增加。因此当两条线相较时(IRR=MCC)资本规模是<code>最优资本预算(Optimal Capital Budget)</code>。</li>
<li>融资成本突破点(Break point)的计算方法是用导致融资成本(债券或股票)变化的融资数额除以公司该类资本的占比。</li>
</ul>
<h3 id="股票发行成本">股票发行成本</h3>
<p>股票发行的发行成本通常是股票发行过程中支付给相关投资银行、会计师事务所、律师事务所等相关中介机构的费用，而我们在计算股东要求回报率时应该考虑该成本。</p>
<h4 id="定量计算-CFA不推荐">定量计算(CFA不推荐)</h4>
<p>该方法认为股票发行成本应作为股票发行价格的抵减。而股东要求回报率就在股利折现模型的基础上在股票现值上抵减掉该发行成本。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>r</mi><mi>e</mi></msub><mo>=</mo><mfrac><msub><mi>D</mi><mn>1</mn></msub><mrow><msub><mi>V</mi><mn>0</mn></msub><mo>−</mo><mi>F</mi></mrow></mfrac><mo>+</mo><mi>g</mi><mtext>      </mtext><mi>o</mi><mi>r</mi><mtext>      </mtext><msub><mi>r</mi><mi>e</mi></msub><mo>=</mo><mfrac><msub><mi>D</mi><mn>1</mn></msub><mrow><msub><mi>V</mi><mn>0</mn></msub><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>f</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>+</mo><mi>g</mi></mrow><annotation encoding="application/x-tex"> r_{e}=\frac{D_{1}}{V_{0}-F}+g\ \ \ \ \ \ or\ \ \ \ \ \ r_{e}=\frac{D_{1}}{V_{0}\times (1-f)}+g
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span></span></p>
<p>但由于该方法导致一次性的发行成本影响公司未来的所有现金流的折现率，不符合实际情况因此不受CFA推荐。</p>
<h4 id="定性计算-CFA推荐">定性计算(CFA推荐)</h4>
<p>该方法认为股票发行成本作为一次性的期初现金流出。</p>
<h1>Session 11</h1>
<h2 id="Reading-34-杠杆衡量-Measures-of-leverage">Reading 34 杠杆衡量(Measures of leverage)</h2>
<p><code>杠杆(leverage)</code>的本质既是使用<code>固定支出(fixed cost)</code>。<code>经营性杠杆(Operating leverage)</code>由固定运营成本导致，衡量方法是<code>DOL(Degree of Operating Leverage)</code>。<code>财务性 杠杆(Financial leverage)</code>由债务融资及其支出导致，衡量方法是<code>DFL(Degree of Financial Leverage)</code>。总杠杆由<code>Degree of Total Leverage(DTL)</code>衡量。</p>
<p><code>商业风险(Business risk)</code>是由经营杠杆导致，使用销售变化导致EBIT变化来衡量，由<code>销售风险(Sales risk)</code>和<code>操作风险(Operating risk)</code>组成。销售风险是指货物和服务的价格和数量相关的不确定性；操作风险是指</p>
<p><code>财务风险(Financial risk)</code>是由财务杠杆导致，使用EBIT的变化导致EPS的变化来衡量。</p>
<h3 id="经营性杠杆-DOL">经营性杠杆(DOL)</h3>
<p>经营性杠杆的定义就是销售变化导致的EBIT变化，计算方法使用计算式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>定义式：</mtext><mi>D</mi><mi>O</mi><mi>L</mi><mo>=</mo><mfrac><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>c</mi><mi>h</mi><mi>n</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>u</mi><mi>n</mi><mi>i</mi><mi>t</mi><mtext> </mtext><mi>s</mi><mi>o</mi><mi>l</mi><mi>d</mi></mrow></mfrac><mo>=</mo><mfrac><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow><mrow><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>Q</mi></mrow><mi>Q</mi></mfrac></mfrac><mspace linebreak="newline"></mspace><mtext>计算式：</mtext><mi>D</mi><mi>O</mi><mi>L</mi><mo>=</mo><mfrac><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>P</mi><mo>−</mo><mi>V</mi><mi>C</mi><mo stretchy="false">)</mo></mrow><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>P</mi><mo>−</mo><mi>V</mi><mi>C</mi><mo stretchy="false">)</mo><mo>−</mo><mi>F</mi><mi>C</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>S</mi><mo>−</mo><mi>T</mi><mi>V</mi><mi>C</mi></mrow><mrow><mi>S</mi><mo>−</mo><mi>T</mi><mi>V</mi><mi>C</mi><mo>−</mo><mi>F</mi><mi>C</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">定义式：DOL=\frac{percentage\ change\ in\ EBIT}{percentage\ chnage\ in\ unit\ sold}=\frac{\frac{\Delta EBIT}{EBIT}}{\frac{\Delta Q}{Q}}\\
计算式： DOL=\frac{Q(P-VC)}{Q(P-VC)-FC}=\frac{S-TVC}{S-TVC-FC}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">定义式：</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">erce</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">c</span><span class="mord mathnormal">hna</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal">u</span><span class="mord mathnormal">ni</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">so</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">erce</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9029em;vertical-align:-1.2955em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6073em;"><span style="top:-2.1856em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9244em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight">Q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.735em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2955em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">计算式：</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>是<code>销售量</code>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>是销售价格，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">VC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>是变动成本，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">FC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span></span></span></span>是固定成本，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>是总销售额，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>V</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">TVC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>是总变动成本。显然，当固定成本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>C</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">FC=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>O</mi><mi>L</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">DOL=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>是最小值。</p>
<h3 id="财务性杠杆-DFL">财务性杠杆(DFL)</h3>
<p>财务性杠杆定义是EBIT变化导致EPS的变化，计算方法使用计算式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>定义式：</mtext><mi>D</mi><mi>F</mi><mi>L</mi><mo>=</mo><mfrac><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>E</mi><mi>P</mi><mi>S</mi></mrow><mrow><mi>p</mi><mi>e</mi><mi>r</mi><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>c</mi><mi>h</mi><mi>a</mi><mi>n</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow></mfrac><mo>=</mo><mfrac><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>E</mi><mi>P</mi><mi>S</mi></mrow><mrow><mi>E</mi><mi>P</mi><mi>S</mi></mrow></mfrac><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow><mrow><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow></mfrac></mfrac><mspace linebreak="newline"></mspace><mtext>计算式：</mtext><mi>D</mi><mi>F</mi><mi>L</mi><mo>=</mo><mfrac><mrow><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi></mrow><mrow><mi>E</mi><mi>B</mi><mi>I</mi><mi>T</mi><mo>−</mo><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">定义式：DFL=\frac{percentage\ change\ in\ EPS}{percentage\ change\ in\ EBIT}=\frac{\frac{\Delta EPS}{EPS}}{\frac{\Delta EBIT}{EBIT}}\\计算式： DFL=\frac{EBIT}{EBIT-Interest}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">定义式：</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">erce</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">erce</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">c</span><span class="mord mathnormal">han</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.05764em;">EPS</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.7147em;vertical-align:-1.1073em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6073em;"><span style="top:-2.2377em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.735em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">EPS</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">EPS</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1073em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">计算式：</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">eres</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">EB</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>当财务费用为0时<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>F</mi><mi>L</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">DFL=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>为最小值。</p>
<h3 id="总杠杆-DTL">总杠杆(DTL)</h3>
<p>总杠杆有经营性杠杆和财务性杠杆组合，用于衡量销售变化导致的每股净利润变化。</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>T</mi><mi>L</mi><mo>=</mo><mi>D</mi><mi>O</mi><mi>L</mi><mo>×</mo><mi>D</mi><mi>F</mi><mi>L</mi><mspace linebreak="newline"></mspace><mi>D</mi><mi>T</mi><mi>L</mi><mo>=</mo><mfrac><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>P</mi><mo>−</mo><mi>V</mi><mi>C</mi><mo stretchy="false">)</mo></mrow><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>P</mi><mo>−</mo><mi>V</mi><mi>C</mi><mo stretchy="false">)</mo><mo>−</mo><mi>F</mi><mi>C</mi><mo>−</mo><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>S</mi><mo>−</mo><mi>T</mi><mi>V</mi><mi>C</mi></mrow><mrow><mi>S</mi><mo>−</mo><mi>T</mi><mi>V</mi><mi>C</mi><mo>−</mo><mi>F</mi><mi>C</mi><mo>−</mo><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">DTL=DOL\times DFL\\
DTL=\frac{Q(P-VC)}{Q(P-VC)-FC-Interest}=\frac{S-TVC}{S-TVC-FC-Interest}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">L</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">eres</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">eres</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>是<code>销售量</code>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>是销售价格，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">VC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>是变动成本，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">FC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span></span></span></span>是固定成本，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>是总销售额，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>V</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">TVC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>是总变动成本。同样的当两个杠杆都为1时<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>T</mi><mi>L</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">DTL=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>是最小值。</p>
<h3 id="盈亏平衡销量-Breakeven-Analysis">盈亏平衡销量(Breakeven Analysis)</h3>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>Q</mi><mrow><mi>B</mi><mi>E</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi>F</mi><mi>C</mi><mo>+</mo><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>t</mi></mrow><mrow><mi>P</mi><mo>−</mo><mi>V</mi><mi>C</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Q_{BE}=\frac{FC+Interest}{P-VC}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">BE</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">eres</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>是销售价格，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">VC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>是变动成本，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">FC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">FC</span></span></span></span>是固定成本, 即<code>除去变动成本后的售价(边际贡献, Marginal Contribution)</code>达到该销量后刚好可以覆盖所有固定成本时，该销量既是盈亏平衡销量。</p>
<p><code>经营性盈亏平衡(Operating breakeven)</code>是指不计算财务利息时的盈亏平衡点，即固定成本除边际贡献。</p>
<h2 id="Reading-35-营运资金管理-Working-Capital-Management">Reading 35 营运资金管理(Working Capital Management)</h2>
<h3 id="流动性衡量">流动性衡量</h3>
<p>公司财务官在管理公司营运资金时的一个重要作用就是监督公司的财务流动性，其中流动性主要分为两种：</p>
<ul>
<li><code>Primary sources of liquidity(主要流动性)：</code> 主要流动性的使用是健康的财务行为，主要包括销售产品或服务，收集应收款项，短期投资获利等等。</li>
<li><code>Secondary sources of liquidity(次要流动性)：</code>当公司需要动用次要流动性时，可能说明公司财务状况已经不太健康。主要的三种行为分别是变卖长期或短期资产，债务重组，申请破产保护。</li>
</ul>
<p>另外有两个可能会导致公司流动性问题的原因分别是<code>收钱慢(Drags on liquidity)</code>和<code>付钱快(Pulls on liquidity)</code>。收钱慢主要的表现有<code>应收账款无法收回(Uncollectable A/R)</code>和<code>老旧存货(Obsolete Inventory)</code>。流动性的其他知识在<code>财务报表分析</code>中已经学习过。</p>
<h3 id="应付账款管理-Payable-management">应付账款管理(Payable management)</h3>
<p>当供应商希望鼓励公司尽快支付应付账款时可能会有为公司提供早鸟优惠，为在早期付款的公司提供一些优惠。这时我们需要计算这些早鸟优惠的<code>等效年利率(Effective annualized return)</code>来为是否接受该优惠决策。该EAR的计算方法就等价于计算在什么折现率下最晚付款期限前付款的现值等于早鸟折扣付款。</p>
<h3 id="现金管理-Cash-management">现金管理(Cash management)</h3>
<p>现金管理是指公司在短期内现金盈余或缺少时进行的短期投资或融资行为。投资的部分会在数量方法课中覆盖，在公司金融中主要涉及的是短期融资行为。主要的短期融资方法包括：</p>
<ul>
<li><code>银行授信(Lines of credit)：</code>银行的授信的可信赖程度从低到高分别有<code>不承诺的授信(Uncommitted line of credit)</code>、<code>承诺的授信(Committed line of credit)</code>和<code>循环授信(revolving line of credit)</code>。</li>
<li><code>抵押贷款</code>(Pledge assets as collateral for bank borrowings)</li>
<li><code>银行承兑汇票(Banker's acceptances)：</code>主要用于出口商品的公司，得到买家银行指定日期的无条件支付现金的承诺。</li>
<li><code>银行保理(Factoring)：</code>将公司应收账款折价卖给银行以获得短期流动性。</li>
</ul>
<p>还有一些非银行的短期融资方法：</p>
<ul>
<li>其他民间贷款：通常对小公司或信用较低的公司来说融资成本较高。</li>
<li>商业票据(Commercial paper)：公司直接发售债券。</li>
</ul>
<p>[第16篇]</p>
]]></content>
      <categories>
        <category>金融分析</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>CFA一级</tag>
        <tag>公司金融</tag>
      </tags>
  </entry>
  <entry>
    <title>[数据分析]基于数据挖掘分类算法的续保价格优化模型记录</title>
    <url>/2022/06/09/17-Price_Optimization_with_Random_Forest/</url>
    <content><![CDATA[<h1>序言</h1>
<p>所谓机器学习就是使用计算机算法让程序从已有数据中学习知识并应用，因此数据挖掘作为从数据中提炼规则的学科，其也是机器学习的最热门的分支之一。本篇缘起是因为老板想要一个可以预测保单续保与否的模型，我在收集数据准备模型的过程中想到了这个利用<code>预测模型(Predictive Model)</code>优化保险定价的<code>指导模型(Prescriptive Model)</code>。一言蔽之就是通过分类模型找出容易被保险定价影响的群体并建议放弃加价以获得其续保。本篇就记录一下这个项目的具体实现过程和表现评估。</p>
<h1>正文</h1>
<h2 id="预测模型">预测模型</h2>
<p>项目第一步是构建一个可以预测续保结果的预测模型，本节会从随机森林模型的数据集构建、参数调整、表现评估等方便记录整个预测模型的构建过程。使用该模型进行实际运用的指导模型的建造和评估会在下一节详解。</p>
<h3 id="数据收集">数据收集</h3>
<p>任何数据挖掘的第一步也是最重要的一步都是数据收集和整理，原数据的质量会直接影响到最后模型的表现。我在做这个项目的时候只用到了公司数据库的数据，而且由于不同险种的可用数据不太一样，我为了提高预测模型的准确性先选定了研究“家居保险”，因此我首先和业务的同事们开会讨论了一下他们认为的可能对家居保险续保有预测效果的保单特征，例如代理的渠道和佣金，顾客的年龄、性别、忠诚度，保单信息中的楼龄、付款方式等等。我具体收集的一些特征如下：</p>
<table>
    <tr>
        <th>分类</th>
        <th>数据</th>  
        <th>描述</th>  
    </tr>
    <tr>
        <td rowspan="4">保单信息</td>
        <td>原始保费</td>  
        <td>家居险的原始保费与其保额及单位面积有关，因此认为可以一定程度上反应客户的财务水平</td>  
    </tr>
    <tr>
        <td>保费增长</td>
        <td>计算得出的续保保费与续保前保费的增长率，是本数据集中公司在续保过程中唯一可以控制的因素</td>  
    </tr>
    <tr>
        <td>理赔数量&理赔金额</td>
        <td>反应客户的理赔方面的特征，因为认为理赔情况可能影响客户的续保决定</td>  
    </tr>
    <tr>
        <td>产品相关信息</td>
        <td>一些仅与家具险相关的数据信息，例如客户是否选购特殊保障条款，所保单位楼龄的分层等</td>  
    </tr>
    <tr>
        <td rowspan="2">代理信息</td>
        <td>代理渠道</td>
        <td>不同的代理商提供给客户的服务体验不同，可能导致续保决策的差异</td>  
    </tr>
    <tr>
        <td>佣金水平</td>
        <td>不同的代理商的佣金水平的差异可能反映至代理商对客户的态度区别</td>  
    </tr>
    <tr>
        <td rowspan="3">客户信息</td>
        <td>客户年龄</td>
        <td>根据本项目开始前的探索性数据分析得知，客户年龄与其续保行为具有较高的相关性，年龄越大的客户越倾向于续保</td>  
    </tr>
    <tr>
        <td>客户性别</td>
        <td>性别被认为是客户分层的重要维度，但需要注意该特征的使用具有敏感性，不应在会体现出性别区别对待的模型上使用该特征</td>  
    </tr>
    <tr>
        <td>客户忠诚度</td>
        <td>选择两个信息用来衡量客户的忠诚度，分别是客户持有我司的总保单数和客户与我司合作的总年数</td>  
    </tr>
</table>
<p>基于以上这些数据维度，我收集了公司2021年经过续保流程的可续保家居保险保单，并且将<code>续保结果(Lapsed or Renewed)</code>作为数据集的目标分类。</p>
<h3 id="数据清洗-2">数据清洗</h3>
<p>总体来说由于数据都是来自于公司自己的数据库中，因此没有太多需要清洗的地方，主要值得说的就是对于缺失值的处理方法。由于公司没有特别收集家居险客户的个人资料，因此客户的性别与年龄数据都是来自于其购买其他如意外险等需要年龄性别信息的投保资料，这也导致客户信息的这一块有非常多的缺失值。下图中是我收集到的保单的性别与年龄分布，这两个信息都有多于一半的保单有信息缺失。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220610155151775.png" alt="客户数据的缺失值，其中性别N代表“Prefer not to say”"></p>
<p>但因为这两个特征从经验判断都是对于续保决策的预测相当有帮助的，而同时由于大量保单都有系统性缺失数据，因此我既不能舍弃掉这两个特征同时又不能直接删除或估算(Impute)缺失值。同时由于这些值是系统性缺失，所以我可以合理假设缺失值本身也带有一些信息(由于某些原因这些客户没有提供个人信息)。因此我的处理方式就是将缺失值加入水平值。代码上实现也很简单：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用addNA将缺失值加入因子特征的水平值</span></span><br><span class="line">df.pre <span class="operator">&lt;-</span> df.pre <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>CLIENT_GENDER <span class="operator">=</span> addNA<span class="punctuation">(</span>CLIENT_GENDER<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>CLIENT_AGE <span class="operator">=</span> addNA<span class="punctuation">(</span>CLIENT_AGE<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line"><span class="comment"># 实际数据处理中不仅这两个特征有缺失值，因此我写了个循环将所有缺失值命名为“NA”</span></span><br><span class="line"><span class="comment"># 需要注意的是这一步一定要做，否则后期训练时Random forest包的算法不会将NA计入导致报错。</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">names</span><span class="punctuation">(</span>df.pre<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">class</span><span class="punctuation">(</span>df.pre<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="operator">==</span><span class="string">&quot;factor&quot;</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    levels<span class="punctuation">(</span>df.pre<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">[</span><span class="built_in">is.na</span><span class="punctuation">(</span>levels<span class="punctuation">(</span>df.pre<span class="punctuation">[[</span>i<span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&quot;NA&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>需要注意的一点是虽然使用<code>addNA()</code>公式就已经把缺失值加入了因子变量的水平值中，但还需要进行第二步对水平变量赋值的操作，否则R的<code>RandomForest</code>算法会错误处理这些NA变量，导致报错。具体可以参考<a href="https://stackoverflow.com/questions/24829674/r-random-forest-error-type-of-predictors-in-new-data-do-not-match" title="r random forest error - type of predictors in new data do not match">这个问题</a>。</p>
<h3 id="处理不平衡数据">处理不平衡数据</h3>
<p>由于我们想要预测的目标分类是某个保单的续保结果，但我司家居险的保单续保率实际达到95%以上，这也就导致我们的数据一定是非常不平衡的，而我们想要预测的却是小数据量的部分标签，如果不加处理就直接以这个比例训练模型的话会导致模型在预测小数据量标签时的表现严重欠拟合。</p>
<p>在简单对比尝试了普通的<code>欠采样(Undersampling)</code>、<code>过采样(Oversampling)</code>与<code>SMOTE方法</code>后，后发现SMOTE训练出的模型效果最能满足我们所需的较高<code>精确度(Precision)</code>。我们不需要将所有不续保的保单预测出来，但我们希望在我们预测会不续保的保单尽可能不要出错，因为每多预测错一个保单就意味着我们要多付出一份不必要的成本，不同处理方法的训练效果会在后面的模型评估中展示。数据最后处理的处理效果如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220610161859969.png" alt="使用SMOTE算法得到平衡数据集"></p>
<p>代码如下，其中：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ROSE包提供欠采样和过采样方法，performanceEstimation提供SMOTE方法</span></span><br><span class="line">library<span class="punctuation">(</span>ROSE<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>performanceEstimation<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 随机抽取样本的80%作为训练集，其余20%作为测试集。</span></span><br><span class="line">sampling <span class="operator">&lt;-</span> sample<span class="punctuation">(</span>nrow<span class="punctuation">(</span>df.GWPRaise<span class="punctuation">)</span><span class="punctuation">,</span><span class="number">0.8</span><span class="operator">*</span>nrow<span class="punctuation">(</span>df.GWPRaise<span class="punctuation">)</span><span class="punctuation">,</span>replace <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">TrainSet <span class="operator">&lt;-</span> df.GWPRaise<span class="punctuation">[</span>sampling<span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line">TestSet <span class="operator">&lt;-</span> df.GWPRaise<span class="punctuation">[</span><span class="operator">-</span>sampling<span class="punctuation">,</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment"># 使用欠采样方法将Renewed数据降至与过采样同水平</span></span><br><span class="line">balanced_train_under <span class="operator">&lt;-</span> ovun.sample<span class="punctuation">(</span>IS_LAPSED<span class="operator">~</span>.<span class="punctuation">,</span> data <span class="operator">=</span> TrainSet<span class="punctuation">,</span> method <span class="operator">=</span> <span class="string">&quot;under&quot;</span><span class="punctuation">)</span><span class="operator">$</span>data</span><br><span class="line"><span class="comment"># 使用SMOTE方法为每个minority生成3个新数据，并为每个新生成的数据从majority中选择1.5个数据放入最终数据集。</span></span><br><span class="line">balanced_train <span class="operator">&lt;-</span> smote<span class="punctuation">(</span>IS_LAPSED<span class="operator">~</span>.<span class="punctuation">,</span> TrainSet<span class="punctuation">,</span> perc.under <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> perc.over <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h3 id="随机森林参数调整">随机森林参数调整</h3>
<p>随机森林的算法本质是一个决策树的<code>投票模型(ensemble model)</code>，其做法是从所有数据中随机抽取一部分样本 (2/3)作为训练集，并随机抽取这些样本的特定数量的特征训练决策树。每个单个决策树默认使用<code>基尼不纯度(Gini Impurity)</code>作为<code>信息增益(Information Gain)</code>的衡量方法，在每个选出的特征值中找出分类目标标签获得最大信息增益的特征作为当个节点的分支，直到将所有抽选的特征分完(也就是让决策树不剪枝完全生长)。以同样的方式随机生成指定数量的决策树，然后使用这些决策树对每一个记录分别分类，以投票的方式决定该记录的最终分类。</p>
<p>随机森林的好处就在于其使用随机数据和随机特征训练模型，使其相较普通决策树<code>泛化(generalization)</code>效果更好，过拟合风险小。而其弱点在于分类过程不透明，与深度学习模型相似属于<code>黑箱模型(Black-box)</code>。因此通常如果我们想要通过数据挖掘算法获取一些数据间的关系和规则时，可以使用决策树算法来揭示。但如果像本项目这样需要一个尽可能准确的预测模型，则可以使用随机森林模型。</p>
<p>在我们使用R的<code>RandomForest包</code>进行随机森林模型训练的时候有两个参数会较大的影响我们的模型表现，一个是生成的决策树数量<code>ntree</code>，一个是随机选取的特征数量<code>mtry</code>。我在这里将两个参数在合理的范围内测试并使用<code>AUC(Area Under ROC Curve)</code>作为模型表现的指标选出了最优的参数分别为<code>ntree=300, mtry=6</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220613112629364.png" alt="ntree=300, mtry=6 generate the highest AUC"></p>
<p>代码如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 分别尝试ntree在200-600区间，mtry在2-8的区间时模型的AUC变化</span></span><br><span class="line">par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> seq<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">,</span><span class="number">600</span><span class="punctuation">,</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">for</span><span class="punctuation">(</span>j <span class="keyword">in</span> seq<span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    model <span class="operator">&lt;-</span> randomForest<span class="punctuation">(</span>IS_LAPSED<span class="operator">~</span>.<span class="punctuation">,</span> data <span class="operator">=</span> balanced_train<span class="punctuation">,</span> importance <span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> ntree <span class="operator">=</span> i<span class="punctuation">,</span> mtry <span class="operator">=</span> j<span class="punctuation">)</span></span><br><span class="line">    Predictions <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>model<span class="punctuation">,</span> newdata <span class="operator">=</span> TestSet<span class="punctuation">)</span></span><br><span class="line">    ModelROC <span class="operator">&lt;-</span> roc<span class="punctuation">(</span>TestSet<span class="operator">$</span>IS_LAPSED<span class="punctuation">,</span><span class="built_in">as.numeric</span><span class="punctuation">(</span>Predictions<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    plot<span class="punctuation">(</span>ModelROC<span class="punctuation">,</span>print.auc <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> auc.polygon <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> grid <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> max.auc.polygon<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> print.thres<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span>main<span class="operator">=</span>paste<span class="punctuation">(</span><span class="string">&quot;ROC Curve for ntree =&quot;</span><span class="punctuation">,</span> i<span class="punctuation">,</span> <span class="string">&quot; and mtry =&quot;</span><span class="punctuation">,</span> j<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="预测模型表现评估">预测模型表现评估</h3>
<p>使用测试集对不同训练集训练出的随机森林模型进行表现评估，发现SMOTE调整后的训练集最符合我们<code>高精准度前提下的高正确率</code>的要求。<code>混淆矩阵(Confusion matrix)</code>对比如下：</p>
<table>
    <tr>
        <th colspan="8" align="center">预测标签</th>  
    </tr>
    <tr>
        <th rowspan="4">实际标签</th>
        <th rowspan="2"></th>
        <th colspan="2" align="center">SMOTE</th>
        <th colspan="2" align="center">欠采样</th>  
        <th colspan="2" align="center">欠采样+过采样</th>  
    </tr>
    <tr>
        <th>Renew</th>    
        <th>Lapse</th>    
        <th>Renew</th>    
        <th>Lapse</th>  
        <th>Renew</th>    
        <th>Lapse</th> 
    </tr>
    <tr>
        <th>Renew</th> 
        <td>9,963</td>    
        <td style="color:red">1,649</td>    
        <td>7,264</td>    
        <td>4,348</td>  
        <td>9,212</td>    
        <td>2,390</td> 
    </tr>
    <tr>
        <th>Lapse</th> 
        <td>382</td>    
        <td style="color:red">249</td>    
        <td>184</td>    
        <td>447</td>  
        <td>292</td>    
        <td>349</td> 
    </tr>
</table>
<p>精准度与正确率的对比如下：</p>
<table>
<thead>
<tr>
<th></th>
<th>SMOTE</th>
<th>欠采样</th>
<th>欠采样+过采样</th>
</tr>
</thead>
<tbody>
<tr>
<td>精准度(Precision)</td>
<td><font color="red">13.1%</font></td>
<td>9.3%</td>
<td>12.7%</td>
</tr>
<tr>
<td>正确率(Accuracy)</td>
<td><font color="red">83.4%</font></td>
<td>62.3%</td>
<td>78.1%</td>
</tr>
<tr>
<td>回归率(Recall)</td>
<td>39.5%</td>
<td>70.8%</td>
<td>54.4%</td>
</tr>
</tbody>
</table>
<p>从上面这些评估中可以看出来即使是表现最好的SMOTE数据集训练出的的预测模型，在预测不续保保单时精准度也非常之低，根本原因就是在于实践中续保保单数量远大于不续保保单，而我们的数据集中没有包含足够的区分这两者的信息(因为客户不续保的根本动机可能性非常多，例如可能被其他保险人接触或出于其本身经济考虑)，因此预测效果一定不会非常好，只要高于阳性标签比例的5.1%就说明已经是有用的预测模型。</p>
<p>一个更好的消息是我们实际上关注的是我们可以通过调整保费来留住的客户，而这些被标注为<code>不续保</code>的1,898个客户中实际可能并不全是因为保费变化而被标注为不续保，下一节我会介绍一下我基于这个预测模型提出的指导模型的用法，以及其价值评估。</p>
<h2 id="指导模型">指导模型</h2>
<h3 id="变量重要性">变量重要性</h3>
<p>虽然随机森林模型本身是一个黑箱模型，但我们其实<a href="https://www.listendata.com/2014/11/random-forest-with-r.html" title="A COMPLETE GUIDE TO RANDOM FOREST IN R">也有办法</a>评估不同变量在预测中的<code>重要性(Importance)</code>。其基本思想就是根据移除不同的特征后模型预测准确度的变化大小来评估每个特征变量的重要性，而从下面这张图中我们除了知道客户忠诚度是准确预测其续保决策的最重要的变量之外，还知道保费变化也对客户的续保决策有较重要的影响。这也是我们可以使用这个预测模型来分类对保费变化敏感的客户并针对性调整保费变化决策以增加总体续保率的理论基础。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220613163543195.png" alt="GWP_Raise既是保费增长率"></p>
<h3 id="模型架构">模型架构</h3>
<p>简单来讲我想到的指导模型的使用方法就是通过调整测试集中预测不续保保单的保费增长率来确定该保单的不续保决策是否由于保费增长影响。若预测模型认为保费增长率调整后预测结果可从不续保转为续保，则说明模型认为该保单受保费增长影响而不续保。模型流程图如下：</p>
<div id="flowchart-0" class="flow-chart"></div>
<h3 id="指导模型评估">指导模型评估</h3>
<p>我们依然可以使用我们最早分出来的测试集来测试这个模型的表现，首先看一看测试集中这个模型对续保率的增益和成本：</p>
<table>
<thead>
<tr>
<th></th>
<th>Label Changed</th>
<th>Label NOT Changed</th>
</tr>
</thead>
<tbody>
<tr>
<td>TP</td>
<td><font color="red">77</font></td>
<td>220</td>
</tr>
<tr>
<td>FP</td>
<td><font color="red">215</font></td>
<td>1,393</td>
</tr>
<tr>
<td>TN</td>
<td>2</td>
<td>9,981</td>
</tr>
<tr>
<td>FN</td>
<td>0</td>
<td>355</td>
</tr>
</tbody>
</table>
<p>在上面这个表中，我对比了不同预测结果与指导模型划分的“价格敏感”保单的分布。其中<code>Label Changed</code>列便是在上方指导模型中被标记为<code>“因受保费增长影响可能不续保”</code>的保单。也就是说，在这一列中被预测为<code>Positive</code>的保单就是我们实际操作中建议免除保费增长的保单。而这其中的<code>FP(False Positive)</code>则是被标记为<code>不续保</code>但实际即使保费增长也会<code>续保</code>的保单。</p>
<p>这也即是说在我们的测试集中，这77笔TP保单的保费会成为模型实践后的收入(因为阻止了这77笔保单的不续保)，而这292笔Positive保单原本应该涨的保费则是该模型的成本(放弃了292个保单的涨价)。而测试集中这292笔保单的平均涨价保费是90港币，77笔TP保单的续保总保费是103,472.6港币，平均至292个保单相当于每放弃90港币的涨价预期可以获得354.3港币的保费收入。</p>
<p>而这77个TP保单占所有652个不续保保单的12%，即是说我们的模型预期可以使12%本会不续保的保单续保，将整体续保率从94.7%升至95.3%。</p>
<p>代码如下：</p>
<figure class="highlight r"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 将原测试集的预测结果记录下来</span></span><br><span class="line">Results <span class="operator">&lt;-</span> cbind <span class="punctuation">(</span>TestSet<span class="punctuation">,</span> as.data.frame<span class="punctuation">(</span>Predictions<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">Results <span class="operator">&lt;-</span> Results <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>Result<span class="operator">=</span>ifelse<span class="punctuation">(</span>Predictions <span class="operator">==</span> <span class="string">&quot;Y&quot;</span><span class="punctuation">,</span> ifelse<span class="punctuation">(</span>IS_LAPSED<span class="operator">==</span><span class="string">&quot;Y&quot;</span><span class="punctuation">,</span><span class="string">&quot;TP&quot;</span><span class="punctuation">,</span><span class="string">&quot;FP&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> ifelse<span class="punctuation">(</span>IS_LAPSED<span class="operator">==</span><span class="string">&quot;N&quot;</span><span class="punctuation">,</span> <span class="string">&quot;TN&quot;</span><span class="punctuation">,</span><span class="string">&quot;FN&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 将保费增长大于0且预测为不续保的保单保费增长调整为0</span></span><br><span class="line">df.TestnoRaise <span class="operator">&lt;-</span> Results <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>GWP_Raise <span class="operator">=</span> ifelse<span class="punctuation">(</span>GWP_Raise<span class="operator">&gt;</span><span class="number">0</span><span class="operator">&amp;</span>Predictions<span class="operator">==</span><span class="string">&quot;Y&quot;</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> GWP_Raise<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 对调整后的数据集的预测结果记录下来并对比两个结果的变化</span></span><br><span class="line">TestPredictions <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>model<span class="punctuation">,</span> newdata <span class="operator">=</span> df.TestnoRaise<span class="punctuation">)</span></span><br><span class="line">df.TestnoRaise <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>df.TestnoRaise<span class="punctuation">,</span> as.data.frame<span class="punctuation">(</span>TestPredictions<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">df.TestnoRaise <span class="operator">&lt;-</span> df.TestnoRaise <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>GWPnoRaiseResult <span class="operator">=</span> ifelse<span class="punctuation">(</span>Predictions <span class="operator">==</span> <span class="string">&quot;Y&quot;</span><span class="punctuation">,</span> ifelse<span class="punctuation">(</span>TestPredictions <span class="operator">==</span> <span class="string">&quot;Y&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Not Changed&quot;</span><span class="punctuation">,</span><span class="string">&quot;Changed&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span>ifelse<span class="punctuation">(</span>TestPredictions<span class="operator">==</span><span class="string">&quot;Y&quot;</span><span class="punctuation">,</span><span class="string">&quot;Changed&quot;</span><span class="punctuation">,</span><span class="string">&quot;Not Changed&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">%&gt;%</span> </span><br><span class="line">  mutate<span class="punctuation">(</span>GWPChanges <span class="operator">=</span> RENEWAL_GWP<span class="operator">-</span>PRORIG<span class="punctuation">)</span></span><br><span class="line">table<span class="punctuation">(</span>df.TestnoRaise<span class="operator">$</span>Result<span class="punctuation">,</span> df.TestnoRaise<span class="operator">$</span>GWPnoRaiseResult<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>
<h2 id="使用聚类分析对预测结果优化的尝试">使用聚类分析对预测结果优化的尝试</h2>
<p>有一个我在优化模型时失败的尝试我觉得也值得记录一下，当时的想法就是想看一看能不能用<code>聚类分析(Clustering analysis)</code>的方法找到一些FP与TP保单中可能被随机森林模型忽略的信息，因此我尝试在预测模型预测阳性的保单上使用<code>K-means Clustering</code>并看一看是否有明显FP数量大于TP的聚类。结果举例如下：</p>
<table>
<thead>
<tr>
<th>Clusters</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr>
<td>FP</td>
<td>18</td>
<td>2</td>
<td>20</td>
<td>147</td>
<td>34</td>
<td>186</td>
<td>12</td>
<td>27</td>
<td>49</td>
<td>245</td>
</tr>
<tr>
<td>TP</td>
<td>7</td>
<td>1</td>
<td>6</td>
<td>63</td>
<td>20</td>
<td>94</td>
<td>9</td>
<td>24</td>
<td>30</td>
<td>90</td>
</tr>
</tbody>
</table>
<p>可以看出来没有聚类能明显区分这些FP和TP的保单，因此可能确实说明我们的数据集中的信息已经不足以更细地区分这些保单了。</p>
<h1>最后</h1>
<p>这个模型只是最初版对于项目可行性的尝试，很多对数据集的处理 (特征选择，使用numerical或categorical变量等)或模型选择(使用随机森林、神经网络或支持向量机分类等)都没有太过深入以追求最好的效果，同时保费增加的调整也可以根据实际情况更细分层(例如分为增长5%、增长10%等)而减少额外的成本，但到这里其实我们已经从一定程度上获得了可行的结果。之后在模型实际投产前我可能会需要在这个基础上使用<code>Weka</code>更深地探究模型的最优化。</p>
<p>[第17篇]</p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script><textarea id="flowchart-0-code" style="display: none">st=>start: 开始
i=>inputoutput: 将一张保单资料输入预测模型
cond1=>condition: 预测结果是否为不续保？
cond2=>condition: 该保单是否有保费增长？
cond3=>condition: 预测结果是否变为续保？
op1=>operation: 下一张保单
op2=>operation: 将保单保费增长改为0
o2=>inputoutput: 将保单再次输入预测模型
o3=>inputoutput: 标记该保单因受保费增长影响可能不续保
e=>end: 结束
st->i->cond1
cond1(no)->op1->i
cond1(yes)->cond2
cond2(no)->op1->i
cond2(yes)->op2->o2->cond3
cond3(yes)->o3->e
cond3(no)->op1->i</textarea><textarea id="flowchart-0-options" style="display: none">"scale:2"</textarea><script>  var code = document.getElementById("flowchart-0-code").value;  var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value));  var diagram = flowchart.parse(code);  diagram.drawSVG("flowchart-0", options);</script>]]></content>
      <categories>
        <category>数据分析</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>R</tag>
        <tag>数据挖掘</tag>
      </tags>
  </entry>
  <entry>
    <title>[金融分析] CFA一级《经济学》学习笔记</title>
    <url>/2022/06/18/18-CFA-level1-Economics/</url>
    <content><![CDATA[<h1>概览</h1>
<p>经济学一共包括2个Session的7个Reading，主要包括的内容是各个Reading的内容如下表：</p>
<table>
    <tr>
        <th>Sessions</th>
        <th>Readings</th>
        <th>Contents</th>
    </tr>
    <tr>
        <td rowspan="4">SS4</td>
        <td>R12</td>
        <td>Topics in Demand and Supply Analysis</td>
    </tr>
    <tr>
        <td>R13</td>
        <td>The Firm and Market Structures</td>
    </tr>
    <tr>
        <td>R14</td>
        <td>Aggregate Output, Prices, and Economic Growth</td>
    </tr>
    <tr>
        <td>R15</td>
        <td>Understand Business Cycles</td>
    </tr>
    <tr>
        <td rowspan="3">SS5</td>
        <td>R16</td>
        <td>Monetary and Fiscal Policy</td>
    </tr>
    <tr>
        <td>R17</td>
        <td>International Trade and Capital Flows</td>
    </tr>
    <tr>
        <td>R18</td>
        <td>Currency Exchange Rates</td>
    </tr>
</table>
# Session 4
<h2 id="Reading-12-需求与供给分析">Reading 12 需求与供给分析</h2>
<p>经济学中最重要概念之一就是供给与需求的关系，在本章中主要会介绍供给需求曲线的理论知识以及其中的弹性等概念。</p>
<h3 id="供需曲线">供需曲线</h3>
<h4 id="需求曲线-Demand-curve">需求曲线(Demand curve)</h4>
<p>分析市场<code>需求</code>时首先主要从买方的购买<code>意愿</code>与<code>能力</code>来分析，只有在同时具有意愿与能力时才能形成需求。会影响需求量的因素一般包括<code>商品价格</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">P_{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>、<code>收入水平</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span>以及<code>其他商品价格</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">P_{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>。</p>
<ul>
<li>商品价格上升时，需求量下降，反之亦然。</li>
<li>收入上升时，需求量上升，反之亦然。</li>
<li>其他商品价格下降时，该商品需求量下降，则其他商品为该商品的<code>替代品</code>；若其他商品价格下降时，该商品需求上升，则其他商品为该商品的<code>互补品</code>。</li>
</ul>
<p>通常经济学中会假设需求曲线的公式为这些因素对于需求量影响的<code>线性函数</code>。例如：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>Q</mi><mi>d</mi><mi>x</mi></msubsup><mo>=</mo><mn>9</mn><mo>−</mo><mn>1.5</mn><msub><mi>P</mi><mi>x</mi></msub><mo>+</mo><mn>0.02</mn><mi>I</mi><mo>+</mo><mn>0.11</mn><msub><mi>P</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">Q_d^{x}=9-1.5P_{x}+0.02I+0.11P_{y}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9614em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">9</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord">1.5</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord">0.02</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord">0.11</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>由于需求曲线绘制的是商品价格与商品需求量之间的关系曲线， 因此绘图时会假设<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">Q_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">P_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>为变量，其他因素如<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">P_{y}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>则是常数。实践中绘制需求曲线时会将需求放在横坐标x轴，然后将价格放在纵坐标y轴。所以绘图时还要将上式表示为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">P_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>关于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Q</mi><mi>x</mi><mi>d</mi></msubsup></mrow><annotation encoding="application/x-tex">Q_x^d</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0961em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>的方程。例如假设<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>=</mo><mn>40</mn></mrow><annotation encoding="application/x-tex">I=40</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">40</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>y</mi></msub><mo>=</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">P_y=25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">25</span></span></span></span>：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>P</mi><mi>x</mi></msub><mo>=</mo><mn>8.37</mn><mo>−</mo><mn>0.667</mn><msubsup><mi>Q</mi><mi>d</mi><mi>x</mi></msubsup></mrow><annotation encoding="application/x-tex">P_x=8.37-0.667Q_d^x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">8.37</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.9614em;vertical-align:-0.247em;"></span><span class="mord">0.667</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span></span></p>
<p>这就是需求曲线的表达式，截距为8.37，斜率为-0.667。</p>
<h4 id="供给曲线-Supply-curve">供给曲线(Supply curve)</h4>
<p>供给曲线与需求曲线类似，主要由生产商家的生产<code>意愿</code>与<code>能力</code>决定，而影响生产厂家的意愿与能力的因素通常是产品价格<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">P_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>与生产成本<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">cost</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">cos</span><span class="mord mathnormal">t</span></span></span></span>。</p>
<ul>
<li>商品价格上升时，供给量上升，反之亦然。</li>
<li>生产成本通常包括人工成本和原材料成本，成本上升时，供给量下降，反之亦然。</li>
</ul>
<p>供给曲线的表达式形式与需求曲线差不多，我就不额外举例了，依然要注意虽然供给曲线主要关注的是各个因素对供给量的影响，但写成表达式以及绘图时依然是表示为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">P_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>关于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>Q</mi><mi>x</mi><mi>s</mi></msubsup></mrow><annotation encoding="application/x-tex">Q_x^s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9303em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>的方程。</p>
<h4 id="需求与供给量的移动">需求与供给量的移动</h4>
<p>需求与供给量的移动有两种情况，因为需求供给方程都是针对其自身价格的变化构建的函数，其他影响因素都被简化为固定的常量，因此当商品本身价格变动时引起的需求供给量的变化是<code>沿供给需求曲线变化(movement along line)</code>；而其他因素变化时实际上是导致供给需求曲线方程中的截距变化，也就是<code>曲线平移(curve shifting)</code>。至于平移方向需求与供给曲线一样，当因素会导致需求或供给量上升时，曲线右移；导致需求或供给量下降时，曲线左移。</p>
<h4 id="市场均衡-Market-Equilibrium">市场均衡(Market Equilibrium)</h4>
<p>将需求曲线与供给曲线画在同一张图上，两个曲线的交点就是市场均衡点。也就是会导致需求量与供给量相同的商品价格。如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220620225227202.png" alt="供给曲线与需求曲线的交点就是市场均衡点"></p>
<p>亚当斯密的古典经济学理论认为市场是一只看不见的手，当商品价格高于均衡价格时， 市场需求低于市场供给，会导致商品难以销售，从而导致生产厂家降价销售。当商品价格低于均衡价格时，市场需求高于市场供给，商品供不应求，会有消费者愿意高价购买商品，导致生产厂家提高商品价格。</p>
<h4 id="消费者剩余与生产者剩余">消费者剩余与生产者剩余</h4>
<p>消费者剩余(Consumer Surplus)是指消费者为购买一批商品所愿意支付的最高价值与其必须支付的价格之间的差值。同理生产者剩余(Producer Surplus)则是生产者生产一批商品可以获得的利润与其生产的最低机会成本的差值。其计算方法就是下图中的三角形面积：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220620231033401.png" alt="消费者剩余和生产者剩余"></p>
<p>这两个指标分别体现的是消费者和生产者在生产活动中自己感觉到获取的额外利益，是一种衡量社会福利指标。</p>
<h3 id="弹性-Elasticity">弹性(Elasticity)</h3>
<p>CFA中只涉及对需求弹性的讨论，需求弹性是衡量<code>需求量</code>对某个影响因素变化而变化的敏感程度。</p>
<h4 id="价格弹性">价格弹性</h4>
<h5 id="定义和计算">定义和计算</h5>
<p>弹性的定义就是计算每当价格变化1%时，需求会变化的百分比，其中价格弹性的计算公式就是：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>e</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msubsup><mi>Q</mi><mi>x</mi><mi>d</mi></msubsup><mi mathvariant="normal">%</mi></mrow><mrow><mi mathvariant="normal">Δ</mi><msub><mi>P</mi><mi>x</mi></msub><mi mathvariant="normal">%</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>Q</mi><mi mathvariant="normal">/</mi><mi>Q</mi></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>P</mi><mi mathvariant="normal">/</mi><mi>P</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>Q</mi></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>P</mi></mrow></mfrac><mo>×</mo><mfrac><mi>P</mi><mi>Q</mi></mfrac></mrow><annotation encoding="application/x-tex">e_{price}=\frac{\Delta Q_x^d\%}{\Delta P_x\%}=\frac{\Delta Q/Q}{\Delta P/P}=\frac{\Delta Q}{\Delta P}\times\frac{P}{Q}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">ce</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3621em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5261em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">%</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord">%</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal">Q</span><span class="mord">/</span><span class="mord mathnormal">Q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal">Q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>Q</mi></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>P</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\Delta Q}{\Delta P}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2694em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9244em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight">Q</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>就是需求函数中的斜率(Q的系数)。这时计算出的<code>需求弹性</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></msub></mrow><annotation encoding="application/x-tex">e_{price}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">ce</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>就是需求曲线在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>Q</mi></mrow><annotation encoding="application/x-tex">PQ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">PQ</span></span></span></span>点的<code>点弹性</code>。相对于点弹性，还有存在<code>弧弹性</code>的概念，其就是指两个点之间的弹性，可以用这两个点中间的平均价格和需求量来计算。</p>
<h5 id="价格弹性的分类">价格弹性的分类</h5>
<p>价格弹性就是商品价格对商品需求量的影响敏感程度。价格弹性小于0时负相关，大于0则是正相关。弹性的性质分为三类：</p>
<ul>
<li><code>富有弹性(Elastic)：</code>当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><msub><mi>e</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></msub><mi mathvariant="normal">∣</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">|e_{price}|&gt;1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">ce</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>时，商品价格会加倍影响需求量。</li>
<li><code>缺乏弹性(Inelastic)：</code>当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><msub><mi>e</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></msub><mi mathvariant="normal">∣</mi><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">|e_{price}|&lt;1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">ce</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>时，商品价格会较少影响需求量。</li>
<li><code>单位弹性(Unit Elastic)：</code>当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><msub><mi>e</mi><mrow><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></msub><mi mathvariant="normal">∣</mi><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">|e_{price}|&gt;1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">ce</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>时，商品价格与需求量变化影响相同。</li>
</ul>
<p><code>完全弹性(Perfectly elastic)</code>和<code>完全不弹性(Perfect inelastic)</code>则分别是指价格的变动对需求量影响无穷大(涨价一点就完全没人买)和价格变动对需求量无影响(不管价格如何变动，需求量都是固定的)。</p>
<h5 id="价格弹性与收入的关系">价格弹性与收入的关系</h5>
<p>在同一条需求曲线上，单位弹性以上的点都是富有弹性的，以下的点都是缺乏弹性的。而厂商的收入是商品价格乘以商品销售量，当商品价格在单位弹性点之上时，每降一点价格都会增加更多销量从而使销售额增大；当商品价格在单位弹性点之下时，每升高一点价格只会导致少量的销量减少，同样是销售额增大。因此厂商的最大销售额就在商品价格处于单位弹性点时。</p>
<h5 id="需求弹性的影响因素">需求弹性的影响因素</h5>
<ul>
<li><code>替代品数量(Availability of substitutes)：</code>当一个商品替代品数量越多时，这个商品的弹性越高。</li>
<li><code>相对收入的比例(Relative amount of income spent on the good)：</code>消费者购买商品的预算占收入比例越大，商品的弹性就越大。(对人们来说越贵的东西越容易被价格变动影响)</li>
<li><code>价格变化的时间(Time since the price change)：</code>时间越长替代品数量越多，因此时间越长弹性越大。</li>
</ul>
<h4 id="交叉弹性-Cross-Elasticity">交叉弹性(Cross Elasticity)</h4>
<p>与价格弹性相似，交叉弹性就是衡量其他商品的价格对需求量影响的弹性的指标：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>e</mi><mrow><mi>c</mi><mi>r</mi><mi>o</mi><mi>s</mi><mi>s</mi></mrow></msub><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msubsup><mi>Q</mi><mi>x</mi><mi>d</mi></msubsup><mi mathvariant="normal">%</mi></mrow><mrow><mi mathvariant="normal">Δ</mi><msub><mi>P</mi><mi>y</mi></msub><mi mathvariant="normal">%</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msub><mi>Q</mi><mi>x</mi></msub><mi mathvariant="normal">/</mi><msub><mi>Q</mi><mi>x</mi></msub></mrow><mrow><mi mathvariant="normal">Δ</mi><msub><mi>P</mi><mi>y</mi></msub><mi mathvariant="normal">/</mi><msub><mi>P</mi><mi>y</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msub><mi>Q</mi><mi>x</mi></msub></mrow><mrow><mi mathvariant="normal">Δ</mi><msub><mi>P</mi><mi>y</mi></msub></mrow></mfrac><mo>×</mo><mfrac><msub><mi>P</mi><mi>y</mi></msub><msub><mi>Q</mi><mi>x</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">e_{cross}=\frac{\Delta Q_x^d\%}{\Delta P_y\%}=\frac{\Delta Q_x/Q_x}{\Delta P_y/P_y}=\frac{\Delta Q_x}{\Delta P_y}\times\frac{P_y}{Q_x}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">cross</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4982em;vertical-align:-0.9721em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5261em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">%</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord">%</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3991em;vertical-align:-0.9721em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3324em;vertical-align:-0.9721em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9721em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>这个公式与价格弹性几乎一样，不过其中的参数由<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>x</mi></msub></mrow><annotation encoding="application/x-tex">P_x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>变成了其他商品的价格<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">P_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>。实际计算中就是\frac{\Delta Q_x}{\Delta P_y}为需求曲线函数中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>y</mi></msub></mrow><annotation encoding="application/x-tex">P_y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03588em;">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>前的系数。</p>
<h5 id="交叉弹性的分类">交叉弹性的分类</h5>
<p>当交叉弹性为<code>负数</code>时，代表该其他商品价格负向影响本商品需求量，说明本商品与该其他商品互为<code>互补品</code>。反之当交叉弹性为<code>正数</code>时，说明本商品与该其他商品互为<code>替代品</code>。</p>
<h4 id="收入弹性">收入弹性</h4>
<p>同样的，还有收入水平变化与商品需求量变化的弹性指标，<code>收入弹性</code><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>e</mi><mi>I</mi></msub></mrow><annotation encoding="application/x-tex">e_I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>e</mi><mi>I</mi></msub><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msubsup><mi>Q</mi><mi>x</mi><mi>d</mi></msubsup><mi mathvariant="normal">%</mi></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>I</mi><mi mathvariant="normal">%</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msub><mi>Q</mi><mi>x</mi></msub><mi mathvariant="normal">/</mi><msub><mi>Q</mi><mi>x</mi></msub></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>I</mi><mi mathvariant="normal">/</mi><mi>I</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><mi mathvariant="normal">Δ</mi><msub><mi>Q</mi><mi>x</mi></msub></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>I</mi></mrow></mfrac><mo>×</mo><mfrac><mi>I</mi><msub><mi>Q</mi><mi>x</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">e_{I}=\frac{\Delta Q_x^d\%}{\Delta I\%}=\frac{\Delta Q_x/Q_x}{\Delta I/I}=\frac{\Delta Q_x}{\Delta I}\times\frac{I}{Q_x}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2677em;vertical-align:-0.7416em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5261em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord">%</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-2.453em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span><span class="mord">%</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7416em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord">/</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>与前面一样，需要注意的只有<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">Δ</mi><msub><mi>Q</mi><mi>x</mi></msub></mrow><mrow><mi mathvariant="normal">Δ</mi><mi>I</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{\Delta Q_x}{\Delta I}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2694em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9244em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mathnormal mtight" style="margin-right:0.07847em;">I</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">Δ</span><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>在实际计算中就是需求曲线函数中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span>前的系数。</p>
<h5 id="收入弹性的分类">收入弹性的分类</h5>
<p>当收入弹性为<code>正数</code>时，这件商品被称为<code>正常商品(normal goods)</code>。反之收入弹性为<code>负数</code>时，商品被称为<code>劣质品(inferior goods)</code>。对正常商品来说(即收入弹性为正数时)，<code>弹性在0-1之间</code>时，收入水平对商品需求量影响较小，商品为<code>必需品</code>。<code>弹性大于1时</code>，收入水平对商品需求量影响较大，商品为<code>奢侈品</code>。</p>
<h4 id="替代效应-Substitution-effect-和收入效应-Income-effect">替代效应(Substitution effect)和收入效应(Income effect)</h4>
<p>替代效应是指当商品价格上升时，消费者会寻找该商品的替代品，从而导致商品的需求量下降。而收入效应则是指当商品价格上升而收入不变时，收入的实际购买力下降，这时会由于收入弹性导致商品需求量的变化，人们对正常商品的需求量会下降，对劣质品的需求量会上升。</p>
<p>对于所有商品来说，替代效应都是正效应。而收入效应对正常商品是正效应，对劣质品是负效应。因此对于劣质品来说有两种情况，如果其收入效应大于替代效应时，总效应为负效应，即商品价格升高会导致商品需求量增加，该商品为<code>吉芬商品(Giffen goods)</code>。与吉芬商品相似的还有<code>韦博伦商品(Veblen goods)</code>，相似点体现在韦博伦商品的需求量也会随其价格的上升而上升(当价格更高越能带来优越感时)，但韦博伦商品的本质是奢侈品，而吉芬商品是劣质品。另外韦博伦商品目前没有理论支持。</p>
<h3 id="利润、产量、收入以及成本">利润、产量、收入以及成本</h3>
<h4 id="会计利润vs经济利润vs正常利润">会计利润vs经济利润vs正常利润</h4>
<ul>
<li><code>会计利润(Accounting profit)</code>的计算方法就是在总收入的基础上扣除<code>显性成本(explicit cost)</code>后的利润。</li>
<li><code>经济利润(economic profit)</code>则是在会计利润的基础上再扣除如<code>机会成本(opportunity cost)</code>和<code>企业家才能(entrepreneurial ability)</code>等<code>隐形成本(Implicit cost)</code>后的利润。</li>
<li><code>正常利润(normal cost)</code>则是当经济利润为0时的会计利润，计算时正常利润的值与隐形成本相等，也即投资至少需要用以覆盖成本的利润。也因此经济利润又被称为<code>非正常/超额利润(abnormal profit)</code>。</li>
</ul>
<h4 id="产量-Product">产量(Product)</h4>
<p>产量是衡量供应商供给能力的指标，我们主要需要介绍的是<code>总产量(Total Product)</code>、<code>平均产量(Average Product)</code>和<code>边际产量(Marginal Product)</code>三个概念：</p>
<ul>
<li><code>总产量</code>是指一段时间内的所有产出，通常是一个关于<code>劳动力(Labour)</code>的函数。</li>
<li><code>平均产量</code>是指每单位劳动力的平均产量。</li>
<li><code>边际产量</code>是指在当前产量情况下，每增加一单位劳动力可以增加的产量。</li>
</ul>
<p><code>边际效益递减规律(The law of diminishing marginal returns)</code>是指通常在增加资产投入时，每单位投入的资产所能产生的边际效益会随着投入越来越多而变小，当边际效益为零时，总产出达到最大值。因此，当边际产量大于平均产量时，每单位投入都会使平均产量增加；相反如果边际产量小于平均产量，每单位投入都会使平均产量减少。当边际产量等于平均产量时，平均产量达到最大值。</p>
<h4 id="收入-Revenue">收入(Revenue)</h4>
<p>收入和产量一样，也有<code>总收入(Total revenue)</code>、<code>平均收入(Average revenue)</code>和<code>边际收入(Marginal revenue)</code>三个概念：</p>
<ul>
<li>总收入是指当一家公司以同样的价格售卖商品给所有客户时，总收入为价格乘以销售量，而销量本身与价格有关。</li>
<li>平均收入是指总收入除以总销售量，也就是产品价格。</li>
<li>边际收入是指每多卖出一个产品时，总收入的增加量。</li>
</ul>
<p>当市场环境是<code>完全竞争市场(Perfect competition market)</code>时，所有厂商都没有定价权，只能被动接受价格，售卖同质化商品，数量多，且进入壁垒低。在这样的市场中，边际收入=商品价格=平均收入。</p>
<p>当市场环境是<code>非完全竞争市场时(Inperfect competition market)</code>时，即市场参与者不满足完全竞争市场的任意条件时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>边际收入</mtext><mo>=</mo><mtext>商品价格</mtext><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mfrac><mn>1</mn><mrow><mi mathvariant="normal">∣</mi><mtext>价格弹性</mtext><mi mathvariant="normal">∣</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">边际收入=商品价格\times (1-\frac{1}{|价格弹性|})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">边际收入</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord cjk_fallback">商品价格</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.3651em;vertical-align:-0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord cjk_fallback mtight">价格弹性</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span>。边际收入大于零时，总收入上升；边际收入小于零时，总收入下降；边际收入等于零时，总收入为最大值。</p>
<h4 id="成本">成本</h4>
<p>经济学中，认为短期内成本可以分为固定成本和可变成本，而长期时间中，成本中只有可变成本。需要掌握的结论有这些：</p>
<ul>
<li>总成本=总固定成本+总可变成本，其中可变成本随生产量变化而变化，固定成本不随生产量变化。</li>
<li>平均总成本=平均固定成本+平均可变成本，其中平均固定成本只会随生产量增加而递减。</li>
<li>边际成本=总成本变化量/生产量变化量，边际成本的变化通常由可变成本变化导致。</li>
<li>边际成本、平均总成本、和平均可变成本随生产量变化的曲线都是先向下后向上的U型曲线。边际成本曲线通过平均总成本和平均可变成本的曲线最低点，也即当边际成本等于这两个成本时，它们达到最低值。</li>
</ul>
<h4 id="一些零散的知识点">一些零散的知识点</h4>
<ul>
<li>由于边际收入随生产量增加而减少，边际成本随生产量增加而增加，当边际收入等于边际成本时，利润达到最大化。</li>
<li>在完全竞争市场下，当商品售价等于平均总成本时，处于<code>盈亏平衡点(Breakeven point)</code>。售价大于该点时供应商会留在市场中，售价低于这点时供应商会因为固定成本而在短期内留在市场中。当商品售价等于平均可变成本时，处于<code>关门点(Shutdown point)</code>。售价高于这点供应商才会再短期内留在市场中，当低于这点时每卖出一份产品就会亏损一份钱，因此供应商应该立即停止生产。</li>
<li>在不完全竞争市场下，商家不是价格的接受者，因此可以通过对比不同生产量下总收入和总成本与总可变成本对比确定盈亏平衡点和关门点。</li>
<li><code>规模经济和规模不经济(Economies of Scale and Diseconomies of Scale)</code>通过<code>长期平均总成本曲线(Long-run average total cost curve)</code>确定，随着生产量增加LATC会先下降，后上升。LATC会随着生产量上升而下降的生产规模叫做规模经济，LATC随着生产量上升而上升的生产规模叫做规模不经济。</li>
</ul>
<h2 id="Reading-13-公司和市场结构">Reading 13 公司和市场结构</h2>
<h3 id="市场结构特点">市场结构特点</h3>
<table>
<thead>
<tr>
<th>Type</th>
<th>Number of Firms</th>
<th>Degree of difference of products</th>
<th>Difficulty to enter or leave</th>
<th>Pricing Power of Firm</th>
<th>The example in our life</th>
</tr>
</thead>
<tbody>
<tr>
<td>Perfect competition（完全竞争）</td>
<td>Many</td>
<td>No difference</td>
<td>Very easy</td>
<td>None</td>
<td>Some agricultural products</td>
</tr>
<tr>
<td>Monopolistic competition（垄断竞争</td>
<td>Many</td>
<td>Some difference</td>
<td>Relatively easy</td>
<td>Some</td>
<td>Some retail products</td>
</tr>
<tr>
<td>Oligopoly（寡头）</td>
<td>More than one but not many</td>
<td>Little or no difference</td>
<td>Difficult</td>
<td>Some or Condiderable</td>
<td>Steel, automobile, oil</td>
</tr>
<tr>
<td>Pure monopoly（垄断）</td>
<td>SIngle</td>
<td>Sole product, nearly no substitute</td>
<td>No way</td>
<td>Considerable</td>
<td>Public sectors</td>
</tr>
</tbody>
</table>
<p><code>完全竞争市场：</code>对于完全竞争市场来说，短期内边际收入等于边际成本时利润最大，所有厂商都是价格接受者，供给曲线为水平，边际收入=市场价格=平均总收入，所有厂商的经济利润都为0。</p>
<p><code>垄断竞争市场：</code>垄断竞争市场为了保证产品差异化会出现创新和产品升级，拥有一定的品牌认知度，并且会有广告出现。短期内体现出垄断市场特点，长期体现出完全竞争市场特点。边际收入等于边际成本时利润最大， 但短期内由于产品差异化，厂商可以根据需求曲线调整价格，从而获取经济利润，但长期内由于产品互相可以替代，厂商会将价格逐步调整为相同，经济利润逐渐变为0。</p>
<p><code>寡头市场：</code>除了上表中的差异以外，寡头市场的特有特点是各个公司会考虑竞争对手的行为而进行决策<code>(Interdependence among competitors)</code>。描述寡头市场的四个经济模型在下面单独介绍。</p>
<p><code>垄断市场：</code>能形成垄断市场说明其市场的进入壁垒较高，主要的垄断壁垒有两种:<code>法律壁垒(Legal barriers)</code>和<code>自然壁垒(Natural barriers)</code>。垄断公司的利润最大化点一定是按照其边际收入等于边际成本计算，其相比完全竞争市场供给更低，价格更高。通常政府会干预垄断公司要求其以平均成本或边际成本定价。</p>
<h3 id="寡头市场模型">寡头市场模型</h3>
<h4 id="拐折的需求曲线-Kinked-Demand-Curve-Model">拐折的需求曲线(Kinked Demand Curve Model)</h4>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220719230332597.png" alt="Kinked Demand Curve Model"></p>
<p>在柺折的需求曲线中，首先要决定价格拐点，模型假设市场供需关系是有效的，也即当前的市场价格既是价格拐点，而寡头市场的特点是产品同质化，当有厂商试图在这个市场中提升价格时，其他厂商不会跟进提升价格，因此该厂商的产品需求量会急剧下降，也就是说在拐折点以上的弹性较大；而相反当有厂商降低价格时其他厂商会跟进降低价格，因此此时价格的降低不会造成那么大的需求量上升，也就是说在拐折点以下的弹性较小。</p>
<p>这个模型的缺点第一是拐点的计算没有理论依据，第二是由于在拐折点商品弹性变化， 该商品的边际收入会在拐点出现分段，导致有一段区间无法计算边际收入与边际成本相等的点(即利润最大点)。</p>
<h4 id="古诺模型-Cournot-Model">古诺模型(Cournot Model)</h4>
<p>古诺模型主要描述只有两个公司的寡头市场，其假设两个企业的边际成本相同，且两企业相互知道对方的产品供给量，最后模型得到的结果是两公司会选择相同的市场供给量。</p>
<h4 id="纳什均衡-Nash-Equilibrium-Model">纳什均衡(Nash Equilibrium Model)</h4>
<p>当市场达到纳什均衡状态时，每个单独的公司改变其自身决策都不会使其获得更好的结果。纳什均衡的一个经典例子就是<code>囚徒困境</code>。其假设是每个决策者以自身利益最大化为目标进行决策，但个人利益最大化的结果并不一定是群体利益最大化。现实中纳什均衡点可能并不存在。</p>
<p>打破纳什均衡的方法是<code>合谋(Collusion)</code>，当市场参与者较少，产品趋同，成本结构类似时才可以达成合谋，即所有厂商达成一致以某个价格销售商品。</p>
<h4 id="主导厂商模型-Dominant-Firm-Model">主导厂商模型(Dominant Firm Model)</h4>
<p>当市场中有一家公司占有明显更大的市场份额时，市场可以适用主导厂商模型。在这个模型中主导厂商类似于垄断市场，而其他小厂商则类似于完全竞争市场。主导厂商可以以其自身的边际收入等于边际成本的点定价，而其他小厂商只能作为价格的接受者。这里面有一个假设是主导厂商由于规模效应，其平均总成本可能低于小厂商，因此若其定价介于自己与小厂商的平均总成本之间时会导致小厂商退出市场从而获得更多市场份额。而长期来看由于主导厂商的定价权会导致市场短期内存在经济利润，因此长期会吸引新的厂商进入市场，从而使主导厂商的市场份额下降。</p>
<h3 id="价格歧视-Price-discrimination">价格歧视(Price discrimination)</h3>
<p>价格歧视是对不同的客户以不同的价格出售相同的产品或服务，其程度分为三级：</p>
<p>一级价格歧视：垄断企业能够向每个客户收取该客户愿意付出的最高价格，最理想情况但基本不可能实现。</p>
<p>二级价格歧视：垄断企业提供基于购买数量的价格选项以获得客户可以接受的最合理的商品价格。</p>
<p>三级价格其实：客户被以人口分类的方式区别对待提供不同的商品价格 。</p>
<h3 id="集中度指标计算-Concentration-Measures">集中度指标计算(Concentration Measures)</h3>
<p>集中度指标用于衡量市场的垄断程度，其中<code>N-firm concentration ratio</code>是将市场上份额占比最多的前N家公司的市场份额相加，而<code>Herfindahl-Hirschman Index(HHI)</code>则是计算市场上所有公司份额的平方和。前者优点是易于计算，但缺点是对兼并收购不敏感，即当两家大公司合并时前者可能只会小幅度上升。</p>
<p>两种集中度指标都有一个共同的缺点就是没有考虑市场的进入和退出壁垒。因为当市场壁垒较小时，既是是拥有大市场份额的公司也没有太多定价权。</p>
<h2 id="Reading-14-总产出，价格和经济增长">Reading 14 总产出，价格和经济增长</h2>
<h3 id="国内生产总值-Gross-Domestic-Product">国内生产总值(Gross Domestic Product)</h3>
<p>国内生产总值(GDP)是一个<code>国家/地区</code>在<code>一段特定时间内</code>生产的<code>最终商品或服务</code>的<code>市场总价值</code>。 当期的GDP<strong>不包括</strong>前期生产的商品的售卖或二次售卖、政府的<code>转移支付(transfer payments)</code>，生产中的商品、副产品、地下产业或<code>以物易物(Barter transaction)</code>。</p>
<p>与GDP类似的指标还有<code>国民生产总值(Gross National Product)</code>，GDP为属地概念，GNP为属人概念。</p>
<h4 id="GDP的定义">GDP的定义</h4>
<p><code>名义GDP(Nominal GDP)</code>简单来讲就是一个经济体生产的所有商品或服务在市场价格下的的总值，公式表达如下：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>N</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>G</mi><mi>D</mi><msub><mi>P</mi><mi>t</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>P</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub><msub><mi>Q</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mo stretchy="false">(</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>g</mi><mi>o</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mtext> </mtext><mi>t</mi><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>t</mi><mi>y</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>g</mi><mi>o</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mtext> </mtext><mi>t</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
Nominal\ GDP_t &amp;= \sum_{i=1}^N P_{i,t}Q_{i,t}\\
&amp;=\sum_{i=1}^N(price\ of\ good\ i\ in\ year\ t)\times(quantity\ of\ good\ i\ produced\ in\ year\ t)
\end{align*}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.812em;vertical-align:-3.156em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.656em;"><span style="top:-5.656em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.156em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.656em;"><span style="top:-5.656em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">oo</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">i</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace"> </span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">an</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">oo</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">i</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal">ce</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace"> </span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.156em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><code>真实GDP(Real GDP)</code>是计算GDP时剔除物价水平变化的影响，使用基期物价水平，公式如下：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>R</mi><mi>e</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>G</mi><mi>D</mi><msub><mi>P</mi><mi>t</mi></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><msub><mi>P</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi><mo>−</mo><mn>5</mn></mrow></msub><msub><mi>Q</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mo stretchy="false">(</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>g</mi><mi>o</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mtext> </mtext><mi>t</mi><mo>−</mo><mn>5</mn><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mi>q</mi><mi>u</mi><mi>a</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>t</mi><mi>y</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>g</mi><mi>o</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mtext> </mtext><mi>t</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
Real\ GDP_t &amp;= \sum_{i=1}^N P_{i,t-5}Q_{i,t}\\
&amp;=\sum_{i=1}^N(price\ of\ good\ i\ in\ year\ t-5)\times(quantity\ of\ good\ i\ produced\ in\ year\ t)
\end{align*}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.812em;vertical-align:-3.156em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.656em;"><span style="top:-5.656em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.156em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.656em;"><span style="top:-5.656em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.25em;"><span class="pstrut" style="height:3.8283em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8283em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">oo</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">i</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace"> </span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">5</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">an</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">oo</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">i</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal">ce</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace"> </span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.156em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>需要说明的是公式中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mrow><mi>i</mi><mo separator="true">,</mo><mi>t</mi><mo>−</mo><mn>5</mn></mrow></msub></mrow><annotation encoding="application/x-tex">P_{i,t-5}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">5</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>是以5年前的物价水平作为基期物价水平，实际计算不一定是五年前。</p>
<p><code>GDP平减指数(GDP Deflator)</code>是使用名义GDP和真实GDP的比值计算出的物价水平指数，用于反映通货膨胀水平，公式如下：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mi>D</mi><mi>P</mi><mtext> </mtext><mi>d</mi><mi>e</mi><mi>f</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo><mfrac><mrow><mi>N</mi><mi>o</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>G</mi><mi>D</mi><mi>P</mi></mrow><mrow><mi>R</mi><mi>e</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>G</mi><mi>D</mi><mi>P</mi></mrow></mfrac><mo>×</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">GDP\ deflator=\frac{Nominal\ GDP}{Real\ GDP}\times 100
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0574em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mina</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">100</span></span></span></span></span></p>
<h4 id="GDP的计算">GDP的计算</h4>
<p><code>The value-of-final-output method：</code>将生产的所有最终商品和服务的总价值加总的方法。</p>
<p><code>The sum-of-value-added method：</code>将生产或分发商品及服务的各阶段的中间附加值累计计算总值的方法。</p>
<p><code>Expenditure approach(支出法)</code>将国内所有支出相加获得总值：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mi>D</mi><mi>P</mi><mo>=</mo><mi>C</mi><mo>+</mo><mi>I</mi><mo>+</mo><mi>G</mi><mo>+</mo><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">GDP = C+I+G+(X-M)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span>分别代表<code>私人部门</code>消费者在最终商品和服务的支出与国内私人总投资， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span>指<code>政府部门</code>的最终商品和服务的总支出，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>X</mi></mrow><annotation encoding="application/x-tex">X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>则分别代表国际贸易的出口与进口，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(X-M)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span>则是国际贸易净出口额。</p>
<p><code>Income approach(收入法)</code>将国内所有收入加总获得总值：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mi>D</mi><mi>P</mi><mo>=</mo><mi>G</mi><mi>r</mi><mi>o</mi><mi>s</mi><mi>s</mi><mtext> </mtext><mi>d</mi><mi>o</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>c</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mo>=</mo><mi>N</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>d</mi><mi>o</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>c</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi><mo>+</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>u</mi><mi>m</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>f</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>c</mi><mi>a</mi><mi>p</mi><mi>i</mi><mi>t</mi><mi>a</mi><mi>l</mi><mo stretchy="false">(</mo><mi>C</mi><mi>F</mi><mi>C</mi><mo stretchy="false">)</mo><mo>+</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>d</mi><mi>i</mi><mi>s</mi><mi>c</mi><mi>r</mi><mi>e</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">GDP = Gross\ domestic\ income=Net\ domestic\ income+Consumption\ of\ fixed\ capital(CFC)+statistical\ discrepency
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">ross</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">p</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">CFC</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">scre</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">cy</span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">CFC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">CFC</span></span></span></span>是用于衡量资产在生产过程中的正常损耗，统计误差则是用于将支出法与收入法所计结果统一的补充项。上式中<code>Gorss domestic income(GDI)</code>以下式计算：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.25em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>G</mi><mi>D</mi><mi>I</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>C</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>e</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>o</mi><mi>y</mi><mi>e</mi><mi>e</mi><mi>s</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>G</mi><mi>r</mi><mi>o</mi><mi>s</mi><mi>s</mi><mtext> </mtext><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>n</mi><mi>g</mi><mtext> </mtext><mi>s</mi><mi>u</mi><mi>r</mi><mi>p</mi><mi>l</mi><mi>u</mi><mi>s</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>G</mi><mi>r</mi><mi>o</mi><mi>s</mi><mi>s</mi><mtext> </mtext><mi>m</mi><mi>i</mi><mi>x</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>T</mi><mi>a</mi><mi>x</mi><mi>e</mi><mi>s</mi><mtext> </mtext><mi>l</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext> </mtext><mi>s</mi><mi>u</mi><mi>b</mi><mi>s</mi><mi>i</mi><mi>d</mi><mi>i</mi><mi>e</mi><mi>s</mi><mtext> </mtext><mi>o</mi><mi>n</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mi>T</mi><mi>a</mi><mi>s</mi><mi>e</mi><mi>s</mi><mtext> </mtext><mi>l</mi><mi>e</mi><mi>s</mi><mi>s</mi><mtext> </mtext><mi>s</mi><mi>u</mi><mi>b</mi><mi>s</mi><mi>i</mi><mi>d</mi><mi>i</mi><mi>e</mi><mi>s</mi><mtext> </mtext><mi>o</mi><mi>n</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>s</mi><mtext> </mtext><mi>a</mi><mi>n</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mi>m</mi><mi>p</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>s</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
GDI &amp;= Compensation\ of\ employees\\
&amp;+ Gross\ operating\ surplus\\
&amp;+ Gross\ mixed\ income\\
&amp;+ Taxes\ less\ subsidies\ on\ production\\
&amp;+ Tases\ less\ subsidies\ on\ products\ and\ imports
\end{align*}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.5em;vertical-align:-3.5em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4em;"><span style="top:-6.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">oyees</span></span></span><span style="top:-4.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">ross</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span></span></span><span style="top:-3.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">ross</span><span class="mspace"> </span><span class="mord mathnormal">mi</span><span class="mord mathnormal">x</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span></span></span><span style="top:-1.66em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mord mathnormal">es</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ess</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">es</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span><span style="top:-0.16em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ses</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ess</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">es</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mspace"> </span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">im</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:3.5em;"><span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>关于收入还有几个概念，<code>个人收入(Household primary income)</code>是衡量消费水平的重要指数，<code>可支配收入(Household disposable income)</code>是个人收入减去缴税部分后的收入水平，<code>家庭净储蓄(Household net saving)</code>是可支配收入减去家庭消费支出后的储蓄部分。</p>
<p>收入法还有一个变型式是将收入记为私人部门的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>，即消费与储蓄加上政府部门的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>即税收收入。将收入法计算的GDP与支出法计算的GDP联立可以得到下面的公式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mo>+</mo><mi>T</mi><mo>=</mo><mi>I</mi><mo>+</mo><mi>G</mi><mo>+</mo><mi>N</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">S +T = I + G +NX
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">NX</span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>代表储蓄，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span>表示税收，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span>表示投资，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">G</span></span></span></span>表示政府消费，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">NX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">NX</span></span></span></span>表示净出口额。</p>
<h3 id="IS曲线-Investment与Saving的关系">IS曲线(Investment与Saving的关系)</h3>
<p>IS曲线反映的是国家商品市场的均衡，即投资与储蓄相等时总收入与利率的关系。 列式表达：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Y</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>−</mo><mi>b</mi></mrow></mfrac><mo stretchy="false">(</mo><mi>a</mi><mo>+</mo><mi>I</mi><mo>+</mo><mi>G</mi><mo>+</mo><mi>N</mi><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Y= \frac{1}{1-b}(a + I + G +NX)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0908em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">b</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">NX</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mo>+</mo><mi>N</mi><mi>X</mi></mrow><annotation encoding="application/x-tex">G+NX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">NX</span></span></span></span>假设为常数，a为正数，b为收入中的消费比例，范围在0-1之间，而投资<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi></mrow><annotation encoding="application/x-tex">I</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span></span></span></span>会随利率的增加而减少。因此可以得出结论利率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>与总收入<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>为负相关。进出口与财政政策则会引起IS曲线的平移，政府支出或出口增加会使曲线右移，总收入增加；反之政府税收或进口增加会导致曲线左移，总收入减少。</p>
<h3 id="LM曲线-Liquidity与Money的关系">LM曲线(Liquidity与Money的关系)</h3>
<p>LM曲线反映的是货币市场均衡，即货币供给与货币需求的相等时，总收入与利率的关系。列式表达：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi>M</mi><msub><mi>S</mi><mi>N</mi></msub></mrow><mi>P</mi></mfrac><mo>=</mo><mi>M</mi><mi>D</mi><mo>=</mo><msub><mi>L</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>L</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\frac{MS_N}{P}=MD=L_1(Y)+L_2(r)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><msub><mi>S</mi><mi>N</mi></msub></mrow><annotation encoding="application/x-tex">MS_N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是名义货币供给，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>是物价水平。而<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">MD</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>货币需求有三类，<code>交易性需求(Transaction demand)</code>，<code>预防性需求(Precautionary demand)</code>和<code>投机性需求(Speculative demand)</code>。其中前两项被认为与总收入<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>正相关，是一类需求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_1(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>;第三项投机性需求是投资需要，受到利率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>的影响较大，与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>负相关，是二类需求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_2(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>。</p>
<p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_1(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_2(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>总和不变，而当利率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>下降使，投资性需求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_2(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>上升，此时一类需求<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_1(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>下降，而一类需求与总收入正相关，因此此情况下总收入也下降。利率<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>与总收入<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi></mrow><annotation encoding="application/x-tex">Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span></span></span></span>正相关。在给定的物价水平下，货币政策和物价水平使LM曲线平移。扩张的货币政策或物价下降增加<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>M</mi><msub><mi>S</mi><mi>N</mi></msub></mrow><mi>P</mi></mfrac></mrow><annotation encoding="application/x-tex">\frac{MS_N}{P}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2336em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8886em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4103em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3567em;margin-left:-0.0576em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1433em;"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>，向右移动；反之向左移动。</p>
<h4 id="货币供给">货币供给</h4>
<p>通常认为货币供给由央行控制，因此货币供给曲线为不受利率影响数量的直线，如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220725233559569.png" alt="货币需求供给曲线"></p>
<p>当货币供过于求时，利率较均衡点高，获取资金的成本高，市场倾向于购买证券，利率降低；反之利率升高。央行可以通过调整货币供给来影响短期的市场利率。</p>
<h3 id="总需求和总供给曲线-AD-AS-Curve">总需求和总供给曲线(AD&amp;AS Curve)</h3>
<p>对于CFA一级来说，我们需要掌握AD曲线的定义，反映的关系和移动，但AS曲线的推导比较复杂，只需要了解它的形状和移动。</p>
<h4 id="AD曲线">AD曲线</h4>
<p>AD曲线主要是用于研究物价P和收入Y的关系，其纵坐标为P，横坐标为Y。使用IS-LM曲线模型可以知道当物价水平P上升时，实际货币供给量<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><msub><mi>S</mi><mi>r</mi></msub></mrow><annotation encoding="application/x-tex">MS_r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>趋于减少，也就是说<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_1(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_2(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>的总和减少，而<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>Y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_1(Y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mclose">)</span></span></span></span>短期内不会变化，因此实际是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>L</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">L_2(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose">)</span></span></span></span>减少，可以知道利率r上升，投资I减少，根据收入Y与投资I的关系可知Y会因此减少。由此可知物价水平P与总收入Y呈负相关关系。</p>
<p>由于AD曲线实际是IS曲线与LM曲线交点时市场状态的集合，因此AD曲线实际上就是货币市场与商品市场同时达到均衡状态时的物价P与总收入Y的关系。</p>
<p>影响AD曲线移动的因素就是会导致IS或LM曲线移动的因素，总的来说就是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>+</mo><mi>I</mi><mo>+</mo><mi>G</mi><mo>+</mo><mo stretchy="false">(</mo><mi>X</mi><mo>−</mo><mi>M</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C+I+G+(X-M)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mclose">)</span></span></span></span>中的各项因素和政府的货币政策与财政政策。举例来说：</p>
<ul>
<li>消费者财富增加时会增加消费C，市场对未来的预期增强时会增加投资I，消费者对未来收入的预期增加时会增加消费C，资本效率上升时也会增加投资I。</li>
<li><code>扩张性的货币政策(Expansionary monetary policy)</code>是指政府增加货币供给，这会使银行有更多可贷资金，因此可能导致利率下降，从而刺激消费C和投资I。</li>
<li><code>扩张性的财政政策(Expansionary fiscal policy)</code>是指政府增加其支出预算，操作层面是指增加政府消费G或减少政府收入T，这会使市场总收入增加或市场可支配收入增加</li>
<li>汇率的变化会影响净出口额NX, 本国货币贬值或外国货币增值时，进口减少出口增加，导致NX增加。反之NX减少。</li>
<li>全球经济增长会导致其他国家的进口增加，也就是本国出口增加，导致NX增加。</li>
</ul>
<h4 id="AS曲线">AS曲线</h4>
<p>AS曲线反映的是物价P与总产出Y的关系，纵坐标P，横坐标Y。 AS曲线需要从三个时间维度来看：</p>
<ol>
<li>超短期总供给曲线VSRAS曲线是完全弹性的，也就是物价水平不变的情况下产出依然会逐步增加，该情况主要出现于大萧条时，不常见。</li>
<li>短期总供给曲线SRAS曲线是斜向上，即物价水平P与总产出Y正相关。</li>
<li>长期总供给曲线LRAS曲线是垂直于总产出Y，也即物价水平不影响总产出Y。</li>
</ol>
<h5 id="LRAS曲线">LRAS曲线</h5>
<p>长期总供给曲线LRAS曲线是稳定在<code>potential GDP</code>的水平，此时市场失业率为自然失业率水平。若市场产出小于<code>potential GDP</code>这意味着资源没有充分利用，也就是说市场失业率较高，市场处于<code>Recession</code>状态。反之若产出大于<code>potential GDP</code>这意味着经济过度利用的Inflation状态，失业率较低。</p>
<h5 id="SRAS曲线">SRAS曲线</h5>
<p>短期总供给曲线SRAS曲线是基于凯恩斯理论，认为工资具有粘性的基础上推导，也即短期内人工工资不会随物价水平变化而变化 。短期内物价水平上升，人员名义工资不变，表示真实工资下降，因此企业成本实际在下降，总产出Y上升。相反物价水平下降时，总产出Y下降，因此得出物价水平P与总产出Y负相关的结论。</p>
<h5 id="AS曲线的移动">AS曲线的移动</h5>
<p>引起LRAS曲线移动的因素同样会导致SRAS曲线移动，但引起SRAS曲线移动的因素不一定会引起LRAS曲线移动。而会引起LRAS曲线移动的因素主要有五个，分别是劳动力供给、资源供给、劳动力受教育程度、实物资本、技术和生产力的增加都会使LRAS和SRAS曲线右移。而短期内会引起SRAS曲线移动的因素分别有名义工资减少、资源价格减少、未来预期物价上升、商业税收减少、补贴增加、汇率增加等都会使SRAS曲线右移。</p>
<h3 id="宏观经济均衡状态-Macroeconomic-equilibrium">宏观经济均衡状态(Macroeconomic equilibrium)</h3>
<p>本节主要需要了解不同经济状态产生的原因与结果，以及使用模型分析的方法（新古典主义和凯恩斯的角度，即政府不干预或干预经济）。</p>
<h4 id="经济萧条-Recession">经济萧条(Recession)</h4>
<p>总需求下降、导致产量和物价水平都下降。</p>
<p>在<code>政府不干预经济</code>的情况下，物价水平下降导致工人实际工资下降，生产成本从而下降从而促进总产出Y，短期总供给曲线SRAS右移使物价水平进一步降低而DGP恢复，市场均衡由1→2→3。</p>
<p>而在<code>政府干预经济</code>的情况下，政府会采用扩张的货币和财政政策，从而促进总需求曲线的右移，市场均衡由1→2→1。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220801232916678.png" alt="经济萧条状态的均衡"></p>
<h4 id="经济过剩-Inflation">经济过剩(Inflation)</h4>
<p>总需求过剩，产量更高、物价水平也更高。</p>
<p>在<code>政府不干预经济</code>的情况下，物价水平上升导致生产成本上升，促使生产者减少产出Y，短期总供给曲线SRAS左移，GDP恢复到均衡水平但物价水平进一步上升，市场均衡由1→2→3。</p>
<p>在<code>政府干预经济</code>的情况下，政府采用紧缩的货币和财政政策，从而促进总需求曲线左移，市场均衡由1→2→1。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220801233432788.png" alt="经济过剩状态的均衡"></p>
<h4 id="经济滞胀-Stagflation">经济滞胀(Stagflation)</h4>
<p>经济停滞(产出不足)，通货膨胀(物价上升)，主要原因是厂商生产成本的忽然上升，例如能源价格上升，导致厂商不愿意生产，短期供给曲线SRAS曲线左移，物价水平上升，产出下降。</p>
<p>在<code>政府不干预经济</code>的情况下，物价水平上升导致工人工资水平上升，总产出Y下降使失业率上升，长期而来工人只能接受更低工资，从而使生产成本重新降低，总产出Y回升，SRAS曲线右移，市场均衡由1→2→1，但需要时间较长。</p>
<p>在<code>政府干预经济</code>的情况下，政府会处于两难境地：如果政府采用紧缩政策，会使总需求曲线左移，物价水平回落，但总产出下降。如果政府采用扩张政策，会使总需求曲线右移，总产出恢复但物价水平会更增加。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220801234315684.png" alt="经济滞胀状态的均衡"></p>
<h4 id="物价水平下降-Decrease-in-Input-Prices">物价水平下降(Decrease in Input Prices)</h4>
<p>物价水平下降会导致总需求曲线AS右移，总产出增加，物价水平下降，是较好的经济情况。</p>
<h3 id="经济增长-Economic-Growth">经济增长(Economic Growth)</h3>
<p>影响经济增长的五大要素与引起LRAS曲线移动的因素相同，分别是：劳动力数量(Labor supply)、劳动力质量(Human capital)、实物资本(Physical capital stock)、科技(Technology)、和自然资源(Natural resources)。这些因素对生产力的影响可以由<code>道格拉斯生产函数(Cobb-Douglas Production function)</code>解释：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Y</mi><mo>=</mo><mi>A</mi><msup><mi>K</mi><mi>α</mi></msup><msup><mi>L</mi><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow></msup></mrow><annotation encoding="application/x-tex">Y = AK^\alpha L^{1-\alpha}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">L</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:0.0037em;">α</span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>其中Y指经济总产出，L指劳动力规模、K指资本量，A为<code>全要素生产率(Total factor productivity，由科技进步或劳动力受教育程度影响)</code>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>为劳动力与资本的配比。</p>
<h4 id="GDP增长率-Potential-GDP-growth-rate">GDP增长率(Potential GDP growth rate)</h4>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>Y</mi><mo>=</mo><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>A</mi><mo>+</mo><mi>α</mi><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>K</mi><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>L</mi><mspace linebreak="newline"></mspace><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>y</mi><mo>=</mo><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>A</mi><mo>+</mo><mi>α</mi><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>k</mi><mspace linebreak="newline"></mspace><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>Y</mi><mo>=</mo><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>y</mi><mo>+</mo><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>L</mi></mrow><annotation encoding="application/x-tex">\Delta \% Y=\Delta \% A + \alpha \Delta \% K + (1-\alpha)\Delta \% L\\
\Delta \% y = \Delta \% A + \alpha \Delta \%k\\
\Delta \% Y = \Delta \% y + \Delta \% L
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.0833em;"></span><span class="mord">Δ%</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mclose">)</span><span class="mord">Δ%</span><span class="mord mathnormal">L</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.0833em;"></span><span class="mord">Δ%</span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">Δ%</span><span class="mord mathnormal">L</span></span></span></span></span></p>
<p>其中各项含义与道格拉斯生产函数中各项含义相同，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">\Delta \% y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9444em;vertical-align:-0.1944em;"></span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span></span></span></span>为人均GDP变化率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>k</mi></mrow><annotation encoding="application/x-tex">\Delta \%k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">Δ%</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>为人均资本变化率。</p>
<h2 id="Reading-15-经济周期">Reading 15 经济周期</h2>
<p><code>经济周期(Business Cycle)</code>是指经济活动中的波动情况，真实DGP和失业率是决定当前经济周期阶段的关键因素。经济周期的四个阶段分别是<code>低谷(trough)</code>、<code>扩张(expansion)</code>、<code>顶峰(peak)</code>、<code>紧缩(contraction)</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220803225711694.png" alt="经济周期的四个状态"></p>
<h3 id="经济周期指标">经济周期指标</h3>
<p>判断经济周期有三个重要的指标，它们分别是：</p>
<ul>
<li><code>Ratio of inventory to sales</code>：当扩张快要到达顶峰时，销售速度开始放缓，存货开始累积，导致存货销售比高于其平常水平，此时厂商作为应对会减少生产，导致顶峰后的紧缩。相反当紧缩快要到达低谷时，厂商发现其销售开始加速，存货开始更快消耗，存货销售比低于正常水平，厂商为满足上涨的需求会增加生产，存货销售比从而向正常水平靠近。这个指标需要在扩张或衰退的后期才能反映出结果，因此该类指标被称为<code>lagging indicator</code>。</li>
<li><code>Utilization of labor levels</code>：在扩张初期，厂商不确定是否经济已经复苏，因此失业率不会有较大变化，但工人可能出现加班情况，直到在复苏后期厂商确定经济复苏时才会开始扩招人员，社会失业率降低。同理在紧缩的前期，经济开始衰退时，由于解雇裁员有成本，厂商不会马上削减人数，而是会减少劳动力劳动时间，最后在经济衰退确认后才开始削减人力开支，社会失业率增加。</li>
<li><code>Utilization of physical capital levels</code>：与劳动力类似，可以反映出经济在扩张或收缩的前后阶段。</li>
</ul>
<p>其他用于判断经济周期的指标还有购房趋势、房价与收入比、本国GDP相对其他经济体GDP变化情况等。</p>
<h3 id="经济周期理论">经济周期理论</h3>
<p>对于经济周期变化的原因有不同的理论解释，其中最主流的就是凯恩斯主义理论、货币主义理论、和古典主义理论。本部分主要需要了解不同学派对于“<code>什么引起了经济周期？</code>”和“<code>是否主张政府干预经济？</code>”的答案差异。</p>
<h4 id="凯恩斯学派-Keynesian-school">凯恩斯学派(Keynesian school)</h4>
<p>凯恩斯学派主张认为政府应该采取赤字财政，<code>主张政府应该干预经济</code>。凯恩斯学派认为<code>总需求的变化</code>引起经济周期。后期发展的新凯恩斯主义与原本的凯恩斯主义只有一点差别，凯恩斯主义认为员工工资具有粘性，不会忽然巨变，而新凯恩斯主义认为所有商品价格都具有粘性。</p>
<h4 id="货币主义学派-Monetarist-school">货币主义学派(Monetarist school)</h4>
<p>货币主义学派的主要思想可以归结为<code>货币数量论</code>，该理论认为市场中的货币供给乘以货币流转次数与物价水平乘以商品总产量相同。同时短期内经济体的货币流转次数与商品产量不会有大幅改变，因此若央行增加货币供给就会使物价水平上升，导致通货膨胀。<code>主张政府不乱发货币，不干预经济</code>。</p>
<h4 id="古典主义学派-Neoclassical-school">古典主义学派(Neoclassical school)</h4>
<p>古典主义最基本的理论就是亚当斯密提出的<code>看不见的手(Invisible hands)</code>，即市场可以自己调节，回复到均衡状态，因此古典主义学派都<code>主张政府不应该干预经济</code>。其中<code>新古典主义</code>认为<code>技术进步</code>引起经济周期；奥地利学派认为<code>政府的参与</code>引起经济周期；<code>新兴古典主义(New classic school: Real Business Cycle Theory)</code>结合新古典主义和奥地利学派，认为<code>外部冲击(external shock)</code>引起了经济周期，经济体的主要的外部冲击便是科技进步和政府干预。</p>
<h3 id="失业率-Unemployment">失业率(Unemployment)</h3>
<p><code>就业人群(Employed)</code>是有工作的人口数量，<code>劳动力(Labor force)</code>则是指有工作和正在找工作的人口数量，劳动力数量要剔除不适龄人群、学生、无工作意愿人群等，<code>工龄人口(Working age population)</code>则指年龄在可工作年龄内的人口数量。</p>
<p>两个重要的指标计算：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>f</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>e</mi><mtext> </mtext><mi>p</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>i</mi><mi>c</mi><mi>i</mi><mi>p</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mtext> </mtext><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo stretchy="false">(</mo><mtext>劳动力参与率</mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>l</mi><mi>a</mi><mi>b</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>f</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow><mrow><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi><mi>i</mi><mi>n</mi><mi>g</mi><mtext> </mtext><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>p</mi><mi>o</mi><mi>p</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></mfrac><mo>×</mo><mn>100</mn><mi mathvariant="normal">%</mi><mspace linebreak="newline"></mspace><mi>U</mi><mi>n</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>o</mi><mi>y</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mtext> </mtext><mi>R</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo stretchy="false">(</mo><mtext>失业率</mtext><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>u</mi><mi>n</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>o</mi><mi>y</mi><mi>e</mi><mi>d</mi></mrow><mrow><mi>L</mi><mi>a</mi><mi>b</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>f</mi><mi>o</mi><mi>r</mi><mi>c</mi><mi>e</mi></mrow></mfrac><mo>×</mo><mn>100</mn><mi mathvariant="normal">%</mi></mrow><annotation encoding="application/x-tex">Labor\ force\ participation\ rate(劳动力参与率)=\frac{labor\ force}{Working\ age\ population}\times 100 \% \\
Unemployment\ Rate(失业率)=\frac{number\ of\ unemployed}{Labor\ force}\times 100 \%
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">ab</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">orce</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal">i</span><span class="mord mathnormal">p</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord cjk_fallback">劳动力参与率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">kin</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">ab</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">orce</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">100%</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal" style="margin-right:0.03588em;">oy</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mopen">(</span><span class="mord cjk_fallback">失业率</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">L</span><span class="mord mathnormal">ab</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">orce</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mord mathnormal">u</span><span class="mord mathnormal">mb</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">oye</span><span class="mord mathnormal">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8056em;vertical-align:-0.0556em;"></span><span class="mord">100%</span></span></span></span></span></p>
<p><code>摩擦性失业(Frictional unemployment)</code>指因为摩擦裸辞等原因辞职，在两份工作之间会有失业期。</p>
<p><code>结构性失业(Structural unemployment)</code>指劳动力技能与岗位不匹配，例如因为科技进步导致一些职业技能不再被需要等等。</p>
<p><code>周期性失业(Cyclical unemployment)</code>指因为经济周期导致的失业率的波动。</p>
<p>最后三个与失业率相关的名词解释：<code>Underemployed</code>指一个人有工作，但其有从事明显比目前更高产出的工作的资质。<code>Discouraged worker</code>指不愿意找工作的人群，这群人可能会在经济回暖时重新进入劳动力市场，从而拉高失业率。<code>Voluntarily unemployed</code>指自愿失业的人群，例如家庭主妇等，这个人群不计入劳动力人口。</p>
<h3 id="通货膨胀-Inflation">通货膨胀(Inflation)</h3>
<p>通货膨胀指所有物价水平持续上涨，其衡量方法是<code>当期物价水平相对基期物价水平的上涨百分比</code>。通常低水平的通货膨胀有刺激经济的作用，但<code>恶性通货膨胀(Hyperinflation)</code>则是指物价水平增长极快的情况。<code>通货紧缩(Deflation)</code>指物价水平持续下降。<code>反通货膨胀(Disinflation)</code>指通货膨胀率在持续下降，此时通货膨胀率还是正值，只是通胀速度放缓。</p>
<h4 id="通货膨胀指标">通货膨胀指标</h4>
<ul>
<li><code>The consumer price index(CPI)</code>：CPI指数以特定商品或服务的当前价格与其基期价格的比值作为指标衡量物价水平。因为不同国家的商品篮子不同，导致不同国家的CPI指数不具备可比性。</li>
<li><code>GDP Deflator</code>：名义GDP与真实GDP的比值。</li>
<li><code>Producer price index(PPI)</code>/<code>Wholesale price index(WPI)</code>：计算方法与CPI指数类似，但其主要使用燃料、金属、农产品等生产者层面的商品作为物价指标物，其对物价水平提高的反映早与CPI指数。</li>
<li><code>Headline inflation</code>：在计算CPI指数时使用所有产品的价值作为指标，相当于GDP Deflator。</li>
<li><code>Core inflation</code>：不包含食物和能源等价格容易受到市场供求关系影响的消费者物价指数(CPI)，更真实反映通胀水平。</li>
</ul>
<h4 id="消费者物价指数-CPI-Index">消费者物价指数(CPI Index)</h4>
<p>CPI指数使用当期物价比基期物价，方法是每个商品的价格与产量的乘积和，其中La氏指标使用各商品基期的产量计算，Pa氏指标使用各商品当期的产量计算：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>L</mi><mi>a</mi><mi>s</mi><mi>p</mi><mi>e</mi><mi>y</mi><mi>r</mi><mi>e</mi><mi>s</mi><mtext> </mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>=</mo><mfrac><mrow><mo>∑</mo><msub><mi>P</mi><mi>t</mi></msub><mo>×</mo><msub><mi>Q</mi><mn>0</mn></msub></mrow><mrow><mo>∑</mo><msub><mi>P</mi><mn>0</mn></msub><mo>×</mo><msub><mi>Q</mi><mn>0</mn></msub></mrow></mfrac><mspace linebreak="newline"></mspace><mi>P</mi><mi>a</mi><mi>a</mi><mi>s</mi><mi>c</mi><mi>h</mi><mi>e</mi><mtext> </mtext><mi>I</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>=</mo><mfrac><mrow><mo>∑</mo><msub><mi>P</mi><mi>t</mi></msub><mo>×</mo><msub><mi>Q</mi><mi>t</mi></msub></mrow><mrow><mo>∑</mo><msub><mi>P</mi><mn>0</mn></msub><mo>×</mo><msub><mi>Q</mi><mi>t</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">Laspeyres\ Index=\frac{\sum P_t\times Q_0}{\sum P_0\times Q_0}\\
Paasche\ Index=\frac{\sum P_t\times Q_t}{\sum P_0\times Q_t}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">p</span><span class="mord mathnormal">eyres</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">aa</span><span class="mord mathnormal">sc</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>La氏指标与Pa氏指标有三个主要缺点，CFA协会分别给出了解决方法：</p>
<ul>
<li>没有考虑新产品：随时间推移将新出现的产品加入商品篮中。</li>
<li>没有考虑产品质量变化：使用<code>hedonic pricing(享乐定价法)</code>。</li>
<li>没有考虑商品间的替代效应：使用<code>Fisher Index</code>，即La氏指标与Pa氏指标的几何平均<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>F</mi></msub><mo>=</mo><msqrt><mrow><msub><mi>I</mi><mi>P</mi></msub><mo>×</mo><msub><mi>I</mi><mi>L</mi></msub></mrow></msqrt></mrow><annotation encoding="application/x-tex">I_F=\sqrt{I_P \times I_L}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1883em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8517em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8117em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1883em;"><span></span></span></span></span></span></span></span></span>。</li>
</ul>
<h4 id="通货膨胀的原因">通货膨胀的原因</h4>
<p>主要有<code>成本变化引起(Cost-push inflation)</code>和<code>需求变化引起(Demand-push inflation)</code>两种:</p>
<p>前者由于员工工资升高或生产原材料价格上升导致生产成本升高，经济滞胀，央行采用宽松的货币政策进一步拉高物价水平。</p>
<p>后者由于政府宽松的货币或财政政策以及出口增加导致，引起市场总需求增加，短期内导致实际GDP大于正常水平，工资要求更高工资引起生产成本升高，工厂减少产出，总生产曲线左移进一步拉高物价。</p>
<h3 id="经济指标-Economic-Indicators">经济指标(Economic Indicators)</h3>
<p>经济指标根据其反映经济状况的时间的不同，分为三类：</p>
<ul>
<li><code>Leading EI</code>：先行指标的拐点在经济转变之前，用于预测经济走势。</li>
<li><code>Coincident EI</code>：同步型指标拐点与整体经济情况基本同步，用于验证预测指标。</li>
<li><code>Lagging EI</code>：滞后型指标拐点滞后于经济变化，例如失业率等。</li>
</ul>
<p>重要的先行指标有<code>S&amp;P 500指数</code>、货币供给、长期债券与短期借款间的利差、消费者指标、平均周生产时间、平均周失业保险索赔、生产商新订单数量、小厂商交货时间、新建房地产数量等。</p>
<h1>Session 5</h1>
<h2 id="Reading-16-货币与财政政策">Reading 16 货币与财政政策</h2>
<p>政府<code>财政政策(Fiscal policy)</code>指政府通过调整其财政支出与税收来干预经济活动的方法。而<code>货币政策(Monetary policy)</code>则是指中央银行通过改变私人部门获得资金的成本(利率)来影响市场中的货币供给，并以此干预经济的方法。本章主要覆盖政府干预经济所采取的货币政策与财政政策的具体工具，以及其缺点。</p>
<h3 id="货币政策">货币政策</h3>
<h4 id="货币乘数">货币乘数</h4>
<p>中央银行每发行一元钱货币，其可能通过贷款流入市场的部分就是除去准备金的部分，而贷款流入市场后可能继续通过储蓄回到商业银行，商业银行又可以继续将这部分存款除去准备金部分后继续贷款，以此构成以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mtext>准备金率</mtext></mrow><annotation encoding="application/x-tex">1-准备金率</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">准备金率</span></span></span></span>的比率递减的等比数列，该数列和既是银行通过贷款在市场上创造的货币数量：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>o</mi><mi>n</mi><mi>e</mi><mi>y</mi><mtext> </mtext><mi>c</mi><mi>r</mi><mi>e</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mo>=</mo><mfrac><mrow><mi>n</mi><mi>e</mi><mi>w</mi><mtext> </mtext><mi>d</mi><mi>e</mi><mi>p</mi><mi>o</mi><mi>s</mi><mi>i</mi><mi>t</mi></mrow><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mtext> </mtext><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Money\ created = \frac{new\ deposit}{reserve\ requirement}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">ey</span><span class="mspace"> </span><span class="mord mathnormal">cre</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">reser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">re</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">re</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>此处<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">reserve requirement</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">reser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">ere</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">i</span><span class="mord mathnormal">re</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span>是央行规定的商业银行最低准备金率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mrow><mi>r</mi><mi>e</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mtext> </mtext><mi>r</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1}{reserve\ requirement}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3262em;vertical-align:-0.4811em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">reser</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span><span class="mspace mtight"><span class="mtight"> </span></span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">q</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4811em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>便是货币乘数，其假设所有贷款都没有被消费，而是回到银行，是商业银行创造货币的理论最大放大效果。</p>
<h4 id="货币数量论-Quantity-Theory-of-Money">货币数量论(Quantity Theory of Money)</h4>
<p>货币数量论的基本式就是货币供给数量乘货币流转速度等于物价水平乘真实产出：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>m</mi><mi>o</mi><mi>n</mi><mi>e</mi><mi>y</mi><mtext> </mtext><mi>s</mi><mi>u</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>y</mi><mo>×</mo><mi>v</mi><mi>e</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mo>×</mo><mi>r</mi><mi>e</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>o</mi><mi>u</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">money\ supply\times velocity=price\times real\ output
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">ey</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">ppl</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">oc</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">re</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">tp</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span></span></span></span></span></p>
<p>其中该理论假设流转速度V与真实产出Y为常数，即货币供给在长期直接影响物价水平，而不会影响总产出与失业率(该结论即被称为<code>货币中性Money neutrality</code>)。</p>
<h4 id="费雪效应-Fisher-Effect">费雪效应(Fisher Effect)</h4>
<p>费雪效应描述名义利率为真实利率与期望通货膨胀率的和：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>R</mi><mrow><mi>N</mi><mi>o</mi><mi>m</mi></mrow></msub><mo>=</mo><msub><mi>R</mi><mrow><mi>R</mi><mi>e</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>+</mo><mi>E</mi><mo stretchy="false">[</mo><mi>I</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">R_{Nom}=R_{Real}+E[I]
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">m</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mclose">]</span></span></span></span></span></p>
<p>费雪效应的背后原理是真实利率比较稳定，因此名义利率的变化主要由预期通货膨胀率引起。</p>
<h4 id="中央银行货币工具">中央银行货币工具</h4>
<ul>
<li><code>政策利率(Policy rate)</code>：指央行盯住的市场利率，不同国家央行所看的市场利率不同， 但基本都是短期利率，其基本思想是通过短期利率影响长期利率。当利率降低时，市场获取资金的成本降低，市场倾向借贷，释放流动性，是扩张性的货币政策；反之则是紧缩性的货币政策。</li>
<li><code>法定存款准备金率(Reserve requirements)</code>：指央行规定的商业银行最低的存款准备金，准备金率越低，则商业银行可以贷出的金额就越多，释放流动性，是扩张性的货币政策；反之是紧缩性的货币政策。</li>
<li><code>公开市场操作(Open market operations)</code>：指央行在公开市场上买卖债券，央行购买证券则是将钱放出市场，释放流动性，是扩张性的货币政策；反之则是紧缩性的货币政策。这是美联储最常使用的货币政策工具。</li>
</ul>
<h4 id="中性利率-Neutral-interest-rate">中性利率(Neutral interest rate)</h4>
<p>一个经济体的中性利率是指既不会引起经济上涨也不会引起经济下降的货币供给增长速度。即：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>N</mi><mi>e</mi><mi>u</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mi mathvariant="normal">Δ</mi><mi mathvariant="normal">%</mi><mi>G</mi><mi>D</mi><mi>P</mi><mo>+</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>f</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><msub><mi>r</mi><mrow><mi>r</mi><mi>e</mi><mi>a</mi><mi>l</mi></mrow></msub><mo>+</mo><mi>t</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>f</mi><mi>l</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">Neutral\ rate = \Delta \% GDP + target\ inflation=r_{real}+target\ inflation
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">e</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.0833em;"></span><span class="mord">Δ%</span><span class="mord mathnormal">G</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">re</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span></span></p>
<p>同时<code>政策利率(Policy rate)</code>是指真实GDP与真实通货膨胀率的和，因此对比政策利率与中性利率的本质就是对比<code>真实通货膨胀率(real inflation)</code>与<code>目标通货膨胀率(target inflation)</code>的大小，政府的目标是保证政策利率向中性利率看齐。</p>
<h4 id="货币政策的限制">货币政策的限制</h4>
<p>货币政策影响的是短期利率，但<code>长期利率可能不会随着短期利率的变化而变化</code>：</p>
<ul>
<li><code>bond market vigilantes</code>：当市场认为货币紧缩政策将会降低未来通货膨胀率的时候，他们会预期未来通货膨胀率更低，这会导致长期债券的价格上升，债券价格上升意味着长期利率的上升。反之亦然。</li>
<li><code>Liquidity trap</code>：由于市场经济处于萧条状态，银行或个人对市场信心不高，因此即使央行采取扩张的货币政策，增加了市场流动性，可能也并不能达到增加银行贷款或者刺激消费的目的。</li>
</ul>
<h2 id="财政政策">财政政策</h2>
<p><code>凯恩斯学派(Keynesian economists)</code>认为财政政策对经济总需求的增长有非常强的影响，而<code>货币主义流派(Monetarists)</code>认为财政政策对经济的刺激是暂时性的而不会对长期的经济产生影响。财政政策的目标主要有三点：</p>
<ul>
<li>影响经济活动水平和总需求</li>
<li>人口财富和收入的再分配</li>
<li>资源再分配</li>
</ul>
<h4 id="财政政策工具">财政政策工具</h4>
<h5 id="Spending-Tools-支付工具">Spending Tools(支付工具)</h5>
<ul>
<li><code>转移支付(Transfer payments)</code>例如养老金低保等，向一部分人征税并为另一部分人支付，这部分支付不计入GDP。</li>
<li><code>经常性支出(Current spending)</code>例如公务员工资等政府的日常开支。</li>
<li><code>资本性支出(Capital spending)</code>例如公路学校等政府在基础设施建设上的支出。</li>
</ul>
<p>支付增加增加总需求，是扩张性的财政政策，反之则是紧缩性的财政政策。</p>
<h5 id="Revenue-Tools-收入工具">Revenue Tools(收入工具)</h5>
<ul>
<li>直接税(Direct taxes)：例如个人所得税和企业所得税等和收入有关的征税。</li>
<li>间接税(Indirect taxes)：例如销售税和增值税等价量税，<strong>间接税对经济的影响更快</strong>。</li>
</ul>
<p>税收增加会减少社会可支配收入，是紧缩性的财政政策，反之则是扩张性的财政政策。</p>
<h4 id="财政乘数">财政乘数</h4>
<p>与货币乘数的概念相似，财政乘数既是计算每单位财政净支出的增加会促进多少单位的经济总产出：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>F</mi><mi>i</mi><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>m</mi><mi>u</mi><mi>l</mi><mi>t</mi><mi>i</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>e</mi><mi>r</mi><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>−</mo><mi>b</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></mfrac><mspace linebreak="newline"></mspace><mi>w</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>e</mi><mtext> </mtext><mi>b</mi><mo>=</mo><mi>M</mi><mi>a</mi><mi>r</mi><mi>g</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>e</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>y</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>u</mi><mi>m</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mfrac><mi>C</mi><mrow><mi>Y</mi><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">Fiscal\ multiplier=\frac{1}{1-b(1-t)}\\
where\ b=Marginal\ propensity\ of\ consumption=\frac{C}{Y(1-t)}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">i</span><span class="mord mathnormal">sc</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord mathnormal">u</span><span class="mord mathnormal">lt</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2574em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">b</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">h</span><span class="mord mathnormal">ere</span><span class="mspace"> </span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">ina</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">p</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<h4 id="财政政策的限制">财政政策的限制</h4>
<ul>
<li><code>Lag(滞后性)</code>：Recognition lag、Action lag、Impact lag等滞后性导致财政政策对经济的影响比较慢。</li>
<li><code>Crowding-out effect(挤出效应)</code>：政府部门的支出提高导致私人部门消费减少。</li>
<li><code>Ricardian Equivalence</code>：该效应认为扩张的财政政策例如减少税收不会导致总需求增加，而反而会使私人部门增加储蓄。</li>
</ul>
<h4 id="债务比率-Debt-Ratio">债务比率(Debt Ratio)</h4>
<p>债务比率的计算方法是国家总债务与国家GDP的比值。</p>
<h3 id="货币政策与财政政策的混合使用">货币政策与财政政策的混合使用</h3>
<p>货币政策影响利率，从而影响私人部门和政府部门的支出，最后影响经济总产出。财政政策通过影响政府部门支出影响经济总产出。当货币政策与财政政策为同向时(同时扩张或同时紧缩)，其影响也是同向，但当两个政策方向相反时：</p>
<ul>
<li>货币政策宽松，财政政策紧缩：由于两个政策会反向影响公共支出，因此此时对总产出的影响<strong>不确定</strong>。</li>
<li>货币政策紧缩，财政政策宽松：货币紧缩导致利率上升，从而使得私人部门的投资和消费下降，引起总产出下降。财政宽松导致政府部门消费上升，引起总产出上升，此时财政政策的影响大于货币政策，最后总产出上升。</li>
</ul>
<h2 id="Reading-17-国际贸易">Reading 17 国际贸易</h2>
<h3 id="相关概念">相关概念</h3>
<ul>
<li><code>进口(Imports)与出口(Exports)</code>：指公司、个人、及政府向外国购买或销售产品及服务。</li>
<li><code>自给自足的经济(Autarky or closed economy)</code>：指不与其他国家进行交易的国家。</li>
<li><code>自由贸易(Free trade)</code>：指国家对进出口没有任何限制或收费。</li>
<li><code>贸易保护(Trade protection)</code>：指国家对进出口有禁令、限制或收费。</li>
<li>世界价格(World price)：指商品或服务在没有限制的世界市场上的交易价格。</li>
<li><code>本土价格(Domestic price)</code>：指商品或服务在本地的价格，可能由于本土贸易限制与世界价格不同。</li>
<li><code>净出口(Net export)</code>：国家的出口价值减去其进口价值，大于零时为<code>贸易顺差(Trade surplus)</code>，反之为<code>贸易逆差(Trade deficit)</code>。</li>
<li><code>外商直接投资(Foreign direct investment)</code>：指在外国所有的生产资源，如土地、工厂、自然资源等。</li>
<li><code>跨国公司(Multinational corporation)</code>：指在一个或多个外国进行外商直接投资的公司。</li>
</ul>
<h3 id="比较优势与相对优势">比较优势与相对优势</h3>
<p>当一个国家在生产产品时拥有以比其他国家更低成本生产的能力时，这个国家就拥有<code>绝对优势(absolute advantage)</code>；如果一个国家生产产品相较于生产其他产品的机会成本低于其他国家时，这个国家就拥有<code>相对优势(comparative advantage)</code>。</p>
<p>由于国家之间存在比较优势，因此一些国家生产某些产品时机会成本低于其他国家，因此国家间的贸易才会产生，交易双方才会获得双赢。</p>
<h4 id="李嘉图模型-Ricardian-Model">李嘉图模型(Ricardian Model)</h4>
<p>在李嘉图模型中，劳动力是衡量生产力的唯一变量，<code>劳动力生产效率(labor productivity)</code>的区别反映了科技水平的差距，也就是比较优势存在的关键。</p>
<h4 id="赫克歇尔-俄林模型-Heckscher-Ohlin-Model">赫克歇尔-俄林模型(Heckscher-Ohlin Model)</h4>
<p>该模型认为除了<code>劳动力</code>是衡量生产力的变量外，还有<code>资本</code>。也就是说劳动力生产率和资源本身是产生比较优势的原因。</p>
<h3 id="贸易限制-Trade-restrictions">贸易限制(Trade restrictions)</h3>
<p>主要的贸易限制有5种：</p>
<ul>
<li><code>关税(Tariffs)</code>：政府向进口商品征收的税款。</li>
<li><code>配额(Quotas)</code>：商品在一定时间内的进口限额。</li>
<li><code>出口补贴(Export subsidies)</code>：政府对公司出口商品的补贴。</li>
<li><code>最小国内供给(Minimum domestic content)</code>：对某些产品由本国厂商供给的最小要求百分比。</li>
<li><code>自愿出口限制(Voluntary export restraint)</code>：出口国家在第一定时间内可以出口到本国的数量限额。</li>
</ul>
<h3 id="资本限制-Capital-restrictions">资本限制(Capital restrictions)</h3>
<p>一些国家会对本国资产的流入流出施加限制，其目的主要为以下几点：</p>
<ul>
<li>减少本国资产价格的波动性</li>
<li>维持较为固定的汇率</li>
<li>保证本国利率维持在较低水平</li>
<li>保护某些重要战略产业</li>
</ul>
<h3 id="国际收支平衡表-Balance-of-Payment">国际收支平衡表(Balance of Payment)</h3>
<p>国际收支平衡表是记录国家间交易的国际贸易的收支平衡表，主要需要了解的是表中主要包含的三个账户：</p>
<ol>
<li><code>经常账户(Current Account)</code>：主要包含日常商品和服务的买卖、投资收益(利息或股利)、单边转移。</li>
<li><code>资本账户(Capital Account)</code>：主要包含个人资产转移、自然资源或无形资产的买卖。</li>
<li><code>金融账户(Financial Account)</code>：主要涉及资金借贷等。</li>
</ol>
<p>需要特别注意的是在一些特殊的情况：例如专利使用费和专利买卖的区别，其中专利使用费一般计入经常账户，而专利买卖则计入资本账户；买卖取票债券时计入金融账户，而股票或债券的投资收益则应该计入经常账户。</p>
<p>最后，影响国际收支平衡的主要因素从GDP收支法结果推导为下方公式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo>−</mo><mi>M</mi><mo>=</mo><mi>p</mi><mi>r</mi><mi>i</mi><mi>v</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext> </mtext><mi>s</mi><mi>a</mi><mi>v</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>s</mi><mo>+</mo><mi>g</mi><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mtext> </mtext><mi>s</mi><mi>a</mi><mi>v</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>s</mi><mo>−</mo><mi>i</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>s</mi><mi>t</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">X-M=private\ savings+government\ savings-investment
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">nm</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6595em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span></span></p>
<h3 id="国际组织">国际组织</h3>
<ul>
<li><code>国际货币基金组织(International Monetary Fund)</code>：功能上主要维持全球金融秩序。职责上会维持汇率稳定、促进国际贸易发展、成员国需要时借出外汇。</li>
<li><code>世界银行(World Bank)</code>：功能上主要是为了扶贫。职责上帮助发展中国家加强政府法律体系，加强发展中国家的金融体系，反贪腐等。</li>
<li><code>世界贸易组织(World trade organization)</code>：功能上主要负责国际贸易秩序。</li>
<li>free trade areas (区域内无贸易限制) -&gt; Customs union(成员国对外采取统一贸易限制) -&gt; Common market(区域内劳动力与资本流动无限制) -&gt; Economic union(成员国成立共同组织与经济政策) -&gt; Monetary union(成员国使用统一货币)</li>
</ul>
<h2 id="Reading-18-汇率">Reading 18 汇率</h2>
<h3 id="基本概念">基本概念</h3>
<ul>
<li><code>base currency</code>指汇率中被标价的货币，<code>price currency</code>指标价用的货币。</li>
<li><code>名义汇率(Nominal exchange rate)</code>中剔除各个国家的物价水平(除以该国家的物价水平指数)即可得到<code>真实汇率(Real exchange rate)</code>。</li>
<li><code>基期汇率(Spot rate)</code>指立即交易时的汇率，<code>远期汇率(Forward rate)</code>指远期合约中约定的汇率。</li>
<li><code>卖方(Sell side)</code>指提供外币的银行机构，<code>买方(Buy side)</code>指购买外币的跨国公司等机构。</li>
<li><code>交叉汇率(Cross rate)</code>是指两个货币通过某个第三方货币计算的汇率。</li>
</ul>
<h3 id="远期汇率">远期汇率</h3>
<p>若远期汇率减去基期汇率大于零，这说明<code>远期升水(Premium)</code>；反之若小于零说明<code>远期贴水(Discount)</code>。需要注意的是计算题中一个point表示0.01%，以百分比形式计算时，底数为基期汇率。</p>
<h3 id="利率平价理论-Interest-Rate-Parity">利率平价理论(Interest Rate Parity)</h3>
<p>利率评价理论是联系利率与汇率关系的公式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mi>F</mi><mi>S</mi></mfrac><mo>=</mo><mfrac><mrow><mn>1</mn><mo>+</mo><msub><mi>r</mi><mi>X</mi></msub></mrow><mrow><mn>1</mn><mo>+</mo><msub><mi>r</mi><mi>Y</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{F}{S}=\frac{1+r_X}{1+r_Y}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1574em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p>
<p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span>分别为远期汇率和基期汇率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>X</mi></msub></mrow><annotation encoding="application/x-tex">r_X</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.07847em;">X</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>r</mi><mi>Y</mi></msub></mrow><annotation encoding="application/x-tex">r_Y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.22222em;">Y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>分别是X和Y两国的名义无风险利率。</p>
<p>该公式的理论逻辑是使用本币投资获取的利息应该与基期汇率换至外国货币后投资获取的利息再用远期汇率换回本币的收益相同，否则会产生套利机会。</p>
<h3 id="本币贬值改善国际贸易">本币贬值改善国际贸易</h3>
<h4 id="弹性法-Elasticity-Approach">弹性法(Elasticity Approach)</h4>
<p>将本币贬值相当于购买本国商品的价格降低，从而促进本国商品总需求上升，同时外币标价的商品价格相当于上升，导致对外国商品的需求量下降，以此达成促进净出口量，改善贸易赤字的目的。但需要注意的是这种方法要成功的前提是商品<code>弹性较大</code>，即商品需求量随价格变化而变化的幅度较大。</p>
<h4 id="J-Curve">J-Curve</h4>
<p>由于本币贬值时，影响发生会有一定的滞后性。例如有一些订单已经签订，需要按原有订单生产，此时货币贬值会导致贸易额减少一段时间，随后由于需求量的变化大于汇率的影响，再将净出口额提升，形成J型曲线。</p>
<h4 id="吸收法-Absorption-Approch">吸收法(Absorption Approch)</h4>
<p>吸收法使用GDP支出法推导，净出口额<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>X</mi><mo>=</mo><mi>Y</mi><mo>−</mo><mo stretchy="false">(</mo><mi>C</mi><mo>+</mo><mi>I</mi><mo>+</mo><mi>G</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">NX=Y-(C+I+G)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">NX</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mclose">)</span></span></span></span>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">(</mo><mi>C</mi><mo>+</mo><mi>I</mi><mo>+</mo><mi>G</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(C+I+G)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">G</span><span class="mclose">)</span></span></span></span>即被称为总吸收。此时如果要通过贬值货币改善贸易赤字，就需要判断货币贬值是否能促进总产出Y，当经济体非充分就业时，本币贬值会刺激总产出Y上升，而当经济体已经充分就业时，本币贬值不会刺激总产出变化，因此无效。</p>
<p>[第18篇]</p>
]]></content>
      <categories>
        <category>金融分析</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>CFA一级</tag>
        <tag>经济学</tag>
      </tags>
  </entry>
  <entry>
    <title>[编程算法] 使用urllib和BeautifulSoup制作爬虫脚本收集公司公开信息的记录</title>
    <url>/2022/06/18/19-A-web-scraper-for-company-info/</url>
    <content><![CDATA[<h1>序言</h1>
<p>前段时间老板在看我司商业客户的数据统计结果时提出想要看一看我司现在商业客户的公司成立时间维度的分析，以此来推断新冠疫情是否对我司的一些统计指标造成了显著的影响。但我司数据采集时并没有向客户收集类似信息，而网上已经整理好的公司信息数据库一定是需要大笔花费才能买到的，好在我们只是需要像成立时间这样的基础信息，只要能找到可以查询到相应信息的公开网站，我们就可以使用Python写一个简单的爬虫脚本来系统性地收集这些数据。</p>
<p>这篇文章就介绍了我利用<code>urllib</code>和<code>BeautifulSoup</code>两个著名的爬虫库，从公开网站<a href="https://hkg.databasesets.com/" title="香港數據庫集 / Hong Kong Datasets">香港数据库集</a>中扒出这些分析所需数据的小小的项目记录。</p>
<h1>正文</h1>
<h2 id="准备阶段">准备阶段</h2>
<p>当我们需要从网络上收集一些特定信息的时候我们要做的首先就是找到一个有这些信息公开网站，那么我开始这个项目的第一件事就是和我们负责商业客户的业务同事聊一聊他平时需要这些信息时通常去哪里看。同事给了我很多不同的选择，但其中有一些是香港政府的公司注册网站或其他收费的公司信息数据库平台，稍微浏览一下网站就知道这些网站通常都做了很严格的防爬虫措施。</p>
<p>最后通过一顿筛选我找到了这个号称是香港政府开放数据的数据库网站<a href="https://hkg.databasesets.com/" title="香港數據庫集 / Hong Kong Datasets">香港數據庫集</a>，在这个网站中确实有许多政府相关的数据查询功能，其中就有<a href="https://hkg.databasesets.com/zh-hant/gongsimingdan/search" title="香港數據庫集：香港最新成立/注册及已更名的公司名单">这个页面</a>可以根据公司名称查询公司信息。</p>
<h2 id="研究网站">研究网站</h2>
<h3 id="网站逻辑">网站逻辑</h3>
<p>要从网站上爬数据首先就是要把网站研究清楚，看使用什么方法最方便最快捷。首先搞清楚我们手上有的东西，事实上我们拥有的信息确实是非常的少，对于在我司购买商业保险的商业客户，我们除了他们的公司名和业务编号以外，并没有收集任何其他可以用于识别他们的信息。而这个网站可供用于引索的方法有四种：</p>
<ul>
<li>通过公司名搜索，利用网站内建的搜索引擎链接公司名和公司独立信息页面。</li>
<li>通过公司注册编号，直接去往公司信息页面。</li>
<li>通过注册时间，每天都有一个单独的页面整理了所有这天成立的公司的清单，连接到公司信息页面。</li>
<li>通过注册地点，香港的每一个地区都有一个单独的页面整理注册在这个地区的公司清单，同样清单中包含每个公司信息页面的链接。</li>
</ul>
<p>这其中后两种方法是非常绕的，对我们的目标也没有任何帮助(但不排除有其他需求时可以使用)。而前两种方法则分别有各自的利弊：</p>
<ul>
<li>若通过公司名搜索有两个问题，一是可能无法搜到我想要的公司数据，而在爬虫运行的过程中我又很难判断哪些搜索成功，哪些没有；二就是这个搜索的方法会比较费时间，因为我需要将我的每一个公司名都单独搜索一遍，时间复杂度是O(n^2)。</li>
<li>通过注册编号搜索速度会快很多，因为公司的信息页索引编号其实就是公司注册编号，因此我们其实可以直接循环公司注册编号把整个数据库一锅端。但事实上现在这个编号数量已经到了三百多万，而我们要查的公司名总共也不过三万条。</li>
</ul>
<p>最后很明显，只有<code>通过公司名搜索</code>这个方案可能可以较大程度上地满足我们的需求。</p>
<h3 id="网站界面">网站界面</h3>
<p>确定可行的方法后，就开始实际研究如何获得想要的信息，正常以公司名查询公司信息的话，应该在公司名称搜索的页面中输入公司的详细名称，然后在返回的结果中默认第一条是网站数据库中与关键词最相似的结果。点击这个搜索结果的链接就可以进到公司的实际信息页面。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220619105617437.png" alt="搜索公司名会返回一个有排序结果的页面，其中包含相应公司的信息页链接"></p>
<p>在公司的信息页面中，则可以看到我们需要的成立日期等信息。我们之后要做的就是研究如何解析这一部分的html代码从而自动完成这两步操作并获取这些信息。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220619105916222.png" alt="进入公司信息页后便可以看到我们要的信息"></p>
<h2 id="编写脚本">编写脚本</h2>
<p>经过上一步对网站的研究后，我们的思路就很清晰了，现在只需要按刚刚的步骤逐步将人手操作的部分写成脚本。</p>
<h3 id="搜索公司名">搜索公司名</h3>
<p>首先要明确我们的输入，就是公司商业客户数据库中的客户名，直接把这些名字拿出来做成一个csv列表，然后遍历即可。那么第一步我们先完成获取每一个公司的信息页面的函数。因此我们想要构建一个输入是公司全称，输出是网站查询到的第一条公司信息的网页链接的函数。</p>
<p>另外，虽然我们人手查询时需要在输入框中输入查询字段并点击查询，但实质上通过地址栏我们可以看到这一步操作其实就是向网站服务器发送一条带有查询字段的搜索请求，因此我们的脚本实际并不需要做这些互动操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220619111505511.png" alt="查询公司名的本质就是向网站发送一条带有查询字段的搜索请求"></p>
<p>通过研究网站的html结构，我写出来的代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 搜索页面的endpoint就是search?keywords=后加上搜索词的URL编码</span></span><br><span class="line">endpoint = <span class="string">&#x27;https://hkg.databasesets.com/zh-hant/gongsimingdan/search?keywords=&#x27;</span></span><br><span class="line">endpoint_main = <span class="string">&#x27;https://hkg.databasesets.com&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_company_link</span>(<span class="params">companyname</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 这个网站需要在请求中加入User-Agent的文件头，否则会拒绝请求。</span></span><br><span class="line">        <span class="comment"># 同时注意要将查询的公司名用quote()函数转换为URL格式</span></span><br><span class="line">        index_page = urllib.request.Request(endpoint+quote(companyname), headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0&#x27;</span>&#125;)</span><br><span class="line">        <span class="comment"># 如果网站不在10秒内返回请求则当做这条信息查询不到，直接函数返回0。</span></span><br><span class="line">        html_index = urllib.request.urlopen(index_page, timeout=<span class="number">10</span>).read()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    bs_index = BeautifulSoup(html_index, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    <span class="comment"># 在网站返回的html中找到所有class是&#x27;field-content&#x27;的元素</span></span><br><span class="line">    comp_list = bs_index.find_all(class_=<span class="string">&#x27;field-content&#x27;</span>)</span><br><span class="line">    <span class="comment"># 如果返回的清单是空，则代表搜索不到，函数返回0。</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> comp_list:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 如果清单不为空，则返回第一条记录的a元素中的链接。</span></span><br><span class="line">        <span class="keyword">return</span> endpoint_main+comp_list[<span class="number">0</span>].a.get(<span class="string">&#x27;href&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>需要补充的一点是，搜索到的链接使用的是相对引用，因此我们直接拿到<code>href</code>信息后还要把它和网站的根URL连在一起才是可以直接访问的页面链接。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220619113226433.png" alt="这段html长这样"></p>
<h3 id="处理搜索名称">处理搜索名称</h3>
<p>在实际测试脚本的时候我发现我们公司的数据中，客户公司名称有时候可能因为一些缩写导致不能搜索到正确结果，其中最主要的原因就是将<code>Company</code>缩写为<code>Co</code>，<code>Limited</code>缩写为<code>LTD</code>。如果直接使用这些名称搜索的话就搜索不到相应的公司。所以我想的办法就是去掉所有这些缩写的<code>CO</code>或者<code>LTD</code>字段，直接只搜索前面有意义的名字。</p>
<p>代码上实现如下，输入是公司名的字符串，输出是截掉特定字的结果：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">trun_name</span>(<span class="params">companyname</span>):</span><br><span class="line">    <span class="comment"># 通过观察发现大部分的缩写都是下面这些</span></span><br><span class="line">    trun_words = [<span class="string">&#x27;CO&#x27;</span>, <span class="string">&#x27;LTD&#x27;</span>, <span class="string">&#x27;CO.&#x27;</span>,<span class="string">&#x27;LTD.&#x27;</span>]</span><br><span class="line">    <span class="comment"># 将输入字符串通过空格分开成清单，然后去除清单中满足条件的字符串，最后重新用空格组成字符串</span></span><br><span class="line">    name_split = companyname.split()</span><br><span class="line">    new_name_split = [x <span class="keyword">for</span> x <span class="keyword">in</span> name_split <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> trun_words]</span><br><span class="line">    new_name = <span class="string">&#x27; &#x27;</span>.join(new_name_split)</span><br><span class="line">    <span class="keyword">return</span> new_name</span><br></pre></td></tr></table></figure>
<p>这里需要注意的是因为这些缩写在单词中也不少见，所以不能直接<code>replace()</code>，否则会把单词中的这些组合也都一并删除了。</p>
<h3 id="获取公司信息">获取公司信息</h3>
<p>现在我们假设通过前两步的环节，我们已经可以通过公司名称获得他的信息页链接了。接下来我们就要从这个返回的信息页中解析并提取我们需要的信息并整理。从下面代码的结构可以看到我们需要的信息被存在一个个的<code>li标签</code>元素中，而我们需要的信息都在这个元素的子元素中，一个自然想到的方法是使用<code>BeautifulSoup</code>的<code>contents</code>属性来获得每个<code>li</code>元素的子元素内容，然后根据表头信息把其中的内容分类装进字典中保存。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220619134323181.png" alt="每一条信息都是个li元素，每个li都有一个表头一个冒号和对应的内容"></p>
<p>代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_comp_info</span>(<span class="params">comp_link</span>):</span><br><span class="line">    <span class="comment"># 与搜索公司链接的方法一样， 尝试请求公司信息页面，如果超过10秒钟则默认无法获取信息，返回空字典</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        resp = urllib.request.Request(comp_link, headers=&#123;<span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0&#x27;</span>&#125;)</span><br><span class="line">        html = urllib.request.urlopen(resp, timeout=<span class="number">10</span>).read()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line">    bs = BeautifulSoup(html, <span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用一个转置字典来规定每个标签名和其对应的保存名，以此达到case...when...的效果</span></span><br><span class="line">    switcher_dict = &#123;</span><br><span class="line">        <span class="string">&#x27;注冊編號/Register Number&#x27;</span>:<span class="string">&#x27;RegisterNo&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;中文名稱/Chinese Name&#x27;</span>:<span class="string">&#x27;ChineseName&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;英文名稱/English Name&#x27;</span>:<span class="string">&#x27;EnglishName&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;成立日期/Date of Establishment&#x27;</span>:<span class="string">&#x27;EstablishDate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;行業分類/Category&#x27;</span>:<span class="string">&#x27;Industry&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;公司現狀/Active Status&#x27;</span>:<span class="string">&#x27;Status&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    temp_info = &#123;&#125;</span><br><span class="line">    x = bs.find_all(<span class="string">&#x27;li&#x27;</span>)</span><br><span class="line">    <span class="comment"># 把页面中所有所有li元素遍历一次</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> x:</span><br><span class="line">        temp=item.contents</span><br><span class="line">        <span class="comment">#判断每个li中的第一个子元素文字是否是转置字典中的字段，如果是则将第三个子元素的内容存入相应的字典值中</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            temp_info[switcher_dict[temp[<span class="number">0</span>].text]]= temp[<span class="number">2</span>].text</span><br><span class="line">        <span class="keyword">except</span>: <span class="keyword">pass</span></span><br><span class="line">	<span class="comment"># 最后以字典的形式返回所有收集到的信息</span></span><br><span class="line">    <span class="keyword">return</span>(temp_info)</span><br></pre></td></tr></table></figure>
<p>这段代码里值得说的一点可能就是转置字典的使用，其实就是为了让代码看起来干净一点，用这个方法代替了一溜if判断：</p>
<blockquote>
<p>temp_info[switcher_dict[temp[0].text]]= temp[2].text</p>
</blockquote>
<p>这一句话的意思就是将转置字典<code>switcher_dict</code>中对应键的值写入<code>temp_info</code>字典中，但如果字典中没有相应的键则会报错，这时使用<code>try...except...</code>就可以跳过那些不需要的信息。</p>
<h3 id="读取和写入数据">读取和写入数据</h3>
<p>有了上面这些函数，我们就已经可以从输入任意公司名字到返回包含所需的该公司信息的字典了。接下来就只需要把我们的公司名称列表循环起来就可以了：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 读取公司名字列表</span></span><br><span class="line">companyfile = pd.read_excel(<span class="string">&#x27;Company_names.xlsx&#x27;</span>,converters=&#123;<span class="string">&#x27;ClientNo&#x27;</span>:<span class="built_in">str</span>&#125;)</span><br><span class="line"><span class="comment"># 以追加模式打开/创建一个存储结果的csv文件</span></span><br><span class="line">csv_file = <span class="built_in">open</span>(<span class="string">&#x27;Company_results.csv&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>,newline=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">fileheader = [<span class="string">&#x27;ClientNo&#x27;</span>,<span class="string">&#x27;OurCompanyName&#x27;</span>, <span class="string">&#x27;RegisterNo&#x27;</span>,<span class="string">&#x27;ChineseName&#x27;</span>,<span class="string">&#x27;EnglishName&#x27;</span>,<span class="string">&#x27;EstablishDate&#x27;</span>,<span class="string">&#x27;Industry&#x27;</span>,<span class="string">&#x27;Status&#x27;</span>]</span><br><span class="line">dict_writer = csv.DictWriter(csv_file, fileheader)</span><br><span class="line">dict_writer.writeheader()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将公司名字列表中的所有行遍历一遍</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="built_in">len</span>(companyfile)),desc=<span class="string">&quot;Number of Companies searched&quot;</span>):</span><br><span class="line">    <span class="comment"># 如果公司名字已经被搜索过就跳过这次循环</span></span><br><span class="line">    <span class="keyword">if</span> companyfile[<span class="string">&#x27;Searched&#x27;</span>][i] == <span class="string">&#x27;Yes&#x27;</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 如果没有被搜索过则把这条记录的公司名和客户号放入结果字典</span></span><br><span class="line">        comp_info = &#123;&#125;</span><br><span class="line">        comp_info[<span class="string">&#x27;ClientNo&#x27;</span>] = companyfile[<span class="string">&#x27;ClientNo&#x27;</span>][i]</span><br><span class="line">        comp_info[<span class="string">&#x27;OurCompanyName&#x27;</span>] = companyfile[<span class="string">&#x27;OurCompanyName&#x27;</span>][i]</span><br><span class="line">        <span class="comment"># 先把要搜索的公司名用之前定义的trun_name函数裁剪一次</span></span><br><span class="line">        Search_name = trun_name(companyfile[<span class="string">&#x27;OurCompanyName&#x27;</span>][i])</span><br><span class="line">        <span class="comment"># 然后把裁剪后的名字输入get_company_link函数获取公司信息页链接</span></span><br><span class="line">        Comp_link = get_company_link(Search_name)</span><br><span class="line">        <span class="comment"># 如果拿不到网页链接，则只把公司名和客户号推进结果字典</span></span><br><span class="line">        <span class="keyword">if</span> Comp_link == <span class="number">0</span>:</span><br><span class="line">            dict_writer.writerow(comp_info)</span><br><span class="line">        <span class="comment"># 否则使用get_comp_info函数获取该公司的信息并和公司名客户号合并成一个字典</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            comp_info.update(get_comp_info(Comp_link))</span><br><span class="line">            dict_writer.writerow(comp_info)</span><br><span class="line">        <span class="comment"># 每完成一条记录，就把当条记录标记为已搜索    </span></span><br><span class="line">        companyfile[<span class="string">&#x27;Searched&#x27;</span>][i] = <span class="string">&#x27;Yes&#x27;</span></span><br><span class="line">        <span class="comment"># 每一百次循环就把搜索标记存储一次</span></span><br><span class="line">        <span class="keyword">if</span> i%<span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">            companyfile.to_excel(<span class="string">&#x27;Company_names.xlsx&#x27;</span>, engine=<span class="string">&#x27;xlsxwriter&#x27;</span>,index=<span class="literal">False</span>)</span><br><span class="line">        sleep(<span class="number">1.1</span>)   </span><br><span class="line">csv_file.close()</span><br></pre></td></tr></table></figure>
<p>读取和写入数据这一步我用了分开的方式，不直接在原本的公司名单文件中写入公司信息，而是只读取名字然后每次读取搜索后标记一下。这样就不至于如果中途程序中断不知道从哪里再开始。标记的信息每100次循环才存储一次，这样如果中断，需要重复的次数也不会超过一百次，得到的结果只需要对客户号去重就可以的到完整的结果。</p>
<p>到这里我们只需要运行这个脚本就已经可以开始慢慢收集数据了，我最后跑完整个三万三千条数据一共花了60个小时，平均每条记录需要运行5-10秒，而结果中大概有一万两千条是实际有数据的，足够我们数据分析的用途使用了。</p>
<blockquote>
<p>Number of Companies searched: 58:  88%|████████████████████████████████▌    | 29366/33412 [55:30:09&lt;5:20:53,  4.76s/it]</p>
</blockquote>
<h2 id="其他可能改进">其他可能改进</h2>
<p>虽然我们已经完成了手上数据的收集工作，但作为一个爬虫脚本，他还有一些可以改进的地方，就包括使用Proxy发送请求，以防止网站屏蔽IP，从而达到加速脚本的作用；其次还可以利用Windows scheduler的定时任务，固定时间定时获取新的公司信息情况。</p>
<h3 id="使用Proxy发送请求">使用Proxy发送请求</h3>
<p>想要不被目标网站屏蔽IP的一个简单而有效的方法就是使用Proxy，这样对目标网站来说我们的发送的请求就是从不同来源发来，也就不会被发现我们在爬取数据。这个方法也可以使我们可以多开并行爬取，把爬虫速度提升很多。使用方法也很简单，可以利用<code>PythonBroker</code>实时获取有效的Proxy地址并添加在请求的头文件参数中即可。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://github.com/constverum/ProxyBroker" title="ProxyBroker">PythonBroker</a></li>
<li><a href="https://www.scrapingbee.com/blog/python-requests-proxy/" title="How to Use a Proxy with Python Requests?">如何使用Proxy with Python Requests? </a></li>
<li><a href="https://blog.csdn.net/kdl_csdn/article/details/103989024" title="python爬虫——urllib使用代理">python爬虫——urllib使用代理</a></li>
</ul>
<h3 id="增加实时更新的功能">增加实时更新的功能</h3>
<p>之后因为我们可能需要按时更新我们的公司数据清单，但因为公司的成立日期不会有变化，因此为了减少我们每次的工作量，可以使用Python首先对比每次清单名称中新增的公司名，然后只查询这些新增的公司的信息，然后推入已有的数据库中。</p>
<p>至于定时脚本的方法，可以使用Windows系统自带的<code>Windows scheduler</code>完成定时运行脚本的步骤。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://datatofish.com/python-script-windows-scheduler/" title="How to Schedule Python Script using Windows Scheduler">How to Schedule Python Script using Windows Scheduler</a></li>
</ul>
<h1>最后</h1>
<p>在本篇中我介绍了我利用Python脚本收集一些公司没有的数据的项目的全过程，最后部分还有一些我在研究项目过程中有看到，且我认为可能对以后的类似项目有帮助的内容或方法，也记录在这里备用。</p>
<p>[第19篇]</p>
]]></content>
      <categories>
        <category>编程算法</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Python</tag>
        <tag>BeautifulSoup</tag>
        <tag>网页爬虫</tag>
      </tags>
  </entry>
  <entry>
    <title>[博客维护] 使用Typora和PicGo简单便捷地编辑带图博文</title>
    <url>/2022/02/12/2-typora_picgo_config/</url>
    <content><![CDATA[<h1>序言</h1>
<p>网站已经搭好了，但是怎么样编辑并且发布文章呢？我们知道网站中的文章都是作者按照排版需求使用Markdown语法写出.md后缀文件(既Markdown文件)并以此生成相应的html文件供浏览器读取展示，而插入图片的方法却只能使用路径引用的方法非常繁琐。本文将介绍在Hexo框架下发博文的方法，以及如何使用md编辑器<a href="https://typora.io/" title="Typora Website">Typora</a>与图床管理软件<a href="https://picgo.github.io/PicGo-Core-Doc/zh/guide/config.html#picbed-tcyun" title="PicGo-Core Documentation">PicGo</a>来简单便捷地编辑图文。</p>
<h1>正文</h1>
<h2 id="创建博文">创建博文</h2>
<p>先介绍一些在Hexo中发文的基础知识。</p>
<h3 id="Hexo框架下博文的保存">Hexo框架下博文的保存</h3>
<p>在我们安装的<a href="https://hexo.io/docs/setup" title="Setup for Hexo">Hexo</a>的根目录下与Hexo有关的分别是下面四个，他们的作用分别如下：</p>
<ul>
<li><strong>scaffolds:</strong> 模板文件夹，保存了草稿，页面和文章这三类md文件的模板，新建的该类文件内容将与模板一致。</li>
<li><strong>source:</strong> 保存网站内容的文件夹，其中的<code>_post</code>子文件夹即是保存md格式博文的文件夹。<code>source文件夹</code>中的所有可渲染文件(例如markdown和html)都将被渲染并被放入<code>public文件夹</code>，其他类型文件则会被直接复制。</li>
<li><strong>public:</strong> 保存网站原码的文件夹，这个文件夹中的内容将被推出并托管在<code>GitHub Pages</code>上形成网页。</li>
<li><strong>theme:</strong> 保存Hexo主题文件的文件夹，Hexo会同时基于网站内容和主题文件来生成相应的静态文件。</li>
</ul>
<p>也就是说我们的博文其实就是保存在<code>source/_post</code>文件夹中的md文件，即创建txt文件后改后缀成md，只要在文件开头—分隔符内(即<code>front-matter</code>)写上必要的配置如标题，日期等，这个md文件便会被识别渲染为一篇博文。</p>
<h3 id="Hexo新建页面-博文命令">Hexo新建页面/博文命令</h3>
<p>即使只要放入md文件即可被渲染成网页，Hexo依然提供了更方便的创建新页面或博文的方法：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new [layout] &lt;title&gt; <span class="comment">#layout若不填则自动按post模板创建，title将同时被用于文件名和frontmatter中的title参数</span></span><br></pre></td></tr></table></figure>
<p>hexo命令创建三类文件的方式分别如下：</p>
<ul>
<li><strong>Page(页面)</strong>: 在<code>source</code>文件夹下创建一个指定名称的路径，并在里面创建一个index.md文件，该文件中内容将显示在页面上。</li>
<li><strong>Draft(草稿)</strong>: 在<code>source/_drafts</code>文件夹中创建一个草稿，该文件不会被展示在页面上，但可以被用<code>hexo pubilish [layout] &lt;filename&gt;</code>命令发布。</li>
<li><strong>Post(博文)</strong>: 若<code>new</code>命令没有指定<code>layout</code>则将默认创建该类型，此类型被创建在<code>source/_post</code>文件夹中，会被直接渲染为博文。</li>
</ul>
<h2 id="使用Typora和PicGo编辑博文">使用Typora和PicGo编辑博文</h2>
<p>知道了Hexo下发博的基本知识，现在终于来到正题，如何方便快捷地编辑一篇图文并茂的博文呢？我的选择是Typora与其绑定的图床管理软件PicGo Core。</p>
<h3 id="Typora是什么">Typora是什么</h3>
<p>Typora是一款专门用来编辑Markdown文件的编辑软件，他的最大特点便是”所见即所得“。在这个软件中你可以使用markdown语法来调整你的文章展示，而你写下的格式语法会被Typora直接转换为渲染后的效果。这样作者就可以很方便地一边编辑一边调整最终成稿。</p>
<h3 id="PicGo是什么">PicGo是什么</h3>
<p>简单来说，PicGo是一个用于快速上传图片至图床并获取图片URL链接地工具。一直以来在md文件中插入并管理图片都是一个非常麻烦的工作，你需要将你需要使用的图片放在本地或图床上，并在md文章中引用这些地址来实现图片地展示。但现在Typora中置入了PicGo Core的工具让你可以以可视化的方式简单方便地插入图片在你的博文中。</p>
<h3 id="具体如何配置">具体如何配置</h3>
<p>虽然PicGo支持的图床相当多，但大部分图床都有各种各样的限制或收费。而我个人选择的则是GitHub作为我的图床，因为在建站时创建的远程仓库刚好可以直接拿来用作图床，除了文章内使用的图片，其他包括top_img或封面等都可以很方便地上传至这些远程仓库用来引用。</p>
<h4 id="配置Typora">配置Typora</h4>
<p>从Typora的上方选项中依次打开<code>格式→图像→全局图像设置</code>，然后会进入下图的界面，按图片中的设置配置打勾：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220214215927465.png" alt="按图中方式配置"></p>
<p>选择插入图片时<code>上传图片</code>，下方下拉选单选择<code>PicGo-Core(command line)</code>，这时可以直接<code>下载或更新</code>。安装好<code>PicGo</code>后就需要配置图床了。</p>
<h4 id="配置图床">配置图床</h4>
<p>为方便我选择的是GitHub的远程仓库作为我的图床，大家可以按照PicGo的<a href="https://picgo.github.io/PicGo-Doc/zh/guide/config.html#github%E5%9B%BE%E5%BA%8A" title="PicoGo Configuration on GitHub图床">官方文档</a>生成该远程仓库的token用于使PicGo可以获得访问该仓库的权限。获得这个token之后我们就可以开始填写PicGo的配置文件，用户可以在命令行中输入<code>picgo set uploader</code>来进入交互式命令行：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220214234833095.png" alt="image-20220214234833095"></p>
<p>用方向上下键移动，回车选中github，然后命令行会分别要求你输入需要的参数以生成配置文件，填写完成后在命令行中继续输入<code>picgo use uploader</code>并选择刚刚配置的uploader来完成配置。按要求完成好后生成的配置文件如下，当然你也可以直接按Typora中的<code>打开配置文件</code>按钮或直接去到系统用户目录下<code>.picgo/config.json</code>中手动填入配置，但鉴于出错的可能性比较大，更推荐自动生成配置文件：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;picBed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;uploader&quot;</span><span class="punctuation">:</span> <span class="string">&quot;github&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;transformer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;path&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;github&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;repo&quot;</span><span class="punctuation">:</span> <span class="string">&quot;username/reponame&quot;</span><span class="punctuation">,</span><span class="comment">//填入你的github仓库的用户名/仓库名</span></span><br><span class="line">      <span class="attr">&quot;branch&quot;</span><span class="punctuation">:</span> <span class="string">&quot;branchname&quot;</span><span class="punctuation">,</span> <span class="comment">//填入分支名</span></span><br><span class="line">      <span class="attr">&quot;token&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tokentokentoken&quot;</span><span class="punctuation">,</span><span class="comment">//填入github token</span></span><br><span class="line">      <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;post_img/&quot;</span><span class="punctuation">,</span><span class="comment">//填入需要上传到的文件夹路径</span></span><br><span class="line">      <span class="attr">&quot;customUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;picgoPlugins&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>此时你就已经在Typora中配置好了图床，按一下Typora中的<code>验证图片上传选项</code>按钮，显示验证成功，这时你就可以直接截图粘贴至你正在Typora中编辑的博文，Typora会自动帮你完成上传图片至图床并返回图片链接至你粘贴图片的位置的操作。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220215000247746.png" alt="image-20220215000247746"></p>
<h4 id="使用图床">使用图床</h4>
<p>除了使用Typora的自动上传功能以外，我们也可以直接手动利用我们的GitHub来作为我们的图床使用，在本地仓库中放入需要使用的文件或图片，然后对他们使用 <code>add commit push</code>三部曲推至远程仓库(由于本地仓库不会自动更新Typora上传至远程仓库中的图片，因此如有改动，在add前还需要先将远程仓库的改动pull至本地仓库，以免报错)，然后便可以使用<code>raw.githubusercontent.com</code>后接文件在github中的路径便可以直接访问该文件的raw (即未处理版本)文件。</p>
<hr>
<p>以下内容为2022年2月19日补充</p>
<h2 id="使用Jsdelivr加速图床">使用Jsdelivr加速图床</h2>
<p>由于一直在香港且只在自己的电脑上测试，并没有意识到GitHub作为图床使用的一个重要缺点，那就是当内地用户访问网站时使用<code>raw.githubusercontent.com</code>链接会导致图片裂开…在苦恼了几分钟以为要把所有链接换成其他内地付费的图床时我找到了<code>JSDelivr</code>这个解决办法。</p>
<p>其实使用<code>JSDelivr</code>的链接是我刚刚开始查找图片链接方法时就注意到了的，但由于发现<code>GitHub</code>的raw链接可以实时展现图片而不需要release版本blabla，也就没有继续看稍微麻烦一些的<code>JSDelivr</code>，现在看来是福不是祸，是祸躲不过啊。</p>
<h4 id="Jsdelivr是什么？">Jsdelivr是什么？</h4>
<p>参考<a href="https://www.dazhuanlan.com/charmsky/topics/1636035" title="前端 使用JSDelivr加速加载Github资源">这篇文章</a>我们知道<code>JSDelivr</code>是<code>内容分发网络(Content Delivery Network, i.e. CDN)</code> 的提供商之一，简单来说既是将特定网站的资源分布至各地网络，然后该资源被请求时即从距离请求最近的服务器回应该请求，从而达到加速资源访问的目的。</p>
<h4 id="如何在Typora中设置JSDelivr？">如何在Typora中设置JSDelivr？</h4>
<p>首先要注意的是前文中提到<code>PicGo</code>的配置文件中有一个之前未提及的<code>customUrl</code>项，设定该项即可将上传图片后返回的链接自定义到<code>JSDelivr</code>的链接从而使用其服务。具体来说是改成：</p>
<blockquote>
<p>“customUrl”: “https:// <a href="http://cdn.jsdelivr.net/gh/%E7%94%A8%E6%88%B7%E5%90%8D/%E4%BB%93%E5%BA%93%E5%90%8D">cdn.jsdelivr.net/gh/用户名/仓库名</a>”   #注意去掉网址中间的空格</p>
</blockquote>
<p>经过我的测试，发现在Typora中粘贴图片可以正常上传至<code>GitHub仓库</code>，但返回的链接却不能正确显示图片。这个原因我猜测是因为是我们没有将上传的图片release，因此这时JSDelivr还无法获得获取我们上传的资源，按照<a href="https://www.cnblogs.com/yu-du-chen/p/12109065.html" title="jsdelivr的使用">这篇文章</a>的方式发布后，图片就可以用<code>JSDeliver</code>的链接访问了。</p>
<p>最后一点小备注，在release步骤中填写的Tag也就是版本号，如果在仓库名和文件夹名中间加入这个Tag名，即可访问该版本的资源，如果不加这个版本号则是默认访问最新的版本资源。</p>
<blockquote>
<p>https:// <a href="http://cdn.jsdelivr.net/gh/%E7%94%A8%E6%88%B7%E5%90%8D/%E4%BB%93%E5%BA%93%E5%90%8D/">cdn.jsdelivr.net/gh/用户名/仓库名/</a><mark class="hl-label default">版本号</mark> /文件路径   #注意去掉网址中间的空格</p>
</blockquote>
<hr>
<h1>最后</h1>
<p>现在作为完全小白的我终于可以快乐而没有顾忌地发文章了，一切麻烦的事情都交给Typora。</p>
<p>[第2篇]</p>
]]></content>
      <categories>
        <category>博客维护</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
        <tag>日常学习</tag>
        <tag>Typora</tag>
        <tag>PicGo</tag>
      </tags>
  </entry>
  <entry>
    <title>[数据分析] 数据挖掘技术在销售、营销与客户关系管理中的应用概览</title>
    <url>/2022/07/03/20-Data-mining-application-in-CRM/</url>
    <content><![CDATA[<h1>序言</h1>
<p>本篇起源于我最近看的一本好书，是<code>Gordon Linoff</code>和<code>Michael Berry</code>所著的<code>Data Mining Techniques: For Marketing, Sales, and Customer Relationship Management, Third Edition</code>。本书从数据挖掘在商业应用中的生态聊起，先介绍了营销和客户关系管理的一些基本原理，然后介绍了通过数据挖掘技术实现这些原理的基本方法，最后分章节介绍了每一个常见的数据挖掘技术的技术细节与应用案例。</p>
<p>虽然第三版作为这本书的最新版也是2011年出版，但其中大部分技术技巧都没有过时，并且在读的过程中给了我很多灵感，在这里把我在这本书中前三章不涉及技术细节的部分学习到的一些内容和我的一些灵感做一些笔记记录。</p>
<h1>正文</h1>
<p>我在本篇中会根据书中的顺序，分别将书中前三章的关键内容做一些总结。其中第一章中<code>数据挖掘的项目循环</code>部分主要是介绍数据挖掘工作的大致流程；第二章<code>营销和客户关系管理</code>主要介绍一些商业方面的知识；第三章<code>数据挖掘过程</code>则是开始尝试将第二章内容与数据挖掘技术做联系，是一个总结性的概览章节。</p>
<h2 id="数据挖掘的项目循环">数据挖掘的项目循环</h2>
<p>一个初出茅庐的技术人员很有可能犯的一个问题就是过于纠结技术问题，沉醉于使用最新的技术或获得最好的模型评分，但需要注意的是这并不是正确处理商业问题的态度，数据挖掘良性循环的重点在于<code>获得好的商业结果</code>，而在应用过某次数据挖掘结果后产生的数据集又可以被用来更新改进下一次的数据挖掘，这就是数据挖掘的良性循环。</p>
<p>一个完整的数据挖掘项目循环应该包括三步：</p>
<ol>
<li>
<p><code>识别业务机会</code>。商业活动中的许多普通的业务流程都蕴藏着数据挖掘的机会，例如设计产品介绍、规划营销活动、理解客户流失原因、评价营销结果、分配营销预算等。这些普通的商业活动都可以被使用数据挖掘技术优化实行，最后达到增加收益或减少成本的效果。</p>
<p>除此之外，还有对过去业务的一些总结度量也可以产生一些有趣的数据挖掘课题，例如分析什么类型的客户会响应以往的营销活动、最好的客户住在哪里、流失的客户有什么特征等。通常与业务专家沟通聊天，会是获得这些课题灵感的最直接的方式。</p>
</li>
<li>
<p><code>挖掘数据并将结果转换为可操作的信息</code>。要再次强调的是，数据挖掘只是工具，最终的目的一定是使数据中隐藏的信息对业务产生正面影响。通常业务实践中的数据挖掘任务会遇到各种各样的问题与阻碍，例如数据格式不统一、数据缺失值多、法律影响(例如保险拒绝赔付时要有法律依据，而不能说因为我的模型说你可能有骗保风险)、组织因素(例如一些业务部门不愿意在没有奖励的情况下改变传统做法)等等。</p>
<p>而这些因素在短期内可能都很难被改变，因此我们在进行某个数据挖掘项目时真正面对的问题不是“如何获得最理想的结果？”，而是“以现有的资源和数据，如何挖掘数据以帮助业务？”。</p>
</li>
<li>
<p><code>采取行动并评估结果</code>这一步在原书中被分成两步，但我认为其实他们的内容是一致的，就是为了获得数据挖掘项目的结果反馈。因为所有的模型都有假设，例如基于过去的数据做出的对未来的预测模型就假设了未来会重复历史。而事实上可能这些假设不成立，或者其变化不能被忽视。这就导致数据分析师必须对项目的结果进行评估以得知项目是否可以应该长期运行或将结果用以改进模型。</p>
<p>实现的方法可以通过设置不同的对照组来判定项目结果，例如对于我们之前做的保险价格优化模型来说，我们可以分四组测试客户的流失率，第一组<code>目标组(Target Group)</code>对模型标识的价格敏感客户进行不加价处置，第二组<code>控制组(Control Group)</code>对模型标识的非敏感客户(但需要加价的)进行不加价处理，第三组<code>对照组(Holdout Group)</code>对模型标识的价格敏感客户照旧加价，第四组<code>模型化对照组(Modeled Holdout Group)</code>对模型标识的非价格敏感客户照旧加价。对这四组客户的流失率进行对比就可以得到加价与否对模型界定的价格敏感/不敏感客户对客户流失率的影响，进而得出模型对识别价格敏感客户并挽回流失客户的效率。</p>
</li>
</ol>
<h2 id="营销和客户关系管理">营销和客户关系管理</h2>
<p>营销和客户关系管理本身也是一门学问，因此我们除了要了解数据挖掘的技术细节以外，也应该知道一些业务方面的知识。这一块在原书的第二章被集中讨论，我也觉得这一章对我本人的启发是最大的，因此我会在这一段中根据原书的结构仔细讲讲营销和客户关系管理的一些内容。</p>
<h3 id="客户生存周期">客户生存周期</h3>
<p>客户关系管理中的一个重要概念就是<code>客户生存周期(Customer Lifecycle)</code>，处于不同生存周期的客户的心态与需求都是有较大的区别的，因此客户生存周期的每个阶段都为我们的客户关系管理和数据挖掘提供了机会，而我们关注的客户生存周期其实可以分为两类。</p>
<p>第一类是<code>客户个人生存周期</code>。每一个客户不论是企业还是个人或家庭，他们对产品的需求都会随着时间推移发生变化，例如公司从创业阶段往后可能会面临收购、倒闭、或是稳定增长；而个人则可能因为升学、结婚、换工作等造成生活环境、地理位置、生活习惯的大幅改变，进而影响他们的商业或个人需求。但实践中，我们可能较少需要关注客户的个人生存周期，其原因主要是及时识别或预测客户的周期转换事件困难。但知道客户个人生存周期对其需求决策有影响让我们可以针对性收集反映客户所处生存周期的数据，例如年龄、婚姻状况、收入水平、工作年资等等，这些信息将对于区分不同客户的共性有非常大的帮助。</p>
<p>第二类则是<code>客户关系生存周期</code>。这是通常企业在进行客户关系管理时更加关注的客户生存周期，对每一个企业来说他的客户关系都可以经过5个主要阶段：</p>
<ul>
<li>目前还不是客户的目标市场中的<code>潜在客户</code>，这类客户可能是任何人，公司没有这些人的任何信息。</li>
<li><code>响应者</code>是表现出一定兴趣的客户，例如表达过愿意接受市场营销信息的已有客户，通过互联网搜索过相关产品的客户等。</li>
<li><code>新客户</code>是指已经开始合作的响应者，从保险市场来看既是新保单的持有者。</li>
<li><code>老客户</code>是持续合作的新客户，可以根据消费能力和意愿分为高价值、高潜力和低价值客户。</li>
<li><code>流失客户</code>是已经离开的客户，他们可能是自愿流失(被竞争者争取到或对现有产品不满意)、强制流失(无能力支付账单)或预期流失(可能因搬家或年龄超标已经是不能服务的客户)。</li>
</ul>
<p>企业在处理与处在不同客户关系生存周期的关系时，会根据客户关系的特性采取不同的客户关系管理手段，例如将潜在客户转为响应者是<code>获取</code>客户的手段；将响应者转化为新客户的客户<code>激活</code>的手段；通过<code>关系管理</code>尽力将新客户<code>保留(retention)</code>为老客户；并将自愿流失的客户<code>赢回(winback)</code>为老客户。详细来说每一个阶段：</p>
<h4 id="客户获取">客户获取</h4>
<p><code>客户获取(Customer Acquisition)</code>是吸引潜在客户，并把他们转化为客户的过程。这通常通过广告、口碑以及定向营销来完成，而数据挖掘则可以在这个过程中发挥重要作用。最主要的方法是通过了解潜在客户的特征构建<code>响应模型(responding model)</code>，在目标市场中寻找最可能响应的客户群体，尤其是将模型应用至直接邮寄和电话销售等运营成本较高的营销活动中，用最小的成本达到最大的收益。其他也有一些应用场景如选择合适的通信渠道(通过鼓励媒体宣扬公司的正面消息或电视/网页广告)，挑选适当的宣传信息(除了将性价比产品推荐给价格敏感的客户外，还要避免广告词引导高价值客户向低价值转变)。</p>
<h4 id="客户激活">客户激活</h4>
<p><code>客户激活</code>的过程既是客户从响应者转变为新客户的过程。在有些业务流程中客户激活可能非常简单，只需输入数项信息即可网上激活，但也有些业务需要复杂的审批流程，例如银行的授信、保险的核保等。在这个过程中，数据挖掘可以帮助的地方不多，但也有。例如有一些客户可能因为他们认为流程过于复杂而在激活过程中流失，通过特别收集这部分客户的信息或反馈，使用决策树等方法发现导致他们流失的关键特征从而帮助改进业务流程。除此之外，根据这本书作者的经验，客户激活过程中的初始信息也是后期其他数据挖掘模型中对于预测客户长期行为的重要特征。</p>
<h4 id="客户关系管理">客户关系管理</h4>
<p><code>客户关系管理</code>的主要目标是提高客户留存率并提高客户价值。主要活动有：</p>
<ul>
<li><code>追加销售(up-selling)</code>，使客户购买高端产品和服务，保险中可能就是提升保障范围和额度。</li>
<li><code>交叉销售(cross-selling)</code>，拓宽客户关系，使客户购买公司提供的其他产品或服务。</li>
<li><code>使用激励(usage stimulation)</code>，激励客户使用产品或服务，例如信用卡公司通过广告刺激客户使用信用卡消费。</li>
<li>客户价值计算，为每个客户指定一个预期价值，并以此判断客户是否有潜在发展空间，以及匹配可以用于该客户的营销预算。</li>
</ul>
<p>对于那些提供许多产品和服务的公司而言，让客户获得尽可能少的最有价值的信息也是非常重要的。因为客户可能并不喜欢选择，如果他们接二连三地收到自己不感兴趣的错误营销内容，会导致他们对营销信息失去兴趣。因此要尽可能向每个客户重点介绍他们可能会感兴趣的少数几个产品信息，而这就是数据挖掘可以帮助的地方。另一方面，交叉销售和追加销售的时间也是其成功的重要因素之一，例如我推断人们可能不喜欢额外的行动，因此如果在他们续保时进行交叉销售，可能会使成功率和用户体验更高，而我可以通过分析交叉销售的在保单不同时间段的成功率来评估我的判断是否具有实际价值。</p>
<p>而对于保留客户提高留存率方面，通常有两种方法。一种是对比短时间离开的客户与长时间保留的客户的区别，另一种方法则是直接对客户的保留时间进行生存分析，预计特定客户的保留时间。从而针对留存时间短的客户特征进行针对性的保留活动。</p>
<h4 id="赢回">赢回</h4>
<p>将已经流失的客户重新吸引回来的过程就是<code>赢回(winback)</code>，具体的操作方法可能包括向有价值的客户提供激励措施、产品、以及价格促销等。比起数据分析来，赢回往往更依靠业务策略，但数据挖掘可以帮助分析确定客户离开的主要原因，尤其是当可用数据中有客户的服务投诉和其他行为时。而赢回客户的策略则可以根据所分析出的离开原因来针对性地进行。这本书中特别提到有些公司设置有专门的<code>拯救团队(save team)</code>，可能类似于我现在公司的<code>Retention team</code>，这些团队除了会尽力与试图离开的客户沟通以留住他们以外，还应该完成获取客户实际离开原因的工作，这些信息对未来保留其他客户非常有价值。</p>
<h3 id="客户关系的性质">客户关系的性质</h3>
<p>除了客户的生存周期以外，客户关系管理还要关注的一个维度是业务中企业与客户关系的性质。基于不同的客户关系性质，所能做的关系管理手段也有所不同。客户关系分为<code>基于订阅</code>的关系和<code>基于事件</code>的关系。以电话公司的业务为例，当客户使用公共电话亭打电话，或购买了一张可以使用固定分钟数的预付费电话卡时，这类客户与电话公司之间的关系就是基于事件的关系，电话公司与他们的这一部分客户几乎没有直接联系。而当客户需要购买一张带有不定期限的手机合约时，他们与电话公司形成了一对一的合约关系，这就是基于订阅的关系，在这类关系中电话公司拥有其客户的详细信息，因此也可以提供更加有指向性的客户关系管理手段。</p>
<p>通常当业务性质以<code>基于事件</code>的关系占主导时，公司通常需要通过电视或网页广告、病毒营销等方式获取目标市场的不特定的多数人群中的潜在客户，在这些情况下公司对营销的分析工作主要集中于产品、地理和时间，这是从基于事务的业务中所能了解的为数不多的信息。当然也有一些情况的例外，例如药厂与其零售客户之间也是基于事件的关系，但药厂可以通过向医生营销的方法来达到增进业务的目的。而另一方面，<code>基于订阅</code>的客户关系中企业则有更多了解客户并与客户交互的机会。</p>
<h2 id="数据挖掘过程">数据挖掘过程</h2>
<p>这一部分是原书第三章的内容，主要是覆盖数据挖掘概览性的技术过程，介绍了第一章中项目循环的第一二步，即识别问题(如何把业务问题转化为数据挖掘问题)和将数据转换为信息(假设检验、模型构建、模式发现)。同时这一章也会介绍一些数据挖掘在实践中会出现的一些常见问题。</p>
<h3 id="可能出现的问题">可能出现的问题</h3>
<p>数据挖掘是从数据中提取信息以促进未来的业务发展或最优决策的工具，而数据挖掘的最佳实践一定要避免两个主要问题：一是<code>学习的东西不真实</code>；二是<code>学习的东西真实但没有价值</code>。好的数据挖掘师应该能识别并避免犯下这些错误。</p>
<h4 id="学习的东西不真实">学习的东西不真实</h4>
<p>学习到错误的东西比学习到无用的东西更可怕，因为有时数据挖掘的模型会给人一种可靠的感觉，因为它是从大量数据中用科学的方法推论出来的，但这种可靠感可能非常具有欺骗性。数据源的错误或者数据处理过程中产生差错都可能破坏或者隐藏数据中藏有的重要信息。导致学习的结果不真实的主要原因有以下三个：</p>
<ol>
<li><code>模型揭示的模式(patterns)可能不代表任何规则。</code>这个错误的最重要代表之一可能就是星座：人们仰望星空，从繁多的星星中寻找他们的规律，并且试图给与每个规律一个名字和含义，甚至衍生出了占星术这样的技术。但事实上这些模式本身可能并没有揭示任何的自然规则，只是模型<code>过拟合(overfitting)</code>的结果，这些模式可能只是偶然出现并不能代表它一直会出现。所以当数据挖掘模型找到一些人们凭经验难以解释的规则时，就要小心了。</li>
<li><code>模型集可能不反映相关的总体。</code>出于现实的原因，我们做任何统计或者数据挖掘的时候都一定要注意一个假设的成立与否：挑选的样本是否是总体的无偏代表。有一些危险的实践比如通过客户调查的数据来评估公司所有客户的表现就是不公允的，因为会回复客户调查的客户可能是具有特定特点的群体，并不能代表所有客户。</li>
<li><code>数据的详细程度有误。</code>原书中举了一个例子，是说作者在某家电话公司做数据挖掘顾问时曾经被告知过一个发现：客户在离开前的那个月使用量通常会下降。但作者最后发现这就是数据详细度出现问题导致的结论不真实的情况，因为电话公司是根据每个月的平均通话时长来确定客户的电话使用量，但事实是客户可能在8月中旬某一天忽然停止使用电话，这个数据在月平均时长的图表上表现出来就是9月份停止服务的客户在8月的使用量只有平时月份的一半，但这个结论是没有任何实际意义的。</li>
</ol>
<h4 id="学习的东西真实但没用">学习的东西真实但没用</h4>
<p>虽然不如学习到不真实的东西那么危险，但是学习到没用的东西是更常见的错误。主要有以下两类：</p>
<ol>
<li><code>学习的东西众所周知。</code>数据挖掘的意义在于发现人类不能发现或难以发现的隐藏信息，但通常在数据分析中，许多表现最强的模式都是众所周知的事情。例如过了退休年龄的人不会响应退休储蓄的优惠计划；生活在华盛顿的客户不会接受香港地区的活动邀请；感恩节前火鸡的销量会比平时高等。</li>
<li><code>学习的东西不可用。</code>数据挖掘曾经揭示过一些真实且先前未知的关系，但最后却难以使用。书中给的几个例子包括客户的信用信息可能对未来的保险索偿具有一定的预测性，但监管机构可能会禁止基于这种信息所做出的承保决定。或在寿险领域，有一些人种可能更容易收到某些疾病的困扰，但显然这个特征不能成为给他们增加保费的原因。其实中国内地也有犯过类似的错误，即所谓的“大数据杀熟”，互联网公司可能根据客户的手机型号、单量等信息调整商品价格至客户的底线，但这种价格歧视很容易就会被发现，并且使公司声誉收到损伤。</li>
</ol>
<h3 id="数据挖掘的类型">数据挖掘的类型</h3>
<p>讲完了数据挖掘需要注意的事项，接下来讲一讲数据挖掘可能出现的一些主要任务类型。强调一遍数据挖掘的两个主要目的：<code>1.是产生得分或结论以辅助决策 2.是洞察事物之间的联系。</code>原书中这一部分的描写我认为逻辑性不够强，我在这里稍微整理一下，以我认为合理的顺序依次讲讲不同类型的数据挖掘的用处和用法。</p>
<h4 id="探索性数据分析-Exploratory-Data-Analysis">探索性数据分析(Exploratory Data Analysis)</h4>
<p>我之前写过一篇专门讲<a href="http://raylei.space/2022/04/09/14-R-EDA-basics/" title="使用 R 做 EDA 分析的基础知识">如何使用R做探索性数据分析</a>的文章，正如其名中的“探索性”一词所述，探索性分析是没有特定目的性的，因为通常在拿到一份用来做数据挖掘任务的原数据集后我们需要了解原数据的组成和一些概览。这时我们通常会使用一系列的图表来剖析数据的不同维度可能蕴含的一些信息。在很多公司中分析员们使用<code>Excel透视表(Pivot table)</code>或<code>Tableau</code>所构建的BI模型实际上就是探索性数据分析的主要内容。它的缺陷也非常明显，因为构建某个分析需要人为依靠常识去判断尝试，而且由于手动性的特点，这种分析很难达到挖掘深藏在多个特征下的信息的目的。更多的是为之后的数据挖掘工作提供一些可能的方向或指导。</p>
<h4 id="分类-Classification">分类(Classification)</h4>
<p>原书中把分类任务分为了<code>二元分类(Binary classification)</code>和<code>多元分类(Multiclass classification)</code>，但在我看来这两者并没有本质区别。唯独某些模型如支持向量机或逻辑回归等可能更适合二元分类的任务，但事实上现在这些模型也都有适用于多分类任务的算法。在使用层面，我们可以使用二元分类模型将保险客户分为续保客户和不续保客户，或者信用卡公司将持卡客户按其特征分为滑雪客户和不滑雪客户以针对性地对某个客户群体进行营销活动。而多元分类模型地适用范围就更广了：信用卡公司可以将信贷申请者分类为高中低三类风险人群；识别具有欺诈风险的保险索赔；基于自由文本的描述指定其对应的行业代码和职务名称等。分类的本质就是在给定的类中将所有的记录逐一划分到每一个分类。(或者也可以通过模型划分分类的过程区别几个分类特征的差异)</p>
<h4 id="评估-Valuation">评估(Valuation)</h4>
<p>前面的分类任务是用来处理离散的输出结果，而评估则是用来<code>得到某个连续变量的值</code>。例如估计某个家庭的收入总额，估计客户的生存周期数值，估计某人响应活动的概率，估算客户违约的风险等。有时我们可以根据评估模型给出的估计值来做出决策，例如某个客户的预计价值高于公司给予每个客户的平均营销成本，那么我们就可以对这个客户拿出额外的成本进行针对性营销，而相反如果某个客户的预计价值低于营销成本，那么我们可以考虑不对该客户进行营销从而节省成本。</p>
<h4 id="发现集群、关联及相关组-Clustering-and-Association">发现集群、关联及相关组(Clustering and Association)</h4>
<p>这类任务主要是用于<code>寻找数据中存在的联系</code>，属于<code>无监督机器学习模型(Unsupervised machine learning)</code>。所谓无监督即是说不需要已有的<code>“正确”</code>数据集作为指导，因为分类模型和评估模型作为有监督的机器学习模型的一大特点既是需要在已有数据中存在正确的数据集才可进行训练，而无监督机器学习模型是依靠每条记录的自然联系分组在一起，每个分组的意义都需要由分析师自己根据分组的特点决定。</p>
<p>发现集群的方法可以将市场中的客户事先划分成不同的集群，并作为其他数据挖掘工具的起点。而关联规则挖掘则可以找出哪些商品通常会被连同其他商品一同被购买，可以被用来做为交叉销售的依据。</p>
<h4 id="A-B-Test">A/B Test</h4>
<p>与前面的机器学习算法不同，A/B检验是统计学的方法，其基本原理是统计学中的<code>假设检验(Hypothesis Testing)</code>，即以统计学的方法确定某个假设是否有显著性的理由被拒绝或接受。而A/B检测的原理则是构建AB两种方案，对比其产生的区别，通过判断两种方案所得结论是否有显著性区别来决定两种方案的使用。通常A/B检测被用来测试微小的决策调整的效果，例如信用卡公司测试新授信方案时将逾期率与旧授信逻辑比较以获得新授信方案是否对旧授信方案有显著改善的结论。</p>
<h3 id="数据挖掘的实例">数据挖掘的实例</h3>
<p>在这里我会介绍一些书中提到的具体的营销或客户关系管理的实际问题，并给出一些可能的数据挖掘解决方案。</p>
<h4 id="选择最佳广告位置">选择最佳广告位置</h4>
<p>有一家公司需要寻找最佳的广告位置，以从潜在客户中获得最优质量的客户，一种可能的方法是：</p>
<ol>
<li>使用现有客户特征和地理特征如年龄、性别、职业、婚姻状况、社区特征等特征剖析现有优质客户，并将结果特征作为优质客户的模板。</li>
<li>将优质客户的特征模板作为潜在广告的最佳受众。</li>
<li>估计每个可能的广告场所受众与潜在客户模板的距离得分，距离最近也即相似度最高的场所即为最佳广告场所。</li>
</ol>
<h4 id="确定向客户提供的最佳产品">确定向客户提供的最佳产品</h4>
<p>下一个向客户大力推销的产品是什么？这个问题是在许多行业都会发生的交叉销售的例子。针对这个问题有几种不同的解决办法，例如之前提过的关联规则挖掘，而当可管理的产品数量不多时，有一个好办法是为每款产品建立一个单独的模型，从而可以对每个客户给定每款产品的得分，而客户的最佳推销产品就是对他来说分数最高的产品。</p>
<ol>
<li>对于每款产品，构建一个二元分类模型来估计客户对该产品的倾向，并将已有该产品的客户倾向设置为0。</li>
<li>使用这些倾向得分设计为每个客户指定最佳产品的决策过程，例如获得最高期望利润或最高成功概率等。</li>
<li>选择得分最高的产品推荐给客户。</li>
</ol>
<p>另一种可能的办法是对持有产品的客户数据进行聚类，并查看每个聚类集群中哪些产品占主导地位，可以把某款产品在聚类中的必力作为该聚类对产品的倾向得分。</p>
<h4 id="发现分店的最佳位置">发现分店的最佳位置</h4>
<p>新的分店应该开在哪里，解决这个问题的指导思想应该是找到一组关于地区的解释变量来预测一家分店的绩效。可能的方法有：</p>
<ol>
<li>使用地区的地理或环境特性建立一个模型来估计某个分店的绩效指标。</li>
<li>把模型应用到侯选位置，以获得最高得分的位置。</li>
</ol>
<p>可供使用的解释变量可能包括驾驶距离内的人口数量、驾驶距离内竞争对手的数量、以及地区人口素质特征等等。</p>
<h4 id="根据未来利润划分客户">根据未来利润划分客户</h4>
<p>假设我们以客户在一年中产生的总收益或净收益来定义利润，那么我们可以基于客户在下一年的预期盈利能力来对他们进行划分。一个简单的模型方法是将去年同一时间的客户特征与其在今年的利润收益作为数据训练模型，并以此模型预计现有客户在未来一年可能产生的收益，以此收益来划分客户的等级。</p>
<h4 id="减少暴露于违约的风险">减少暴露于违约的风险</h4>
<p>此业务问题的目标是在仍有时间采取措施降低风险暴露之时检测出违约信号并预警。一种方法是以违约为目标分类建立二元分类模型，以历史客户的资料对他们三个月后违约的数据进行建模，以此得到客户三月内违约的风险指数模型，可以采取的措施有例如对高违约风险的信用卡客户降低其信贷额度至合理水平。</p>
<p>另一种改进的方法是将违约的概率与违约的数额结合，在上面这个模型的基础上使用所有逾期数据产生一个欠款数额的模型，并以概率和数额相乘计算预期的亏损值。</p>
<p>还有一种可行的方法是使用生存模型对客户可能会违约的时间进行估计，在数据集中包含所有的客户，他们的业务开始时间、结束时间、以及是否违约。以此模型估算客户的违约时间。当我们使用这个模型对现有客户进行评估时，如果发现某些客户的违约时间在不久的将来，即可以采取行动降低风险暴露。</p>
<h4 id="提高客户留存">提高客户留存</h4>
<p>有几种可能的提高客户留存的方法：</p>
<ul>
<li>发现离开风险最高的客户，并鼓励他们留下来。</li>
<li>量化改进操作的价值，从而使客户继续保留。</li>
<li>确定哪些获取客户的方法会带来更好的客户。</li>
<li>确定哪些客户无益，并让他们离开。</li>
</ul>
<p>我在<a href="https://raylei.space/2022/06/09/17-Price_Optimization_with_Random_Forest/" title="基于数据挖掘分类算法的续保价格优化模型记录">第17篇</a>文章中介绍的续保价格优化模型就是其中的第一种方法，总的来说就是构建二元分类模型从而发现导致客户流失的原因并以此为着手点改善操作，提升客户留存率。</p>
<h4 id="检测欺诈性索赔">检测欺诈性索赔</h4>
<p>如果我们已经有一个标注有&quot;欺诈行为&quot;标签的数据集，那么这个问题就与前面的所有二元分类模型一样，使用数据集制作一个可以判断索赔案件的欺诈可能性的模型，并将模型应用至所有索赔案件，并对模型给出高诈骗性标签的案件进行额外审查。</p>
<p>如果没有可用的数据集，我们依然可以使用聚类分析，将所有赔案依其数据性质聚合分组，其中大量数据记录会被聚为几类，他们可能代表的是不同性质的正常索赔。我们需要额外关注的是其他的小的聚类，需要关注这些聚类为何与其他聚类产生区别，从中可能获取一些关于欺诈行为的特征或线索。</p>
<h3 id="针对不同目标任务的技术">针对不同目标任务的技术</h3>
<p>我们有许多不同的数据挖掘技术，而他们都有各自的特性及优缺点，根据这些区别他们所适用的任务也各有不同，需要根据以下任务特征来选择合适的数据挖掘技术：</p>
<ul>
<li>任务是否有明确的目标数据集决定使用分类模型或聚类、探索性分析。</li>
<li>目标数据类型决定使用离散的分类模型或连续的估值模型或计算概率的二元分类模型。</li>
<li>输入数据的类型决定使用回归模型、神经网络等运用数字输入且对缺失值敏感的模型或使用决策树、朴素贝叶斯等使用离散输入数据并不需要处理缺失值的模型。</li>
<li>任务的可能收益决定是否使用一些准备成本较高的模型如遗传算法。</li>
<li>模型是否需要可解释性来决定使用决策树、回归模型等可以直观看见输入值对输出影响的模型或使用随机森林、神经网络等精度更高但过程难以解释的&quot;黑箱模型&quot;。</li>
</ul>
<p>原书中还给出了一张适用于不同任务类型的数据挖掘算法的表格。</p>
<table>
<thead>
<tr>
<th>任务</th>
<th>最适合</th>
<th>也考虑</th>
</tr>
</thead>
<tbody>
<tr>
<td>分类和预测</td>
<td>决策树、逻辑回归、神经网络</td>
<td>相似度模型、表查询模型、最近邻模型、朴素贝叶斯模型</td>
</tr>
<tr>
<td>评估</td>
<td>线性回归、神经网络</td>
<td>回归树、最近邻模型</td>
</tr>
<tr>
<td>二元响应</td>
<td>逻辑回归、决策树、神经网络</td>
<td>相似度模型、表查询模型、最近邻模型、朴素贝叶斯模型</td>
</tr>
<tr>
<td>发现集群和模式</td>
<td>任何聚类算法</td>
<td>关联规则</td>
</tr>
</tbody>
</table>
<h1>最后</h1>
<p>我在这篇文章中总结了<code>Data Mining Techniques: For Marketing, Sales, and Customer Relationship Management, Third Edition</code>一到三章的主要内容，其内容也是极具概括性的，但这些内容对于一个技术人员理解商业问题，并将商业问题转换为技术问题有非常强的<code>启发性</code>。这本书全书正文600余页共有21章，其后的每一章都对应了一个数据挖掘技术的详细<code>使用方法和案例</code>，非常推荐所有在数据挖掘技术的商业应用领域的朋友们学习参考。</p>
<p>[第20篇]</p>
]]></content>
      <categories>
        <category>数据分析</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>数据挖掘</tag>
      </tags>
  </entry>
  <entry>
    <title>[编程算法]基于Selenium的自动网页报价机器人功能实现记录</title>
    <url>/2022/08/01/21-Automated_Website_Logging_Robot/</url>
    <content><![CDATA[<h1>序言</h1>
<p>早在我的第4篇博文《<a href="http://raylei.space/2022/02/21/4-Selenium_documentation_learning/" title="公司项目需要的自动化测试 Selenium 文档解读">公司项目需要的自动化测试 Selenium 文档解读</a>》中我就提到过现公司有一个集团设定报价逻辑的报价系统，其本质是一个内部的网站。核保人员只需要在网站上填入投保人的相关信息就可以从网站设定的逻辑中获得报价并将报价录入公司系统中。但这个过程中操作人员需要不停与网页互动，等待网站响应等，通常填写一个汽车险报价需要花费一个人10-15分钟时间，非常耗时，一个熟练的操作员一个小时也只能发出4-6张报价单，而我们每个月需要的报价量都是数以千计，这使得整个报价操作的人工成本非常高。有了这个自动操作的机器人后，每个报价将只需要50秒左右就能完成。</p>
<p>本篇博文是在之前的自动化报价机器人的基础上，为了更增加机器人运行稳定性等方面升级调整过程中对一些功能实现的代码记录。</p>
<h1>正文</h1>
<p>现在的操作是操作员直接将信息填写进Excel表格中，脚本机器人读取Excel信息然后依次将表格中的信息填写到网站的相应位置最后发出报价单并记录单号和报价。为了避免输入的信息有误，有选项的Excel使用表单选择信息，而如果网页接受信息后弹出错误或提醒，脚本也会记录下这个提示的内容。其他还有选择表单中最相近选项等功能都会在这篇中介绍。</p>
<h2 id="检查输入文件">检查输入文件</h2>
<p>虽然我在收集数据的Excel表格中设置了如表单等内容验证的功能，但有些网站报价必须要有的信息我也必须在保证Excel中存在。因此在脚本开始报价之前必须先检视一遍Excel文件中是否有缺失的信息。我的实现方法就是使用<code>Pandas包</code>将Excel文件读取成文件框格式，然后将可以允许空值的列名除外，检视所有列中是否有空值，如果有则报错请用户将空值补全。代码的实现上值得说的主要是避免将<code>assert语句</code>重复多次而显得语句赘余，因此直接使用循环exec执行字符串的方式：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 遍历所有不在非必填清单中的列，如果不是没有任何空值则报错。</span></span><br><span class="line">Non_compulsory_col = [<span class="string">&quot;Body Type&quot;</span>, <span class="string">&quot;Customer Address&quot;</span>, <span class="string">&quot;Replace No&quot;</span>, <span class="string">&quot;Unit&quot;</span>, <span class="string">&quot;Building&quot;</span>, <span class="string">&quot;District&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> names <span class="keyword">in</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> data_record.head() <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> Non_compulsory_col]:</span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">&quot;assert(not data_record[&#x27;&#123;column_name&#125;&#x27;].isnull().values.any()),&#x27;There are missing values in &#123;column_name&#125; Column, please fill in.&#x27;&quot;</span>.<span class="built_in">format</span>(column_name = names))</span><br></pre></td></tr></table></figure>
<h2 id="获取错误信息">获取错误信息</h2>
<p>使用Selenium与网站交互时，可能有一些情况下某个客户不能按正常步骤获得报价，或者信息本身不符合报价条件，又或者信息填写错误等等都会导致及脚本无法按照预期获得最后结果。这种时候我们的脚本需要记录下这些错误的原因从而让用户可以相应调整信息输入或回复给报价人不能报价等。而可能导致错误信息的原因根据我的测试都有好几种，我希望脚本可以将所有可能的错误信息全部记录下来。</p>
<h3 id="脚本结构">脚本结构</h3>
<p>我将每一个报价过程中填写每一个页面的脚本各自封装成函数，需要的参数只有记录编号。这样将每一条信息输入过程模块化，就可以在报错时更快定位到报错的位置。而在每一个函数中都加上一个<code>try: except:</code>的结构，如果出现错误则收集所有错误信息并<code>return</code>，需要注意的是我的每一个模块本身是没有返回值的，也就是说如果不报错的话每一个函数的返回值都应该是<code>None</code>。那么最后在循环遍历所有记录的函数中依次调用每一个函数并且检视这些函数的返回值，如果返回值不为<code>None</code>则说明这个模块出现了错误，这时以<code>continue</code>语句结束该循环并且记录下返回的错误信息。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 运行每条记录并检视返回值，如果不为None则说明报错，在Remark中输入返回错误内容。</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data_record)):</span><br><span class="line">    status = start_quoting(x)</span><br><span class="line">    <span class="keyword">if</span> status != <span class="literal">None</span>:</span><br><span class="line">        data_record[<span class="string">&#x27;Remarks&#x27;</span>][x] = status</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Quote record %s failed.&quot;</span>% <span class="built_in">str</span>(x+<span class="number">1</span>))</span><br><span class="line">        <span class="built_in">print</span>(status)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="抓取错误信息">抓取错误信息</h3>
<p>导致程序没有按预期完成的可能原因有很多，有些是程序本身的bug，有些是填写信息无效，有些是系统判断不能报价等等。这时使用<code>try:except:</code>结构时报错本身的信息可以反映程序出错的原因，而网站上一些特定区域的提示则可以反映出网站未返回预期结果的原因，我们接下来要做的就是在自动测试的每一步中抓取这些信息并且保存。我使用的方法是用<code>list</code>将每一个可能出现错误信息的地方的信息都存起来，然后将有效的结果合成为一条字符串：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 以start quoting阶段为例。</span></span><br><span class="line"><span class="keyword">try</span>: ...</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 首先标明在哪一个模块出现了错误。</span></span><br><span class="line">    errormsg = [<span class="string">&quot;Error in start quoting stage:&quot;</span>]</span><br><span class="line">    <span class="comment"># 然后将系统的错误信息附在list中。</span></span><br><span class="line">    errormsg.append(<span class="built_in">str</span>(e))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 如果error-list中有内容也附在后面。</span></span><br><span class="line">        errormsg += [x.text <span class="keyword">for</span> x <span class="keyword">in</span> driver.find_elements_by_xpath(<span class="string">&quot;//ul[@id=&#x27;error-list&#x27;]/li[not(contains(@style,&#x27;display: none;&#x27;))]&quot;</span>)]</span><br><span class="line">    <span class="keyword">except</span>: <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 最后将errorText中的内容也附上。</span></span><br><span class="line">    errormsg += [x.text <span class="keyword">for</span> x <span class="keyword">in</span> driver.find_elements_by_xpath(<span class="string">&quot;//li[@class=&#x27;errorText&#x27;]&quot;</span>) <span class="keyword">if</span> x.text != <span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="comment"># 将list中所有的信息用换行符隔开输出为一条字符串作为返回值。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> errormsg <span class="keyword">if</span> x.strip())+<span class="string">&quot;\n&quot;</span></span><br></pre></td></tr></table></figure>
<p>这其中有两条值得详细讲一讲的代码：</p>
<ol>
<li>XPATH的<code>&quot;//ul[@id='error-list']/li[not(contains(@style,'display: none;'))]&quot;</code>的用法中，需要注意的是<code>li[not(contains(@style,'display: none;'))]</code>表示前面那个<code>ul</code>元素下所有中<code>display</code>不为<code>none</code>的<code>li</code>元素：也即所有可见的<code>li</code>元素。</li>
<li><code>&quot;\n&quot;.join(list)</code>表示以<code>&quot;\n&quot;</code>分隔的方式将<code>list</code>中的每一项合并为一个字符串。而后面的<code>x.strip() for x in errormsg if x.strip()</code>则表示将<code>errormsg</code>这个<code>list</code>中每一项移除首尾空行后不为空的项组成的新<code>list</code>，也即移除<code>list</code>中的空项。</li>
</ol>
<h3 id="使用assert语句">使用assert语句</h3>
<p>有一些情况下程序没有按预期运行，但程序却无法立刻报错，例如按下某个按钮后网页没有按照预期进入下一个页面，但程序本身则是在运行下一个模块时才发现这个问题，或者有时候根本不能发现出现问题。这会降低错误抓取的信息的有效性，因此这时我们需要使用assert语句来在一些特定的地方判断代码是否已经按照预期达成了想要的效果。assert本身的使用就是设定一个判断，如果判断没有成立则让程序抛出一个<code>exception</code>，也就是强制进入我们的except的部分，对我们的脚本错误抓取来说非常有用。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span>(driver.current_url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>]==<span class="string">&quot;displayPortal.do&quot;</span>),<span class="string">&quot;Login Failed, please check your credentials and try again.&quot;</span></span><br></pre></td></tr></table></figure>
<p>上面这个assert语句会判断某个操作后，网页的url是否变为以<code>displayPortal.do</code>结尾，如果是则说明操作成功，否则进入报错流程。</p>
<h2 id="匹配表单选项">匹配表单选项</h2>
<p>我的程序是在前人开发的“直球版”脚本的基础上扩展，而前人在处理代理输入的车辆信息与报价网站车辆信息的匹配问题时使用的是<code>Cosine Similarity</code>的方法，将车辆的品牌、型号、描述等信息连起来之后与官网的描述拼接起来做<code>Cosine Similarity</code>比较，然后以相似度得分最高的结果为最终结果，其解决匹配错误的方法是将相似度得分以两车的排量差值扣减。这个方法有很多明显的缺点：</p>
<ol>
<li>将原本已经分段的信息合为一条，本质上是剔除了有用的信息（即分段点），这会导致匹配没有用上所有可用信息从而影响准确性。</li>
<li>将代理填写的车辆信息与公司报价网站的通表对比，而通表是离线向相关同事拿的，这导致自动化程度不高且不容易实时同步最新车辆数据。</li>
<li>将排量信息作为文本匹配相似度的修正值的信息使用效率非常低，事实上不同车型的排量信息应该是可以作为判断匹配是否成功的决定性依据的。</li>
</ol>
<p>我想到的解决方法更加简便且匹配准确率更高，也非常简单，即直接提取网站上的表单列表，然后直接点对点逐条信息使用Python的字符串模糊匹配包<code>FuzzyWuzzy</code>进行匹配选择。</p>
<h3 id="FuzzyWuzzy">FuzzyWuzzy</h3>
<p><a href="https://www.analyticsvidhya.com/blog/2021/07/fuzzy-string-matching-a-hands-on-guide/" title="Fuzzy String Matching – A Hands-on Guide">FuzzyWuzzy</a>的使用<code>Levenshtein Distance(莱文斯坦距离)</code>算法计算两个字符串之间的相似度，此算法又称<code>Edit Distance(编辑距离)</code>算法，是指两个字符串之间，由一个转成另一个所需的最少编辑次数，编辑方法包括替换字符、插入字符、或删除字符。编辑距离越小，两个字符串的相似度就越大。</p>
<p>FuzzyWuzz有两个模块，分别是计算两条字符串相似度分数的<code>fuzz模块</code>和匹配列表中相似度的<code>process模块</code>。本节只介绍fuzz模块：</p>
<p>该模块下主要介绍四个函数（方法），分别为：<code>简单匹配（Ratio）</code>、<code>非完全匹配（Partial Ratio）</code>、<code>忽略顺序匹配（Token Sort Ratio）</code>和<code>去重子集匹配（Token Set Ratio）</code>。</p>
<ul>
<li><code>简单匹配</code>直接以编辑距离计算相似度，与本章开头提到的剔除分段信息的原理相同，这种方法匹配出的结果准确度一般不如其他方法。</li>
<li><code>非完全匹配</code>将两条输入字符串中的短者对比另一条字符串中所有同长度的子串计算编辑距离，这种方法较简单匹配好，但若几个词间顺序变换会对结果产生较大影响。</li>
<li><code>忽略顺序匹配</code>以空格为分隔符将字符串分为多个子串并将所有字母转换为小写移除标点符号，最后将所有子串以首字母排序后组合在一起计算编辑距离。</li>
<li><code>去重子集匹配</code>使用set操作来直接取出字符串中的子串，因此重复或多余的子串会被忽略。</li>
</ul>
<p>使用者可以根据自己的用例来选择适合的方法计算字符串相似度，他们的使用方法如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> fuzzywuzzy <span class="keyword">import</span> fuzz</span><br><span class="line"></span><br><span class="line"><span class="comment">#简单匹配</span></span><br><span class="line">Ratio = fuzz.ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line"><span class="comment">#非完全匹配</span></span><br><span class="line">Ratio = fuzz.partial_ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line"><span class="comment">#忽略顺序匹配</span></span><br><span class="line">Ratio = fuzz.token_sort_ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line"><span class="comment">#去重子集匹配</span></span><br><span class="line">Ratio = fuzz.token_set_ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>在我们的例子中，<code>去重子集匹配</code>应该是提供最精准的匹配结果的方法。</p>
<h3 id="匹配车辆信息">匹配车辆信息</h3>
<p>车辆信息分为品牌、型号、描述等字符串信息和排量、吨位等数字信息，在匹配字符串信息时我们就使用上节提到的<code>fuzz</code>方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match_option</span>(<span class="params">value, element</span>):</span><br><span class="line">    <span class="comment"># 使用Select函数将网站相应表单中的选项提取成list，</span></span><br><span class="line">    option_lst = Select(element).options</span><br><span class="line">    <span class="comment"># 依次计算其相似度</span></span><br><span class="line">    match_score = np.array([fuzz.token_set_ratio(x.text,value) <span class="keyword">for</span> x <span class="keyword">in</span> option_lst])</span><br><span class="line">    <span class="comment"># 最后返回相似度最高的选项字符</span></span><br><span class="line">    <span class="keyword">return</span> option_lst[np.argmax(match_score)].text</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用Select函数的select_by_visible_text方法即可选择匹配的选项</span></span><br><span class="line">matched_option = match_option(value, element)</span><br><span class="line">Select(element).select_by_visible_text(matched_option)</span><br></pre></td></tr></table></figure>
<p>上面这个函数中只需要传入一个需要匹配的字符串(代理提供的信息)与一个selenium网页元素(相应的网页表单)便可以返回表单中与代理提供的信息最匹配的选项，最后使用Select函数的<code>select_by_visible_text()</code>方法选择到匹配的选项。</p>
<p>而匹配数字信息的方法就更加简单直观了，直接在表单中找到离给定数字最近的选项：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find_nearest</span>(<span class="params">array, value</span>):</span><br><span class="line">    <span class="comment"># 使用numpy方法返回列表中与给定值的绝对差值最小的值</span></span><br><span class="line">    array = np.asarray(array)</span><br><span class="line">    idx = (np.<span class="built_in">abs</span>(array - value)).argmin()</span><br><span class="line">    <span class="keyword">return</span> array[idx]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match_cc</span>(<span class="params">car_cc, element</span>):</span><br><span class="line">    lst = []</span><br><span class="line">    <span class="keyword">for</span> opt <span class="keyword">in</span> Select(element).options:</span><br><span class="line">        cc = opt.get_attribute(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cc != <span class="string">&quot;&quot;</span>:</span><br><span class="line">            lst.append(<span class="built_in">int</span>(cc))</span><br><span class="line"><span class="comment">#     lst = [int(x.get_attribute(&#x27;value&#x27;)) for x in Select(element).options if x.get_attribute(&#x27;value&#x27;) != &quot;&quot;]</span></span><br><span class="line">    <span class="keyword">return</span> find_nearest(lst, car_cc)</span><br></pre></td></tr></table></figure>
<p>上面的代码没有什么好讲的，唯一的一点就是<code>match_cc()</code>函数中被我注释掉的那条代码和现在用的这个<code>append</code>的代码哪个更加合适一点，因此都放在这里。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">matched_option = match_cc(car_cc, element)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">abs</span>(matched_option-<span class="built_in">int</span>(data_record[<span class="string">&#x27;Cylinder Capacity&#x27;</span>][record_no]))&lt;<span class="number">100</span>),<span class="string">&quot;No similar car available!&quot;</span></span><br></pre></td></tr></table></figure>
<p>最后在选择排量后，将选择的排量与给定的排量信息对比，如果差值大于100则说明匹配一定有误。</p>
<h1>最后</h1>
<p>在这篇文章中我记录了对之前的自动脚本的一些改进方法，同时为了方便没有任何专业知识的同事操作这个自动报价机器人，我还使用<code>tkinter包</code>另外设计了一个GUI界面，这其中也有许多值得一说的小技巧和实现记录，我会在下一篇文章中详细介绍。</p>
<p>[第21篇]</p>
]]></content>
      <categories>
        <category>编程算法</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Python</tag>
        <tag>Selenium</tag>
        <tag>RPA</tag>
      </tags>
  </entry>
  <entry>
    <title>[金融分析] CFA一级《股权投资》学习笔记</title>
    <url>/2022/08/29/23-CFA-level1-equity-investment/</url>
    <content><![CDATA[<h1>概览</h1>
<p>经济学一共包括2个Session的6个Reading，主要包括的内容是各个Reading的内容如下表：</p>
<table>
    <tr>
        <th>Sessions</th>
        <th>Readings</th>
        <th>Contents</th>
    </tr>
    <tr>
        <td rowspan="3">SS12</td>
        <td>R36</td>
        <td>Market Organization and Structure</td>
    </tr>
    <tr>
        <td>R37</td>
        <td>Security Market Indexes</td>
    </tr>
    <tr>
        <td>R38</td>
        <td>Market Efficiency</td>
    </tr>
    <tr>
        <td rowspan="3">SS13</td>
        <td>R39</td>
        <td>Overview of Equity Securities</td>
    </tr>
    <tr>
        <td>R40</td>
        <td>Introduction to Industry and Company Analysis</td>
    </tr>
    <tr>
        <td>R41</td>
        <td>Equity Valuation: Concepts and Basic Tools</td>
    </tr>
</table>
<h1>Session 12</h1>
<h2 id="Reading-36-金融市场组织和结构">Reading 36 金融市场组织和结构</h2>
<h3 id="金融市场的主要功能">金融市场的主要功能</h3>
<ul>
<li>满足不同投资者的不同需求：存储、借贷、股权发行、风险管理、交换资产、信息兑现。</li>
<li>决定市场利率：金融市场的市场利率由贷款和借款的数量决定。</li>
<li>资金最有效配置：市场中的资产被最有效地分配到需要他们的人手上，每个人都获得更高收益。</li>
</ul>
<h3 id="正常运行的金融市场">正常运行的金融市场</h3>
<p>正常运行的金融市场应该具有以下特性：</p>
<ul>
<li>完整市场(Complete market)：可以满足不同投资者的不同金融需求。</li>
<li>经营效率(Operational efficiency)：交易成本低。</li>
<li>信息有效性(Informational efficiency)：新信息在价格上的反映迅速。</li>
<li>资源配置有效性(Allocational efficiency)：资金被分配到可以最高效运动它的人手中。</li>
</ul>
<p>金融监管机构的主要职责包含：</p>
<ul>
<li>最小化代理人冲突</li>
<li>保证金融市场公平公正运行</li>
<li>防止内幕交易</li>
<li>防止违约和金融欺诈</li>
<li>保证负债应该被资产覆盖</li>
</ul>
<h3 id="金融市场参与者-Intermediaries-of-Financial-Market">金融市场参与者(Intermediaries of Financial Market)</h3>
<p>金融市场的主要参与者包括Brokers, Dealers and Exchange/ Securitizers/ Depositor Institutions/ Insurance Companies/ Arbitrageurs/ Clearinghouses and Custodians。其中Broker和Insurance Company是这一部分的主要考点。</p>
<ul>
<li>经纪人(Brokers)：经纪人的主要功能是撮合希望交易的双方并从中获取佣金。</li>
<li>Dealers：与经纪人不同，Dealers会实际作为交易对手方，参与买卖并赚取<code>买卖价差(bid-ask spread)</code>。</li>
<li>Block Brokers：主要是负责<code>大宗商品交易</code>的经纪人。</li>
<li>Broker-dealers：指市场上一些既做经纪人又做Dealer的交易方。</li>
<li>交易所(Exchanges)：为交易提供场所，主要发挥监管职能。</li>
<li>保险公司：保险公司面临的风险主要有三个，道德风险(Moral hazard)指被保险人可能因为被保险而使风险上升；逆向选择(Adverse selection)指购买保险的人群往往比普通大众更加处在被保风险之中；诈骗(fraud)指虚构索赔等骗保行为。</li>
</ul>
<h3 id="资产分类">资产分类</h3>
<h4 id="集合融资产品-Pooled-investment-Vehicles">集合融资产品(Pooled investment Vehicles)</h4>
<p>集合融资产品的本质就是<code>基金(Funds)</code>，基金中包括购买上市公司股票的<code>公募基金(Mutual Funds)</code>；购买非上市公司股票的<code>私募基金(Private Equity)</code>；购买房地产的<code>房地产金融投资(REITS)</code>；购买金融衍生品的<code>对冲基金(Hedge Funds)</code>。所有的这些基金种类统称为集合融资产品。</p>
<h4 id="公募基金-Mutual-Funds">公募基金(Mutual Funds)</h4>
<p>公募基金主要分为<code>开放基金(open-ended)</code>和<code>封闭基金(close-ended)</code>。其中开放基金的申购和赎回都可以随时向基金公司申请，以<code>基金净值交易(Net Asset Value, NVA)</code>，但由于需要应对赎回情况，开放基金通常需要配置部分高流动性资产，而被<code>影响收益率(Cash drag)</code>；封闭基金则是在认购期外不能直接与基金公司交易的基金，但可以在二级市场以市场价格交易，市场价格通常对比基金净值有折扣(因为提供了额外流动性)。</p>
<h4 id="交易性开放式指数基金-Exchange-traded-fund">交易性开放式指数基金(Exchange traded fund)</h4>
<p>ETF往往挂钩指数，融合了开放基金和封闭基金各自的优势，因为其既可以在二级市场以市场价格交易，又可以与基金公司以基金净值交易。</p>
<p>[第23篇]</p>
]]></content>
      <categories>
        <category>金融分析</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>CFA一级</tag>
        <tag>股权投资</tag>
      </tags>
  </entry>
  <entry>
    <title>[编程算法]自动报价机器人的GUI开发记录</title>
    <url>/2022/08/23/22-Automated_Website_Logging_Robot_GUI/</url>
    <content><![CDATA[<h1>序言</h1>
<p>这一篇文章与第4篇和第21篇其实是同一个项目，就是将公司的一些填写网页的机械重复劳动使用Python将其自动化，从而达到减少人工成本，增加公司报价效率的结果。这一篇之所以与前两篇分开是因为本篇主要记录的是这个报价工具的用户界面逻辑，虽然是同一个项目但在逻辑上与前两篇是分开的。这篇中主要会涵盖我使用Python内置的<code>tkinter包</code>给这个小程序做的GUI界面，并记录如何将各个功能实现或链接。</p>
<h1>正文</h1>
<h2 id="界面设计">界面设计</h2>
<p>首先要明确软件本身就是为了加速用户处理报价的速度，而实际业务的输入都可以在Excel模板中调整规范，因此我们的软件界面本身可以尽可能的简介易用，我最终的第一版界面就如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220830204919666.png" alt="软件界面"></p>
<p>最上方两个<code>输入框(Entry)</code>用来收集登录网站要用的用户名和密码；一个开始<code>按钮(Button)</code>简洁易懂；往下第二层是选择报价的险种的<code>单选按钮(Radio Button)</code>，根据这个按钮的选项程序会切换不同报价的业务逻辑，第一版还只有私家车险的自动报价；再往下是一个巨大的<code>文本框(Text)</code>，程序在这里向用户展示必要的反馈信息；最后是展示报价进度的<code>进度条(Process Bar)</code>和<code>标签(Label)</code>。</p>
<p>简单来讲用户在输入必要信息后点击开始按钮，程序就会开始运行并反馈信息直到整个报价过程完成。</p>
<h2 id="程序结构">程序结构</h2>
<p>整个程序一共包括三个<code>py文件</code>，分别负责私家车险报价功能实现，主程序界面，和一个图标文件。</p>
<ul>
<li>报价功能文件中主要是程序从检查Excel文件到最后获取报价单号的全流程公式集，每个公式获取一个行号并以此操作Excel文件中相应行数的数据；以后如果增加不同险种的报价逻辑，只需要再增加相应的<code>py文件</code>即可。</li>
<li>在读取数据的主程序界面文件中包括一个主界面的类，其中定义了程序界面的控件和对应函数，同时以POP的方法定义了按键后程序的运行；</li>
<li>最后的图标文件是为了将图标的图片一并打包到最后的exe文件中而将<code>ico文件</code>转码为<code>py文件</code>，运行程序时再自动解码为<code>ico文件</code>的而存在的，本篇也会讲解如何转码解码。</li>
</ul>
<h2 id="程序主界面">程序主界面</h2>
<p>首先是以OOP方法定义的主界面，实现上方界面的代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> ttk</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Qnect_Quoter</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># the main window</span></span><br><span class="line">        self.root = tkinter.Tk()</span><br><span class="line">        <span class="comment"># Title of the tool</span></span><br><span class="line">        self.root.title(<span class="string">&quot;Qnect Quoter&quot;</span>)</span><br><span class="line">        <span class="comment"># add ico from the icon.py file and delete the file after</span></span><br><span class="line">        picture = <span class="built_in">open</span>(<span class="string">&quot;picture.ico&quot;</span>, <span class="string">&quot;wb+&quot;</span>)</span><br><span class="line">        picture.write(base64.b64decode(img))</span><br><span class="line">        picture.close()</span><br><span class="line">        self.root.iconbitmap(<span class="string">&quot;picture.ico&quot;</span>)</span><br><span class="line">        os.remove(<span class="string">&quot;picture.ico&quot;</span>)</span><br><span class="line">        <span class="comment"># mainwindow size</span></span><br><span class="line">        self.root.geometry(<span class="string">&quot;725x605&quot;</span>)</span><br><span class="line">        self.root.resizable(<span class="literal">False</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Main Page frame</span></span><br><span class="line">        self.input_frame = ttk.Frame(self.root)</span><br><span class="line">        self.selection_frame = ttk.LabelFrame(self.root, text=<span class="string">&quot;Quoting Cover&quot;</span>)</span><br><span class="line">        self.textbox_frame = ttk.Frame(self.root)</span><br><span class="line">        self.pb_frame = ttk.Frame(self.root)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create input cells for Qnect acount and passwords</span></span><br><span class="line">        self.account_label = ttk.Label(self.input_frame, text=<span class="string">&quot;Qnect Account: &quot;</span>)</span><br><span class="line">        self.account_input = ttk.Entry(self.input_frame, width=<span class="number">20</span>)</span><br><span class="line">        self.password_label = ttk.Label(self.input_frame, text=<span class="string">&quot;Password: &quot;</span>)</span><br><span class="line">        self.password_input = ttk.Entry(self.input_frame, width=<span class="number">20</span>)</span><br><span class="line">        <span class="comment"># The button to start quoting</span></span><br><span class="line">        self.start_button = tkinter.Button(self.input_frame, command=self.start_quote, text=<span class="string">&quot;Start Quoting&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create radio buttons for selection of quoting coverages</span></span><br><span class="line">        self.alignment_var = StringVar()</span><br><span class="line">        self.alignments = [<span class="string">&quot;Private Car&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Display textbox and scrollbar for information</span></span><br><span class="line">        self.info_text = tkinter.Text(self.textbox_frame, width=<span class="number">85</span>, height=<span class="number">28</span>)</span><br><span class="line">        self.scrollbar = ttk.Scrollbar(self.textbox_frame, orient=<span class="string">&quot;vertical&quot;</span>, command=self.info_text.yview)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add a process bar to the window</span></span><br><span class="line">        self.pb = ttk.Progressbar(self.pb_frame, orient=<span class="string">&quot;horizontal&quot;</span>, mode=<span class="string">&quot;determinate&quot;</span>, length=<span class="number">700</span>)</span><br><span class="line">        self.pb_label = ttk.Label(self.pb_frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gui_arrang</span>(<span class="params">self</span>):</span><br><span class="line">        self.input_frame.grid(padx=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.selection_frame.grid(padx=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.textbox_frame.grid(padx=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.pb_frame.grid(padx=<span class="number">10</span>, pady=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.account_label.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">5</span>, pady=<span class="number">10</span>, sticky=W)</span><br><span class="line">        self.account_input.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">5</span>, sticky=W)</span><br><span class="line">        self.password_label.grid(row=<span class="number">0</span>, column=<span class="number">2</span>, padx=<span class="number">5</span>, sticky=W)</span><br><span class="line">        self.password_input.grid(row=<span class="number">0</span>, column=<span class="number">3</span>, padx=<span class="number">5</span>, sticky=W)</span><br><span class="line">        self.start_button.grid(row=<span class="number">0</span>, column=<span class="number">4</span>, padx=<span class="number">30</span>, sticky=E)</span><br><span class="line">        radio_column = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> alignment <span class="keyword">in</span> self.alignments:</span><br><span class="line">            radio = ttk.Radiobutton(self.selection_frame, text=alignment, value=alignment, variable=self.alignment_var)</span><br><span class="line">            radio.grid(column=radio_column, row=<span class="number">0</span>, ipadx=<span class="number">10</span>, ipady=<span class="number">10</span>)</span><br><span class="line">            radio_column += <span class="number">1</span></span><br><span class="line">        self.info_text.grid(row=<span class="number">1</span>, column=<span class="number">0</span>)</span><br><span class="line">        self.scrollbar.grid(row=<span class="number">1</span>, column=<span class="number">1</span>, sticky=NS)</span><br><span class="line">        self.info_text[<span class="string">&quot;yscrollcommand&quot;</span>] = self.scrollbar.<span class="built_in">set</span></span><br><span class="line">        self.pb.grid(row=<span class="number">0</span>, sticky=EW)</span><br><span class="line">        self.pb_label.grid(row=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_quote</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">global</span> completed, listening</span><br><span class="line">        login_thread = threading.Thread(target=LoginValidate)</span><br><span class="line">        login_thread.start()</span><br><span class="line">        completed = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># make sure there is only one Waiting_for_login() loop going on, otherwise will create several loops each click.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> listening:</span><br><span class="line">            Waiting_for_login()</span><br><span class="line">            listening = <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">global</span> main_window</span><br><span class="line">    main_window = Qnect_Quoter()</span><br><span class="line">    main_window.gui_arrang()</span><br><span class="line">    logging.basicConfig(filename=<span class="string">&quot;Run.log&quot;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s %(message)s&#x27;</span>, filemode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    logger = logging.getLogger()</span><br><span class="line">    logger.setLevel(logging.ERROR)</span><br><span class="line">    tkinter.mainloop()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>上面代码中值得注意的主要有几点，<code>Tkinter</code>各控件的详细使用方法与示例参考<a href="https://www.pythontutorial.net/tkinter/" title="Python Tutorial Tkinter">这个网站</a>：</p>
<ol>
<li>导入<code>tkinter包</code>时的<code>tk</code>使用的是1991年引入的经典控件，而使用<code>tkinter</code>中的<code>ttk module</code>创建的控件则是2007年新的控件风格。另外<code>from tkinter import *</code>语句的意义是为了导入<code>tkinter包</code>中表示方位的字符&quot;E&quot;“EW”&quot;N&quot;等，这些字符可以在<code>grid方法</code>中表示控件偏向某个方向，或向哪个方向延申。</li>
<li><code>__init__</code>中定义各个控件的初始化信息，以及主程序窗口的设置参数，从上至下初始化输入框，选择框，信息框，以及进度条框四个<code>框架(Frame)</code>。</li>
<li><code>gui_arrang(self)</code>函数中使用<code>grid函数</code>将不同控件与框架在主窗口中分别排列，这个方法比<code>pack方法</code>自由度更高，比<code>place方法</code>需要的成本更低，排版更漂亮。</li>
<li><code>self.start_button</code>按钮绑定的程序是<code>start_quote(self)</code>，而该程序会在运行后开始一个新的线程并在主程序的循环外同步运行<code>LoginValidate</code>，这个函数会验证并通过报价模块的函数获取其从Excel文件中提取的<code>pandas数据框对象</code>与打开的<code>webdriver对象</code>。与此同时程序会开始一个等待<code>LoginValidate</code>函数完成的监听过程<code>Waiting_for_login</code>，该监听过程会在判断前一个线程的目标完成后开启新线程运行相应的报价程序。</li>
<li>在<code>main()函数</code>中，实例化一个主界面，并使其进入<code>mainloop()</code>，同时在loop之前加入一个记录报错信息的<code>logger</code>。这个logger会记录运行中的错误信息与时间并写入log文件中以便debug。</li>
</ol>
<h2 id="链接功能模块">链接功能模块</h2>
<p>接上节内容，<code>main.py文件</code>中除了主界面的元素等内容外，还有几个函数，用来调用协调主界面元素与实际报价的功能模块。我就按顺序首先讲讲<code>start_quote(self)</code>中新线程运行的<code>LoginValidate()</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">LoginValidate</span>():</span><br><span class="line">    <span class="comment"># initiate the process bar</span></span><br><span class="line">    main_window.pb[<span class="string">&quot;value&quot;</span>] = <span class="number">0</span></span><br><span class="line">    main_window.pb_label[<span class="string">&quot;text&quot;</span>] = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">global</span> completed</span><br><span class="line">    <span class="comment"># get the inputs from the UI</span></span><br><span class="line">    username = <span class="built_in">str</span>(main_window.account_input.get())</span><br><span class="line">    password = <span class="built_in">str</span>(main_window.password_input.get())</span><br><span class="line">    covername = <span class="built_in">str</span>(main_window.alignment_var.get())</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>([<span class="keyword">not</span> username, <span class="keyword">not</span> password, <span class="keyword">not</span> covername]):</span><br><span class="line">        update_info_text(<span class="string">&quot;Please input QNECT username, password and select a cover you wish to quote.\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> data_record, driver</span><br><span class="line">    <span class="comment"># validating the input file</span></span><br><span class="line">    update_info_text(<span class="string">&quot;Loading File...\n&quot;</span>)</span><br><span class="line">    load_file = PrivateCarQuoting.load_data(Filename)</span><br><span class="line">    <span class="keyword">if</span> load_file[<span class="number">0</span>] != <span class="number">0</span>:</span><br><span class="line">        update_info_text(load_file[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        update_info_text(<span class="string">&quot;File loaded!\n&quot;</span>)</span><br><span class="line">        data_record = load_file[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Login to Qnect</span></span><br><span class="line">    update_info_text(<span class="string">&quot;Connecting to Qnect...\n&quot;</span>)</span><br><span class="line">    login_qnect = PrivateCarQuoting.Login(username, password)</span><br><span class="line">    <span class="keyword">if</span> login_qnect[<span class="number">0</span>] != <span class="number">0</span>:</span><br><span class="line">        update_info_text(login_qnect[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            driver = login_qnect[<span class="number">1</span>]</span><br><span class="line">            driver.quit()</span><br><span class="line">        <span class="keyword">except</span>: <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        update_info_text(<span class="string">&quot;Log in Success!\n&quot;</span>)</span><br><span class="line">        driver = login_qnect[<span class="number">1</span>]</span><br><span class="line">        completed = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_info_text</span>(<span class="params">text</span>):</span><br><span class="line">    main_window.info_text.insert(END, text)</span><br><span class="line">    main_window.info_text.see(END)</span><br></pre></td></tr></table></figure>
<p>上面这个函数主要需要完成的是验证数据并通过主界面实例将结果动态反馈至主界面，并在成功收集数据，打开webdriver对象后返回这两个对象以供后面的程序使用。特别需要注意的是其中的<code>complete</code>变量，这是一个<code>布尔变量</code>，只有在所有验证成功完成后这个变量才会被标记为<code>真</code>。在这个变量被标记为真后另一个线程中正在监听<code>complete</code>结果的函数<code>Waiting_for_login()</code>才会开始执行：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">listening = <span class="literal">False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Waiting_for_login</span>():</span><br><span class="line">    <span class="keyword">global</span> completed, listening</span><br><span class="line">    <span class="keyword">if</span> completed:</span><br><span class="line">        listening = <span class="literal">False</span></span><br><span class="line">        update_info_text(<span class="string">&quot;Start Quoting...\n\n&quot;</span>)</span><br><span class="line">        quoting_thread = threading.Thread(target=PrivateCarQuote)</span><br><span class="line">        quoting_thread.start()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        main_window.root.after(<span class="number">100</span>, Waiting_for_login)</span><br></pre></td></tr></table></figure>
<p>这里需要注意的一点主要是<code>listening</code>这个变量在这里的意义是为了控制同时发起的线程，因为在<code>start_quote(self)</code>按钮的函数中会直接调用<code>Waiting_for_login()</code>函数，而每一个被运行的<code>Waiting_for_login()</code>函数又会在得到<code>complete</code>变量之前，每100毫秒循环运行自己，这会导致如果程序一直不能<code>complete</code>时，如果用户一直点击按钮，就会创建多个线程运行同一个函数，而在<code>complete</code>被完成时，所有的多个函数被同时执行。因此这里以一个<code>listening</code>变量控制，只有在<code>listening</code>为<code>假</code>时，按按钮才会运行新的<code>Waiting_for_login()</code>函数。</p>
<p>到这里，我这个第一版的报价工具用户界面就已经基本完成了，上方这个<code>Waiting_for_login()</code>函数在以后增加不同的险种报价功能后还应该改成输入一个单选按钮的结果，在线程中运行对应报价流程的函数，但目前还没有这个功能的需求，单选按钮就当是占位符了。</p>
<h2 id="ico文件转码">ico文件转码</h2>
<p>运行下面这段代码将<code>ico文件</code>编码为<code>py文件</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">open_icon = <span class="built_in">open</span>(<span class="string">&quot;QBE_Vertical_White_RGB.ico&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">b64str = base64.b64encode(open_icon.read())</span><br><span class="line">open_icon.close()</span><br><span class="line">write_data = <span class="string">&quot;img = %s&quot;</span> % b64str</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;icon.py&quot;</span>, <span class="string">&quot;w+&quot;</span>)</span><br><span class="line">f.write(write_data)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>然后在主程序中加入下面这些代码从而将上面生成的<code>icon.py</code>文件中的内容重新解码为<code>ico文件</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># add ico from the icon.py file and delete the file after</span></span><br><span class="line">picture = <span class="built_in">open</span>(<span class="string">&quot;picture.ico&quot;</span>, <span class="string">&quot;wb+&quot;</span>)</span><br><span class="line">picture.write(base64.b64decode(img))</span><br><span class="line">picture.close()</span><br><span class="line">self.root.iconbitmap(<span class="string">&quot;picture.ico&quot;</span>)</span><br><span class="line">os.remove(<span class="string">&quot;picture.ico&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Webdriver-manager-SSL验证">Webdriver manager SSL验证</h2>
<p>在最后将文件打包为exe文件后还遇到一个关于<code>Webdriver manager</code>的奇怪BUG，为了避免每次运行<code>webdriver</code>时都要去下载最新的<code>chrome driver</code>， 我使用了<code>webdriver manager包</code>，它会自动检测当前缓存中的<code>webdriver</code>版本并对比当前最新版本，如果本机不是最新版本则会自动去官网下载并打开，只需要一句代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> webdriver_manager.chrome <span class="keyword">import</span> ChromeDriverManager</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(ChromeDriverManager().install())</span><br></pre></td></tr></table></figure>
<p>这句话在<code>Pycharm</code>中运行非常顺畅，但当我把文件打包成exe文件后再运行就会在这句报错，说SSL未验证，我最后也没有找到原因，只能根据<code>webdriver manager</code>官方文档的指导通过修改os环境参数<code>WDM_SSL_VERIFY</code>来跳过SSL验证。</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.environ[<span class="string">&#x27;WDM_SSL_VERIFY&#x27;</span>] = <span class="string">&#x27;0&#x27;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1>最后</h1>
<p>以上就是整个自动报价机器人的操作界面的记录，到这里我就算是独立完成了一个可以大幅减少公司重复劳动工作的RPA程序，到我写完这篇文章的时候这个报价工具已经同时完成了向两个不同渠道的400余个报价案件的测试，在4小时内完成了普通一个人人手需要十几个工作日才能完成的报价量，之后这个软件的升级或改进如果有意义的话我会再开一篇。</p>
<p>[第22篇]</p>
]]></content>
      <categories>
        <category>编程算法</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Python</tag>
        <tag>RPA</tag>
        <tag>GUI</tag>
      </tags>
  </entry>
  <entry>
    <title>[MS Office] 设计Excel报告模板动态展示前n项产品</title>
    <url>/2022/02/19/3-excel-tool-develop-1/</url>
    <content><![CDATA[<p><font size=4><mark class="hl-label default">特别声明</mark> </font></p>
<mark class="hl-label default">本文中的出现的数据均经过随机扭曲处理，仅工具排版，逻辑与公式可供参考。</mark> 
<hr>
<h1>序言</h1>
<p>上周为公司的月度保费报告做了一些升级调整，主要是涉及产品保费量展示部分由以前的<code>静态展示固定产品保费</code>改为<code>按保费量动态展示产品排行</code>。其中涉及的Excel公式技巧包括但不限于<code>OFFSET应用</code>，<code>动态排名展示</code>，<code>合并单元格文字</code>等。</p>
<p>原工具中有三张表格，其中有互相参考验证数据正确性的<code>Tracking cells</code>，这里面我只讲稍微复杂一些的最后一张，且数据经过随机数扭曲，所以本文中展示的表格中的<code>Tracking cells</code>不会正常显示。</p>
<h1>正文</h1>
<p>该工具的最终目的是使用系统中生成的原始数据利用excel的公式功能自动整理计算数据并以要求形式展示。工具的目的是为了减少人力成本，因此一个原则是尽最大可能减少工具使用人在工具定板后使用时投入的成本，在此原则之上再尽力减少制作工具本身需要的时间和精力成本。本篇中我会分别介绍这个工具的版面设计以及从已有数据结构到需求的展示样式的逐步实现方法以及其中设计的一些可以广泛应用的小技巧。</p>
<h2 id="工具版面设计">工具版面设计</h2>
<p>我设计Excel工具时一个习惯的guideline是将数据分为至少三个部分：</p>
<ol>
<li>不改变原数据的结构，以所得即所用的原则组成一个<code>数据输入区</code>，用这样的数据做成的工具可以减少该工具在后续使用中对使用人<code>“调整原数据”</code>的需求，从而降低使用成本。</li>
<li>将数据以标准形式整理并计算的<code>数据处理区</code>，这个部分通常会包含标准化的数据分类，这样做的目的是将原数据在该区域内透明地以标准化方式整理计算，以方便后续数据展示，并使各部分公式易于阅读和后续维护修改。</li>
<li>最后是数据的输出形式，即<code>数据展示区</code>，这个部分通常是按<code>数据使用人</code>的需求调整，也即在工具制作期间制作人通常不能控制的部分，我们最后的目的就是将处理好的数据按使用人需求展示。</li>
</ol>
<p>本工具的版面既是根据上述习惯排版：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/img_20220220131551.png" alt="工具版面分为“数据输入区”，“数据处理区”和“数据展示区”三个部分"></p>
<h2 id="工具设计思路">工具设计思路</h2>
<p>在开始设计工具之前需要理清最重要的两点，第一是到手的原数据结构，第二就是最终需要展示的信息。在这个案例中，我们提取出来的原数据为月度数据，包含信息有4列，分别是<code>险种</code>，<code>新/续业务</code>，<code>本/上年信息</code>以及<code>保费</code>本身。其中每个险种分别会有本/上年的新/续业务保费，这样<code>2x2=4</code>种的组合。因此可以知道标准格式中只需要包含<code>所有可能险种数x4</code>行既可以展示所有可能的输入组合。</p>
<p>此时开始分析需要展示的信息，所需展示的信息可以分为3部分：首先是将险种按当前年度总保费的大小排名并展示前8个险种，将此之外的保费信息加总归入<code>Other</code>类。其次将各月保费按需求的时间维度分组加总展示(如月度，季度，半年度，当前合计等)。最后只需要动态地将未展示出来的险种名合并展示作为备注即可。</p>
<p>为满足该需求，我的设计是将保费性质信息作为标准化维度放在数据处理区的最左边并以月份为列名排列所有数据输入区的数据，排列后在处理区将各险种按当年保费(新续业务加总)排出大小并标识，最后在展示区以<code>OFFSET</code>为引用处理区不同月度数据的方法，以降低制作工具本身所需的时间，提高公式的<code>可读性</code>和<code>修改弹性</code>。</p>
<h2 id="实现方法">实现方法</h2>
<p>此章中我不会事无巨细介绍所有出现的技巧，如果想要详细了解建议在最后链接中下载该工具样本自己研究，我的公式应该都是trackable的，这里我只会分别介绍几个可以广泛应用到其他需求中的方法和公式。</p>
<h3 id="如何跳行-列引用数据">如何跳行/列引用数据</h3>
<p>这是制作该工具时我使用的第一个小技巧，答案非常简单，既是<code>OFFSET</code>。在工具中可以看到，原数据中每月数据有4列信息，而数据处理区中我们只希望每1列展示一个月信息，这样导致的问题是如果不使用OFFSET而将处理区中的<code>SUMIFS</code>公式直接向右复制，则会使每个引用信息仅向右移动1列，从而导致<code>引用区域错位</code>。因此我们需要左边处理区每向右移动1列，公式中的引用区同步向右移动4列，才能将所有引用信息移动至原数据中的<code>下月中相应区域</code>。</p>
<p>以处理区中最左上角的公式为例：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220220151308158.png" alt="=SUMIFS(OFFSET($VV$177,,EUU$177,,ED30,OFFSET($TT$177,,EC30,OFFSET($SS$177,,EB30)/1000000"></p>
<blockquote>
<p>=SUMIFS(OFFSET($V<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>V$177,E<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>28</mn><mo separator="true">,</mo><mo separator="true">,</mo><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>O</mi><mi>F</mi><mi>F</mi><mi>S</mi><mi>E</mi><mi>T</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">28,,),OFFSET(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">28</span><span class="mpunct">,,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">OFFSET</span><span class="mopen">(</span></span></span></span>U<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>U$177,E<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>28</mn><mo separator="true">,</mo><mo separator="true">,</mo><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">28,,),</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">28</span><span class="mpunct">,,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mclose">)</span><span class="mpunct">,</span></span></span></span>D30,OFFSET($T<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>T$177,E<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>28</mn><mo separator="true">,</mo><mo separator="true">,</mo><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">28,,),</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">28</span><span class="mpunct">,,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mclose">)</span><span class="mpunct">,</span></span></span></span>C30,OFFSET($S<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>S$177,E<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>28</mn><mo separator="true">,</mo><mo separator="true">,</mo><mo stretchy="false">)</mo><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">28,,),</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">28</span><span class="mpunct">,,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mclose">)</span><span class="mpunct">,</span></span></span></span>B30)/1000000</p>
</blockquote>
<p>该公式除去OFFSET便是非常简单的SUMIF公式如下，即将原数据中的信息按标准模板加总排列：</p>
<blockquote>
<p>=SUMIFS($V<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>V<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>177</mn><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">177,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">177</span><span class="mpunct">,</span></span></span></span>U<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>U<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>177</mn><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">177,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">177</span><span class="mpunct">,</span></span></span></span>D30,$T<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>T<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>177</mn><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">177,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">177</span><span class="mpunct">,</span></span></span></span>C30,$S<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>S<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>177</mn><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">177,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">177</span><span class="mpunct">,</span></span></span></span>B30)/1000000</p>
</blockquote>
<p>那么OFFSET是怎么用的呢？OFFSET函数本身的作用就是以公式参数的方法来移动改变引用区域，他的参数如下：</p>
<blockquote>
<p>=OFFSET(Reference, rows, cols, [height],[width])</p>
</blockquote>
<p>其中<code>Reference</code>为引用的区域，后面的四个参数分别代表在<code>Reference</code>的基础上要移动的<code>行数</code>，<code>列数</code>，<code>高度</code>，<code>宽度</code>，<code>正数代表向右/向下，负数反之</code>。</p>
<p>以我们的公式为例，<code>OFFSET($V$30:$V$177,,E$28,,)</code>即代表将<code>$V$30:$V$177</code>移动<code>E$28</code>标注的列数(此处为0，即不移动)，其他参数未设置则用<code>,</code>隔开。到这里我只需要将每个月的列上以等差数列向右排列引用所需移动的列数，即可以一个公式为每个月需要引用的原数据找到正确的引用位置。同样的方法在<code>数据展示区</code>也大量的使用，因此可以用一个公式以改变最少参数的方法来填入表格中。</p>
<p>OFFSET这样的公式非常明显，是为了减轻工具制作和维护的成本而存在的，因为用到不同的公式越少，后期维护时就越简单，毕竟这里你也可以选择人手将不同月份的引用区域拖动到他们合适的位置，不过制作和维护的成本将大大增加。</p>
<h3 id="仅对当前第一次出现的元素计算">仅对当前第一次出现的元素计算</h3>
<p>我们想要将产品按当前合计保费量排名，也即将当年的新/续保费加总并排名，但我们却不能直接使用SUMIF加总，因为按照我的版面设计，如果直接全部加总排行时每个产品会有两个相同的保费，从而影响排行名次。因此我们要想办法使每个产品名后仅出现一个加总保费。好在我们的数据处理区是标准化设计，上半部分全部是当年数据且每个险种按NB-RN的顺序规律排列。因此我们可以是用公式从上至下仅仅对该元素第一次出现时进行计算。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220220152214570.png" alt="=IF(COUNTIF($BB30,$B30)=1,SUM(OFFSET(E30:P30,,,2,)),0)"></p>
<blockquote>
<p>=IF(COUNTIF($B<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>B30,$B30)=1,SUM(OFFSET(E30:P30,2,)),0)</p>
</blockquote>
<p>这个公式分为两个部分，其中<code>IF</code>部分为重点，即判断语句<code>COUNTIF($B$30:$B30,$B30)=1</code>。需要注意其中<code>$B$30:$B30</code>中<code>:</code>后的<code>B30</code>仅仅固定了列数，因此该公式在下拉时该引用区域也会相应拉长。这就使得这个<code>COUNTIF</code>公式可以实现计算<code>从上到下到目前为止B列该元素出现过的次数</code>。而此时将判断语句写为<code>该COUNTIF为1</code>则表示从上到下第一次出现这个元素时，则计算后面的<code>SUM(OFFSET(E30:P30,,,2,))</code>，否则返回0。</p>
<p>这个<code>SUM</code>函数中的<code>OFFSET</code> 的<code>height</code>参数被设置为<code>2</code>，因此加总包括该引用处在内的向下共<code>2</code>个单元格。以此实现每个出现的产品进行一次NB和RN的数值加总。</p>
<h3 id="将出现过的数字按大小排名">将出现过的数字按大小排名</h3>
<p>上一步中我们已经得到了每一个产品的当年总保费，那么使用<code>RANK.EQ</code>函数既可以对保费量进行排名从而使每个险种得到一个相应的排名。本来此时在展示区左边我只需要手动输入1,2,3便可以自动展示排名为1,2,3的产品名，但此处有一个特殊需求，那就是由于下架，要将PAM这个产品的除出排名，直接并入Other分类。但由于PAM还是有续保保费，因此它每个月的保费量也并不是固定的，虽然我可以使用<code>IF</code>函数将<code>PAM</code>的排名直接设定为<code>999</code>，但我们依然需要一个可以动态将已有数字从小到大排列的方法，否则会出现的问题是假设<code>PAM</code>实际排名是<code>6</code>，但它被公式设定为排名<code>999</code>，这会导致手动输入的<code>6</code>后面将没有可以引用的数据，我们需要自动将上方排列设置为4,5,7来跳过排名为<code>6</code>的<code>PAM</code>。</p>
<p>我想到的办法是SMALL公式：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220220153736776.png" alt="=SMALL($AA$103,ROW(A2)/2)"></p>
<blockquote>
<p>=SMALL($A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>A$103,ROW(A2)/2)</p>
</blockquote>
<p>该公式可用参数为<code>SMALL(array,k)</code>，其作用既是返回该数据中第<code>K</code>个最小值，同理的还有<code>LARGE</code>函数。</p>
<p>在这里的使用方法既是展示<code>在数据处理区中出现的排行数中排行第ROW(A2)/2的最小值</code>，使用<code>ROW(A2)</code>就可以使该<code>K</code>值随着公式的下拉而增加，<code>ROW(A2)</code>返回的是<code>A2</code>单元格的行数，也即<code>2</code>。该数值<code>/2</code>则可以使每个数值出现两次，以此匹配每个险种名显示两次以匹配NB和RN这两行数据，因为<code>A2</code>和<code>A3</code>两行的计算结果分别是<code>1</code>和<code>1.5</code>，都会被公式向下取整认定为<code>1</code>，同理如果希望数值重复<code>N</code>次，则<code>/N</code>即可实现，注意不要让商小于<code>1</code>。</p>
<h3 id="IF公式的数组应用">IF公式的数组应用</h3>
<p>最后的一个展示要求是将Other分类中，也即保费排名未在前八位但本年有保费收入的产品名备注出来:</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220220170737896.png" alt="=CONCAT(&quot;*The Other Products contains &quot;,IF(($QQAAAABB$103,3)&amp;&quot;, &quot;,&quot;&quot;))"></p>
<blockquote>
<p>=CONCAT(“*The Other Products contains “,IF(($Q<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>Q<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>103</mn><mo>&lt;</mo><mo>&gt;</mo><mn>0</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">103&lt;&gt;0)*(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">103</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>103</mn><mo>&gt;</mo><mi>M</mi><mi>A</mi><mi>X</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">103&gt;MAX(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">103</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">(</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">6:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>21</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>L</mi><mi>E</mi><mi>F</mi><mi>T</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">21)),LEFT(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">21</span><span class="mclose">))</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.13889em;">EFT</span><span class="mopen">(</span></span></span></span>B<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>B$103,3)&amp;”, “,””))</p>
</blockquote>
<p>这个公式中的主要知识点便是<strong>IF公式的数组应用</strong></p>
<blockquote>
<p>IF(($Q<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>Q<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>103</mn><mo>&lt;</mo><mo>&gt;</mo><mn>0</mn><mo stretchy="false">)</mo><mo>∗</mo><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">103&lt;&gt;0)*(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">103</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&lt;&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>103</mn><mo>&gt;</mo><mi>M</mi><mi>A</mi><mi>X</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">103&gt;MAX(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6835em;vertical-align:-0.0391em;"></span><span class="mord">103</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">(</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>6</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">6:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">6</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>21</mn><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo separator="true">,</mo><mi>L</mi><mi>E</mi><mi>F</mi><mi>T</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">21)),LEFT(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">21</span><span class="mclose">))</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.13889em;">EFT</span><span class="mopen">(</span></span></span></span>B<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>30</mn><mo>:</mo></mrow><annotation encoding="application/x-tex">30:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">30</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span></span></span></span>B$103,3)&amp;“, “,””)</p>
</blockquote>
<p>该公式的<code>重点</code>，也是<mark class="hl-label red">难点</mark> ，便是条件语句部分的<code>($Q$30:$Q$103&lt;&gt;0)*($A$30:$A$103&gt;MAX($A$6:$A$21))</code>,此处的乘法操作是为了筛选出该范围中同时满足两个条件的行数，因为Excel中所有<code>1等价于TRUE，0等价于FALSE</code>，因此此时两个判断语句的结果每行相乘，只有两个判断均为<code>TRUE</code>时，产生的结果才是<code>TRUE</code>。（0乘0或0乘1都是0这个很好理解吧）这时<code>IF</code>函数返回的数组既是所有同时满足这两个条件的行(两个1相乘才返回1)，即当年总保费不为0且排名大于展示区所有排名的产品代码。最后用<code>CONCAT</code>函数便可以将数组返回的数据组合在一个单元格中。</p>
<h1>最后</h1>
<p>这个看似简单的数据工具却花了我将近一天的时间设计调整，其中的公式都是我自己根据自己的知识储备自己琢磨出来的，因此很难说参考了哪些资料，如果一定要说的话大概就是<code>Michael Alexander</code>的<code>Excel 2019 Bible</code>吧，当年入坑Excel的参考书就这一本，但也非常足够了。</p>
<p>该工具的一个副本放在这里,有兴趣可以看看：<a href="/attachment/Product_ranking.xlsx">下载链接</a></p>
<p>[第3篇]</p>
]]></content>
      <categories>
        <category>MS Office</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Excel</tag>
      </tags>
  </entry>
  <entry>
    <title>[编程算法] 公司项目需要的自动化测试Selenium文档解读</title>
    <url>/2022/02/21/4-Selenium_documentation_learning/</url>
    <content><![CDATA[<h1>序言</h1>
<p>基于刚进公司时接手的一个<code>自然语言处理</code>+<code>自动化测试</code>的项目，这篇文章我会主要覆盖Python的Selenium包的文档解读，由于在HKU时的毕业项目便涉及各种在线论坛的评论爬取，我对Selenium并不算陌生，但由于Selenium的内容功能是比较多的，本篇除了一些基础知识以外，我会重点关注与公司项目有关的部分。</p>
<h1>正文</h1>
<h2 id="背景介绍">背景介绍</h2>
<p>刚进公司的时候接手了一个前人的<code>自然语言处理</code>+<code>自动测试</code>项目。因为现在公司有一个由集团设定报价逻辑的报价系统，通常来说由代理或核保人员输入客户的相关资料便可以完成报价，但这个系统报价汽车险时要输入的资料非常繁琐，导致代理不愿意使用这个系统报价，影响报价率。考虑到这个系统中很多资料是没有意义的，因此前人建议代理直接填写车型排量司机年龄等必要资料，并用Python做了一个自动报价工具。</p>
<p>这个工具由两个大部分组成，第一个部分是自然语言处理，即使用<code>Cosine Similarity</code>算法将代理输入的车型信息与公司系统中的车型信息匹配，有机会我会再写一篇文章讲讲这部分。第二部分则是自动化测试，使用匹配到的车型信息利用Selenium自动填写资料并返回报价。前人对第一个部分的完成度是比较高的，因此我只是对代码<code>规范性</code>和<code>循环逻辑</code>稍作调整便可以获得较好的<code>文本匹配和稳定性</code>。但第二个部分他的测试显然是不够的（毕竟是未完成的项目），网站中有非常多的特殊情况例如某些资料未填写时其他资料将不会显示，司机年龄和驾龄都很小时会直接弹出错误信息不予报价，有时网站弹窗提示时需要先将该弹窗关闭才能继续操作等等。</p>
<p><strong>但由于代码本身涉及公司内部报价网站的架构，我<code>不会</code>在这里分享具体的代码或逻辑，因此本篇我会分享一些我在解决这些问题时通过<a href="https://selenium-python.readthedocs.io/index.html" title="Selenium with Python">Selenium with Python</a>学习到的知识。</strong></p>
<h2 id="Selenium文档解读">Selenium文档解读</h2>
<p>在开始之前，我想先通过<a href="https://stackoverflow.com/questions/54459701/what-is-selenium-and-what-is-webdriver" title="What is selenium and what is webdriver">这个问题</a>下大佬们的回答介绍一下<code>Selenium</code>和<code>Webdriver</code>是什么。<code>Selenium</code>是一个适用于各种浏览器和平台的网页应用的<code>自动测试套装</code>，各个主要的浏览器提供商都已将<code>Selenium</code>作为其浏览器内部部分进行支持，而我使用的则是<code>Selenium</code>为<code>Python</code>接入提供的一个包。而<code>Webdriver</code>则顾名思义是一个连接你的脚本和浏览器的一个程序，其通过在浏览器中注入<code>Javascript</code>的方式来控制浏览器行为，你可以想象你通过你的Python脚本告诉这个<code>“司机”(driver)</code>如何开这个<code>&quot;车&quot;(browser)</code>。</p>
<h3 id="基本约定">基本约定</h3>
<p>在介绍具体的函数之前，首先介绍一下Selenium API的一个基本约定。Selenium API 有一些属性(Attribute)是可调用的(即方式methods)，有一些属性是不可调用的(即特性properties)，所有可调用的属性都以圆括号结尾。如下例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">driver.current_url <span class="comment">#这是一个property,是一个值。具体来说是&quot;现在这个页面的URL&quot;。</span></span><br><span class="line">driver.close()<span class="comment">#这是一个method，是一个动作。具体来说是&quot;关闭当前窗口&quot;。</span></span><br></pre></td></tr></table></figure>
<h3 id="打开网页">打开网页</h3>
<p>举例来说，当使用<code>webdriver.Chrome()</code>将<code>Chrome driver</code>设定为<code>实例(instance)</code>并将该实例赋值给<code>driver</code>时，使用<code>driver.get(“xx网址URL”)</code>，浏览器便会被打开并导航至该指定网址，需要注意的是<code>Webdriver</code>会等到网页完全加载完毕之后才将控制权返回你的脚本，也就是说在这个阶段你通常不用担心你的程序会急着在没有加载出来的网页中操作或找寻你要的东西，但如果网页使用了大量的<code>AJAX(Asynchronous JavaScript And XML</code>, 用于直接在已加载的网页中读取网络服务器数据)，那么driver可能无法判断网页是否完全加载，如果要确保网页完全加载可能需要使用selenium的<a href="#%E7%AD%89%E5%BE%85%E5%8A%A0%E8%BD%BD(Waits)">waits</a>函数。</p>
<h3 id="定位元素">定位元素</h3>
<p>当我们进入了想要测试的网页之后，首先要解决的问题就是如何让driver找到你想要互动的元素，Selenium提供的方式非常丰富，包括<code>id, name, Xpath, link text, partial link text, tag name, class name甚至css selector</code>。</p>
<h4 id="举例说明">举例说明</h4>
<p>举例来说，如果我们有一个如下的网页：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;loginForm&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;continue&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Login&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;continue&quot;</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Clear&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span> Are you sure you want to do this?<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;continue.html&quot;</span>&gt;</span>Continue<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;cancel.html&quot;</span>&gt;</span>Cancel<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>那么你可以分别通过下面这些方式定位你想要的各个元素：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">login_form = driver.find_element_by_id(<span class="string">&#x27;loginForm&#x27;</span>) <span class="comment"># 通过id定位到表格</span></span><br><span class="line">username = driver.find_element_by_name(<span class="string">&#x27;username&#x27;</span>) <span class="comment"># 获得第一个name是“username”的元素</span></span><br><span class="line">username = driver.find_element_by_xpath(<span class="string">&quot;//form[input/@name=&#x27;username&#x27;]&quot;</span>) <span class="comment"># 第一个有子input元素名字是&#x27;username&#x27;的表格中的这个input元素</span></span><br><span class="line">continue_link = driver.find_element_by_link_text(<span class="string">&#x27;Continue&#x27;</span>) <span class="comment"># 第一个描述是&#x27;Continue&#x27;的链接</span></span><br><span class="line">continue_link = driver.find_element_by_partial_link_text(<span class="string">&#x27;Conti&#x27;</span>) <span class="comment"># 第一个描述包含&#x27;Conti&#x27;的链接</span></span><br><span class="line">p_element = driver.find_element_by_tag_name(<span class="string">&#x27;p&#x27;</span>) <span class="comment"># 第一个tag是p的元素</span></span><br><span class="line">content = driver.find_element_by_class_name(<span class="string">&#x27;content&#x27;</span>) <span class="comment"># 第一个class名是&#x27;content&#x27;的元素</span></span><br><span class="line">content = find_element_by_css_selector(<span class="string">&#x27;p.content&#x27;</span>) <span class="comment"># 第一个css selector符合给定条件的元素</span></span><br></pre></td></tr></table></figure>
<p>上面这些<code>find_element_by_*</code>的方式都只能用于找到页面中<code>第一个</code>出现的<code>符合条件</code>的元素，而如果把方式换成相应的<code>find_elements_by_*</code>那么它将以list的形式返回页面中符合条件的所有元素(但<strong>注意<mark class="hl-label red">没有</mark>  <code>find_elements_by_id</code></strong>, 因为一个html文件中<code>id只能是唯一</code>的)。</p>
<p>另外除了以上这些<code>public methods</code>以外，<code>Selenium</code>还提供了两个<code>private methods</code>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">driver.find_element(By.XPATH, <span class="string">&#x27;//button[text()=&quot;Some text&quot;]&#x27;</span>)</span><br><span class="line">driver.find_elements(By.XPATH, <span class="string">&#x27;//button&#x27;</span>)</span><br><span class="line"><span class="comment">## 除了By.XPATH外，像private methods也同样有By.ID, By.LINK_TEXT, By.PARTIAL_LINK_TEXT, By.NAME, By.TAG_NAME, By.CLASS_NAME, By.SELECTOR这些参数可以选择。</span></span><br></pre></td></tr></table></figure>
<p>需要注意的是，这两种方式并没有本质区别，因为<code>find_element_by_*</code>就是以<code>find_element</code>定义的，<a href="https://stackoverflow.com/questions/51035651/difference-between-public-and-private-selector-methods" title="Difference Between Public and Private Selector Methods">参考这里</a>：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find_element_by_xpath</span>(<span class="params">self, xpath</span>):</span><br><span class="line">    <span class="keyword">return</span> self.find_element(by=By.XPATH, value=xpath)</span><br></pre></td></tr></table></figure>
<h4 id="更多关于XPath">更多关于XPath</h4>
<p>XPath通常来说是用得最多的定位元素的方式。XPath本身是一个专门用来定位XML文件中<code>节点(nodes)</code>的语言，由于<code>HTML</code>也可以由<code>XML</code>实现(<code>XHTML</code>), 这也使得Selenium用户可以用这个强大的语言来定位网页元素。XPath之所以用得比较多是因为理论上它可以定位到网页中的任何一个元素，无论它有没有被用<code>id</code>或<code>name</code>定义过。</p>
<p>XPath在selenium中使用也可以有两种方式，<code>绝对引用</code>或<code>相对引用</code>：</p>
<ul>
<li><code>绝对引用(不推荐)</code>：绝对引用的路径是从<code>root(html)</code>层开始往后推，虽然绝对引用可能可以更精确定位到想要引用的元素，但它的缺点却在于网页文件的一点点变动都会导致引用不正确。</li>
<li><code>相对引用</code>：相对引用是定位目标元素到它附近的(最好是母元素)有<code>id</code>或<code>name</code>属性的元素的相对路径，虽然有几率错过真正想找的元素(比如有两个<code>name</code>相同的元素)，但引用相对页面变动也更加稳定。</li>
</ul>
<p>举例来说，在上面这个[网页][#举例说明]中,我们可以使用很多不同的XPath来定位同一个元素：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">login_form = driver.find_element_by_xpath(<span class="string">&quot;/html/body/form[1]&quot;</span>) <span class="comment"># 绝对引用定位form</span></span><br><span class="line">login_form = driver.find_element_by_xpath(<span class="string">&quot;//form[1]&quot;</span>) <span class="comment"># 文件中第一个form</span></span><br><span class="line">login_form = driver.find_element_by_xpath(<span class="string">&quot;//form[@id=&#x27;loginForm&#x27;]&quot;</span>) <span class="comment"># id是&quot;loginForm&quot;的form</span></span><br><span class="line">username = driver.find_element_by_xpath(<span class="string">&quot;//form[input/@name=&#x27;username&#x27;]&quot;</span>) <span class="comment"># 第一个form里面有name为“username”的input子元素</span></span><br><span class="line">username = driver.find_element_by_xpath(<span class="string">&quot;//form[@id=&#x27;loginForm&#x27;]/input[1]&quot;</span>) <span class="comment"># id是&quot;loginForm&quot;的form元素里的第一个input元素</span></span><br><span class="line">username = driver.find_element_by_xpath(<span class="string">&quot;//input[@name=&#x27;username&#x27;]&quot;</span>) <span class="comment"># 第一个name是&quot;username&quot;的input元素</span></span><br><span class="line">clear_button = driver.find_element_by_xpath(<span class="string">&quot;//input[@name=&#x27;continue&#x27;][@type=&#x27;button&#x27;]&quot;</span>) <span class="comment">#第一个name是&quot;continue&quot;且type是&quot;button&quot;的input元素</span></span><br></pre></td></tr></table></figure>
<p><a href="https://www.w3schools.com/xml/xpath_intro.asp" title="W3School XPath Tutorial">W3School</a>有更细致更全面的XPath有关的教程。</p>
<h3 id="等待加载-Waits">等待加载(Waits)</h3>
<p>自动测试项目中非常影响实际测试效果的一个因素就是这个部分了。Waits顾名思义就是让程序等待，Python的time包中有一个<code>sleep()</code>函数就可以做到这点，让程序暂停执行一段设定的时间。那么Selenium中的<code>·</code>有什么不同呢？<code>time.sleep()</code>是没有任何其他条件地让程序暂停一段时间，但Selenium中的<code>waits</code>却是令程序在某个条件被达成之前等一段设定的时间。换言之<code>一旦条件达成便立即执行</code>。Selenium有两种waits。</p>
<h4 id="显式等待-Explicit-waits">显式等待(Explicit waits)</h4>
<p>使用显示等待会让程序在<code>给定条件</code>出现以前等待一段时间，超过这段时间或达成条件才进行下一步操作。默认设定下，程序会每隔<code>500毫秒</code>判断一次条件是否达成。以这段代码为例：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">&quot;http://somedomain/url_that_delays_loading&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    element = WebDriverWait(driver, <span class="number">10</span>).until(</span><br><span class="line">        EC.presence_of_element_located((By.ID, <span class="string">&quot;myDynamicElement&quot;</span>))</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>
<p><code>expected_condition</code>是<code>selenium</code>预设的一些判断条件的函数，代码中的<code>EC.presence_of_element_located()</code>接受<code>locator</code>参数，而<code>locator</code>则是一个<code>(by, path)</code>的<code>元组(Tuple)</code>，这也是这里有两层括号的原因。当这个元素可以被定位后该函数会返回一个<code>true</code>(Boolean), 如果无法被定位这个函数则会返回<code>not null</code>。(<a href="https://www.selenium.dev/selenium/docs/api/py/_modules/selenium/webdriver/support/expected_conditions.html#visibility_of_element_located" title="Source code for selenium.webdriver.support.expected_conditions">参考这里</a>)</p>
<p><code>expected_condition</code>提供的预设好的网页条件还有以下这些：</p>
<ul>
<li>title_is</li>
<li>title_contains</li>
<li>presence_of_element_located</li>
<li>visibility_of_element_located</li>
<li>visibility_of</li>
<li>presence_of_all_elements_located</li>
<li>text_to_be_present_in_element</li>
<li>text_to_be_present_in_element_value</li>
<li>frame_to_be_available_and_switch_to_it</li>
<li>invisibility_of_element_located</li>
<li>element_to_be_clickable</li>
<li>staleness_of</li>
<li>element_to_be_selected</li>
<li>element_located_to_be_selected</li>
<li>element_selection_state_to_be</li>
<li>element_located_selection_state_to_be</li>
<li>alert_is_present</li>
</ul>
<p>如果这些预设好的条件无法满足你的需求，你还可以自己<code>定义等待条件</code>，参考<a href="https://selenium-python.readthedocs.io/waits.html" title="Selenium with Python (Waits)">文档</a>中的方法。</p>
<h5 id="一些容易有疑问的条件">一些容易有疑问的条件</h5>
<p>上面这些预设的等待条件中有几个<code>非常相似</code>的条件，我特别拎出来讲一讲他们的区别：</p>
<ul>
<li>presence_of_element_located：只要元素在文件物件模型(DOM)<code>出现</code>便会返回true。</li>
<li>visibility_of_element_located：元素在DOM中<code>出现并且高度和宽度大于0 (visible)</code> 才会返回true。</li>
<li>element_to_be_clickable：元素需要<code>出现，可见并且可以互动</code>才会返回true。</li>
</ul>
<p>显然越下面的条件比上面越加严苛，如果你想让你的脚本按一个<code>button</code>，那么比起它的出现或者可见，你更应该关心它是不是已经<code>可以被按</code>了。其他的条件的具体解释也都可以参考<a href="https://www.selenium.dev/selenium/docs/api/py/_modules/selenium/webdriver/support/expected_conditions.html#visibility_of_element_located" title="Source code for selenium.webdriver.support.expected_conditions">源代码</a>中的写法和注释。</p>
<h4 id="隐式等待-Implicit-waits">隐式等待(Implicit waits)</h4>
<p>隐式等待比显式等待在写代码的层面上更加简单，针对性也没有那么强。它只是让driver不能立马在DOM中定位到某项元素时，多等一段设定好的时间。隐式等待时间的默认设置为0，在一次<code>Webdriver</code>的使用中它只需要被<code>设定一次</code>。使用方式如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.implicitly_wait(<span class="number">10</span>) <span class="comment"># seconds</span></span><br><span class="line">driver.get(<span class="string">&quot;http://somedomain/url_that_delays_loading&quot;</span>)</span><br><span class="line">myDynamicElement = driver.find_element_by_id(<span class="string">&quot;myDynamicElement&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="操作元素">操作元素</h3>
<p>Selenium中可以用来操作元素的方式实在是太丰富了，我在这篇中只会提到我项目中会使用到的，也是最简单最基础的几个操作方法。</p>
<h4 id="点击元素">点击元素</h4>
<p>非常直观，在你找到的元素后面调用<code>.click()</code>方式，便可以让driver尝试点击这个元素。</p>
<h4 id="填写输入">填写输入</h4>
<p>当你定位到一个可以<code>input</code>的元素之后，可以使用<code>send_keys(&quot;whatevertext&quot;)</code>来将<code>引号</code>中的内容填入<code>Input元素</code>中。需要注意的一点是，<code>send_keys()</code>也可以发送其他如<code>回车(Keys.ENTER)</code>,<code>空格(Keys.SPACE)</code>等键盘上的功能键的指令 ,因此这个函数可以在任何元素上被调用。另外在文本框中文字不会将已有的文字清除，如果文本框中已经有文字，<code>send_keys()</code>只会在已有文字的后面附上新加的文字。因此通常使用此函数在文本框中输入文字时建议先使用<code>.clear()</code>将文字清除。</p>
<h4 id="选择表单">选择表单</h4>
<p>Selenium使用户可以获取下拉表单的选项数据，并且使用<code>setSelected</code>来选中特定<code>OPTION标签</code>的元素。可用的选中方式如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</span><br><span class="line">select = Select(driver.find_element_by_name(<span class="string">&#x27;name&#x27;</span>)) <span class="comment"># 选中第一个name为&quot;name&quot;的元素</span></span><br><span class="line">select.select_by_index(index) <span class="comment"># 按序号(index)选中表单选项</span></span><br><span class="line">select.select_by_visible_text(<span class="string">&quot;text&quot;</span>) <span class="comment"># 按可见文字选中</span></span><br><span class="line">select.select_by_value(value) <span class="comment"># 按选项值选中</span></span><br></pre></td></tr></table></figure>
<p>其中<code>select_by_visible_text(&quot;text&quot;)</code>和<code>select_by_value(value)</code>的区别在于，想要选中给定的<code>&lt;option value=&quot;foo&quot;&gt;Bar&lt;/option&gt;</code>这个选项，需要使用<code>select_by_visible_text(&quot;Bar&quot;)</code>或者<code>select_by_value(&quot;foo&quot;)</code>。</p>
<p>另外，Select类中还有一些非常有用的公式如：</p>
<ul>
<li><code>all_selected_option</code>: 用于返回一个select标签下的所有已选项的list。</li>
<li><code>deselect_all()</code> : 清除所有已选项（仅对支持多选的元素有效）。</li>
<li><code>options</code>: 返回表单中所有可选项。</li>
</ul>
<h4 id="获取文字">获取文字</h4>
<p>要从网页中爬取文字就一定要用到元素的<code>text</code>属性，该属性即可返回元素中的文字。</p>
<h2 id="Chrome开发者工具">Chrome开发者工具</h2>
<p>虽然现在其实我对网页和网络的运作方式还处于一团迷雾的状态，但因为要爬取网页元素，也算是小小接触了<code>Chrome</code>中<code>按F12</code>就可以打开的<code>开发者工具</code>，要写关于网页的脚本这个界面是一定绕不开的。下面我会介绍两个我作为萌新<code>自己乱点摸索出来的</code>对爬虫或自动测试非常有用的两个功能。<strong>因为是自己摸索，所以很有可能走了弯路都不自知。如果有更好的方法，或者完整的玩转F12的指南手册，还希望各位大佬在评论区不吝赐教。</strong></p>
<h3 id="在网页文件中定位元素">在网页文件中定位元素</h3>
<p>刚刚接触开发者工具的时候完全不知道如何在花里胡哨的html文件中找到网页中的某个元素，只知道在body里面一个一个往下找，对应着页面上的高亮一点一点往里点，后来才知道原来用Chrome的<code>这个功能</code>就可以快速定位到元素在html文件中的位置，非常方便。这是全世界都知道所以才没有被任何教程提及吗？</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220224195103131.png" alt="按下这个“定位”按钮再点想找的元素就可以定位到该元素在html中的位置"></p>
<h3 id="得到元素的XPath">得到元素的XPath</h3>
<p>同样也是一个大概所有人都知道(所以没有在任何教程里见到提及)，但我是自己玩了老半天才偶然发现的功能。原来在开发者工具中右键点击元素，找到<code>复制→复制XPath</code>就可以直接得到这个元素相对路径的XPath，不确定Chrome的算法是怎样，但似乎这个复制XPath是在尽量选择<code>不会导致ambiguity</code>的方式引用。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220224195027232.png" alt="对元素点击右键，然后依次按复制→复制XPath"></p>
<h1>最后</h1>
<p>因为这个项目的机会，我对网页自动测试甚至是爬取网页的经验又增加了不少（当然我知道一般爬取网页的首选项肯定是<code>BeautifulSoup</code>，毕竟不经过浏览器互动的爬取会稳定不少，但现如今大部分的网页不用浏览器互动已经啥都爬不到了）。另外之后有时间我会再把项目前半部分关于<code>Cosine Similarity</code>文本相似度匹配的部分整理好再发一篇。</p>
<p>[第4篇]</p>
]]></content>
      <categories>
        <category>编程算法</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Python</tag>
        <tag>Selenium</tag>
      </tags>
  </entry>
  <entry>
    <title>[编程算法] 到底什么是“面向对象编程(OOP)”</title>
    <url>/2022/02/23/5-What_is_object_oriented_programming/</url>
    <content><![CDATA[<h1>序言</h1>
<p>本篇介绍了对“程序员”来说很可能是第一个难点ever，但又绝不能不知道的<code>面向对象编程(Object Oriented Programming)</code>和<code>面向过程编程(Procedural Oriented Programming)</code>，由于我自己本科学的是金融数学，二硕学个计算机吧又是金融计算方向(选课偏向<code>数据分析</code>而非<code>软件开发</code>)，因此基本上在编程的时候使用的都只是简单易懂的<code>“面向过程编程”</code>的方法，因此本篇我就要好好研究一下到底什么叫<code>“面向对象编程”</code>。</p>
<h1>正文</h1>
<h2 id="背景介绍-2">背景介绍</h2>
<p>在写上一篇博文的时候，我把<a href="https://selenium-python.readthedocs.io/index.html" title="SeleniumwithPython">Selenium with Python</a>的文档看了一遍，看着看着忽然觉得有些吃力，这才想起来我有一个东西一直都是半懂不懂，那就是传说中所谓的<code>面向对象编程(Object Oriented Programming)</code>和<code>面向过程编程(Procedural Oriented Programming)</code>。这导致我在看别人代码的时候总是没有那种融汇贯通心领神会的感觉，作为“<code>1/4”</code>个计算机<code>“科班出生”</code>的<code>“1/4程序员”</code>这怎么行？所以我今天就要把这个东西彻底啃透。</p>
<h2 id="概述">概述</h2>
<p>根据这篇<a href="https://zhuanlan.zhihu.com/p/75265007" title="2分钟让你明白什么是面向对象编程">知乎文章</a>的解释，<code>面向过程</code>与<code>面向对象</code>这两种编程方式拥有各自的优缺点。通俗一点解释就是**：**</p>
<ul>
<li>
<p><strong>面向过程：</strong> 顾名思义，编程方式注重过程。在解决一个问题的时候这种编程方式需要把解决方式拆分成一个个过程，按照一定的顺序执行完这些方法(methods)，方法执行完问题就解决了。</p>
</li>
<li>
<p>**面向对象：**同样名字就已经非常清晰了，注重的是程序互动的对象。解决问题的时候面向对象编程是将事物抽象成对象，那问题里可能涉及的事物都定义成一个程序对象，然后给这个对象赋上一些<code>属性(Properties)</code>和<code>方法(methods)</code>。让各个对象去执行自己的方法以此来解决问题。</p>
</li>
</ul>
<h3 id="举例说明-2">举例说明</h3>
<p>我引用<a href="https://zhuanlan.zhihu.com/p/75265007" title="2分钟让你明白什么是面向对象编程">呜呜轩轩</a>提到的我觉得对于我的理解起到重要帮助的两个例子，分别是洗衣服和做饭。</p>
<h4 id="洗衣服">洗衣服</h4>
<p>假设有一个问题：要用洗衣机洗干净脏衣服，如何执行？</p>
<p><strong><code>面向过程</code>的解决方法</strong>：</p>
<ol>
<li>执行加洗衣粉的方法；</li>
<li>执行加水的方法；</li>
<li>执行洗衣服的方法；</li>
<li>执行清洗的方法；</li>
<li>执行烘干的方法；</li>
</ol>
<p>将解决过程拆分成一个个方法，不用调用对象，通过执行一个个方法来解决问题。</p>
<p><strong><code>面向对象</code>的解决方法：</strong></p>
<ol>
<li>先抽象出两个对象，分别是<code>洗衣机</code>和<code>人</code></li>
<li>针对对象<code>洗衣机</code>加入一些属性和方法：“洗衣服方法”，”清洗方法“，”烘干方法“</li>
<li>针对对象<code>人</code>加入一些属性和方法：“加洗衣粉方法”，“加水方法”</li>
<li>然后执行：<code>人.加洗衣粉→人.加水→洗衣机.洗衣服→洗衣机.清洗→洗衣机.烘干</code></li>
</ol>
<p>同一个问题，面向对象编程需要先定义对象然后靠对象执行方法的方式解决问题。</p>
<h4 id="做饭">做饭</h4>
<p>呜呜轩轩引用了@十四期_李光的说法，分别将<code>面向过程编程</code>和<code>面向对象编程</code>比喻成<code>蛋炒饭</code>和<code>盖浇饭</code>。以此来说明两种方法的优缺点：</p>
<ul>
<li><code>面向过程编程就像蛋炒饭</code>，食材和饭交融在一起，难以分开，其味道可能均匀易于入口，但一旦做好就很难再改变。</li>
<li><code>面向对象编程就像盖浇饭</code>，食材和饭是分开的，食客在同时能享受到食材和饭的同时，如果想要换一个口味也只需要将不同的菜与之前的饭放在一起就可以了。</li>
</ul>
<p>回到现实，这两种方法各自的优缺点就是：</p>
<ul>
<li>面向过程编程性能高于面向对象编程，缺点是不易维护，难以扩展，难以复用。适合需要性能优先的场景。</li>
<li>面向对象编程就是相反了，性能略低但易维护易扩展，结构更加灵活。适合大而复杂的软件开发。</li>
</ul>
<p>这两个例子一个让人了解这两种方法在表达形式上的区别，一个让人了解各自的优缺点，我觉得非常方便概念比较模糊的人理解。</p>
<h2 id="面向对象编程">面向对象编程</h2>
<p>我个人觉得<code>面向过程编程</code>是非常<code>straightforward</code>的，所以除了两者的对比以外，我不打算细说面向过程编程。那在这一节我就还是用我从网上学到的内容(主要还是<a href="https://zhuanlan.zhihu.com/p/75265007" title="2分钟让你明白什么是面向对象编程">呜呜轩轩</a>和<a href="https://www.udacity.com/blog/2021/11/__init__-in-python-an-overview.html" title="__init__ in Python: An Overview">Alexey</a>)现学现卖，详细讲讲面向对象编程的三大特征和五大原则，以及其实际的实现方法等。</p>
<h3 id="三大基本特征">三大基本特征</h3>
<p>**封装(Encapsulation)：**把客观事物封装成抽象的<code>类(Class)</code>，而类可以把自己的<code>属性(Property)</code>和<code>方法(methods)</code>只让可信的类或者对象操作，对不可信的进行信息隐藏(public和private)。一个类就是一个封装了数据以及操作这些数据的代码的逻辑实体。</p>
<p>**继承(Inheritance)：**让某个类型的对象获得另一个类型对象的属性的方法。继承使新类可以使用现有类的所有功能，并在无需重新编写原来的类的情况下对这些功能进行扩展，通过继承创建的新类称为<code>“子类(Subclass)”</code>或<code>“派生类(Derived class)”</code>，被继承的类称为<code>“基类(Base class)”</code>，<code>“父类(Parent class)”</code>或<code>“超类(Super class)”</code>。继承的过程就是从<code>一般(generalized)</code>到<code>特殊(specialized)</code>的过程。要实现继承，可以通过<code>“继承(Inheritance)”</code>和<code>“组合(Composition)”</code>来实现。继承概念的实现方式有两类：<code>实现继承(Implementation inheritance)</code>与<code>接口继承(Interface inheritance)</code>。前者指直接使用父类的属性和方法而无需额外编码的能力；后者则是指仅使用属性和方法的名称，但子类必须提供实现的能力。</p>
<p>**多态(Polymorphism)：**指一个类实例的相同方法在不同情形有不同表现形式。多态机制使具有不同内部结构的对象可以共享相同的外部接口。这意味着虽然针对不同对象的具体操作不同，但通过一个公共的类，它们可以通过相同的方式予以调用。</p>
<h3 id="五大基本原则">五大基本原则</h3>
<p>**单一职责原则SRP(Single Responsibility Principle)：**指一个类的功能要单一，不能混杂什么都有。</p>
<p>**开放封闭原则OCP(Open－Close Principle)：**一个模块在扩展性方面应该是开放的，而在更改性方面应该是封闭的。比如：一个网络模块，原来只有服务端功能，在现在要加入客户端功能，那么就应该在不用修改已有功能代码的前提下就能增加客户端的实现代码，这要求在设计之初就将两个部分分开，将公共部分抽象出来。</p>
<p>**里式替换原则LSP(the Liskov Substitution Principle LSP)：**子类应当可以替换父类并出现在父类能出现的任何地方。</p>
<p>**依赖倒置原则DIP(the Dependency Inversion Principle DIP)：**程序要依赖于抽象接口而不能依赖于具体实现。假设B是较A低的模块，但B需要使用到A的功能，这个时候，B不应当直接使用A中的具体类，因为如果这样做的话任何一个下层模块的变动都会导致上层必须要被相应更改。正确做法应当由B定义一个抽象接口，并由A来实现这个抽象接口，B只使用这个抽象接口：这样就达到了依赖倒置的目的，B也解除了对A的依赖，反过来是A依赖于B定义的抽象接口。</p>
<p>**接口分离原则ISP(the Interface Segregation Principle ISP)：**模块间要通过抽象接口隔离开，而不是通过具体的类强耦合起来。</p>
<h3 id="Python中的面向对象编程">Python中的面向对象编程</h3>
<h4 id="Python中的类-Class">Python中的类(Class)</h4>
<p>一个<code>类(Class)</code>会定义所有以它创建的对象，你甚至可以把类想象成一个对象工厂。举例来说，假设你有一只<code>牛头梗</code>，从<code>面向对象编程</code>的角度来看，一个<code>狗</code>的类中可能包含狗的一些特征，比如他的品种，眼色等。由于牛头梗是一只狗，那么我们就可以创建一个继承<code>狗</code>这个<code>类</code>特征的对象来定义牛头梗。<code>类</code>使用<code>方法函数(methods)</code>和<code>构造函数(constructors)</code>来创建并定义<code>对象(Objects)</code>。</p>
<h4 id="用户定义的方法-user-defined-methods-和特殊方法-special-methods">用户定义的方法(user-defined methods)和特殊方法(special methods)</h4>
<p><code>方法(methods)</code>是类中用以执行特殊任务的函数，Python将方法分成程序员编写的<code>用户定义方法(user-defined method)</code>和语言中自带的<code>特殊方法(special method)</code>。比如一个叫<code>狗</code>的<code>类</code>中可能有一个方法叫做<code>walk()</code>来供<code>狗</code>的对象调用，程序员编写这个方法来执行特殊的动作。</p>
<p>而<code>特殊方法</code>则被<code>双下划线(__)</code>包围的名字定义，比如说<code>__init__</code>。Python用这些特殊方法来加强类的功能性，其大多在后台工作并会在程序需要的时候被自动调用。程序员不能直接调用这些方法。举例来说，当你创建一个新的对象的时候，Python会自动调用<code>__new__</code>方法，而这又会调用<code>__init__</code>方法。</p>
<h4 id="构造函数-constructor">构造函数(constructor)</h4>
<p>构造函数是程序在创建对象时会调用的特殊方法，其在类中是被用来初始化对象数据的。以<code>狗</code>这个类举例，我们可以用这个类的构造函数去给每一个<code>牛头梗</code>对象特征赋值，<code>__init__</code>就是Python的构造函数。</p>
<h4 id="用代码来解释">用代码来解释</h4>
<p>我们首先创建一个类，并且在这个类中定义一个<code>__init__</code>方法，而这个方法则初始化两个<code>属性(attribute)</code>:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:                   </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,dogBreed,dogEyeColor</span>):</span><br><span class="line">  </span><br><span class="line">    self.breed = dogBreed       </span><br><span class="line">    self.eyeColor = dogEyeColor...</span><br></pre></td></tr></table></figure>
<p>这时我们已经有了一个<code>类</code>了，接下来我们以这个类创建<code>对象</code>，并且将<code>类</code>中的<code>属性</code>传递给这个<code>对象</code>。这时候我们就需要<mark class="hl-label red">self</mark> 这个magic word来将对象的属性绑定在其接收到的参数上。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">...Tomita = Dog(<span class="string">&quot;Fox Terrier&quot;</span>,<span class="string">&quot;brown&quot;</span>)...</span><br></pre></td></tr></table></figure>
<p>在上面这行代码中，我们创建了一个叫做<code>Tomita</code>的对象(这是这只狗的名字)，然后我们首先声明定义这个对象的类的名字(<code>Dog</code>)，然后将在<code>Dog类</code>的<code>__init__</code>中设定的两个属性分别设定为<code>Fox Terrier</code>和<code>brown</code>。然后<code>__init__</code>用<code>self</code>来将这两个以参数传回的值赋给对象的属性<code>self.breed</code>和<code>self.eteColor</code>。</p>
<p>然后要访问我们创建的对象的属性，我们只需要在对象名后用<code>.</code>接上相应的属性名，就可以访问这个对象的这个属性的值，例如：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">...<span class="built_in">print</span>(<span class="string">&quot;This dog is a&quot;</span>,tomita.breed,<span class="string">&quot;and its eyes are&quot;</span>,tomita.eyeColor)</span><br></pre></td></tr></table></figure>
<p>我们运行上面这段代码会得到这样的结果：</p>
<blockquote>
<p>This dog is a Fox Terrier and its eyes are brown</p>
</blockquote>
<p>Python中的构造函数也可以不输入参数，可以使用默认参数设定。如果一个构造函数不是必须输入参数的话，这个构造函数就叫<code>默认构造函数(default constructor)</code>。比如上面的<code>Dog类</code>如果写成默认构造函数形式：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:                </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, dogBreed=<span class="string">&quot;German Shepherd&quot;</span>,dogEyeColor=<span class="string">&quot;Brown&quot;</span></span>): </span><br><span class="line">  </span><br><span class="line">    self.breed = dogBreed   </span><br><span class="line">    self.eyeColor = dogEyeColor</span><br></pre></td></tr></table></figure>
<p>可以注意到<code>__init__</code>中规定了两个参数的默认值<code>dogBreed</code>为<code>German Shepherd</code>而<code>dogEyeColor</code>为<code>Brown</code>，这时如果我们以<code>tomita = Dog()</code>这样不传递任何参数的方式创建对象，那么这个对象的属性就会被设定成默认的<code>German Shepherd</code>和<code>Brown</code>。</p>
<h1>最后</h1>
<p>通过这篇文章，我们首先理清楚了<code>面向过程编程</code>和<code>面向对象编程</code>二者的关系以及各自的利弊，前半部分实际适用于所有的编程语言，之后我们重点关注Python中面向对象编程的方式，并举例来说明一些比较难以理解的参数和设定(比如<code>__init__</code>和<code>slef</code>等)，搞懂了这些基础知识终于可以看懂一些大佬的代码到底在干什么了。</p>
<p>[第5篇]</p>
]]></content>
      <categories>
        <category>编程算法</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>[MS Office] 分割MS Access数据库为前端和后端</title>
    <url>/2022/02/25/6-MSAccess_database_split/</url>
    <content><![CDATA[<h1>序言</h1>
<p>这篇文章会介绍<code>Access</code>的一些<code>基本知识</code>以及我在工作中通过<code>分割Access数据库为前后端</code>，从而帮助其他团队<code>提高工作效率</code>的方法。由于Access本身对数据库分割就有专门的功能支持，所以整个过程是<code>非常简单</code>的，在这里我只是介绍一下<code>流程</code>和<code>需要注意的点</code>。</p>
<h1>正文</h1>
<h2 id="背景介绍-3">背景介绍</h2>
<p>这篇文章其实源于我帮隔壁客户服务团队的一个小忙，他们团队有一个十人左右使用的小Access数据库来同步更新并记录客户电话来的一些信息，由于客户服务的<code>时效性</code>非常重要(<code>1.客户提供的信息最好马上能被其他同事访问 2.访问信息本身不应该花太多时间</code>)，但他们之前的操作是将一整个大概600M左右的数据库摆在共享文件夹中，每个同事要访问或修改数据信息时就<code>直接打开数据库</code>访问，如果有其他人正在访问那就只能等他们关闭后才能继续访问，而我们共享文件夹的服务器(我估计,因为全球同事都能访问特定共享文件夹)并不在香港本地，如果不是在澳大利亚至少也是在新加坡的地区办公室附近。因为本身在这么远的服务器上传输600M的文件就已经非常慢了，同时还不能保证文件的可用性，这导致他们之前做这部分工作几乎是非常困难的。</p>
<p>一次会议中我介绍我的另一个VBA自动工具之后(希望之后也有机会可以说一说这个)，他们的老板就问我可不可以解决他们的这个问题，我稍微查了一下资料就找到了这个MS Access支持的<code>分割数据库(split database)</code>的方法，现在看来应该是完美解决了他们的所有问题。</p>
<h2 id="Access基本知识">Access基本知识</h2>
<p>开始分割数据库前先复习一下MS Access的一些<a href="https://support.microsoft.com/en-us/office/database-basics-a849ac16-07c7-4a31-9948-3c8c94a7c204" title="Microsoft Access database Intro">基本知识</a>：</p>
<p>数据库是用来收集和管理信息的工具。本来信息也都可以储存在一般的列表或者电子表格中，但随着数据规模不断变大，用列表或表格管理的数据可能会出现各种各样的混乱且不利于提取需要的信息。如果数据达到了这种规模，普通的方式就已经不适用于这些数据的管理，这也是像Access这样的<code>数据管理系统(DBMS)</code>出现的原因。</p>
<p>一个数据库文件中可能有多种<code>对象(obJects)</code>，除了存储数据的<code>表(Table)</code>还有实现其他功能的<code>表单(Forms)</code>，<code>报表(Reports)</code>，<code>宏(Macros)</code>和<code>模块(Modules)</code>。这些对象在一个数据库文件中可能都不只有一个。创建格式在<code>Access 2007</code>之后的文件后缀为<code>.accdb</code>，在此之前的格式后缀都为<code>.mdb</code>，Access版本在2007之后的也可以用来创建<code>.mdb</code>格式的文件。</p>
<p>通过Access你可以实现这些功能：</p>
<ul>
<li>向数据库中添加新的数据</li>
<li>在数据库中编辑已有的数据</li>
<li>删除数据库中的数据</li>
<li>以不同的方式管理和查看数据</li>
<li>通过报表，邮件，内联网，互联网等方式将数据与他人共享</li>
</ul>
<h3 id="数据库物件">数据库物件</h3>
<h4 id="表-Tables">表(Tables)</h4>
<p>数据库的表看起来和电子表格一样，被用行列的形式存储，也因为这个好处，想要将电子表格数据导入数据库中是非常方便的。数据库表和电子表格的区别主要在与他们管理和储存数据的方式上。数据库表格中为了避免冗余，会将不同层面的信息分开为不同的表，比如一个电影票的数据库中可能有观影者信息，但每个观影者可能有多张电影票，这样如果每个电影票表中都存储同一个观影者信息就会导致冗余。这个过程被称为<code>标准化(normalization)</code>。</p>
<p>表中的每一行都是一条<code>记录(record)</code>,每一条记录都以不同<code>字段(fields)</code>的形式储存独立的信息，字段对应表中的列。比如有一条记录是关于某个观影者，那么字段可能包括他的姓，名，性别等。每一条记录代表了一个观影者在不同字段上的信息。</p>
<p>关于<code>表</code>的更多细节可以参考<a href="https://support.microsoft.com/en-us/office/introduction-to-tables-78ff21ea-2f76-4fb0-8af6-c318d1ee0ea7" title="Introduction to tables">这里</a>。</p>
<h4 id="表单-Forms">表单(Forms)</h4>
<p>表单是一个允许用户<code>输入</code>和<code>编辑数据</code>的用户界面。表单里面除了数据的展示，还会有一些带有<code>控制命令</code>的按钮。用户可以不使用表单而直接在表中<code>删增改</code>数据，但使用表单会让这个过程更加清晰方便。设计者可以通过<code>自定义命令按钮</code>来决定用户可以访问修改哪些数据，这也赋予了数据一定程度的安全性，来控制数据库使用者的权限。</p>
<p>关于表单的更多细节可以参考<a href="https://support.microsoft.com/en-us/office/introduction-to-forms-e8d47343-c937-44e8-a80f-b6a83a1fa3ae" title="Introduction to forms">这里</a>。</p>
<h4 id="报表-Reports">报表(Reports)</h4>
<p>报表是用户用来<code>整理总结</code>并<code>展示数据</code>的对象。一个报表的目的通常是某个具体的问题，比如“<code>我们今年在每部电影上的收入是多少</code>”等等，而报表可以让数据变得更加简单易读，用户可以通过报表得到这个设计好的问题在当前数据下的答案。</p>
<p>关于报表的更多细节可以参考<a href="https://support.microsoft.com/en-us/office/introduction-to-reports-in-access-e0869f59-7536-4d19-8e05-7158dcd3681c" title="Introduction to reports in Access">这里</a>。</p>
<h4 id="查询-Queries">查询(Queries)</h4>
<p>查询是所有数据库系统最核心的功能之一，它通过不同的函数<code>连接(JOIN)</code>不同数据库，<code>筛选(FILTER)</code>条件来获取数据库中符合特定条件的数据。查询通常有两种基本类型：<code>选择查询(select query)</code>和<code>动作查询(action query)</code>。前者可以用来获取数据，后者则是用来对数据进行特定操作，例如<code>增加新表，更新数据，删除数据</code>等。</p>
<p>关于查询的更多细节可以参考<a href="https://support.microsoft.com/en-us/office/introduction-to-queries-a9739a09-d3ff-4f36-8ac3-5760249fb65c" title="Introduction to queries">这里</a>。</p>
<h4 id="宏-Macros">宏(Macros)</h4>
<p>Access中的宏是一种用以给数据库<code>增加特定功能</code>的简单的<code>编程语言</code>。比如用户可以用宏编程一些可以完成提取特定数据或报表的按钮，用户点击按钮便会执行这些宏。这个主要用来将一些重复而复杂的人手工作自动化。</p>
<h4 id="模块-Modules">模块(Modules)</h4>
<p>与宏一样，模块是用来向数据库添加功能的对象。它们的区别在于宏中使用的方法是从宏操作列表中选择，而编写模块则是使用VBA编程语言进行编程。模块是作为一个单元存储在一起的<code>声明(declarations)</code>，<code>陈述(statements)</code>，和<code>过程(procedures)</code>的集合。</p>
<p>关于在Access中编程的细节都可以参考<a href="https://support.microsoft.com/en-us/office/introduction-to-access-programming-92eb616b-3204-4121-9277-70649e33be4f" title="Introduction to Access programming">这里</a></p>
<h2 id="操作流程">操作流程</h2>
<p>熟悉了Access的基本知识，现在我们可以意识到，其实一个Access数据库文件中真正存储数据信息的就只有<code>表(Table)</code>类型，所以我们分割数据库的理论基础就是，我们可以只把需要存储的信息(即表)放在共享网络上(作为<code>后端back-end</code>)，而需求信息的用户只需要使用链接在这些共享的表格上的其他类(作为<code>前端front-end</code>)既可以实时<code>有针对性地</code>访问需求的信息而不需要将整个数据库传输来传输去了。由于用户实际占用的只有他们各自的前端副本，且通过网络传输的只有被需求的一小股信息流(而不是整个数据库)，从而实现数据库的<code>可用性</code>和<code>实时性</code>。参考微软的<a href="https://support.microsoft.com/en-us/office/split-an-access-database-3015ad18-a3a1-4e9c-a7f3-51b1d73498cc" title="Office Support: Split an Access database">官方支持</a>，我接下来就介绍我实用的详细的分割数据库的流程。</p>
<h3 id="注意事项">注意事项</h3>
<p>开始之前有些需要注意的点：</p>
<ul>
<li>分割数据库前一定要<code>先备份数据</code>，很简单，直接复制一个副本放在一边，或者直接用副本分割。因为数据是非常宝贵的东西，在很多环境下可能一旦失去就是永远失去， 所以一点风险都不应该承担。</li>
<li>分割数据前要<code>提前通知用户</code>，否则分割时用户输入的数据可能不会被记录在分割后的数据库后端中。</li>
<li><code>确保用户电脑中的Access版本能够支持你分割后的数据库格式</code>，比如我在分割数据库的同时就帮他们把数据库格式从<code>mdb</code>升级成了<code>accdb</code>，因为公司的Access版本都是统一控制的，而文件格式本身就是向下兼容，没有必要不用功能更多性能更好的新版本格式。</li>
</ul>
<h3 id="分割数据库">分割数据库</h3>
<p>数据库分割的功能是Access自带的，只需要按照下方步骤即可完成：</p>
<ol>
<li>
<p>首先在你的本地电脑中复制一份已有的Access数据库文件，确保左边<code>All Access Objects</code>栏位中没有任何被隐藏的表，如果表被隐藏是不会被自动分割的。(不要问我为什么特别提这点，第一次分割数据库发现一部分数据无法同步，DEBUG好久最后发现原来是因为那部分数据的表被隐藏，导致分割数据库没有把这些表上传至共享文件夹)</p>
<p>在<code>All Access Objects(所有Access对象)</code>选项上右键，选择<code>Navigation Options(导航选项)</code>，这时会打开一个对话框，将<code>Show Hidden Objects(显示隐藏对象)</code>打勾并且确定。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301124556871.png" alt="打开导航选项"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301124707290.png" alt="勾选显示隐藏对象并确认"></p>
<p>这时回到<code>All Access Objects栏</code>中，如果文件中有被隐藏的对象，会看到他们现在呈半透明色，右键点击他们按<code>Unhide in this Group(该组中取消隐藏)</code>即可解除隐藏。确保你要分割的文件中没有隐藏的表。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301124841322.png" alt="image-20220301124841322"></p>
</li>
<li>
<p>分割数据库本身就非常简单了，只需要在<code>Database Tools(数据库工具)</code>选项卡上的<code>Move Data(移动数据)</code>组中，点击<code>Access Database(Access数据库)</code>，就会出现图中这个<code>Database Splitter(数据库分割向导)</code>。现在点击<code>Split Database(分割数据库)</code>按钮。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301125110106.png" alt="image-20220301125110106"></p>
</li>
<li>
<p>单击<code>Split Database(分割数据库)</code>按钮后就会出现浏览文件路径的对话框，这里就是设定<code>后端</code>的所在地的地方，我们选择到我们已经准备好的共享文件夹中，确保需要使用这个数据库的用户都可以访问这个共享文件夹。数据库名称和文件类型都可以改，但没有必要(<code>除非有特别的理由</code>，否则只有坏处没有好处)。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301125246928.png" alt="image-20220301125246928"></p>
</li>
<li>
<p>设置完成后点击<code>Split(分割)</code>Access就会开始自动分割数据库了，原数据库中的<code>表</code>都会被复制到刚刚设定的<code>后端文件</code>中，而这时我们进行这些操作的文件就是<code>前端文件</code>了，<code>表以外的其他对象</code>就都在前端文件中了，前后端是通过网络绑定连接在一起的。数据库分割完成后会弹出<code>分割成功</code>的提示消息。</p>
</li>
<li>
<p>这里加一点是微软的<code>官方教程没有提到</code>的，那就是前后端分割完成后还需要点击<code>Database Tools(数据库工具)</code>选项卡上的<code>Tools(工具)</code>组中的<code>Compact and Repair Database(压缩和修复数据库)</code>，否则前端数据库的大小可能跟分割前一样大。按照微软的说法，这是因为Access的运作方式中即使删除对象，它也不会立即将该对象曾经占用的硬盘空间释放。如果你对数据库中删改的需求很多量也很大的话，你也可以设置自动压缩和修复数据库，方法<a href="https://support.microsoft.com/en-us/office/compact-and-repair-a-database-6ee60f16-aed0-40ac-bf22-85fa9f4005b2" title="Compact and repair a database">参考这里</a>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301125322541.png" alt="image-20220301125322541"></p>
</li>
<li>
<p>最后，为了限制使用者对前后端数据的更改权限，我们把刚刚的前端文件(<code>.accdb格式</code>)保存为已编译的二进制文件(<code>.accde</code>)，既将前端中可以设计更改数据库逻辑的源代码编译保存，这样二进制文件的用户可以照常使用前端需求数据，但无法对他的功能和设计做改变。具体来说只需要在前端文件中点击<code>Save as(另存为)</code>然后按下图中选择并保存在希望的位置即可。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301125353890.png" alt="image-20220301125353890"></p>
</li>
<li>
<p>这时候我们已经把后端的数据库放在了共享文件夹中，并且已经有了一个可以连接后端数据库的前端文件，剩下的我们只需要把这些前端文件分发给我们的数据库用户就可以了，通过电子邮件，U盘，或者共享文件夹都可以，用户只要保存一份前端文件的副本在自己的本地硬盘中，确保他们可以通过网络访问共享文件夹，那么他们就可以像以前一样使用表以外的Access的数据提取展示等功能了。</p>
<h3 id="更改后端数据库">更改后端数据库</h3>
<p>如果想要更改后端数据库，或者是想把后端数据库的保存位置更改，<code>仅仅只复制粘贴是不行的</code>，因为前端中的连接还是在原来的后端数据库的位置。</p>
<p>以移动后端数据库的位置为例，假设后端数据库中的表结构和名字都不需要变化，那么要做的就很简单：</p>
<p><code>首先</code>把后端数据库复制并粘贴到你想要的新位置，<code>然后</code>如图所示点击<code>External Data(外部数据)</code>选项卡上<code>Import&amp;Link(导入和连接)</code>组中的<code>Linked Table Manager(链接表管理器)</code>。在<code>链接表管理器</code>中你可以分别连接当前前端数据库绑定的每一个表的位置，在我们的情况中我们只需要<code>Select All(选择全部)</code>然后点击上方<code>Relink(重新连接)</code>，然后选择到你新复制到的后端数据库位置。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301125452427.png" alt="image-20220301125452427"></p>
<p>点击确定之后会有一个弹窗，如果你新的后端数据库没有做任何更改，那么这里<code>不要点Yes</code>。点<code>No</code>它就会开始自动帮你把所有的连接从旧的位置一张表一张表地连接到新位置的每一张同名表上，但如果你点了Yes，它会要求你每一张表给他提供新的名字，除非你真的有表名字的变化否则<code>千万别按错了</code>，不然会浪费很多时间。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301125530871.png" alt="image-20220301125530871"></p>
<h1>最后</h1>
<p>通过这一次帮助其他团队解决效率问题，我复习并且更加了解了MS Access的一些基本功能和结构，同时知道了中小型团队在共享数据时可以使用Access来解决数据库<code>同步性(synchronization)</code>和<code>可用性(availability)</code>问题的解决方案。</p>
<p>[第6篇]</p>
</li>
</ol>
]]></content>
      <categories>
        <category>MS Office</category>
      </categories>
      <tags>
        <tag>工作学习</tag>
        <tag>Access</tag>
      </tags>
  </entry>
  <entry>
    <title>[英语学习]《唐顿庄园》第1季第1集学习笔记</title>
    <url>/2022/03/01/7-Downton_Abbey_S01E01/</url>
    <content><![CDATA[<h1>序言</h1>
<p>用英语用了这么多年，在英语学习上面已经不需要再在乎太多语法发音之类的问题了，因为在我看来那些都已经不会太大影响到英语水平，以实用为标准的话现在学习英语需要提升的主要是欧美的文化习惯和词汇量了。个人认为最好的办法就是认真地在欧美流行的电视剧或电影中学习他们的表达，这样既可以避免学到生僻没用的单词，也可以在一个流畅的语境下学习到新的表达甚至温故知新。</p>
<h1>正文</h1>
<h2 id="学习方法">学习方法</h2>
<p>首先一定要建立认知，看剧不是目的，学英语才是目的。只有在心里认知了这个目的，才能在之后的学习中不会急躁，因为我的方法非常慢但也非常稳。简单来说就是每集剧看3遍：</p>
<p><code>第一遍：</code>无字幕看第一遍，第一遍的目的首先是建立对剧情发展的一个基本认识，另外对哪些部分看不懂的也会有比较清晰的认识，最后这也是建立兴趣的关键一步，因为有了第一遍的“看不懂”的对比，第三遍时“完全看懂”才能提供成就感的反馈，激励自己更长久地学习。</p>
<p><code>第二遍：</code>对着剧的脚本一句话一句话地看剧，记录<code>不熟悉</code>或者<code>能听能看但不会用</code>的词和表达，我首先会用有道的<code>Collins词典</code>查释义(<code>Collins</code>的特点是将词放在英语的上下文中解释，非常适合<code>非母语者</code>快速了解单词的用法)，如果<code>Colins</code>没有收录才去查其他词典或例句。第二遍这个过程是最痛苦的，有时候一个1小时的剧要看4小时才能看完，实在不行就分几天看完，一定不能急躁。</p>
<p><code>第三遍：</code>最后再无字幕看一遍，这一遍是最爽的了。看完前两遍第三遍时基本上已经无障碍看剧了，看着剧里那些生僻的表达和含糊的口语都在脑海里清晰地形成文本，这时候就会感觉学习真是太爽了。</p>
<h2 id="学习资源">学习资源</h2>
<p>我的无字幕资源是在这个网站下载的，记得好像也不是免费来着，大家有更好的资源求分享:<a href="https://www.ostmovie.net/downton-abbey-season-12010/">点击链接</a></p>
<p>《唐顿庄园》第一季的字幕脚本我是从网上找的: <a href="/attachment/DowntonAbbey_Script.pdf">点击下载</a></p>
<h2 id="故事梗概">故事梗概</h2>
<p>第1季第1集主要体现唐顿庄园的贵族与仆人们生活状态，通过各种小事介绍剧中各主要人物的背景与个性。主要内容是泰坦尼克沉没后导致Lord Robert Grantham的两个继承人去世从而引出的唐顿庄园的遗产继承问题，主要矛盾在于Lord Grantham对第三顺位继承者Matthew不熟悉，家中就是否挑战继承权以将遗产继承给大女儿Mary展开辩论，最后因为Duke of Crowborough的上门让Lord Grantham坚定了维护继承法顺位的意志，并通知Mathew他的继承权。</p>
<h2 id="学习笔记">学习笔记</h2>
<h3 id="生词">生词</h3>
<h4 id="cease">cease</h4>
<ul>
<li>
<p>If something <code>ceases</code>, it stops happening or existing. (At one o’clock the rain had <code>ceased</code>.)</p>
</li>
<li>
<p>If you <code>cease to</code> do something, you stop doing it. (He never <code>ceases to</code> amaze me.)</p>
</li>
<li>
<p>If you <code>cease</code> something, you stop it happening or working.(The Tundra Times, a weekly newspaper in Alaska, <code>ceased</code> publication this week.)</p>
</li>
</ul>
<h4 id="handiwork">handiwork</h4>
<ul>
<li>You can refer to something that you have done or made yourself as your <code>handiwork</code>.(The architect stepped back to admire his <code>handiwork</code>.)</li>
</ul>
<h4 id="Kedgeree">Kedgeree</h4>
<ul>
<li>
<p><code>Kedgeree</code> is a cooked dish consisting of rice, fish and eggs.</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220301160302387.png" alt="Kedgeree"></p>
</li>
</ul>
<h4 id="dreadful">dreadful</h4>
<ul>
<li>If you say that something is <code>dreadful</code>, you mean that it is very bad or unpleasant, or very poor in quality. (They told us the <code>dreadful</code> news.)</li>
<li><code>Dreadful</code> is used to emphasize the degree or extent of something bad. (We’ve made a <code>dreadful</code> mistake.)</li>
</ul>
<h4 id="mourning">mourning</h4>
<ul>
<li><code>Mourning</code> is behaviour in which you show sadness about a person’s death. (Expect to feel angry, depressed and confused. It’s all part of the <code>mourning</code> process.)</li>
<li>If you are <code>in mourning</code>, you are dressed or behaving in a particular way because someone you love or repect has died. (Yesterday the whole of Greece was <code>in mourning</code>.)</li>
</ul>
<h4 id="attic">attic</h4>
<ul>
<li>An <code>attic</code> is a room at the top of a house just below the roof.</li>
</ul>
<h4 id="snuff">snuff</h4>
<ul>
<li>Snuff is powdered tobacco which people take by breathing it in quickly though their nose.</li>
</ul>
<h4 id="speak-up">speak up</h4>
<ul>
<li>If you <code>speak up</code>, you say something, especially to defend a person or protest about something, rather than just saying nothing. (Uncle Herbert never argued, never <code>spoke up</code> for himself.)</li>
<li>If you ask someone to <code>speak up</code>, you are asking them to speak more loudly. (I’m quite deaf. you’ll have to <code>speak up</code>.)</li>
</ul>
<h4 id="luncheon">luncheon</h4>
<ul>
<li>A <code>luncheon</code> is a formal lunch, for example, to celebrate an important event or to raise money for charity. (Earlier this month, a <code>luncheon</code> for former U.N. staff was held in Vienna.)</li>
</ul>
<h4 id="hail">hail</h4>
<ul>
<li>If a person, event, or achievement <code>is hailed as</code> important or successful, they are praised publicly. (Faulkner has <code>been hailed as</code> the greatest American novelist of his generation.)</li>
<li><code>Hail</code> consists of small balls of ice that fall like rain from the sky. (… a sharp short-lived storm with heavy <code>hail</code>.)</li>
<li><code>A hail of</code> things, usually small objects, is a large number of them that hit you at the same time and with great force. (The victim was hit by <code>a hail of</code> bullets.)</li>
<li>Someone who <code>hails from</code> a particular place was born there or lives there. (He <code>hails from</code> Memphis.)</li>
<li>If you <code>hail a taxi</code>, you wave at it in order to stop it because you want the driver to take you somewhere. (I hurried away to <code>hail a taxi</code>.)</li>
</ul>
<h4 id="daunting">daunting</h4>
<ul>
<li>Something that is <code>daunting</code> makes you feel slightly afraid or worried about dealing with it. (He and his wife Jane were faced with the <code>daunting</code> task of restoring the gardens to their former splendour.)</li>
</ul>
<h4 id="cemetery">cemetery</h4>
<ul>
<li>A <code>cemetery</code> is a place where dead people’s bodies or their ashes are buried.</li>
</ul>
<h4 id="solicitor">solicitor</h4>
<ul>
<li>In the United States, a <code>solicitor</code> is the chief lawyer in a government or city department.</li>
</ul>
<h4 id="take-on">take on</h4>
<ul>
<li>If you <code>take on</code> a job or responsibility, especially a difficult one, you accept it. (No other organization was able or willing to <code>take on</code> the job.)</li>
<li>If something <code>takes on</code> a new appearance or quality, it develops that appearance or quality. (Believing he had only a year to live, his writing <code>took on</code> a feverish intensity.)</li>
<li>If you <code>take someone on</code>, you employ them to do a job. (He’s spoken to a publishing company. They are going to <code>take him on</code>.)</li>
<li>If you <code>take someone on</code>, you fight them or compete against them, especially when they are bigger or more powerful than you are. (Democrats were reluctant to <code>take on a president</code> whose popularity ratings were historically high.)</li>
</ul>
<h4 id="eccentric">eccentric</h4>
<ul>
<li>If you say that someone is <code>eccentric</code>, you mean that they behave in a strange way, and have habits or opinions that are different from those of most people. (He is an <code>eccentric</code> character who likes wearing a beret and dark glasses.)</li>
</ul>
<h4 id="peculiar">peculiar</h4>
<ul>
<li>If you describe someone or something as <code>peculiar</code>, you think that they are strange or unusual, sometimes in an unpleasant way. (Mr. Kennet has a rather <code>peculiar</code> sense of humor.)</li>
<li>If something is <code>peculiar to</code> a particular thing, person, or situation, it belongs or relates only to that thing, person, or situation. (Punks, soldiers, hippies, and Sumo wrestlers all have distinct hair styles, <code>peculiar to</code> their group.)</li>
</ul>
<h4 id="nurture">nurture</h4>
<ul>
<li>If you <code>nurture</code> something such as a young child or a young plant, you care for it while it is growing and developing. (Parents want to know the best way to <code>nurture</code> and raise their child to adulthood.)</li>
<li><code>Nurture</code> can also be a noun where it is care and encouragement that is given to someone while they are growing and developing. (The human organism learns partly by nature, partly by <code>nurture</code>.)</li>
</ul>
<h4 id="nuisance">nuisance</h4>
<ul>
<li>If you say that someone or something is a <code>nuisance</code>, you mean that they annoy you or cause you a lot of problems. (He could be a bit of a <code>nuisance</code> when he was drunk.)</li>
</ul>
<h4 id="chaperones">chaperones</h4>
<ul>
<li>A <code>chaperon</code> is someone who accompanies another person somewhere in order to make sure that they do not come to any harm.</li>
</ul>
<h4 id="pry">pry</h4>
<ul>
<li>If someone <code>pries</code>, they try to find out about someone else’s private affairs, or look at their personal possessions. (We do not want people <code>prying</code> into our affairs.)</li>
</ul>
<h4 id="coy">coy</h4>
<ul>
<li>A <code>coy</code> person is shy, or pretends to be shy, about love and sex. (I was sickened by the way Carol charmed all the men by turning <code>coy</code>.)</li>
<li>If someone is being <code>coy</code>, they are unwilling to talk about something that they feel guilty or embarrassed about. (Mr. Alexander is not the slightest bit <code>coy</code> about his ambitions.)</li>
</ul>
<h4 id="come-off">come off</h4>
<ul>
<li>If something <code>comes off</code>, it is successful or effective. (It was a good try but it didn’t <code>come off</code>.)</li>
<li>If someone <code>comes off worst</code> in a contest or conflict, they are in the worst position after it. If they <code>come off best</code>, they are in the best position. (Some Democrats still have bitter memories of how they <code>came off worst</code> during the investigation.)</li>
</ul>
<h4 id="dalliance">dalliance</h4>
<ul>
<li>If two people have a brief romantic relationship, you can say that they have a <code>dalliance</code> with each other, especially if they do not take it seriously.</li>
</ul>
<h4 id="conscience">conscience</h4>
<ul>
<li>Your <code>conscience</code> is the part of your mind that tells you whether what you are doing is right or wrong. If you have a <code>guilty conscience</code>, you feel guilty about something because you know it was wrong. If you have a <code>clear conscience</code>, you do not feel guilty because you know you have done nothing wrong. (What if he got a guilty conscience and brought it back?)</li>
</ul>
<h4 id="interlude">interlude</h4>
<ul>
<li>An <code>interlude</code> is a short period of time when an activity or situation stops and something else happens.</li>
</ul>
<h3 id="需要熟悉的词">需要熟悉的词</h3>
<ul>
<li>lit是light的过去式，即点亮。</li>
<li>crouch: 蹲；蹲下</li>
<li>burner: 炉灶</li>
<li>milk train: 早班火车(因为通常运送牛奶的是最早的一班火车)</li>
<li>butler: 管家</li>
<li>cedar-lined cupboards: 雪松木的衣柜</li>
<li>studs: 金属饰纽</li>
<li>hoard: 收藏；贮藏</li>
<li>reluctant: 抗拒</li>
<li>drawing room: 客厅</li>
<li>flatter: 高看；奉承</li>
<li>late husband: 已故的丈夫</li>
<li>swag: 赃物；窗饰</li>
<li>dowry: 嫁妆</li>
<li>entail: 继承权</li>
<li>tongue-tied: 因拘谨而说不出话</li>
<li>in the presence of: 在…面前</li>
<li>comrade: 同伴(尤其指共患难的)；战友</li>
<li>brass: 黄铜</li>
<li>sprinkle on…: 洒在…上</li>
<li>dispiriting: 令人沮丧的</li>
<li>unjust: 不公平；不公正</li>
<li>tenner: 十英镑纸币</li>
<li>turn up: 出现</li>
<li>crippled: 残疾的</li>
<li>tremendous: 巨大的；极好的</li>
<li>glare: 怒视；刺眼的光</li>
<li>vapours: 蒸汽</li>
<li>Be that as it may: 无论如何；尽管如此</li>
<li>merely: 仅仅</li>
<li>clear away: 收拾(餐具)</li>
<li>be content with: 满足于</li>
<li>run off: 逃跑；私奔；复印；喋喋不休</li>
<li>put up with: 忍受</li>
<li>wear out: 精疲力竭</li>
<li>undignified: 不体面的</li>
<li>conservatory: 音乐学院；温室</li>
<li>fern: 蕨类植物</li>
<li>genus: 属（生物分类的）</li>
<li>compromise: 降格；妥协</li>
<li>Holy Grail: 圣杯</li>
<li>speak out: 公开说出；求婚</li>
<li>see to: 照料；办理</li>
<li>slip away: 溜之大吉</li>
<li>slipped the hook: 滑钩</li>
<li>turn in: 睡觉;自首</li>
<li>graceless: 没有教养的</li>
<li>hollow out: 镂空</li>
<li>lump: 块；忍耐</li>
</ul>
<h3 id="表达方式">表达方式</h3>
<ul>
<li>None of them will be <code>up</code> for hours. 他们几个小时内都不会<code>起床</code>。</li>
<li>Is your fire still <code>in</code>? 火还<code>燃</code>着吧？</li>
<li>wonders will never <code>cease</code>. 奇迹总会出现。</li>
<li><code>blacking</code> the stove. <code>擦亮</code>炉子。</li>
<li>I want the dining room given a proper <code>going-over</code> today. 今天要把餐厅<code>彻底</code>打扫干净。</li>
<li>No rest for the wicked. 永无安宁(出自圣经，指恶人要永受折磨)</li>
<li>There are <code>bound to</code> be others. <code>肯定</code>还有别人。</li>
<li>When you think how excited Lucy Rothes was <code>at the prospect</code>. 你想想当时Lucy Rothes对去美国的<code>期待</code></li>
<li>Though he left it in <code>quite a state</code>. 虽然他走的时候留下了<code>一片狼藉</code>(quite a state主要表示状态非常不一般)</li>
<li><code>rotate</code> the summer and winter stuff. <code>轮流</code>放夏天和冬天的东西</li>
<li>I will <code>get the hang of</code> it. 我会记住的。(get the hang of… 指掌握…的窍门)</li>
<li>I can’t believe I’ve been <code>passed over for Long John Silver</code>. 不敢相信我居然<code>被一个跛脚海盗抢了职位</code>。</li>
<li>I‘m not entirely sure that he’ll <code>prove equal to</code> the task. 我不太确定他是不是能<code>胜任</code>这份工作。</li>
<li>We were all so <code>fond of</code> him. 我们都很<code>喜欢</code>他。</li>
<li>When my sister died, God rest her soul, I <code>ate my way through</code> four platefuls of sandwiches at one sitting and slept <code>round the clock</code>. 我姐姐走的时候 愿她安息 我<code>一口气吃了</code>四盘三明治，然后睡了整整<code>12 个小时</code>。</li>
<li>Your father <code>tied the knots pretty tight</code>. 你爸爸<code>把结打得非常死</code>。(指很难有别的方法。)</li>
<li>Don’t <code>catch me out</code>. 别<code>鸡蛋里挑骨头</code></li>
<li>Is it any wonder if the <code>others' noses are put out</code>? 也难怪别人会<code>说三道四</code>。</li>
<li>I wouldn’t <code>sleep a wink</code>. 我肯定<code>一宿睡不着</code>。</li>
<li>Let’s not gild the lily. 不要多此一举。</li>
<li>Don’t <code>stir</code> 别<code>搅混水</code>（别拱火）</li>
<li>But the honour of Downton is <code>at stake</code>. 但这是<code>赌上</code>唐顿名誉的</li>
<li>Don’t be such a <code>chatterbox</code>, Edith. 别这么<code>多嘴</code>，伊迪丝。</li>
<li>It’s an ill wind. 祸兮福所倚。（指因祸得福）</li>
<li>One swallow doesn’t make a summer. 孤燕不成夏(不要因为出现一件好事，就以为情况好转了。)</li>
</ul>
<h1>最后</h1>
<p>这篇除了学习时做的笔记，还介绍了我的学习方法和资料，之后的各篇我就直接只摆上学习笔记了。</p>
<p>[第7篇]</p>
]]></content>
      <categories>
        <category>英语学习</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>Downton Abbey</tag>
        <tag>英语学习</tag>
      </tags>
  </entry>
  <entry>
    <title>[信息安全]解码微信PC版中以dat格式存储的聊天图片</title>
    <url>/2022/03/04/8-decrypt-wechat-pics/</url>
    <content><![CDATA[<h1>序言</h1>
<p>最近有些好奇微信PC版的聊天文件在本地是如何保存的，因为这些文件要兼顾<code>可以快速随时访问</code>，又要<code>不能直接在文件夹中展示</code>，所以稍微研究了一下，发现原来这些文件虽然是被加密过,但解码的方法其实非常简单(与其说被加密不如说只是让它不能直接打开而已)，这里就分享一下这个dat文件的<code>解码原理</code>和我写的<code>解码小脚本</code>。</p>
<h1>正文</h1>
<h2 id="方法论">方法论</h2>
<p>我首先找到的是<a href="https://blog.csdn.net/ainivip/article/details/111772428" title="微信Dat文件解码">这篇文章</a>，通过这篇文章我知道了两个原先不知道的小知识，<code>第一</code>是jpg有固定的<code>标识符FF D8</code>来标记图像的起始位置，<code>第二</code>是dat文件的加密方式是对图片文件的每一个字节做一个固定数值的<code>异或运算(XOR)</code>(既以比特(bit)各位计算，两值不同返回1，两值相同返回0，运算符号为⊕)，<code>异或运算</code>的一个重要特性就是<code>自反性</code>，既：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>a</mi><mo>⊕</mo><mi>b</mi><mo>⊕</mo><mi>a</mi><mo>=</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">a \oplus b \oplus a = b
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span></p>
<p>而我们现在已经有了一个经过<code>特定数值x</code>异或处理过的<code>FF D8</code>，那么我们只要在这个基础上再使用<code>FF D8</code>进行异或运算就能倒算出这个特定的数值<code>x</code>，既：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mn>0</mn><mi mathvariant="normal">x</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">d</mi><mn>8</mn><mtext> </mtext><mo>⊕</mo></mrow><mtext> </mtext><mi>x</mi><mtext> </mtext><mrow><mo>⊕</mo><mtext> </mtext><mn>0</mn><mi mathvariant="normal">x</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">d</mi><mn>8</mn></mrow><mo>=</mo><mi>x</mi></mrow><annotation encoding="application/x-tex">\mathrm{0xffd8\ \oplus}\ x\ \mathrm{\oplus \ 0xffd8}=x
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathrm">0xffd8</span><span class="mspace"> </span><span class="mord">⊕</span></span><span class="mspace"> </span><span class="mord mathnormal">x</span><span class="mspace"> </span><span class="mord"><span class="mord">⊕</span><span class="mspace"> </span><span class="mord mathrm">0xffd8</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span></span></p>
<p>然后使用这个计算出来的<code>x</code>将<code>dat文件</code>中的所有字节都进行异或运算就可以得到原来的图片数据了。我们可以先小试一下实际是不是这样。</p>
<h2 id="小实验">小实验</h2>
<p>我们就借用<a href="https://blog.csdn.net/ainivip/article/details/111772428" title="微信Dat文件解码">这位大佬</a>的代码和思路，先随便拿张图试试。先用<a href="https://www.sublimetext.com/" title="Sublime Text website">sublime text编辑器</a>的十六进制模式查看一下这个被抽中的幸运图片的内容：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220305125220649.png" alt="dat文件开头是'6641'"></p>
<p>这时用计算器的程序员模式算一下<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>0</mn><mi mathvariant="normal">x</mi><mn>6641</mn><mo>⊕</mo><mn>0</mn><mi mathvariant="normal">x</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">f</mi><mi mathvariant="normal">d</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">\mathrm{0x6641\oplus 0xffd8}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathrm">0x6641</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm">0xffd8</span></span></span></span></span>的结果：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220305125751063.png" alt="结果是'9999'，因此可知x是'99'"></p>
<p>那就把这个<code>幸运图片(.dat)</code>的每一个字节对<code>99</code>做一次<code>异或运算</code>吧：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">imageDecode</span>(<span class="params">f</span>):</span><br><span class="line">    dat_read = <span class="built_in">open</span>(f,<span class="string">&quot;rb&quot;</span>) <span class="comment"># 打开这个图片</span></span><br><span class="line">    out = <span class="string">&quot;00.png&quot;</span> </span><br><span class="line">    png_write = <span class="built_in">open</span>(out, <span class="string">&quot;wb&quot;</span>) <span class="comment"># 定义一个输出写入的文件</span></span><br><span class="line">    <span class="comment"># 遍历每一个字节并对每一个字节做99的异或运算后写入新png文件</span></span><br><span class="line">    <span class="keyword">for</span> now <span class="keyword">in</span> dat_read:</span><br><span class="line">        <span class="keyword">for</span> nowByte <span class="keyword">in</span> now:</span><br><span class="line">            newByte = nowByte ^ <span class="number">0x99</span></span><br><span class="line">            png_write.write(<span class="built_in">bytes</span>([newByte]))</span><br><span class="line">    <span class="comment">#关闭两个文件</span></span><br><span class="line">    dat_read.close()</span><br><span class="line">    png_write.close()</span><br><span class="line"></span><br><span class="line">name = <span class="string">&quot;0b64663254a42d95d4546fd03a85d921.dat&quot;</span></span><br><span class="line">imageDecode(name)</span><br></pre></td></tr></table></figure>
<p>运行后发现果不其然，图片信息被还原了：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220305130647692.png" alt="image-20220305130647692"></p>
<p>看来方法是没有问题的，但似乎用计算器算x这个步骤有些脱裤放屁的嫌疑了，直接用Python算好了自己代进去不就好了，这样就可以把解码步骤一般化啦。那就改进一下吧。</p>
<h2 id="改进一下">改进一下</h2>
<p>我想让解码的工作更加方便快捷一些，只需要把我们的exe文件放进微信的存储文件夹下运行就可以自动解码所有的文件并且放在一个固定的文件夹中，这里我假设<code>每个文件夹中的dat文件都用相同的字节加密</code>，所以每次打开一个文件夹，程序都会用文件夹中的第一个dat文件的第一个字节来解码得到解码字节。</p>
<p>但事实上根据我的观察，似乎这个解码字节似乎是根据主机与用户号生成，也就是说同一个用户在同一台主机中的图片文件都被用同一个解码字节加密成dat文件，但用这个程序也不需要管那么多了，只要你没有把不同用户的dat文件混合在一个文件夹下就都没有问题。于此同时，我还给程序加了一些可视化的<code>进度条</code>，这样解码大量文件时也不会等得茫然。废话少说，放代码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_decode_key</span>(<span class="params">file</span>):</span><br><span class="line">    <span class="comment"># 读取文件第一个字节并与0xFF做异或运算以得到解码字节</span></span><br><span class="line">    dat_read = <span class="built_in">open</span>(file, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    head = dat_read.read(<span class="number">1</span>)</span><br><span class="line">    x = <span class="built_in">int</span>.from_bytes(head, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    dat_read.close()</span><br><span class="line">    <span class="keyword">return</span> x ^ <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">image_decode</span>(<span class="params">file_in, file_out ,key</span>):</span><br><span class="line">    <span class="comment"># 将图片中每个字节分别与解码字节做异或运算并输出结果至指定地点</span></span><br><span class="line">    dat_read = <span class="built_in">open</span>(file_in,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    out = os.path.join(file_out)+<span class="string">&quot;.png&quot;</span></span><br><span class="line">    png_write = <span class="built_in">open</span>(out, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> now <span class="keyword">in</span> dat_read:</span><br><span class="line">        <span class="keyword">for</span> nowByte <span class="keyword">in</span> now:</span><br><span class="line">            newByte = nowByte ^ key</span><br><span class="line">            png_write.write(<span class="built_in">bytes</span>([newByte]))</span><br><span class="line">    dat_read.close()</span><br><span class="line">    png_write.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_all</span>():</span><br><span class="line">    <span class="comment"># 列出当前文件夹下的所有文件</span></span><br><span class="line">    fsinfo = os.listdir()</span><br><span class="line">    num_folders = <span class="built_in">len</span>([x <span class="keyword">for</span> x <span class="keyword">in</span> fsinfo <span class="keyword">if</span> os.path.isdir(x) <span class="keyword">and</span> x <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&quot;.idea&quot;</span>, <span class="string">&quot;result&quot;</span>)])</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 创建一个result文件夹来存储结果</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;result&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> fsinfo:</span><br><span class="line">        os.makedirs(<span class="string">&#x27;result&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        shutil.rmtree(<span class="string">&#x27;result&#x27;</span>)</span><br><span class="line">        os.makedirs(<span class="string">&#x27;result&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历当前文件夹中的所有子文件夹</span></span><br><span class="line">    <span class="comment"># 并将里面所有dat文件进行解码后放入result文件夹中的相应位置</span></span><br><span class="line">    <span class="keyword">for</span> folders <span class="keyword">in</span> fsinfo:</span><br><span class="line">        <span class="comment"># 只对文件夹中的内容解码</span></span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(folders) <span class="keyword">and</span> folders <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&quot;.idea&quot;</span>, <span class="string">&quot;result&quot;</span>):</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\r&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Folders to be decoded: %s/%s&quot;</span> % (i, num_folders))</span><br><span class="line">            temp_path = os.path.join(<span class="string">&quot;result&quot;</span>, folders)</span><br><span class="line">            os.makedirs(temp_path)</span><br><span class="line">            key_flag = <span class="literal">False</span> <span class="comment"># 每个文件夹只对第一个文件提取解码字节</span></span><br><span class="line">            dat_files = [x <span class="keyword">for</span> x <span class="keyword">in</span> os.listdir(folders) <span class="keyword">if</span> x.endswith(<span class="string">&quot;.dat&quot;</span>)] <span class="comment"># 只看文件夹中的dat文件</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(dat_files) == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;No dat file in this folder&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 对每个文件夹中的dat文件分别解码并放入“result”文件夹中的相应位置</span></span><br><span class="line">                <span class="keyword">for</span> files <span class="keyword">in</span> tqdm(dat_files, desc=<span class="string">&quot;Folder%s: &quot;</span> % i):</span><br><span class="line">                    output_path = os.path.join(temp_path, files)</span><br><span class="line">                    <span class="keyword">if</span> key_flag <span class="keyword">is</span> <span class="literal">False</span>:</span><br><span class="line">                        file_path = os.path.join(folders, files)</span><br><span class="line">                        key = get_decode_key(file_path)</span><br><span class="line">                        image_decode(file_path, output_path, key)</span><br><span class="line">                        key_flag = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        file_path = os.path.join(folders, files)</span><br><span class="line">                        image_decode(file_path, output_path, key)</span><br><span class="line">            <span class="keyword">if</span> i == num_folders:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;All Jobs Done!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    decode_all()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h2 id="打包测试一下">打包测试一下</h2>
<p>用py2exe包把文件打包成一个<code>exe文件</code>，大小大概<code>7.6M</code>比较合理。把这个exe文件复制去我自己的微信image文件夹下双击运行，程序就开始慢慢跑起来了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics/post_img/image-20220306195549214.png" alt="把exe文件放在微信image文件夹下双击便可运行"></p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220306195720817.png" alt="所有图片都被复原了~！"></p>
<p>结果非常完美！运行体验也很好！</p>
<h2 id="软件下载">软件下载</h2>
<p>我把这个exe文件放在这里<code>转需</code>，也可以看看自己的微信里都缓存了些什么玩意：<a href="/attachment/wechat_img_decryption.exe">文件下载</a></p>
<h2 id="补充一个小bug的解决思路">补充一个小bug的解决思路</h2>
<p>我发现有一种情况可能导致解码失败，那就是当微信聊天的图片不仅仅有<code>jpg格式</code>还有<code>png格式</code>时，我们如果第一步获取解码字节是从这些<code>png加密的dat文件中</code>获取,这些图片的文件头是<code>89 50</code>(来自<a href="https://blog.csdn.net/weixin_30847865/article/details/96186989" title="利用文件头标志判断文件类型">这篇博文</a>，非常有用马克一下)，但我们是使用<code>jpg格式</code>的文件头<code>FF D8</code>来获取，这会导致获得错误的解码字节，从而导致一整个文件夹都解码失败。</p>
<p>我已经想到了一个<code>解决办法</code>，因为dat文件不管是<code>png图片</code>还是<code>jpg图片</code>都会被同一个解码字节进行异或处理，那也就是说因为异或运算的自反性，使用加密后的字节1与加密后的字节2进行异或运算所得的结果<code>与其加密前的异或结果会是一样的</code>，如下式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mrow><mtext>字节</mtext><mn>1</mn><mtext> </mtext><mo>⊕</mo></mrow><mtext> </mtext><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mrow><mo>⊕</mo><mtext> </mtext><mo stretchy="false">(</mo><mtext>字节</mtext><mn>2</mn><mtext> </mtext><mo>⊕</mo></mrow><mtext> </mtext><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mrow><mtext>字节</mtext><mn>1</mn><mtext> </mtext><mo>⊕</mo><mtext> 字节</mtext><mn>2</mn></mrow><mo stretchy="false">)</mo><mtext> </mtext><mrow><mo>⊕</mo><mtext> </mtext></mrow><mi>x</mi><mtext> </mtext><mrow><mo>⊕</mo><mtext> </mtext></mrow><mi>x</mi><mo>=</mo><mrow><mtext>字节</mtext><mn>1</mn><mtext> </mtext><mo>⊕</mo><mtext> 字节</mtext><mn>2</mn></mrow></mrow><annotation encoding="application/x-tex">(\mathrm{字节1\ \oplus}\ x)\ \mathrm{\oplus \ (字节2\ \oplus}\ x)=(\mathrm{字节1\ \oplus\ 字节2})\ \mathrm{\oplus \ }x\ \mathrm{\oplus \ }x=\mathrm{字节1\ \oplus\ 字节2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathrm cjk_fallback">字节</span><span class="mord mathrm">1</span><span class="mspace"> </span><span class="mord">⊕</span></span><span class="mspace"> </span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace"> </span><span class="mord"><span class="mord">⊕</span><span class="mspace"> </span><span class="mopen">(</span><span class="mord mathrm cjk_fallback">字节</span><span class="mord mathrm">2</span><span class="mspace"> </span><span class="mord">⊕</span></span><span class="mspace"> </span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathrm cjk_fallback">字节</span><span class="mord mathrm">1</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm cjk_fallback">字节</span><span class="mord mathrm">2</span></span><span class="mclose">)</span><span class="mspace"> </span><span class="mord"><span class="mord">⊕</span><span class="mspace"> </span></span><span class="mord mathnormal">x</span><span class="mspace"> </span><span class="mord"><span class="mord">⊕</span><span class="mspace"> </span></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord mathrm cjk_fallback">字节</span><span class="mord mathrm">1</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⊕</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm cjk_fallback">字节</span><span class="mord mathrm">2</span></span></span></span></span></span></p>
<p>而<code>png</code>的文件头<code>89 50</code>进行异或运算结果为<code>D9</code>，这与<code>FF D8</code>两字节的异或运算结果<code>27</code>是不一样的，由此我们可以增加一个判断，将dat文件的头两个字节进行异或运算，若得出结果为<code>27</code>，则判断<code>加密前为jpg文件</code>，使用<code>FF D8来获得解码字节</code>；若得出结果为<code>D9</code>，则判断<code>加密前为png文件</code>，使用<code>89 50来获得解码字节</code>。只要解码字节获取成功，后面的解码操作其实都是一样的。但我懒得改代码了，<code>反正也没那么多png图片</code>，有需要的自己把思路拿去改吧。</p>
<h1>最后</h1>
<p>通过这一次的这个好奇心驱使下的学习，实际上除了主题相关的<code>图片格式</code>，<code>微信dat文件加密</code>方式等等以外，最重要的是我重新复习了一下<code>Python操作文件</code>，<code>显示进度条</code>以及<code>打包</code>等等内容，都是非常基础但需要熟能生巧的技能。</p>
<p>[第8篇]</p>
]]></content>
      <categories>
        <category>信息安全</category>
      </categories>
      <tags>
        <tag>日常学习</tag>
        <tag>微信</tag>
        <tag>解码</tag>
      </tags>
  </entry>
  <entry>
    <title>[博客维护]Jsdelivr CDN的图片缓存更新的解决方案</title>
    <url>/2022/03/09/9-keep-cdn-pics-updated/</url>
    <content><![CDATA[<h1>序言</h1>
<p>我在我的<a href="http://raylei.space/2022/02/12/2-typora_picgo_config/" title="使用 Typora 和 PicGo 简单便捷地编辑带图博文">第二篇博文</a>中曾经提到过为了加速世界各地的人访问博客图片的速度，我们需要使用<code>Jsdelivr</code>的<code>CDN</code>服务，但<code>CDN</code>在带来一些便捷的同时也带来了<code>一些问题</code>。比如如果我们对远程仓库中的某些图片做了<code>修改</code>(而不是添加一个新的图片)，这种情况下<code>Jsdelivr</code>的缓存文件却可能<code>不会马上被更新</code>，所以我们需要使用一些方法使我们修改后的图片能实时反映在我们的网站中，本篇就记录一下我尝试的方法和最终的解决方案。</p>
<h1>正文</h1>
<p>要搞清楚图片缓存不能按时更新的主要原因，首先先要了解一下<code>Jsdelivr</code>到底是怎么运作的。我在第二篇文章里简单地介绍过他的基本原理就是将上传的资料缓存在各地的边缘服务器中，然后每次链接被请求时直接从距离请求最近的服务器中响应请求。而从<code>JSdelivr</code>的官网中我们可以看到它具体的实现方法如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/infographics.png" alt="JSdelivr工作原理图"></p>
<p>可以注意到<code>Jsdelivr</code>除了拥有我们之前介绍的缓存服务器以外还有一项功能，是由<code>亚马逊</code>提供的<code>S3云储存服务</code>。根据其官方的介绍：</p>
<blockquote>
<p>We use a permanent S3 storage to ensure all files remain available even if GitHub goes down, or a repository or a release is deleted by its author. Files are fetched directly from GitHub only the first time, or when S3 goes down.</p>
</blockquote>
<p>可以想象他们的做法是每当<code>Github</code>中发布新的<code>release</code>之后马上将新的资产复制至<code>S3空间</code>，这样即使<code>GitHub崩溃</code>或者<code>原作者删除掉仓库或release</code>这些已经存储的文件也不会丢失，只有<code>S3崩溃</code>的时候他们才会再从<code>GitHub</code>拉数据。这个做法第一眼看就知道是利弊共存的。显然他们的做法保证了数据的可用性，但随之而来的问题就是更改数据的成本增加了，我的每次更改都要同步到S3，而似乎<code>Jsdelivr</code>在这点上做得并不好，我估计可能和他们备份和引用方式的底层逻辑有关，导致他们实时同步数据的成本非常高。</p>
<h2 id="清除缓存">清除缓存</h2>
<p>在网上看了一些<a href="https://www.tgee.cn/jsdelivr-cdn.html" title="Jsdelivr CDN 缓存清除">其他人的分享</a>，大多数人都会介绍使用<code>endpoint purge</code>调用<code>Jsdelivr</code>缓存清除功能的方法，来强制刷新缓存。具体用法只是在浏览器中将需要引用的<code>Jsdelivr</code>链接前的<code>cdn</code>替换为<code>purge</code>然后发送请求就会让<code>Jsdelivr</code>将该链接的缓存强制刷新。但似乎现在这个功能已经被禁用了，在<code>Jsdelivr</code>的官网上我没有看到任何类似的记录，仅仅只有<a href="https://www.jsdelivr.com/tools/purge" title="Jsdelivr Purge Tool">一个页面</a>表明<code>Jsdelivr</code>正在开发清除缓存的工具。</p>
<p>从<a href="https://blog.juanertu.com/archives/cbcd1946.html" title="解决 jsdelivr 缓存问题的几个办法">别的博主的博文</a>中可以看到，如果要使用前面提到的<code>Purge方法</code>可能需要向-dak@prospectone.io发邮件请求，但我自己并没有在文档中找到这句话，可能是在<code>Jsdelivr</code>的<code>API文档</code>中吧。但总之<code>Purge</code>这个方法现在也是没有那么方便了，只能看有生之年能不能等到这个官方工具出炉了，先想想还有没有别的方法。</p>
<h2 id="引用版本号">引用版本号</h2>
<p>其实一般对文件加版本号的引用方法其实非常稳定，也即：</p>
<blockquote>
<p><code>https://cdn.jsdelivr.net/gh/user/repo@version/file</code></p>
</blockquote>
<p>但这个方法比较麻烦的地方在于，我们一般是用<code>Typora</code>来插入图片，然后使用提前设置好的<code>Jsdelivr</code>链接地址来引用图片，但<code>Typora</code>并不知道你接下来的版本号是多少，所以如果用这种方法的话你还需要在每次引用图片后再手动在每个图片链接中加入版本号，这就非常麻烦了。而<a href="https://www.jsdelivr.com/" title="Jsdelivr website">官方文档</a>提供的另一个更<code>consistent</code>的方式：</p>
<blockquote>
<p>Omit the version completely or use “latest” to load the latest one (not recommended for production usage)<br>
<code>https://cdn.jsdelivr.net/gh/jquery/jquery@latest/dist/jquery.min.js</code><br>
<code>https://cdn.jsdelivr.net/gh/jquery/jquery/dist/jquery.min.js</code></p>
</blockquote>
<p>去掉版本号或者将版本号用<code>latest</code>替代就可以固定引用<code>最新版本的release</code>，但实际使用后发现这个方法依然不太稳定，<code>新release</code>的文件的确可以无缝访问，但如果是旧文件修改后，使用这个方法依然可能导致直接引用旧文件。<code>所以看起来Jsdelivr只从文件名判断一个文件是不是已经存在了S3空间中。</code></p>
<h2 id="解决办法">解决办法</h2>
<p>既然<code>Jsdelivr</code>是从<code>文件名</code>判断是否更新缓存，那么其实最直接的更新缓存的方法就是<code>改文件名</code>了。我使用的方法是把所有文件链接改成<code>@latest</code>版本，这样每次引用的版本都会是最新版本，但如果对过去已经上传过的图片要做更改，那可以在更改后的文件中加上一些更改的<code>备注信息</code>，例如<code>a_picture.png</code>改成<code>a_picture_v1.png</code>再上传，这样对文件链接的修改也仅只是增加的<code>_v1部分</code>，加上修改图片本身就是相对不常有的操作，所以这个方法已经足以解决我的问题了。</p>
<h2 id="一个疑惑">一个疑惑</h2>
<p>在尝试解决这个问题的中途我曾经尝试过<code>删除以前的release和tag</code>的方法，当时我对<code>Jsdelivr</code>的运作方法还不是很了解，以为删除了已经发布的<code>release</code>就可以彻底解决链接至旧文件的问题。现在虽然知道这个方法不可行，但中途出现了一个现象却开始让我对<code>Jsdelivr</code>的业务逻辑产生了一些疑惑。</p>
<p>这个问题就是我曾经以<code>v1.0.2</code>的版本号发布过一个<code>release</code>,后来我删除了这个<code>release</code>并且以相同的<code>v1.0.2</code>这个<code>tag</code>发布了一个新的<code>release</code>，其他都非常正常，我可以在<code>新的v1.0.2</code>中访问一些<code>旧的v1.0.2</code>中没有加入过的文件，但其中有一张我修改过的图，却一直显示的是<code>旧v1.0.2</code>中的内容，即使我反复确认过<code>新的v1.0.2</code>中这张图的名称完全没有改变，而且内容也确实与旧版本不同，但如果在版本号中加入<code>@v1.0.3</code>(我已经删掉的版本)却可以找到新加的图片。</p>
<p>而当我使用官网提供的查看<code>Jsdelivr</code>目录的方式(<code>https://cdn.jsdelivr.net/gh/jquery/jquery@3.2.1/dist/</code>)进入目录时却发现这里并<code>没有v1.0.3版本</code>，而<code>v1.0.2</code>中那张修改过的图片也确实是<code>旧版</code>。</p>
<p>这些奇怪的现象让我确实难以理解<code>Jsdelivr</code>的逻辑究竟是如何。难道它按<code>链接</code>保存<code>单个文件</code>后储存在某个空间中作为<code>base</code>，然后从<code>新的release</code>中对比各个文件的链接然后<code>逐个更新</code>至这个<code>base</code>中？那即使是这样他也可以实现将<code>同名文件</code>用<code>新release中的版本</code>替代啊。希望以后对<code>Jsdelivr</code>的使用增加能解决我的这个疑惑。</p>
<h1>最后</h1>
<p>这篇文章主要是记录了<code>Jsdelivr</code>使用相关的一些知识和经过研究对这个CDN服务和逻辑的一些了解与猜测，最后更新缓存图片的解决方案其实让我有些不太满意，但想着官方清除缓存的工具都快出来了，那就再等等吧。</p>
<p>[第9篇]</p>
]]></content>
      <categories>
        <category>博客维护</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>日常学习</tag>
        <tag>Github</tag>
      </tags>
  </entry>
</search>
