<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>[编程算法]基于Selenium的自动网页报价机器人功能实现记录 | HideOnRubbish | RayHLei</title><meta name="keywords" content="工作学习,Python,Selenium,RPA"><meta name="author" content="RayHLei"><meta name="copyright" content="RayHLei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="[第21篇]本篇记录了使用Python Selenium包为公司开发自动网页报价机器人时的一些功能实现。">
<meta property="og:type" content="article">
<meta property="og:title" content="[编程算法]基于Selenium的自动网页报价机器人功能实现记录">
<meta property="og:url" content="http://raylei.space/2022/08/01/21-Automated_Website_Logging_Robot/index.html">
<meta property="og:site_name" content="HideOnRubbish | RayHLei">
<meta property="og:description" content="[第21篇]本篇记录了使用Python Selenium包为公司开发自动网页报价机器人时的一些功能实现。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/21-Automated_Website_Logging_Robot.jpg">
<meta property="article:published_time" content="2022-07-31T19:07:15.000Z">
<meta property="article:modified_time" content="2022-08-23T14:35:33.129Z">
<meta property="article:author" content="RayHLei">
<meta property="article:tag" content="工作学习">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Selenium">
<meta property="article:tag" content="RPA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/21-Automated_Website_Logging_Robot.jpg"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/blog_img/logo.png"><link rel="canonical" href="http://raylei.space/2022/08/01/21-Automated_Website_Logging_Robot/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?0db3a3c6777e617edaf2659e819e2c15";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-BQ5ZYHEF37"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-BQ5ZYHEF37');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300&amp;family=Nunito:wght@200&amp;family=Quicksand:wght@300&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":100,"languages":{"author":"Author: RayHLei","link":"Link: ","source":"Source: HideOnRubbish | RayHLei","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#888888","bgDark":"#121212","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '[编程算法]基于Selenium的自动网页报价机器人功能实现记录',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-23 22:35:33'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/rss2.xml" title="HideOnRubbish | RayHLei" type="application/rss+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/blog_img/logo.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">31</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">38</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">8</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/MsgBoard/"><span> MsgBoard</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/blog_img/algorithm.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">HideOnRubbish | RayHLei</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/MsgBoard/"><span> MsgBoard</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">[编程算法]基于Selenium的自动网页报价机器人功能实现记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-07-31T19:07:15.000Z" title="Created 2022-08-01 03:07:15">2022-08-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-08-23T14:35:33.129Z" title="Updated 2022-08-23 22:35:33">2022-08-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BC%96%E7%A8%8B%E7%AE%97%E6%B3%95/">编程算法</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">3.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>11min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="[编程算法]基于Selenium的自动网页报价机器人功能实现记录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>序言</h1>
<p>早在我的第4篇博文《<a href="http://raylei.space/2022/02/21/4-Selenium_documentation_learning/" title="公司项目需要的自动化测试 Selenium 文档解读">公司项目需要的自动化测试 Selenium 文档解读</a>》中我就提到过现公司有一个集团设定报价逻辑的报价系统，其本质是一个内部的网站。核保人员只需要在网站上填入投保人的相关信息就可以从网站设定的逻辑中获得报价并将报价录入公司系统中。但这个过程中操作人员需要不停与网页互动，等待网站响应等，通常填写一个汽车险报价需要花费一个人10-15分钟时间，非常耗时，一个熟练的操作员一个小时也只能发出4-6张报价单，而我们每个月需要的报价量都是数以千计，这使得整个报价操作的人工成本非常高。有了这个自动操作的机器人后，每个报价将只需要50秒左右就能完成。</p>
<p>本篇博文是在之前的自动化报价机器人的基础上，为了更增加机器人运行稳定性等方面升级调整过程中对一些功能实现的代码记录。</p>
<h1>正文</h1>
<p>现在的操作是操作员直接将信息填写进Excel表格中，脚本机器人读取Excel信息然后依次将表格中的信息填写到网站的相应位置最后发出报价单并记录单号和报价。为了避免输入的信息有误，有选项的Excel使用表单选择信息，而如果网页接受信息后弹出错误或提醒，脚本也会记录下这个提示的内容。其他还有选择表单中最相近选项等功能都会在这篇中介绍。</p>
<h2 id="检查输入文件">检查输入文件</h2>
<p>虽然我在收集数据的Excel表格中设置了如表单等内容验证的功能，但有些网站报价必须要有的信息我也必须在保证Excel中存在。因此在脚本开始报价之前必须先检视一遍Excel文件中是否有缺失的信息。我的实现方法就是使用<code>Pandas包</code>将Excel文件读取成文件框格式，然后将可以允许空值的列名除外，检视所有列中是否有空值，如果有则报错请用户将空值补全。代码的实现上值得说的主要是避免将<code>assert语句</code>重复多次而显得语句赘余，因此直接使用循环exec执行字符串的方式：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 遍历所有不在非必填清单中的列，如果不是没有任何空值则报错。</span></span><br><span class="line">Non_compulsory_col = [<span class="string">&quot;Body Type&quot;</span>, <span class="string">&quot;Customer Address&quot;</span>, <span class="string">&quot;Replace No&quot;</span>, <span class="string">&quot;Unit&quot;</span>, <span class="string">&quot;Building&quot;</span>, <span class="string">&quot;District&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> names <span class="keyword">in</span> [x <span class="keyword">for</span> x <span class="keyword">in</span> data_record.head() <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> Non_compulsory_col]:</span><br><span class="line">    <span class="built_in">exec</span>(<span class="string">&quot;assert(not data_record[&#x27;&#123;column_name&#125;&#x27;].isnull().values.any()),&#x27;There are missing values in &#123;column_name&#125; Column, please fill in.&#x27;&quot;</span>.<span class="built_in">format</span>(column_name = names))</span><br></pre></td></tr></table></figure>
<h2 id="获取错误信息">获取错误信息</h2>
<p>使用Selenium与网站交互时，可能有一些情况下某个客户不能按正常步骤获得报价，或者信息本身不符合报价条件，又或者信息填写错误等等都会导致及脚本无法按照预期获得最后结果。这种时候我们的脚本需要记录下这些错误的原因从而让用户可以相应调整信息输入或回复给报价人不能报价等。而可能导致错误信息的原因根据我的测试都有好几种，我希望脚本可以将所有可能的错误信息全部记录下来。</p>
<h3 id="脚本结构">脚本结构</h3>
<p>我将每一个报价过程中填写每一个页面的脚本各自封装成函数，需要的参数只有记录编号。这样将每一条信息输入过程模块化，就可以在报错时更快定位到报错的位置。而在每一个函数中都加上一个<code>try: except:</code>的结构，如果出现错误则收集所有错误信息并<code>return</code>，需要注意的是我的每一个模块本身是没有返回值的，也就是说如果不报错的话每一个函数的返回值都应该是<code>None</code>。那么最后在循环遍历所有记录的函数中依次调用每一个函数并且检视这些函数的返回值，如果返回值不为<code>None</code>则说明这个模块出现了错误，这时以<code>continue</code>语句结束该循环并且记录下返回的错误信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 运行每条记录并检视返回值，如果不为None则说明报错，在Remark中输入返回错误内容。</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data_record)):</span><br><span class="line">    status = start_quoting(x)</span><br><span class="line">    <span class="keyword">if</span> status != <span class="literal">None</span>:</span><br><span class="line">        data_record[<span class="string">&#x27;Remarks&#x27;</span>][x] = status</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Quote record %s failed.&quot;</span>% <span class="built_in">str</span>(x+<span class="number">1</span>))</span><br><span class="line">        <span class="built_in">print</span>(status)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<h3 id="抓取错误信息">抓取错误信息</h3>
<p>导致程序没有按预期完成的可能原因有很多，有些是程序本身的bug，有些是填写信息无效，有些是系统判断不能报价等等。这时使用<code>try:except:</code>结构时报错本身的信息可以反映程序出错的原因，而网站上一些特定区域的提示则可以反映出网站未返回预期结果的原因，我们接下来要做的就是在自动测试的每一步中抓取这些信息并且保存。我使用的方法是用<code>list</code>将每一个可能出现错误信息的地方的信息都存起来，然后将有效的结果合成为一条字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以start quoting阶段为例。</span></span><br><span class="line"><span class="keyword">try</span>: ...</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 首先标明在哪一个模块出现了错误。</span></span><br><span class="line">    errormsg = [<span class="string">&quot;Error in start quoting stage:&quot;</span>]</span><br><span class="line">    <span class="comment"># 然后将系统的错误信息附在list中。</span></span><br><span class="line">    errormsg.append(<span class="built_in">str</span>(e))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 如果error-list中有内容也附在后面。</span></span><br><span class="line">        errormsg += [x.text <span class="keyword">for</span> x <span class="keyword">in</span> driver.find_elements_by_xpath(<span class="string">&quot;//ul[@id=&#x27;error-list&#x27;]/li[not(contains(@style,&#x27;display: none;&#x27;))]&quot;</span>)]</span><br><span class="line">    <span class="keyword">except</span>: <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 最后将errorText中的内容也附上。</span></span><br><span class="line">    errormsg += [x.text <span class="keyword">for</span> x <span class="keyword">in</span> driver.find_elements_by_xpath(<span class="string">&quot;//li[@class=&#x27;errorText&#x27;]&quot;</span>) <span class="keyword">if</span> x.text != <span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="comment"># 将list中所有的信息用换行符隔开输出为一条字符串作为返回值。</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;\n&quot;</span>.join(x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> errormsg <span class="keyword">if</span> x.strip())+<span class="string">&quot;\n&quot;</span></span><br></pre></td></tr></table></figure>
<p>这其中有两条值得详细讲一讲的代码：</p>
<ol>
<li>XPATH的<code>&quot;//ul[@id='error-list']/li[not(contains(@style,'display: none;'))]&quot;</code>的用法中，需要注意的是<code>li[not(contains(@style,'display: none;'))]</code>表示前面那个<code>ul</code>元素下所有中<code>display</code>不为<code>none</code>的<code>li</code>元素：也即所有可见的<code>li</code>元素。</li>
<li><code>&quot;\n&quot;.join(list)</code>表示以<code>&quot;\n&quot;</code>分隔的方式将<code>list</code>中的每一项合并为一个字符串。而后面的<code>x.strip() for x in errormsg if x.strip()</code>则表示将<code>errormsg</code>这个<code>list</code>中每一项移除首尾空行后不为空的项组成的新<code>list</code>，也即移除<code>list</code>中的空项。</li>
</ol>
<h3 id="使用assert语句">使用assert语句</h3>
<p>有一些情况下程序没有按预期运行，但程序却无法立刻报错，例如按下某个按钮后网页没有按照预期进入下一个页面，但程序本身则是在运行下一个模块时才发现这个问题，或者有时候根本不能发现出现问题。这会降低错误抓取的信息的有效性，因此这时我们需要使用assert语句来在一些特定的地方判断代码是否已经按照预期达成了想要的效果。assert本身的使用就是设定一个判断，如果判断没有成立则让程序抛出一个<code>exception</code>，也就是强制进入我们的except的部分，对我们的脚本错误抓取来说非常有用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>(driver.current_url.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>]==<span class="string">&quot;displayPortal.do&quot;</span>),<span class="string">&quot;Login Failed, please check your credentials and try again.&quot;</span></span><br></pre></td></tr></table></figure>
<p>上面这个assert语句会判断某个操作后，网页的url是否变为以<code>displayPortal.do</code>结尾，如果是则说明操作成功，否则进入报错流程。</p>
<h2 id="匹配表单选项">匹配表单选项</h2>
<p>我的程序是在前人开发的“直球版”脚本的基础上扩展，而前人在处理代理输入的车辆信息与报价网站车辆信息的匹配问题时使用的是<code>Cosine Similarity</code>的方法，将车辆的品牌、型号、描述等信息连起来之后与官网的描述拼接起来做<code>Cosine Similarity</code>比较，然后以相似度得分最高的结果为最终结果，其解决匹配错误的方法是将相似度得分以两车的排量差值扣减。这个方法有很多明显的缺点：</p>
<ol>
<li>将原本已经分段的信息合为一条，本质上是剔除了有用的信息（即分段点），这会导致匹配没有用上所有可用信息从而影响准确性。</li>
<li>将代理填写的车辆信息与公司报价网站的通表对比，而通表是离线向相关同事拿的，这导致自动化程度不高且不容易实时同步最新车辆数据。</li>
<li>将排量信息作为文本匹配相似度的修正值的信息使用效率非常低，事实上不同车型的排量信息应该是可以作为判断匹配是否成功的决定性依据的。</li>
</ol>
<p>我想到的解决方法更加简便且匹配准确率更高，也非常简单，即直接提取网站上的表单列表，然后直接点对点逐条信息使用Python的字符串模糊匹配包<code>FuzzyWuzzy</code>进行匹配选择。</p>
<h3 id="FuzzyWuzzy">FuzzyWuzzy</h3>
<p><a target="_blank" rel="noopener" href="https://www.analyticsvidhya.com/blog/2021/07/fuzzy-string-matching-a-hands-on-guide/" title="Fuzzy String Matching – A Hands-on Guide">FuzzyWuzzy</a>的使用<code>Levenshtein Distance(莱文斯坦距离)</code>算法计算两个字符串之间的相似度，此算法又称<code>Edit Distance(编辑距离)</code>算法，是指两个字符串之间，由一个转成另一个所需的最少编辑次数，编辑方法包括替换字符、插入字符、或删除字符。编辑距离越小，两个字符串的相似度就越大。</p>
<p>FuzzyWuzz有两个模块，分别是计算两条字符串相似度分数的<code>fuzz模块</code>和匹配列表中相似度的<code>process模块</code>。本节只介绍fuzz模块：</p>
<p>该模块下主要介绍四个函数（方法），分别为：<code>简单匹配（Ratio）</code>、<code>非完全匹配（Partial Ratio）</code>、<code>忽略顺序匹配（Token Sort Ratio）</code>和<code>去重子集匹配（Token Set Ratio）</code>。</p>
<ul>
<li><code>简单匹配</code>直接以编辑距离计算相似度，与本章开头提到的剔除分段信息的原理相同，这种方法匹配出的结果准确度一般不如其他方法。</li>
<li><code>非完全匹配</code>将两条输入字符串中的短者对比另一条字符串中所有同长度的子串计算编辑距离，这种方法较简单匹配好，但若几个词间顺序变换会对结果产生较大影响。</li>
<li><code>忽略顺序匹配</code>以空格为分隔符将字符串分为多个子串并将所有字母转换为小写移除标点符号，最后将所有子串以首字母排序后组合在一起计算编辑距离。</li>
<li><code>去重子集匹配</code>使用set操作来直接取出字符串中的子串，因此重复或多余的子串会被忽略。</li>
</ul>
<p>使用者可以根据自己的用例来选择适合的方法计算字符串相似度，他们的使用方法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fuzzywuzzy <span class="keyword">import</span> fuzz</span><br><span class="line"></span><br><span class="line"><span class="comment">#简单匹配</span></span><br><span class="line">Ratio = fuzz.ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line"><span class="comment">#非完全匹配</span></span><br><span class="line">Ratio = fuzz.partial_ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line"><span class="comment">#忽略顺序匹配</span></span><br><span class="line">Ratio = fuzz.token_sort_ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br><span class="line"><span class="comment">#去重子集匹配</span></span><br><span class="line">Ratio = fuzz.token_set_ratio(<span class="string">&quot;Hello world!&quot;</span>, <span class="string">&quot;Hello world!&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>在我们的例子中，<code>去重子集匹配</code>应该是提供最精准的匹配结果的方法。</p>
<h3 id="匹配车辆信息">匹配车辆信息</h3>
<p>车辆信息分为品牌、型号、描述等字符串信息和排量、吨位等数字信息，在匹配字符串信息时我们就使用上节提到的<code>fuzz</code>方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match_option</span>(<span class="params">value, element</span>):</span><br><span class="line">    <span class="comment"># 使用Select函数将网站相应表单中的选项提取成list，</span></span><br><span class="line">    option_lst = Select(element).options</span><br><span class="line">    <span class="comment"># 依次计算其相似度</span></span><br><span class="line">    match_score = np.array([fuzz.token_set_ratio(x.text,value) <span class="keyword">for</span> x <span class="keyword">in</span> option_lst])</span><br><span class="line">    <span class="comment"># 最后返回相似度最高的选项字符</span></span><br><span class="line">    <span class="keyword">return</span> option_lst[np.argmax(match_score)].text</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用Select函数的select_by_visible_text方法即可选择匹配的选项</span></span><br><span class="line">matched_option = match_option(value, element)</span><br><span class="line">Select(element).select_by_visible_text(matched_option)</span><br></pre></td></tr></table></figure>
<p>上面这个函数中只需要传入一个需要匹配的字符串(代理提供的信息)与一个selenium网页元素(相应的网页表单)便可以返回表单中与代理提供的信息最匹配的选项，最后使用Select函数的<code>select_by_visible_text()</code>方法选择到匹配的选项。</p>
<p>而匹配数字信息的方法就更加简单直观了，直接在表单中找到离给定数字最近的选项：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">find_nearest</span>(<span class="params">array, value</span>):</span><br><span class="line">    <span class="comment"># 使用numpy方法返回列表中与给定值的绝对差值最小的值</span></span><br><span class="line">    array = np.asarray(array)</span><br><span class="line">    idx = (np.<span class="built_in">abs</span>(array - value)).argmin()</span><br><span class="line">    <span class="keyword">return</span> array[idx]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match_cc</span>(<span class="params">car_cc, element</span>):</span><br><span class="line">    lst = []</span><br><span class="line">    <span class="keyword">for</span> opt <span class="keyword">in</span> Select(element).options:</span><br><span class="line">        cc = opt.get_attribute(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> cc != <span class="string">&quot;&quot;</span>:</span><br><span class="line">            lst.append(<span class="built_in">int</span>(cc))</span><br><span class="line"><span class="comment">#     lst = [int(x.get_attribute(&#x27;value&#x27;)) for x in Select(element).options if x.get_attribute(&#x27;value&#x27;) != &quot;&quot;]</span></span><br><span class="line">    <span class="keyword">return</span> find_nearest(lst, car_cc)</span><br></pre></td></tr></table></figure>
<p>上面的代码没有什么好讲的，唯一的一点就是<code>match_cc()</code>函数中被我注释掉的那条代码和现在用的这个<code>append</code>的代码哪个更加合适一点，因此都放在这里。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">matched_option = match_cc(car_cc, element)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">abs</span>(matched_option-<span class="built_in">int</span>(data_record[<span class="string">&#x27;Cylinder Capacity&#x27;</span>][record_no]))&lt;<span class="number">100</span>),<span class="string">&quot;No similar car available!&quot;</span></span><br></pre></td></tr></table></figure>
<p>最后在选择排量后，将选择的排量与给定的排量信息对比，如果差值大于100则说明匹配一定有误。</p>
<h1>最后</h1>
<p>在这篇文章中我记录了对之前的自动脚本的一些改进方法，同时为了方便没有任何专业知识的同事操作这个自动报价机器人，我还使用<code>tkinter包</code>另外设计了一个GUI界面，这其中也有许多值得一说的小技巧和实现记录，我会在下一篇文章中详细介绍。</p>
<p>[第21篇]</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">RayHLei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://raylei.space/2022/08/01/21-Automated_Website_Logging_Robot/">http://raylei.space/2022/08/01/21-Automated_Website_Logging_Robot/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%B7%A5%E4%BD%9C%E5%AD%A6%E4%B9%A0/">工作学习</a><a class="post-meta__tags" href="/tags/Python/">Python</a><a class="post-meta__tags" href="/tags/Selenium/">Selenium</a><a class="post-meta__tags" href="/tags/RPA/">RPA</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/21-Automated_Website_Logging_Robot.jpg" data-sites="facebook,twitter,wechat,weibo,qq,douban"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/07/03/20-Data-mining-application-in-CRM/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/20-Data-mining-application-in-CRM.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">[数据分析] 数据挖掘技术在销售、营销与客户关系管理中的应用概览</div></div></a></div><div class="next-post pull-right"><a href="/2022/08/23/22-Automated_Website_Logging_Robot_GUI/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/22-Automated_Website_Logging_Robot_GUI.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">[编程算法]自动报价机器人的GUI开发记录</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/08/23/22-Automated_Website_Logging_Robot_GUI/" title="[编程算法]自动报价机器人的GUI开发记录"><img class="cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/22-Automated_Website_Logging_Robot_GUI.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-23</div><div class="title">[编程算法]自动报价机器人的GUI开发记录</div></div></a></div><div><a href="/2022/02/21/4-Selenium_documentation_learning/" title="[编程算法] 公司项目需要的自动化测试Selenium文档解读"><img class="cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/4-Selenium_documentation_learning.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-21</div><div class="title">[编程算法] 公司项目需要的自动化测试Selenium文档解读</div></div></a></div><div><a href="/2022/06/18/19-A-web-scraper-for-company-info/" title="[编程算法] 使用urllib和BeautifulSoup制作爬虫脚本收集公司公开信息的记录"><img class="cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/19-A-web-scraper-for-company-info.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-18</div><div class="title">[编程算法] 使用urllib和BeautifulSoup制作爬虫脚本收集公司公开信息的记录</div></div></a></div><div><a href="/2022/03/09/10-introduction-to-different-db/" title="[数据分析]常用数据库类型对比介绍"><img class="cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/10-introduction-to-different-db.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-09</div><div class="title">[数据分析]常用数据库类型对比介绍</div></div></a></div><div><a href="/2022/03/27/11-MSAccess-documentation-tool/" title="[MS Office]使用 MS Access 开发文档管理查询工具"><img class="cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/11-MSAccess-documentation-tool.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-27</div><div class="title">[MS Office]使用 MS Access 开发文档管理查询工具</div></div></a></div><div><a href="/2022/04/09/14-R-EDA-basics/" title="[数据分析] 使用R做EDA分析的基础知识"><img class="cover" src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/cover_img/14-R-EDA-basics.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-09</div><div class="title">[数据分析] 使用R做EDA分析的基础知识</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div><div id="comment-switch"><span class="first-comment">Livere</span><span class="switch-btn"></span><span class="second-comment">Disqus</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NTQ0NC8zMTkxMQ=="></div></div><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">序言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">正文</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E8%BE%93%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.</span> <span class="toc-text">检查输入文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.</span> <span class="toc-text">获取错误信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%84%9A%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">2.2.1.</span> <span class="toc-text">脚本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%93%E5%8F%96%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-number">2.2.2.</span> <span class="toc-text">抓取错误信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8assert%E8%AF%AD%E5%8F%A5"><span class="toc-number">2.2.3.</span> <span class="toc-text">使用assert语句</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E8%A1%A8%E5%8D%95%E9%80%89%E9%A1%B9"><span class="toc-number">2.3.</span> <span class="toc-text">匹配表单选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FuzzyWuzzy"><span class="toc-number">2.3.1.</span> <span class="toc-text">FuzzyWuzzy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E8%BD%A6%E8%BE%86%E4%BF%A1%E6%81%AF"><span class="toc-number">2.3.2.</span> <span class="toc-text">匹配车辆信息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">最后</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background-image: url('https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/blog_img/algorithm.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By RayHLei</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hey! What have you learned today!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !true) {
  if (true) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'http://raylei.space/2022/08/01/21-Automated_Website_Logging_Robot/'
    this.page.identifier = '2022/08/01/21-Automated_Website_Logging_Robot/'
    this.page.title = '[编程算法]基于Selenium的自动网页报价机器人功能实现记录'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://rayhlei.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Livere' === 'Disqus' || !true) {
  if (true) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script></div><script id="canvas_nest" defer="defer" color="133,133,133" opacity="0.7" zIndex="-1" count="200" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":60,"vOffset":-40},"mobile":{"show":true,"scale":0.5},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>