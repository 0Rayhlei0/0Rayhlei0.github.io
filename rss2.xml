<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>HideOnRubbish | RayHLei</title>
    <link>http://raylei.space/</link>
    
    <atom:link href="http://raylei.space/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>一个给保险公司做数据分析的人</description>
    <pubDate>Thu, 24 Aug 2023 15:38:33 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>[日语学习] 《标准日本语》中级第三单元学习笔记</title>
      <link>http://raylei.space/2023/08/14/32-Japanese_Chapter_17/</link>
      <guid>http://raylei.space/2023/08/14/32-Japanese_Chapter_17/</guid>
      <pubDate>Mon, 14 Aug 2023 13:58:24 GMT</pubDate>
      
      <description>[第32篇] 本章为学习标准日本语中级第三单元的笔记。</description>
      
      
      
      <content:encoded><![CDATA[<h1>第9课</h1><h2 id="生词-5">生词</h2><h3 id="表1-5">表1</h3><ul><li>てにもつがかり（手荷物係）　[名] 行李员 <code>手荷物を預ける（あずける）。</code></li><li>どのような　[连体] 什么样的</li><li>なふだ（名札）　[名] 姓名牌 <code>荷物に名札をつけて預ける。</code></li><li>よびだし（呼び出し）　[名] 呼叫，传唤 <code>お呼び出しを申し上げます。JC企画の王風様、お友達が入り口でお待ちです。</code></li><li>のちほど（後ほど）　[副] 随后，稍后（「後で」的郑重说法） <code>後ほどお電話します。</code></li></ul><h3 id="表2-5">表2</h3><ul><li>やぶれる（破れる）　[自動2] 破，破损；（平稳安定的状态）被打破 <code>靴下が破れる。</code></li><li>やぶく（破く）　[他動1] 撕破，弄破 <code>手紙を読まずに破いた。</code></li><li>しょくご（食後）　[名] 饭后</li><li>とりあつかい（取り扱い）　[名] 对待，待遇；&lt;物品的&gt;操作，使用；&lt;事务、工作的&gt;处理，办理 <code>この機械は取り扱いが難しい。</code></li><li>しょうさい（詳細）　[名、形2] 详细；详细情况，细则 <code>詳細な説明</code></li><li>よびだす（呼び出す）　[動1] 呼叫，传唤 <code>仕事中に、呼び出してすみません。</code></li><li>ことづける　[動2] 托人捎带 → 可写作「言付ける」   <code>家へは帰れないので、友人に言づけておいた。</code></li><li>もうしこむ（申し込む）　[動1] 提出，申请 <code>彼女に結婚を申し込む。</code></li><li>しじ（指示）　[名、動3] 指示，吩咐 部下に指示する。</li></ul><h3 id="表3-5">表3</h3><ul><li>けいゆ（経由）　[名] 经由 <code>香港を経由してシンガポールへ行く。</code></li><li>かんこう（観光）　[名、動3] 观光、游览</li><li>けんがく（見学）　[名、動3] 参观考察</li><li>よくじつ（翌日）　[名] 翌日，次日，第二天 <code>翌朝（よくあさ）</code></li><li>ふあん（不安）　[名、形2] 不安 <code>不安を感じる。</code></li><li>きしょう（起床）　[名、動3] 起床</li><li>よびかける（呼びかける）　[動2] 招呼，呼吁</li><li>だまる（黙る）　[動1]  闭嘴，沉默，瞒着</li><li>じゅん（順）　[名] 顺序 <code>一番から順に説明する。</code></li><li>ばくはつ （爆発）　[名、動3] 爆发 <code>爆弾が爆発する。</code></li><li>うまる（埋まる）　[動1] 被埋，填满 <code>庭は木の葉で埋まる。</code></li><li>すみ（隅）　[名] 角落 <code>部屋の隅に本棚が置いてある。</code></li><li>なんとなく　[副] 总觉得 <code>なんとなくおかしい。</code></li><li>ほっと　[副、動3] 放心，松了口气 <code>子供が帰ってきたのを見てほっと安心した。</code></li><li>あいつうじる（相通じる）　[動2] 相通 <code>二人の作風には相通じるものがある。</code></li><li>～はつ（～発）　～出发 <code>東京発の下り列車</code></li><li>～はく（～泊）　～晚 <code>二泊三日（にはくみっか）の旅行</code></li></ul><h3 id="表4-5">表4</h3><ul><li>ゆげ（湯気）　[名] 水蒸气，热气</li><li>ぞうきん　[名] 抹布 → 可写作「雑巾」</li><li>いきなり　[副] 突然，冷不防 <code>いきなりそう言われても、どうしたらいいか分からない。</code></li><li>うらやましい　[形] 羡慕，眼红 → 可写作「羨ましい」</li><li>このむ（好む）　[他動1] 喜欢，爱好  <code>絵をかくことを好む。</code></li><li>おえる（終える）　[動2] 做完，完成，结束 <code>仕事を終えて家に帰った。</code></li><li>そのうち　[副] 不久，过几天 <code>そのうち帰ってくる。</code></li><li>ねいろ（音色）　[名] 音色</li><li>めだつ（目立つ）　[自動1] 显眼，显著，引人注目<code>この上着はすぐ汚れが目立つ。</code></li></ul><h2 id="语法-5">语法</h2><ol><li>「自動詞＋ている」：单纯地陈述客观状态；「他動詞＋てある」：侧重动作结束后留下的状态，暗示动作的实施者。<code>玄関の電気が付けてある。/玄関の電気が付いている。</code></li><li>「～てある」：关注结果、状态; 「～ておく」：关注行为。<code>書類は机の上に置いてあります。/書類は机の上に置いておきます。</code></li><li>～どおり：表示与预定好的内容没有出入，“与～一样”“按照～那样”「動詞基本形／た形」＋とおり；「名詞＋の」＋とおり；「名詞」＋どおり。<code>私の言うとおりに繰り返して言ってください。/田中さんは、希望どおり大学院に進学しました。</code></li><li>に：表示存在的场所或移动行为的目的地；で：表示动作进行的场所 <code>李さんは今図書館にいます。/李さんは今図書館で本を読んでいます。</code></li><li>あこがれ：由动词「憧れる（あこがれる）」转化而来，后续「の」修饰名词。此时词转变为表示性质、状态。<code>これは社員一同、期待の新製品です。</code></li><li>拟声拟态词后续「する」：大部分拟声拟态词为副词，也可后续「する」构成自动词。 <code>背の高い男性が、にこにこしながら近づいてきて何か言う。</code></li><li>疑问词 / 疑问短句＋かと思ったら： 表示事出所料，与原先想象的不同，带有意外的语气。<code>誰かと思ったら、我々を迎えに来たガイドさんだった。/やあ、どこの美人かと思ったら、花子じゃないか。</code></li><li>のだろうか：「だろうか」主要针对眼前的事实表示疑问；「のだろうか」则是对某个事情背后的事实表示疑问。<code>（天気予報では、明日は晴れだそうだ。でも、今日は朝から曇っている。本当に）明日は晴れるのだろうか。/（明日ハイキングに行くことになっているけど、）明日は晴れるだろうか。</code></li><li>なんて：接续：简体小句＋なんて；形2词干 / 名词（だ）＋なんて 意思：常用口语中，后项多接评价性的语言，用于表示惊讶、赞叹或轻视，也可接过对方话题表示自己的态度。<code>ここで会うなんて、びっくりしました。</code></li><li>らしい：1）表示推测、传闻：简体小句＋らしい；形2词干 / 名词＋らしい <code>隅に日本人らしいグループがいたので、なんとなくほっとする。</code>2）表示典型特征：名词＋らしい <code>彼はとても男らしい。</code></li></ol><h1>例句</h1><ol><li>明天的碰头会在会议室召开。 <code>明日の打ち合わせは会議室にて行います。</code></li><li>在路上听到有人叫自己的名字。还在想是谁呢，原来是我初中时的朋友。 <code>道で名前を呼ばれた。だれかと思ったら、中学校時代の友達だった。</code></li><li>已经中午了，但工作连一半也没做完。这项工作在傍晚之前真的干得完吗？ <code>もうお昼だ。仕事の半分も終わっていない。この仕事が夕方までに終わるのだろうか。</code></li><li>居然在这种地方遇到你，真没想到！ <code>こんなところで会うなんて、びっくりしました。</code></li></ol><h1>第10课</h1><h2 id="生词-6">生词</h2><h3 id="表1-6">表1</h3><ul><li>とんでもない　[形1] 1. 没有的事儿，哪里的话（そんなことはない）2. 荒唐，岂有此理，超乎常识的（非常識だ）<code>とんでもない値段 / 間違い / 要求</code></li><li>いれる（入れる）　[動2] 包含，算上 <code>子供を入れて10人です。</code></li><li>のんびり　[副、動3] 轻松，悠闲，悠然自得 <code>昨日は、自宅でのんびりと一日を過ごした。</code></li><li>おかみ（女将）　[名] 老板娘 <code>料理屋の女将</code></li><li>かんしんがある（関心がある）　感兴趣</li><li>～つき（～付き）　附带～ <code>食事つき</code></li></ul><h3 id="表2-6">表2</h3><ul><li>まんしつ（満室）　[名] 客满，无空房间 <code>あいにくその日は満室となっております。</code></li><li>あんせい（安静）　[名、形2] 静养 <code>医者から絶対安静を命じられた。</code></li><li>エプロン　[名] 围裙 &lt;英：apron&gt;</li><li>せいそうする（清掃する）　[動] 清扫，扫除 <code>車内の清掃が済んで、乗客が乗り込んできた。</code></li><li>くむ（組む）　[動1] 手挽手，安排，编制 <code>ふたりは腕を組んで駅まで歩いた。</code></li><li>たまたま　[副] 偶尔，偶然 <code>たまたま駅で旧友にあった。</code></li><li>いちど（一度）　[副] 一次、一遍 <code>前から一度会ってみたい。</code></li><li>きょうりょくする（協力する）　[動3] 合作，协作 <code>今日はご協力ありがとうございました。</code></li><li>つぼ　[名] 瓶，坛，罐 → 可写作「壺」 <code>壺を手に取る。</code></li><li>しちゃくする（試着する）　[動3] 试穿 <code>試着室はどこですか。</code></li><li>かたみち（片道）　[名] 单程 &lt;-&gt; 往復（おうふく） <code>会社から家まで片道1時間半かかる。</code></li><li>ひかり（光）　[名] 光线</li><li>あいずする（合図する）　[動3] 发信号，示意 <code>太郎は、父親に目で合図を送った。</code></li><li>とく（解く）　[動1] 解答；解开；解除 <code>算数の問題を解く。</code></li><li>ひょうじ（表示）　[名] 指示，表明，表示</li><li>まんぞく（満足）　[名、動3、ナ形]  满意，心满意足；2. 完善，完美，充分。 <code>今の子どもは満足に字も書けない。</code></li></ul><h3 id="表3-6">表3</h3><ul><li>のべ（延べ）　[名] 总计 <code>この駅の1日の利用者数は延べ3万人です。</code></li><li>ちちゅう（地中）　[名] 地下，地里 <code>種を地中に埋める。</code></li><li>わきでる（湧き出る）　[動2] 喷涌，涌出 <code>温泉が地中から湧き出る。</code></li><li>きてい（規定）　[名、動3] 规定，认定 <code>米国の大学は、学年という考えはなく、規定の授業を終えれば卒業できる。</code></li><li>ふくむ（含む）　[動1] 含，包含，含有 <code>かれは一口、酒を含んでそれからゆっくりと説明してくれた。</code></li><li>にごる（濁る）　[動1] 混浊 <code>川の水が濁っている。</code></li><li>しんけいつう（神経痛）　[名] 神经痛</li><li>こうけつあつ（高血圧）　[名] 高血压</li><li>ちりょう（治療）　[名、動3] 治疗 <code>手術と薬による治療がありますが、どちらにしますか？</code></li><li>かえる（変える）　[動2] 改变 <code>インターネットは、私たちの日常生活を変える。</code></li><li>たっぷり　[副] 足够，充分 <code>時間はたっぷりありますから、慌てなくてもいいです。</code></li><li>つかる　[動1] 浸泡 → 可写作「浸かる」</li><li>あつめる（集める）　[動2] 招揽、吸引 <code>注目を集める。</code></li><li>しゅくはくする（宿泊する）　[動3] 投宿 <code>上海滞在中は、平和ホテルに宿泊していた。</code></li><li>せんとう（銭湯）　[名] 公共澡堂，洗浴中心</li><li>ころ　[名] 时候 → 可写作「頃」 <code>若い頃</code></li><li>たのしむ（楽しむ）　[動1] 享受</li><li>ちょっとした　[連] 一点，稍稍；相当的 <code>ちょっとしたトラブルがあった。</code></li><li>いやし　[名] 放松，治疗，抚慰 → 可写作「癒し」 <code>疲れたとき、いつもこの歌が私の心を癒してくれる。</code></li></ul><h3 id="表4-6">表4</h3><ul><li>ていりゅうじょ（停留所）　[名] 公交车站 <code>バス停 ＝ バスの停留所 巴士站</code></li><li>ぴったり　[副] 正合适 <code>君にぴったりの仕事</code></li><li>つるつる　[副、動3] 光滑 <code>雪で路面は凍ってつるつると滑った。</code></li><li>こうずい（洪水）　[名] 洪水</li><li>ながす（流す）　[動1] 流下，冲走，播放 <code>二人は感動して涙を流しながら聞いていた。</code></li><li>おかず　[名] 菜肴，配菜</li><li>まったく（全く）　[副] 完全，全然 <code>まったくそのとおりだ。</code></li><li>はんい（範囲）　[名] 范围</li><li>しょくざい（食材）　[名] 食品的原材料 <code>一週間分の食材を買っておいた。</code></li><li>げんいん（原因）　[名] 原因 <code>事故の原因を調べる。</code></li><li>いやす　[動1] 治疗，修养 → 可写作「癒す」 <code>とても有名な医者さんで、どんな病気でも必ず癒してくれるそうだ。</code></li><li>かおり（香り）　[名] 香味 &lt;-&gt; 匂い（概指气味）<code>花の香り</code></li><li>よぼうする（予防する）　[動3] 预防 <code>治療するのに一番良い方法です。</code></li><li>たてなおす（立て直す）　[動1] 重建，站稳 <code>日本は、経済を立て直すために、改革を行わなければならない。</code></li><li>いじする（維持する）　[名、動3] 维持，保持 <code>健康維持をするために何かしていますか。</code></li><li>ひづけ（日付）　[名] 日期 <code>契約の日付</code></li><li>そうとう（相当）　[副、形2、動3] 相当 <code>高野君は、お酒がそうとういけるようだ。</code></li></ul><h2 id="语法-6">语法</h2><ol><li>動詞（基本形／ない形）＋よう／ように：表示目的，「よう」多用于书面语或较正式的口语场合。<code>できるだけたくさんの取材ができるよう（に）予定を立てました。</code></li><li>予定：最常用的动词搭配「予定を立てる / 組む / 入れる」<code>今夜は、山田に電話して東京行きの予定を立てることにした。</code></li><li>とんでもない：① 作为形容词，含有出乎意外，不合常理等消极语气。 ② 会话中，还可表示强烈的否定，并伴有强烈的感情色彩。<code>-- 先日は、落とした財布を届けてくださって、本当にありがとうございました。-- いえ、とんでもありません。たまたま見つけたものですから。</code></li><li>尊他语形式：  「お＋動詞ます形」（如：「お泊り」「お急ぎ」）「ご＋サ変語幹或汉字名词」（如：「ご予定」「ご趣味」）</li><li>～ませ：「ませ」原本为「ます」的命令形，在口语中不表示命令，比「ます」更为郑重。<code>少々お待ちくださいませ。</code></li><li>ご～できる：是自谦语「ご～する」的可能形式，表示己方的动作。</li><li>「のんびり」「リラックス」：这两个词意思相近，但是前者表示悠闲自得，后者表示紧张后的短暂放松。<code>これから、収入は少なくてもいいから、のんびり生きたい。/その医者は手術の前に患者をリラックスさせる。</code></li><li>名詞＋による / 名詞＋によって：两者都在本课中表示方法手段。<code>自動車のデザインはコンピュータによって行われています。/電話による調査は、中国では、あまり行われていない。</code></li><li>「～によって」4种用法：1. 情况差异；<code>林さんが行くかどうかによって、わたしもどうするか決めます。</code>2. 方法、手段；<code>中国語を勉強することによって、世界が広がります。</code>3. 原因；<code>洪水によって多くの建物が流されてしまった。</code>4. 被动句的动作主体。<code>このレストランは、有名なデザイナーによって設計された。</code></li><li>～のだ：表示理由或说明。含有说明背景或叙述已定事实的意思。可用于文章或演讲中对前述内容换一种说法或总结、陈述。<code>「スーパー銭湯」は忙しい人たちのちょっとした癒しの場になっているのだ。</code></li></ol><h1>第11课</h1><h2 id="生词-7">生词</h2><h3 id="表1-7">表1</h3><ul><li>こうかいする（公開する）　[動3] （向公众）开放，公开，公映 <code>新作の映画が公開されました。</code></li><li>こうぎょう（興行）　[名] （为了盈利而举行的）演出，上映，票房 <code>その芝居は三週間興行された。</code></li><li>みこみ（見込み）　[名] 可能性，预估 <code>今年卒業の見込みだ。</code></li><li>しゅえんする（主演する）　[動3] 主演 <code>人気女優が主演する映画</code></li><li>あたる（当たる）　[動1] 中奖，成功，走运 <code>田中さんの企画が当たって、その商品は大ヒットしました。</code></li><li>ひょうかする（評価する）　[動3] 评价 <code>この小説に対する評価は、二つに分かれている。</code></li><li>たかまる（高まる）　[自動1] 高涨，提高 <code>現在、収入格差の拡大を心配する声が高まっている。</code></li><li>そうすると　[連] 于是，这么说来 <code>少子化で子供が少ない。そうすると将来老人ばかりの社会になってしまう。&lt;结果&gt; みんなバイトをする。そうすると、勉強している君は少数派というわけだ。&lt;结论&gt;</code></li><li>わけ　[名] 缘故，缘由，道理 <code>これにはわけがある。</code></li><li>くべつする（区別する）　[動3] 区分，区别 <code>人間は理性によって、動物から区別される。</code></li><li>うけいれる（受け入れる）　[動2] 接受，采纳 <code>新しいものごとを受け入れる。</code></li><li>つかむ　[動1] 抓住，掌握 → 可写作「掴む」  <code>手を掴む。/消費者の心を掴む。</code></li><li>くちこみ（口コミ）　[名] 口碑，传言，小道消息</li><li>ていきょうする（提供する）　[動3] 提供 <code>情報 / 資金 / サービスを提供する。</code></li><li>きがする（気がする）　觉得 <code>誰かに見られているような気がして、わたしは立ち止まった。</code></li><li>どう～（同～）　同～；该～</li></ul><h3 id="表2-7">表2</h3><ul><li>ていねん（定年）　[名] 退休，退休年龄 <code>今年定年を迎える。</code></li><li>ぬく（抜く）　[動1] 拔出；超越，超过 <code>歯 / 草を抜く。</code></li><li>さっと　[副] 突然，忽然，骤然 <code>さっと立ち上がる。</code></li><li>ヒットする　[動3] 成功，大受欢迎 &lt;英：hit&gt; <code>ラジオをつけると、昔のヒット曲が流れてきた。</code></li><li>せつやく（節約）　[名、動3] 节约 <code>節約は身近な、簡単なことから始めましょう。</code></li><li>うすめる（薄める）　[他動2] 冲淡；稀释；淡化 <code>日本人は、ウイスキーを水で薄めて飲むのが普通だ。</code></li><li>とおす（通す）　[動1] 将……带到；通过；穿过 <code>窓を開けて風を通す。</code></li><li>ていかする（低下する）　[動3] 下降 <code>学力が低下する。</code></li><li>いずれ　[副] 早晚；两者中的某一个 <code>いずれかひとつ選んでください。</code></li><li>じょうい（上位）　[名] 排前面，优先，地位、等级高 <code>男性上位の社会</code></li><li>ゆだん（油断）　[名、動3] 疏忽，掉以轻心 <code>大事な仕事だから、油断するな。</code></li><li>はいく（俳句）　[名] 俳句</li><li>こわす（壊す）　[動1] 损害，伤害 <code>働きすぎて体を壊してしまった。</code></li><li>こうりゅう（交流）　[名、動3] 交流 <code>中国と日本との文化交流の歴史は長い。</code></li></ul><h2 id="语法-7">语法</h2><ol><li>ところ：接在「今」「現在」等之后，表示阶段、或一段相当幅度的时间。 <code>日本のGDPは今のところ世界第2位ですが、将来中国に抜かれるでしょう。</code></li><li>見込み：表示预料、估计、可能性等。 动词现在将来时+見込みだ <code>来年大学卒業の見込みです。</code></li><li>AでもBでも / AにしてもBにしても：表示“不管是A还是B，都……”，用于列举出两个同类或对立的事物。前者含有极端之意，后者可以接在简体小句后。 <code>彼が主演する映画は、アクションでも恋愛ドラマでも、必ず当たります。/来るにしても来ないにしても、電話をください。</code></li><li>～わけではない：表示对原本应该推断得出的结论的否定。 <code>外国のものだから人気があるというわけではないんですね。</code></li></ol><p>[第32篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E6%97%A5%E8%AF%AD%E5%AD%A6%E4%B9%A0/">日语学习</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/%E6%A0%87%E5%87%86%E6%97%A5%E6%9C%AC%E8%AF%AD%E4%B8%AD%E7%BA%A7/">标准日本语中级</category>
      
      
      <comments>http://raylei.space/2023/08/14/32-Japanese_Chapter_17/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[日语学习] 《标准日本语》中级第二单元学习笔记</title>
      <link>http://raylei.space/2023/07/04/30-Japanese_Chapter_16/</link>
      <guid>http://raylei.space/2023/07/04/30-Japanese_Chapter_16/</guid>
      <pubDate>Tue, 04 Jul 2023 15:02:15 GMT</pubDate>
      
      <description>[第30篇] 本章为学习标准日本语中级第二单元的笔记。</description>
      
      
      
      <content:encoded><![CDATA[<h1>第5课</h1><h2 id="生词">生词</h2><h3 id="表1">表1</h3><ul><li>じゅしょうする（受賞する）　[動3] 获奖，得奖 <code>最高賞を受賞する。</code></li><li>きっかけ　[名] 机会，契机，开端 <code>奥様と知り合ったきっかけは何ですか。</code></li><li>きんぼし（金星）　[名] 非凡功绩、大功  きんせい（金星）　[名] 金星</li><li>すもう（相撲）　[名] 相扑</li><li>くらい（位）　[名] 地位，职位，官位 <code>～に位を譲る。</code></li></ul><h3 id="表2">表2</h3><ul><li>さて　[連] 那么</li><li>けれども　[連] 不过，但是 → だけれども　だけど</li><li>あと　[連] 另外，再，还有 <code>あと少し頑張ればゴールだ！</code></li><li>で　[連] 那么 <code>で、次は？</code></li><li>てがかり（手がかり）　[名] 线索 <code>手掛かりをつかむ</code></li><li>たより（頼り）　[名] 依靠 <code>地図を頼りに世界一周/頼りになる / ならない</code></li><li>のこす（残す）　[動1] 留下，剩下 <code>夏目漱石は、いろいろな素晴らしい作品を残している。</code></li><li>ゆらいする（由来する）　[動3] 来源于 <code>地名の由来を調べる。</code></li><li>おさめる（納める）　[動2] 缴纳；收纳 <code>税金を納める。</code></li><li>そうい（相違）　[名] 差异、不同 <code>意見の相違</code></li><li>ほうふ（豊富）　[形2] 丰富 <code>豊富な経験</code></li><li>のびる（伸びる）　[動2] 增加，扩大；伸展，变长 <code>背が伸びた。</code></li><li>けっしん（決心）　[名] 决心 <code>決心がつく</code></li></ul><h3 id="表3">表3</h3><ul><li>もと（元）　[名] 原本，原来；根源，起源 <code>不幸のもと</code></li><li>わける（分ける）　[他动2] 区分，分给，分开 <code>クラスを四つに分ける。</code></li><li>とりいれる（取り入れる）　[他动2] 引进，引入，采用 <code>海外の進んだ文化を取り入れる。</code></li><li>もとづく（基づく）　[自动1] 根据，依据，基于 <code>計画に基づいて仕事をする。</code></li><li>うち（内）　[名] 之中，之内 <code>十人スタッフのうち、女性は二人しかいません。</code></li><li>くみあわせる（組み合わせる）　[动2] 组合，编到一起 <code>胸の前で両手を組み合わせて考える。</code></li><li>なまもの（生物）　[名] 生的（食品），生鲜（食品）</li><li>にる（煮る）　[动2] 煮，炖，熬</li></ul><h3 id="表4">表4</h3><ul><li>がんらい（元来）　[名、副] 原来 元旦 → がんたん</li><li>おだやか（穏やか）　[形2] 温和；平稳，平静 <code>穏やかな天気</code></li><li>じつわ（実話）　[名] 真实的故事 <code>この小説は実話に基づいて書かれたものです。</code></li><li>やちん（家賃）　[名] 房租</li><li>コレステロール　[名] 胆固醇</li><li>あくび　[名] 打哈欠 <code>あくびをする / あくびが出る。</code></li><li>かつやくする（活躍する）　[动3] 活跃 <code>これからのきみたちの活躍に期待しています。</code></li><li>ふろしき（風呂敷）　[名] 包袱布 <code>荷物を風呂敷で包む。</code></li><li>かべかざり（壁飾り）　[名] 墙饰</li><li>てさげ（手提げ）　[名] 手提 <code>手提げかばん</code></li><li>ふくろ（袋）　[名] 袋子</li><li>～ぶそく（～不足）　～不足 <code>睡眠不足 / 寝不足</code></li></ul><h2 id="语法">语法</h2><ol><li>～をきっかけに（して）：以……为契机、以……为开端 接続：[名] ＋をきっかけに（して）<code>コンテストで最高賞を受賞したのをきっかけに（して）、売れるようになりました。</code></li><li>～を受ける：表示“接受、受到”  ～に受ける：表示受欢迎 <code>「金星」という名前は、中国人に受けるでしょうか。</code> ～に受けがいい <code>吉田は、社の若い社員に受けのいい上司のようです。</code></li><li>～という点から：点：表示抽象的话题，“观点、方面”。与「こと」「ところ」相同，更口语化。 ～という点から判断する / 分類する。 ～という点で：判断的依据或方式。 <code>日本語の単語を、元の言葉は何かという点から分類すると、…</code></li><li>～に基づいた～： 基：表示根基、基础 → 基づく：表示根据，依据  ～に基づく：～を基礎にして・～を根拠にして／基于……、以……为基础、以……为依据  接続：[名詞]＋に基づく／基づいた＋名詞 　　[名詞]＋に基づいて＋谓语 <code>音読みとは、昔の中国語の発音に基づいた読み方だ。</code></li><li>～を中心とした～： AをBとする：表示“把A作为B”，「とする」「とした」修饰名词。<code>この雑誌は20代の女性を中心とする若者に読まれている。</code> ～を中心に / ～を中心として＋动  <code>地球は太陽を中心として回っている。</code></li></ol><h2 id="例句">例句</h2><ol><li>这部小说是根据真人真事所写的。 <code>この小説は実際にあったことに基づいて書かれたものだ。/この小説は実際にあったことに基づいたものだ。/この小説は実話を基にしたものだ。</code></li><li>地球以太阳为中心旋转。<code>地球は太陽を中心として回っている。</code></li><li>在东京那样的大城市，房租很贵，很辛苦。 <code>東京のような大都市では、家賃が高くて大変だ。</code></li><li>将来我想从事像电视播音员那样的出现在电视上的工作。<code>将来は、アナウンサーのようにテレビに出る仕事につきたいと思っています。</code></li></ol><h1>第6课</h1><h2 id="生词-2">生词</h2><h3 id="表1-2">表1</h3><ul><li>なんと　[副] 竟然，多么 なんと～ことか / だろう：表达说话人赞叹或惊讶之情 <code>なんと素晴らしい景色だろう。</code></li><li>しんらいする（信頼する）　[动3] 相信 <code>部下から信頼されるには、どうすればいいか。</code></li><li>おひる（お昼）　[名] 午间，午饭</li><li>ながびく（長引く）　[动1] 拖延，延长</li><li>ねっしん（熱心）　[形2] 热心 <code>研究に熱心な先生/研究熱心な先生</code></li><li>まさに（正に）　[副] 正是，确实；即将 <code>まさに君の言うとおりだ／そのとおりだ。</code></li><li>きになる（気になる）　在意，挂心，为～而烦心 <code>明日お祭りがあるので天気が気になる。</code></li></ul><h3 id="表2-2">表2</h3><ul><li>たった：Only ただ：Just</li><li>しばい（芝居）　[名] 戏剧，话剧；演技 <code>今のはお芝居だよ。</code></li><li>はやる　[自動1] 流行　→ 可写作「流行る」  <code>このごろ、風邪ははやっているそうだ。</code></li><li>おしゃれする　[自動3] 打扮　→ 可写作「お洒落する」 <code>彼は大のおしゃれだ。</code></li><li>おっと（夫）　[名] 丈夫</li><li>いきのこる（生き残る）　[自動1] 幸存 <code>地震で家族を失い、生き残ったのはぼくひとりだけだ。</code></li><li>たおれる（倒れる）　[自動2] 病倒；倒下；倒塌；倒闭 <code>父が過労で倒れた。</code></li><li>しはらい（支払い）　[名] 支付 <code>クレジットカードでの支払いはできますか。</code></li><li>リストラ　[名] 重组；解雇，裁员 &lt;英：restructuring的略语&gt; <code>夫がリストラされて、一家の生活が苦しくなった。</code></li><li>ぎゃく（逆）　[名、形2] 相反   <code>逆な言い方</code></li><li>ぎろん（議論）　[名] 讨论，谈论；争论 <code>その議論は成り立たない。</code></li></ul><h3 id="表3-2">表3</h3><ul><li>れんげ　[名] 调羹 【散蓮華（ちりれんげ）的简略说法】</li><li>もちあげる（持ち上げる）　[他動2] 端起，拿起，举起 <code>みんな、グラスを持ち上げて、乾杯した。</code></li><li>ぐ（具）　[名] 工具；配料、材料 <code>味噌汁の具(味增汤的食材)\お椀などの日常の具</code></li><li>ちいき（地域）　[名] 地域，区域</li><li>たけ（竹）　[名] 竹子</li><li>ぎょく（玉）　[名] 玉 <code>宝玉（ほうぎょく）</code></li><li>やや　[副] 稍微，略显 <code>これについて、やや気になる点があります。</code></li><li>たいら（平ら）　[形2] 平，平坦 <code>牛乳バッグをたいらに延ばす。(把牛奶盒子压平)</code></li><li>さき（先）　[名] 先端，尖儿；前面；将来</li><li>とがる（尖る）　[自動1] 尖；尖锐，尖细；刻薄；（神经）紧张 <code>鉛筆の先が尖っている。</code></li><li>ぬる（塗る）　[他動1] 涂抹，刷 <code>パンにバターを塗る。</code></li><li>じつに（実に）　[副] 实在，确实，真 <code>実に面白い。</code></li></ul><h3 id="表4-2">表4</h3><ul><li>ビニール　[名] 塑料薄膜</li><li>うなぎ（鰻）　[名] 鳗鱼</li><li>おくる（贈る）　[動1] 赠送 <code>バレンタインデーというのは、女の子が男の子にチョコレートを贈る日だ。</code></li><li>じき（時期）　[名] 时期 <code>時期尚早（じきしょうそう）</code></li><li>たいおう（対応）　[名] 接待，应对 <code>店員の対応が悪いと、お客さんは二度と来てくれなくなる。</code></li><li>てんこう（天候）　[名] 气候</li><li>おんど（温度）　[名] 温度</li><li>ちょうせいする（調整する）　[動3] 调整 <code>部屋の温度を調整する。</code></li><li>すいどう（水道）　[名] 自来水，自来水管道</li><li>じこく（時刻）　[名] 时间，时刻</li><li>きのう（機能）　[名] 功能</li><li>しょくりょうひん（食料品）　[名] 食品 <code>スーパーから買ってきた食料品を冷蔵庫に納めた。</code></li><li>ざっか（雑貨）　[名] 杂货，日用品 <code>雑貨を扱う店（雑貨屋）</code></li><li>ながぐつ（長靴）　[名] 靴子</li><li>すな（砂）　[名] 沙子 <code>砂浜（すなはま）沙滩</code></li><li>み（実）　[名] 果实；种子 <code>椰子の実</code></li><li>たてる（立てる）　[動2] 立起，竖起；弄响；制定 <code>旗を立てる。</code></li></ul><h2 id="语法-2">语法</h2><ol><li>「のだ」「のです/んです」的最根本用法：说明情况、陈述事由、解释原因  A.「のだ」用于根据某种前提事态，对状况进行推测并向对方确认。<code>&lt;看见对方拿着湿漉漉的伞进来&gt; -- あ、雨が降っているんですか。（降っていますか。×）</code>； B. 在「なぜ～」、「どうして～」等询问理由的疑问句中，常使用「～のですか / ～んですか」。 <code>&lt;问一个正在笑的人&gt;  -- なぜ笑っているんですか？（笑っていますか？×）</code>；C.「のだ」最根本的用法是对事实的说明，这一基本用法贯穿于「の？」「のか」「のだろう」「のかもしれない」等用法之中。 <code>かれはもう会社にいない。きっと帰ったんだろう</code>。D.「のだ」的否定形式是「のではない」，一般认为是对原因、手段、方法等状语部分进行否定。 <code>僕は行かなかった。行けないのではない。行きたくないのだ。</code>E.「のだ」由于是根据某个事实做出判断，本来某些只能用于第一人称的反映人的内心世界的感情、态度如果表现于外在，那么「のだ」就可用在这些词后。<code>姉は歌を歌いながら食事の用意をしている。きっと嬉しいんだ。</code></li><li>口语中，「が」「を」「は」等助词容易被省略，而增添特定意义的「から」「より」「まで」等则不宜省略。此外修饰名词时很少见到省略现象。</li><li>～による / ～によって：前接名词，表示“因……而不同”，后多接续「違う」「変わる」「いろいろだ」等表达。～によって修饰谓语；<code>食べる時に何を使うかは、食事の内容や習慣によって違う。</code>～による修饰名词或单独使用 <code>食事の内容による値段の違いはありますが、ツアーの行き先は同じです。</code></li><li>简体小句 / 名词+といっても：表示转折关系，意思是“虽说……但是……”。<code>「はし」といっても、その形や材料は国や地域によって違う。</code></li><li>简体小句 / 名词の＋ほか：表示“除……之外”。如前后项是并列关系，可用「～ほか、～も」。<code>材料は木や竹、プラスチックのほか、玉や金属のものもある。</code></li><li>身体部位、外观、形状、颜色等名词＋をする：表示人或物体呈现出某种外观、形状、颜色、表情。～をしている 用于句末 <code>面白い形をしている。</code>；注意与「感觉名词＋がする」的区别 <code>変な味がする。</code></li><li>～とされる：表示一种普遍认可的事实，类似的表达有「と考えられる」「と思われる」。 在有特定来源时以及叙述当前被认同的事实而自己持有不同意见时，多用「～とされている」。<code>大皿から料理を取る時は、取りばしを使うのが、正式なマナーだとされる。</code></li></ol><h2 id="例句-2">例句</h2><ol><li>风俗习惯因国家而异。 <code>習慣は国によって違う。</code></li><li>这个药有的人用了会有副作用。 <code>この薬は人によっては副作用が出ることもあります。</code></li><li>虽说都叫筷子，但其形状和材质因国家或地域不同而不同。<code>「はし」といっても、その形や材料は国や地域によって違う。</code></li><li>虽说会英语，但也只不过是会一些简单的寒暄而已。 <code>英語ができるといっても、簡単な挨拶くらいしかできない。</code></li><li>那朵云形状像猫。 <code>あの雲は、猫の形をしている。</code></li><li>前辈以一种不可思议的表情看着我。<code>先輩は、不思議そうな顔をしてぼくを見ている。</code></li><li>在日本，2月14日的情人节被认为是女性向男性送巧克力的日子。<code>日本では、2月14日のバレンタインデーは、女性が男性にチョコレートを贈る日だとされている。</code></li></ol><h1>第7课</h1><h2 id="生词-3">生词</h2><h3 id="表1-3">表1</h3><ul><li>さんこう（参考）　[名] 参考 ～を参考にする：把～作为参考 <code>社員の意見を参考にする。</code>；～が参考になる：～有参考价值 <code>仕事の参考になる本を紹介してください。</code></li><li>かんせい（感性）　[名] 感性 <code>感性を育てる。</code></li><li>そうさく（創作）　[名] 创作 <code>歌の創作</code></li><li>ぼしゅうする（募集する）　[动3] 征集，募集，招募 <code>アルバイトを募集する。</code></li><li>応募する（おうぼする）　[动3] 应征 <code>アルバイト募集に応募した。</code></li><li>とりあげる（取り上げる）　[動2] 拿起；剥夺；采纳；作为问题提出，报道 <code>僕はカップを取り上げ、コーヒーを飲み干した。&lt;拿起&gt;/誰でも、楽しみを取り上げられるのは辛いものだ。&lt;剥夺&gt;/彼らの提案は全く取り上げられなかった。&lt;采纳&gt;/そこにはいろんな問題があるのだが、まず人生観を取り上げてみたい。&lt;作为问题提出&gt;/不思議な事件なので、各新聞社は一斉に（いっせいに）取り上げた。&lt;报道&gt;</code></li></ul><h3 id="表2-3">表2</h3><ul><li>みっともない　[形1] 不像样，不成体统　<code>大の大人が大きな口を開けて笑うのはみっともない。</code></li><li>ニンニク　[名] 大蒜</li><li>えんきする（延期する）　[動3] 延期　<code>昨日は運動会だったのですが、雨で延期になりました。</code></li><li>はったつする（発達する）　[動3] 发达　<code>航空機の発達で、外国もぐっと近くなった。</code></li><li>しんさつ（診察）　[名] 看病，诊疗 <code>医者がどんなに診察しても、悪いところは見当らない。</code></li><li>うめ（梅）　[名]  梅花，梅，梅树；梅子 <code>梅干し（うめぼし）</code></li><li>トラブル　[名] 故障，麻烦，纠纷 &lt;英： trouble&gt;  <code>パソコンのトラブルで再起動した。</code></li><li>はんばいそくしん（販売促進）　[名]  促销</li><li>はっぴょう（発表）　[名]  发表，发布，宣布，揭晓 <code>昨日、模試の結果が発表になった。</code></li><li>しゅうごう（集合）　[名]  集合 <code>明日の9時、食堂の前に集合してください。</code></li><li>かいさつぐち（改札口）　[名] 检票口</li><li>ぶしょ（部署）　[名] 岗位，部门 <code>あの人は同じ部署の先輩です。</code></li><li>ベテラン　[名]  行家，里手 &lt;英：veteran&gt; <code>30年の経験を持つベテラン俳優</code></li><li>ちり（地理）　[名] 地理</li><li>～じょう（～錠）　片，粒 <code>この薬は毎日一錠ずつ飲んでください。</code></li></ul><h3 id="表3-3">表3</h3><ul><li>さほう（作法）　[名] 作法(写作法、创作法)；礼仪，礼节 <code>手紙の作法</code></li><li>しゅだん（手段）　[名] 手段 <code>交通手段</code></li><li>めいかく（明確）　[形2] 明确（明らかで確かなこと） <code>事実は明確である。</code></li><li>あてさき（宛て先）　[名] 收件（信）人地址</li><li>いれる（入れる）　[动2] 添加、加入，补足 <code>彼を仲間に入れる。</code></li><li>かんけつ（簡潔）　[形2] 简洁 <code>件名はできるだけ簡潔に書く。</code></li><li>ようてん（要点）　[名] 要点 <code>要点をまとめる。(整理出要点)</code></li><li>かいぎょうする（改行する）　[动3] 换行</li><li>あける　[他动2] 空出；腾空 → 可写作「空ける」 <code>一行空けて書く。</code></li><li>しょめい（署名）　[名] 签名 <code>その博物館に有名人の署名が多く保存されている。</code></li><li>しょぞく（所属）　[名] 供职于～，所属部门 <code>営業部に所属している。</code></li></ul><h3 id="表4-3">表4</h3><ul><li>つきあい（付き合い）　[名] 交往 <code>付き合いが悪い。(不懂交往)</code></li><li>ひので（日の出）　[名] 日出 <code>冬は日の出が遅い。</code></li><li>へんじ（返事）　[名] 回答，答复，回复 <code>手紙の返事はなかなか来ない。</code></li><li>あいづち（相づち）　[名] 随声附和（源于打刀时徒弟帮师傅打帮锤） → 可写作「相槌」<code>【惯用】相槌を打つ。</code></li><li>ごうとう（強盗）　[名] 强盗，抢劫 <code>強盗を働く。</code></li><li>くわえる（加える）　[他动2] 加上，添加；入伙；施加，施以 <code>3に4を加えると7だ。</code></li><li>とりひき（取り引き）　[名] 交易 <code>株の取り引き</code></li><li>てんすう（点数）　[名] 得分；（商品、物品）件数 <code>テストの点数</code></li><li>テーマ　[名] 主题 &lt;德：Thema&gt; <code>論文 / 研究のテーマ</code></li><li>きほん（基本）　[名] 基本，基础 <code>中国語を基本から勉強する。</code></li><li>おもいきり（思い切り）　[副] 狠狠地，痛快地，尽情地；严重 <code>思い切り遊びたい。</code></li><li>ちょうせんする（挑戦する）　[动3] 挑战 <code>世界記録に挑戦する。</code></li><li>ちかづく（近づく）　[自动1] 接近，临近，靠近 <code>春が近づいてきた。</code></li><li>いちおう（一応）　[副] 大致，姑且 <code>話は一応聞いてみよう。</code></li><li>せっちする（設置する）　[动3] 设置，安装&lt;某设备&gt;；设立&lt;某部门&gt; <code>事務所にエアコンを設置した。</code></li><li>たまる　[动1] 积累，积攒 → 可写作「溜まる」 <code>机の上に埃が溜まっている。</code></li></ul><h2 id="语法-3">语法</h2><ol><li>谈话中，当记忆不确切需要确认时，常用「っけ」。 <code>あれ、わたし、さっき花瓶をどこに置いたっけ？</code></li><li>会话中有时需要确认或提醒对方，可用「ね」「でしょう / だろう」。 <code>-- サンドイッチをください。　-- サンドイッチですね。</code></li><li>当对对方提出异议和反问时，可用「じゃない（です）か」「って」等用法。 <code>おかしいじゃないですか。さっきの説明と今の説明は違うじゃないですか。</code></li><li>～だろうと思う：「だろう」表示说话人的推测，和「と思う」一起使用，陈述个人观点，可以缓和语气，不能说成「でしょうと思う」。<code>課長が出張しているから、たぶん今日は会議がないだろうと思います。</code></li><li>～なら：表示根据对方的言谈，或者谈话现场的情况，或者谈话中的某个话题，引出自己对这个话题的观点、意见或者给出建议或提案。<code>ステーキなら、駅前のあの店がいいですよ。</code></li><li>うえで：“在……方面，在……上”，表示抽象的某方面，某领域。 接续：名词＋の / 动词基本形 <code>仕事のうえでのメールや目上の人に送る場合は、いくつか気を付けなければならないことがある。</code> ～上（じょう）：“……上，在……方面” <code>あの二人は法律上もう夫婦です。</code></li><li>さえ～ば：表示后项事态成立的最低条件，“只要……就……”。 <code>お金と時間さえあれば、毎日演劇を見に行きたい。</code>「さえ / すら / まで」提示极端事例 <code>親友にさえ裏切られた。</code></li><li>～といい：表示建议、提议，含有做不做都可以的语气。 <code>よく眠れない場合は、運動をするといいよ。</code></li><li>～ごとに：1）表示时间或空间等距离的间隔，“每隔……”。<code>高速道路には、10キロごとに非常電話が設置されている。</code>；2）表示「～する時にはいつも」。“每次……，每逢……”。<code>彼は、会う人ごとに、自分の彼女を自慢している。</code></li></ol><h2 id="例句-3">例句</h2><ol><li>生活上有什么困难请告诉我。<code>生活のうえで何か困ったことがあったら言ってください。</code></li><li>在日企工作必须注意的事情是什么？ <code>日本の企業で働くうえで、気を付けなければならないことは何ですか。</code></li><li>只要有你在身边，别的我什么都不要。 <code>君さえそばに居てくれれば、ほかに何も要らない。</code></li><li>营销、人事等部门的工作跟大学里学到的东西没什么关系。 <code>営業、人事などという部署の仕事は、大学で学んだこととは関係がない。</code></li><li>为金钱而工作什么的，真是叫人倍感凄凉。 <code>金のために働く、などというのは、さびしいことだ。</code></li><li>你要是睡不好的话，可以运动运动。 <code>よく眠れない場合は、運動をするといい。</code></li><li>奥运会每4年举办一次。 <code>オリンピックは4年ごとに開催されます。</code></li><li>高速公路上每隔1公里就设有一个紧急电话。<code>高速道路には1キロごとに緊急電話が設置されています。</code></li></ol><h1>第8课</h1><h2 id="生词-4">生词</h2><h3 id="表1-4">表1</h3><ul><li>しぼる（絞る）　[动1] 挤；缩小；集中 <code>ターゲットを絞る。/タオルを絞る。</code></li><li>いれる（入れる）　[动2] 花费（精力），倾注（热情） <code>力を入れる。</code></li><li>さぐる（探る）　[动1] 探寻；探访；试探 <code>かばんを探って財布を探す。</code></li><li>しゅざい（取材）　[名] 采访；取材 <code>事故の取材のために大阪へ行く。</code></li><li>～とおり　[名] 按照～，～那样，正如～  → 可写作「～通り」<code>試験の結果は先生の言ったとおりだ。</code></li><li>～通り（どおり）　[接尾] 按照～ <code>全ては計画どおりだ。</code></li></ul><h3 id="表2-4">表2</h3><ul><li>ちょきん（貯金）　[名] 存钱，储蓄 <code>銀行から貯金を下ろす。(取钱)</code></li><li>そうきんする（送金する）　[动3] 寄钱，汇款 <code>親に送金してもらう。</code></li><li>ゆうしょく（夕食）　[名] 晚饭</li><li>とくちょう（特徴）　[名] 特征</li><li>こうさいする（交際する）　[动3] 交往 <code>結婚を前提としない交際はすべて痴漢行為だ。</code></li><li>たいしょう（対象）　[名] 对象 <code>研究対象</code></li><li>はなしあう（話し合う）　[动1] 谈话，讨论</li><li>はりきる（張り切る）　[动1] 绷紧；起劲，干劲足 <code>新しい仕事に張り切る。</code></li><li>かいさいする（開催する）　[动3] 召开，举办 <code>オリンピックは4年ごとに開催される。</code></li></ul><h3 id="表3-4">表3</h3><ul><li>そそぐ（注ぐ）　[动1] 注入，倾注 <code>火に油を注ぐ。</code></li><li>すでに　[副] 已经，业已 <code>私が着いた時には彼らはすでに出発していた。</code></li><li>すると　[连词] 于是，接着 <code>ドアをあけた。すると、中から猫が飛び出してきた。</code></li><li>どんぶり　[名] 大碗</li><li>かわり（代わり）　[名] 代替，替代 <code>私にとって、あなたの代わりはこの世にいない。</code></li><li>くだく（砕く）　[动1] 打碎；挫败；尽心 <code>氷を小さく砕いてコップに入れる。</code></li><li>くふう（工夫）　[名] 设法，下功夫，花心思 <code>ちょっとした工夫で不用品も生きる。</code></li><li>すえ（末）　[名] 末尾，结果 <code>これはみんなで話し合った末の結論です。</code></li><li>さいようする（採用する）　[动3] 雇用，录用；采纳 <code>新人を採用する。</code></li><li>すべりおちる（滑り落ちる）　[动2] 滑下，掉下 <code>階段から滑り落ちて、腰を痛めた。</code></li></ul><h3 id="表4-4">表4</h3><ul><li>もうける（儲ける）　[動2] 赚钱、发财   <code>株で100万円を儲けた。</code></li><li>もうかる（儲かる）　[自動1] 赚钱 <code>楽で儲かる仕事がほしいと思う人がいるが、そんな仕事があるはずがない。</code></li><li>かせぐ（稼ぐ）　[他動1] 挣钱 <code>バイトで生活費と学費を稼ぐ。</code></li><li>ひがい（被害）　[名] 受害 <code>被害が大きい / ひどい。</code></li><li>かくだい（拡大）　[名] 扩大 <code>「企業」の最大の目的は、利益の拡大を図ることだ。</code></li><li>あう（遭う）　[動1] 遭遇 <code>今日はひどい目にあった。</code></li><li>とびだす（飛び出す）　[動1] 跳出，冲出，出走 <code>ドアをあけると、猫が二匹飛び出してきた。</code></li><li>ちかよる（近寄る）　[動1] 接近，走近 <code>あの犬には近寄るな。</code></li><li>ちかづく（近づく）　[動1] 还可表示某个事物、状态、时刻的临近 <code>台風が本土に近づいています。</code></li><li>うつ（打つ）　[動1] 打，敲，注射 <code>転んで頭を打って怪我をした。</code></li><li>はなしあい（話し合い）　[名] 协商，交谈</li><li>まとまる　[動1] 达成一致；凑齐 → 可写作「纏まる」 <code>みんな自分の意見を主張し、話がまとまらなかった。</code></li><li>けっきょく（結局）　[副] 结果，最后 <code>いろいろ試してみたが、結局だめだった。</code></li><li>こづつみ（小包）　[名] 包裹 <code>郵便局に小包を出しに行きます。</code></li><li>とかす（溶かす）　[動1］溶解，溶化 <code>山の上では、水は貴重品だ。そのため、よく雪を溶かして水を作る。</code></li><li>うつす（写す）　[動1］摄影，拍照，抄写 <code>家族に見せてあげようと、私はビデオカメラで街を写しながら歩いた。</code></li><li>ながねん（長年）　[名] 长年</li><li>てんけん（点検）　[名] 检查，检修</li><li>ちんもく（沈黙）　[名] 沉默</li><li>かたよる（偏る）　[動1] 偏向，偏颇 → 亦作「片寄る」 <code>栄養のバランスが偏る。</code></li></ul><h2 id="语法-4">语法</h2><ol><li>建议对方采取某种行动时，基本用法：「～てはどうですか」「～たらどうですか」；更礼貌的说法：「～てはいかがですか」「～たらいかがですか」；推量形式更加礼貌：「～てはいかがでしょうか」「～たらいかがでしょうか」</li><li>提议对方和自己一起作某事时：「～ませんか」「～ましょうか」；「～ましょうよ」则提议的心情更为强烈。；「～はどうですか」「～はいかがですか」更为客气，谨慎。</li><li>代わる：表示替代、代替 <code>父に代わって長男がごあいさつに伺います。</code>； 「～かわりに～」还可表示否定前项，采纳后项（即代替前项），或者表示两个事项的并存。 <code>私が話す代わりに、あなたも話してくださいよ。</code></li><li>～ようにする：表示要努力做到，前面多为状态性内容。其中「する」还可用其他动词替代。 <code>免許証はいつでも見せられるようにしておかなければいけない。</code></li><li>と：此处是「というように」的省略表达、表示形象化的列举。 <code>ガラス、紙、プラスチック、金属と、当時考えられるだけのものが集められた。</code></li><li>工夫：表示开动脑筋，想法设法。 <code>捨てようと思っていたものでも、工夫して使えばもう一度使うことができる。</code></li></ol><h1>例句</h1><ol><li>只看一眼就知道是真品。 <code>ちょっと見ただけで本物だと分かります。</code></li><li>别担心，只是个小感冒。 <code>心配するな、ちょっと風邪を引いただけだ。</code></li><li>便利店里不只是食品和杂志，还有售烟酒等等。 <code>コンビニは、食べ物や雑誌だけではなく、タバコやお酒もあります。</code></li><li>你想吃多少就吃多少吧。 <code>食べたいだけ食べてください。</code></li><li>我把邻居家的玻璃打碎了，结果只道了个歉就完事了。 <code>隣の家のガラスを割ってしまったが、謝っただけですんだ。</code></li><li>这件事恐怕不是道个歉就能解决的吧。  <code>このことは謝るだけではすまないだろう。</code></li><li>我一打开纸箱盖，从里面跳出一只老鼠。 <code>段ボール箱のふたを開けると、中からネズミが飛び出してきた。</code></li><li>由于部长突然生病，所以由科长代替部长去出差。 <code>部長が急病のため、部長に代わって課長が出張することになりました。</code></li><li>在日式房间，不睡床而是铺着被褥睡。 <code>和室ではベッドの代わりに、ふとんでねます。</code></li><li>做生意有赚有赔。 <code>商売は、儲かるときもある代わりに、損をすることもある。</code></li><li>我来教你日语，你能不能教我中文？ <code>僕が日本語を教えてあげる代わりに、君が中国語を教えてくれないかな。</code></li><li>经过长时间协商，大家终于达成了一致意见。  <code>長い話し合いの末に、やっとみんなの意見がまとまった。</code></li><li>思虑良久，最终还是决定辞职。 <code>いろいろ考えたあげく、会社をやめることにした。</code></li><li>查了词典，才明白是记错了。  <code>辞書で調べた結果、間違えて覚えていたことが分かった。</code></li></ol><p>[第30篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E6%97%A5%E8%AF%AD%E5%AD%A6%E4%B9%A0/">日语学习</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/%E6%A0%87%E5%87%86%E6%97%A5%E6%9C%AC%E8%AF%AD%E4%B8%AD%E7%BA%A7/">标准日本语中级</category>
      
      
      <comments>http://raylei.space/2023/07/04/30-Japanese_Chapter_16/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[编程算法]论文解读《Attention is all you need》</title>
      <link>http://raylei.space/2023/07/02/29-Paperstudy_attention_is_all_you_need/</link>
      <guid>http://raylei.space/2023/07/02/29-Paperstudy_attention_is_all_you_need/</guid>
      <pubDate>Sun, 02 Jul 2023 04:37:12 GMT</pubDate>
      
      <description>[第29篇] 本篇解读NLP领域著名论文,提出Transformer结构的《Attention is all you need》以及其他自然语言模型的相关知识。</description>
      
      
      
      <content:encoded><![CDATA[<h1>前言</h1><p>随着最近ChatGPT的爆火，<code>自然语言处理(Natural Language Processing, NLP)</code>再一次成为人工智能领域最热门的课题之一，而ChatGPT所使用的<code>“基于Transformer结构的大语言模型(Large Language Model, LLM)”</code>也在一夜之间成为了几乎所有开发者争相研究的内容。</p><p>本篇将以理解发明Transformer结构的开山之作《<a href="https://arxiv.org/pdf/1706.03762.pdf" title="Attention Is All You Need">Attention is all you need</a>》为引，介绍自然语言处理模型的发展历史和相关知识。</p><h1>正文</h1><h2 id="NLP模型发展历史">NLP模型发展历史</h2><p>人类对自然语言模型的研究从上世纪50年代开始，当时人们对机器处理自然语言的主流研究方向是认为机器应该像人类理解语义那样，通过输入处理各种单词语法规则，将人类语言转换为机器可使用的语言来完成自然语言任务(<a href="https://doubleoperative.files.wordpress.com/2009/12/chomsky-syntactic-structures-2ed.pdf" title="Syntactic Structures By Noam Chomsky, 1957">Noam Chomsky, 1957</a>)。直到70年代初Fred Jelinek首次提出使用统计方法解决自然语言处理问题的<code>统计语言模型(statistical language models)</code>，早年主流的统计语言模型有<code>隐马可夫模型(hidden Markov model)</code>、<code>n元语义模型(n-gram model)</code>、<code>最大熵模型(maximum entropy model)</code>，这些模型与早年<code>语义学(Lexicalism)</code>推崇基于规则的语言模型不同，他们使用已有的数据基于统计模型来计算词语在当前上下文中出现的概率并以此预测自然语言结果，这也是后来神经网络语言模型的基础。</p><p>所谓<code>语言模型(Language model)</code>就是给定前词预测后词的任务模型，第一个神经语言模型(<a href="https://proceedings.neurips.cc/paper_files/paper/2000/hash/728f206c2a01bf572b5940d7d9a8fa4c-Abstract.html" title="A Neural Probabilistic Language Model">Bengio, 2000</a>)首次使用<code>词嵌入(word embeding)</code>与<code>多层神经网络(Multi-layer Neural Networks)</code>来解决n元语义模型面临的短上下文, 维数灾难等问题。此后涌现的新技术如<code>多任务学习(Multi-task learning)</code>(<a href="https://dl.acm.org/doi/abs/10.1145/1390156.1390177" title="A unified architecture for natural language processing: deep neural networks with multitask learning">Collobert and Weston， 2008</a>)，<code>Word2Vec(CBoW &amp; Skip-gram)</code>(<a href="https://arxiv.org/pdf/1301.3781.pdf" title="Efficient Estimation of Word Representations in Vector Space">Mikolov et al., 2013</a>)为深度学习模型在自然语言处理领域发力奠定了基础。</p><p>从2013年开始，研究者开始大量使用深度学习网络构建NLP模型，最早被用来处理序列数据的RNN(<a href="https://onlinelibrary.wiley.com/doi/abs/10.1207/s15516709cog1402_1" title="Finding Structure in Time">Elman, 1990</a>)以及为消除经典RNN模型梯度消失和梯度爆炸问题而出现的LSTM(<a href="https://www.bioinf.jku.at/publications/older/2604.pdf" title="LONG SHORT-TERM MEMORY">Hochreiter &amp; Schmidhuber, 1997</a>)和GRU(<a href="https://arxiv.org/abs/1406.1078" title="Learning Phrase Representations using RNN Encoder-Decoder for Statistical Machine Translation">Kyunghyun Cho et al., 2014</a>)，他们的基本原理都是通过将前文特征按顺序输入下一个单元从而实现依次输入处理序列信息的功能，具体参见<a href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" title="Understanding LSTM Networks">这篇博文</a>。除此之外还有CNN网络(<a href="https://aclanthology.org/P14-1062/" title="A Convolutional Neural Network for Modelling Sentences">Kalchbrenner et al., 2014</a>)和另一种Recursive neural networks(<a href="https://nlp.stanford.edu/~socherr/EMNLP2013_RNTN.pdf" title="Recursive Deep Models for Semantic Compositionality">Socher et al., 2013</a>)在自然语言处理上的应用。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/RNN-unrolled.png" alt="Vanilla RNN, h_t表示在t位置的输出，x_t表示输入。也即在每个时间点除了输入当时的数据x以外还输入上一个时间点的输出h_（t-1）"></p><p>2014年，谷歌的三位学者将提出Seq2Seq模型(<a href="https://arxiv.org/pdf/1409.3215.pdf" title="Sequence to Sequence Learning with Neural Networks">Sutskever et al., 2014</a>)，其原理是使用一个RNN结构作为Encoder将输入的序列编码为一个含有序列信息的<code>语境矢量(Context vector)</code>然后用这个输出的矢量输入另一个RNN的Decoder中从而输出另一个序列信息。顾名思义，Seq2Seq的出现使得序列数据可以用于生成另一个序列，这弥补了深度学习网络此前只能进行语言模型或情感分析等简单任务的短板。但Seq2Seq结构本身并没有解决Encoder的输入序列过长时神经网络模型很难在一个单一的语境矢量中有效抓住所有信息的弊病，为解决这个问题，Transformer结构中最关键的<code>注意力机制(Attention)</code>被提出(<a href="https://arxiv.org/abs/1409.0473" title="Neural Machine Translation by Jointly Learning to Align and Translate">Bahdanau et al., 2015</a>)，其原理是在Seq2Seq模型的基础上在Decode每一个目标单元时同时加入用来强调与该单元相关的Encoder单元语境的注意力模块，从而达到翻译每个目标位置时给予原文中单词不同权重的目的。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/v2-bb14e7491f244b7e553e816d046cd985_720w.webp" alt="t时刻的attention模块示意图，s^(t-1)表示decoder模块上一个时刻的隐藏状态，a^t表示encoder模块中每个时刻的输出结果，最终的context向量则是将每个时刻的a^t加权加总后的语境向量，包含了需要在该时刻关注的输入信息。"></p><p>最终在2017年，谷歌机器翻译团队决定彻底抛弃RNN和CNN等传统结构，直接使用Attention机制架构多层自注意结构来完成机器翻译任务，并取得很好的效果(<a href="https://arxiv.org/pdf/1706.03762.pdf" title="Attention Is All You Need">Vaswani et al., 2017</a>)。到这里我们终于可以看看这篇文章到底讲了什么了, 本篇内容参考了很多著名大佬对Transformer的解读，包括<a href="https://www.youtube.com/watch?v=SysgYptB198" title="C5W3L07 Attention Model Intuition">Andrew Ng</a>, <a href="https://www.youtube.com/@thea.i.hacker-michaelphi6569" title="Illustrated Guide to Transformers Neural Network: A step by step explanation">Michael Phi</a>,  <a href="https://jalammar.github.io/" title="The Illustrated Transformer">Jay Alammar</a>, <a href="https://sebastianraschka.com/blog/2023/self-attention-from-scratch.html" title="Understanding and Coding the Self-Attention Mechanism of Large Language Models From Scratch">Sebastian Raschka</a>， <a href="https://sebastianraschka.com/blog/2023/self-attention-from-scratch.html" title="Understanding and Coding the Self-Attention Mechanism of Large Language Models From Scratch">Prafulla Dalvi</a>等，其中Jay Alamar的博客将各种内容讲得非常细致，适合新手，推荐阅读；Sebastian Raschka和Prafulla Dalvi分别通过代码实现和数字实例解释抽象的结构，也可辅助理解,。</p><h2 id="前置知识-Building-Blocks">前置知识(Building Blocks)</h2><h3 id="自注意机制-Self-Attention">自注意机制(Self-Attention)</h3><p>Transformer结构中介绍的最重要的一个机制就是自注意机制，与RNN中的注意力只计算当前词与其他词的关联性不同，Transformer中的注意力为每一个可能的词引入了三个向量<code>q(query)</code>，<code>k(Keyword)</code>，和<code>v(Value)</code>，每个可能的词都有独特的qkv三向量，而这三个向量分别由该词的<code>词嵌入向量(word embedding vector)</code>乘以从文本中训练而来的<code>权重矩阵(Weight matrix)</code> Wq，Wk, 和Wv计算得到。原文中词嵌入的维度是512，而权重矩阵的维度是512x64，因此两者相乘，每个词将得到维度为64的qkv三个向量。</p><p>如何理解这三个向量的作用呢？你可以将Query代表你要查询的词，Keyword代表输入中的其他词，对比q和k在向量空间中的相似度就可以知道两个词之间的关联有多大，将每个k(k1, k2, k3 …)与某个q(例如q1)的相似度使用softmax取最大的那一个，就可以知道每个k对于理解这个q1的权重有多少，然后将每个v分别乘以这个对应的权重取和就可以得到这个词在当前输入中的Attention值(在原文的例子里也是一个64维的向量)。原文中给出的公式是：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>t</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo stretchy="false">(</mo><mi>Q</mi><mo separator="true">,</mo><mi>K</mi><mo separator="true">,</mo><mi>V</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>o</mi><mi>f</mi><mi>t</mi><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac><mo stretchy="false">)</mo><mi>V</mi></mrow><annotation encoding="application/x-tex">Attention(Q,K,V)=softmax(\frac{QK^T}{\sqrt{d_k}})V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4483em;vertical-align:-0.93em;"></span><span class="mord mathnormal">so</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">t</span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5183em;"><span style="top:-2.2528em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8572em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8172em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1828em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span></span></p><p>下图为原文图示对应上方公式的表达，其中Mask部分为Decoder部分特有，这里暂且不看；大写的QKV分别代表每个词的qkv向量组成的矩阵，该图中QKV中每行为输入序列中的一个词，列为上文提到的64维特征，也就是说假设输入是三个词的&quot;I love you&quot;，那么QKV就都是3x64的矩阵。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20230827154436081.png" alt="原文中图示Attention的计算方式，其中mask只有Decoder部分有，Encoder部分没有，mask的作用后面再解释"></p><p>因此上图中第一步<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">QK^T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0358em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8413em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span>的结果会是一个行代表query列代表key的3x3矩阵，其中的数字大小代表了每个qk pairs在64维空间上的相似度；第二步Scale是为了减小点乘的梯度波动而将上面3x3矩阵中的每个数字都除以空间维度的开方，在本例中也就是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mn>64</mn></msqrt><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">\sqrt{64}=8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1328em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9072em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">64</span></span></span><span style="top:-2.8672em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1328em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">8</span></span></span></span>；第三步softmax归一函数将每行的结果进行归一，大的增大，小的减少，经过这一步后3x3矩阵的每行的加和都会变成1，而每列就是该k对应q的在其他所有其他词中应占的权重，例如第1行第2列代表的就是&quot;I&quot;的query向量相对于&quot;love&quot;的k向量在“I love you”三个k向量中的权重，以机器翻译举例就是翻译&quot;I&quot;时应该对&quot;love&quot;分配的注意力权重；第四步将针对该q向量的每一个k向量的权重乘以其对应的v向量以重新获得针对每个输入词在64维向量空间上的重点分布，以矩阵来表示就是将此前3x3的权重矩阵乘以3x64的V矩阵，结果应该为3x64的矩阵，每一行都是一个q对应分配的注意力，也就是该自注意模块的输出结果。</p><h3 id="多头注意力-Multi-Head-Attention">多头注意力(Multi-Head Attention)</h3><p>所谓的多头注意力其实简单讲就是多个上文的自注意模块的组合，原文中使用了8个头也就是将8个不同的Wq, Wk, Wv针对每个词计算出的QKV矩阵简单拼接在一起后通过点乘另一个与Wq, Wk, Wv一同训练得到的大权重矩阵W0的方法整合在一起得到最终的注意力矩阵。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/transformer_attention_heads_weight_matrix_o.png" alt="将每个头的结果按下图所示拼接在一起计算结果，注意Z矩阵的每一行对应输入中的一个词"></p><p>在我们的例子中，8个头拼接出来的矩阵是3x512(512 = 64 x 头数，也就是8)，因此对应的权重矩阵W0为512x512，512列是为了将最终的乘积和重新整合成3x512的注意力矩阵从而与输入矩阵的规模统一，可以再次输入同一个单元。使用多头注意力的原因是避免单个注意力模块可能出现的某个词独占所有的注意力而导致理解不全面的情况，也就是说多头注意力拓展了模型完成自然语言任务时注意多个不同位置的能力，从另一个角度解释多头注意力就是从多个角度表示目标词的属性。</p><h3 id="位置编码-Positional-Encoding">位置编码(Positional Encoding)</h3><p>Transformer与传统RNN结构还有一个最大的不同就是自注意机制本身不会考虑输入词向量的位置信息，因为使用点乘求和也就是说每个词出现在矩阵的不同位置上他们计算出的结果不会有变化，但处理序列数据时位置信息一定是会对理解不同词有影响的。RNN结构通过循环引入上个时间点的结果，考虑了每个词出现的时机以及其会对理解下一个词造成的影响，而Transformer则是使用有固定规律的位置编码的方法引入输入中各词的位置信息。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>E</mi><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator="true">,</mo><mn>2</mn><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><mi>sin</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mrow><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant="normal">/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow></msup></mrow></mfrac><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>P</mi><mi>E</mi><mo stretchy="false">(</mo><mi>p</mi><mi>o</mi><mi>s</mi><mo separator="true">,</mo><mn>2</mn><mi>i</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow><mrow><mn>1000</mn><msup><mn>0</mn><mrow><mn>2</mn><mi>i</mi><mi mathvariant="normal">/</mi><msub><mi>d</mi><mrow><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi></mrow></msub></mrow></msup></mrow></mfrac><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace></mrow><annotation encoding="application/x-tex">PE(pos, 2i) = \sin(\frac{pos}{10000^{2i/d_{model}}})\\PE(pos, 2i+1) = \cos(\frac{pos}{10000^{2i/d_{model}}})\\</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8116em;vertical-align:-0.704em;"></span><span class="mop">sin</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1000</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">PE</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.8116em;vertical-align:-0.704em;"></span><span class="mop">cos</span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1076em;"><span style="top:-2.296em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1000</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.814em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">i</span><span class="mord mtight">/</span><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mord mathnormal">os</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.704em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span><span class="mspace newline"></span></span></span></span></p><p>其中pos是词在输入中出现的位置，i是维度。原文作者选用这个公式的原因是因为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mrow><mi>p</mi><mi>o</mi><mi>s</mi><mo>+</mo><mi>k</mi></mrow></msub></mrow><annotation encoding="application/x-tex">PE_{pos+k}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">os</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>可以被表达为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><msub><mi>E</mi><mrow><mi>p</mi><mi>o</mi><mi>s</mi></mrow></msub></mrow><annotation encoding="application/x-tex">PE_{pos}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">os</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span></span>关于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>的线性函数，因此他们认为模型可以从这之中获得不同词之间的相对位置关系信息。其他模型中使用过通过学习获得的位置编码方法，他们也进行过实验发现二者效果区别不大， 且此方法可以计算超过训练数据最长句子的位置编码，因此选用这个可以直接计算的位置编码矩阵。将原文使用的位置编码方法使用图像表达如下：</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/attention-is-all-you-need-positional-encoding.png" alt="位置编码的图像表示"></p><h3 id="残差连接-Residual-Connection">残差连接(Residual Connection)</h3><p>残差连接是为了解决深度学习网络中<code>梯度消失(Gradient Vanish)</code>问题而被提出，Transformer中也大量使用了残差连接。残差连接的实现简单来说就是将一些层的计算输出结果与其输入数据相加，这样保证网络不会在多次计算输出之后忘记数据最开始的样子。原文作者们除了使用残差连接以外还将其结果<code>标准化(Normalize)</code>，即计算结果矩阵中每行的均值和标准差，以下面的公式计算标准化结果：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>γ</mi><mfrac><mrow><mi>v</mi><mo>−</mo><mi>μ</mi></mrow><mi>σ</mi></mfrac><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex">\gamma \frac{v-\mu}{\sigma}+\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.9463em;vertical-align:-0.686em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">μ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi></mrow><annotation encoding="application/x-tex">\mu</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">μ</span></span></span></span>是均值，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span></span></span></span>是标准差，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span>都是控制标准化结果的常量参数。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/transformer_resideual_layer_norm_2.png" alt="残差连接和标准化"></p><h3 id="前馈神经网络-Feed-Forward-Neural-Network">前馈神经网络(Feed Forward Neural Network)</h3><p>为保证模型能够抓住更多非线性关系，加深网络深度和复杂度并使输出向量的不同维度之间保持信息互通，Transformer中还加入了许多<code>全连接前馈神经网络(FNN)</code>。原文中使用的FNN是中间使用ReLU激活函数的双层线性转换，用下方函数表示输入<code>x</code>与输出<code>FNN(x)</code>的关系：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>F</mi><mi>N</mi><mi>N</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><msub><mi>W</mi><mn>1</mn></msub><mo>+</mo><msub><mi>b</mi><mn>1</mn></msub><mo stretchy="false">)</mo><msub><mi>W</mi><mn>2</mn></msub><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">FNN(x) = max(0, xW_1+b_1)W_2+b_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">FNN</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>m</mi><mi>a</mi><mi>x</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">y(x)=max(0,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">ma</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>就是ReLU激活函数的函数表达，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>W</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">W_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>b</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">b_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>分别表示第i层的连接的权重和偏置，从公式可以看出该网络将第一层全连接结果使用ReLU函数激活后将结果继续输入第二层全连接并得到输出结果，原文中该网络输入与输出维度均为512，而中间层的维度为2048，对于不同词的FNN参数是相同的，但在结构中不同的FNN的参数都不同。</p><h3 id="掩码注意力-Masked-Attention">掩码注意力(Masked Attention)</h3><p>就如<a href="%E8%87%AA%E6%B3%A8%E6%84%8F%E6%9C%BA%E5%88%B6(Self-Attention)">前面</a>提到的，原文中的注意力模块中有一个optional的Mask层，这个Mask只在Decoder中有在Encoder中没有，而之所以要在Decoder中加上这个Mask的原因是Decoder的任务是生成新的文本，而在之前提到的注意力机制中我们要计算每个key向量对某个query向量的注意力权重，但我们不能给予还没有生成的结果权重，因此我们需要将当前即将生成的query向量之后的key都mask掉，具体做法就是在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>Q</mi><msup><mi>K</mi><mi>T</mi></msup></mrow><msqrt><msub><mi>d</mi><mi>k</mi></msub></msqrt></mfrac></mrow><annotation encoding="application/x-tex">\frac{QK^T}{\sqrt{d_k}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.6275em;vertical-align:-0.538em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0895em;"><span style="top:-2.5864em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8622em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3488em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1512em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8222em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1778em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">Q</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9191em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>的结果之上覆盖一个<code>Look-ahead Mask</code>，由此当前词之后词的key向量都会变成-inf，softmax函数激活后这些部分的权重就会是0，因此权重只会分布在之前已经生成的结果上。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20230827214905913.png" alt="在QK矩阵之后覆盖Look-ahead Mask"></p><h3 id="线性层-Linear-Layer">线性层(Linear Layer)</h3><p>线性层也就是<code>全连接层(Fully Connected Layer)</code>，需要这个结构的原因是我们最终需要将解码的数字输出为特定的单词，在这一层中的输出向量的每一个数字都代表一个已知的单词，例如我们的模型是翻译英语而我们已知的英语词有10000个，那么这一层Logits向量的长度就是10000。将Decoder输入这层线性层后对输出的Logits向量进行softmax激活，得到一个显示每个可能词概率的向量，概率最大的那个词就是我们最终选择的输出词。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/transformer_decoder_output_softmax.png" alt="Decoder-&gt;logits-&gt;log_probs-&gt;index-&gt;word"></p><h2 id="Tranformer结构">Tranformer结构</h2><p>到这里我们就拥有了组成Transformer结构的所有积木，回过头去看看整个Transformer的流程：</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/eAKQu.png" alt="Tranformer结构详解"></p><h3 id="编码器-Encoder">编码器(Encoder)</h3><ol><li>以将“I love you”翻译为中文为例，输入为3x512的词嵌入矩阵，矩阵的每行代表一个输入词的特征(representations)。</li><li>将位置编码加在词嵌入矩阵上，以使该输入包含不同词之间的相对位置的信息，输出依然为3x512的矩阵。</li><li>将上一步的矩阵放进第一个多头注意力模块输出3x512的注意力矩阵。</li><li>将第2步的输入矩阵和第3步的注意力矩阵结果加在一起进行标准化(残差连接)，依然输出3x512的矩阵。</li><li>将第4步的矩阵输入全连接FNN中加强非线性联系，依然输出3x512的矩阵。</li><li>将第4步的输出矩阵和第5步的FNN输出矩阵相加标准化，并输出3x512的输出矩阵。</li><li>将第3-6步重复N次，原文中为重复6次，上一个次的输出作为下一次的输入，依次连接，最终结果还是3x512的矩阵。</li></ol><h3 id="解码器-Decoder">解码器(Decoder)</h3><ol start="8"><li>解码器首先将已经输出的词转换为512维的词嵌入向量，由于没有第一个词，因此它的输入以一个<code>&lt;BOS&gt;</code>（即Beginning of Sentense）为第一个输出，也即所谓的shifted right。假设已输出词m个，该处输入应为大小是mx512的矩阵</li><li>与编码器一样，在第8步的输出结果上覆盖一个位置编码，提供已输出结果的位置信息，输出mx512的矩阵。</li><li>将第9步的输出结果输入掩码多头注意力模块中，得到已输出的词语对当前已输出的词语的注意力矩阵，结果依然是mx512的矩阵。</li><li>将第10步的输出结果与第9步的输出结果通过残差标准化连接，输出mx512的矩阵。</li><li><strong>将第11步中的Q矩阵拿出(此时为mx64的矩阵)的与第7步编码器的K,V矩阵(3x64)进行多头注意力计算，结果应为mx512的矩阵</strong></li><li>将第11步输出与第12步的输出再次通过残差标准化连接，输出mx512的矩阵。</li><li>将第13步的结果输入与第5步不相同的另一个全连接FNN中，输出mx512的矩阵。</li><li>将13步的输出结果与14步的输出结果再次通过残差标准化连接，输出mx512的矩阵。</li><li>将第10-15步重复N次，原文中为重复6次，上一个次的输出作为下一次的输入，依次连接，最终结果还是mx512的矩阵。</li><li>将第16步的结果输入最终的线性层，通过softmax激活并找到下一个预测的词。</li><li>将第17步输出的结果加入此前已有的结果，重新输入第8步，直到17步输出<code>&lt;EOS&gt;</code>(即End of Sentense)为止。</li></ol><h1>最后</h1><p>在本篇中我回顾了NLP历史发展至Transformer的各个重大里程碑，并拆解Transformer结构中的各种创新设计及其意义，最后将整个Transformer模型的运作方式梳理了一遍。但此结构并不是NLP领域的最新进展，随后在此基础上发展出的<code>BERT(Bidirectional Encoder Representations from Transformers)</code>, <code>GPT(Generative Pretrained Transformer)</code>, 以及BERT结构的各种定向优化衍生模型等都在NLP历史上已经或正在产生改变世界的影响。下一篇NLP相关的文章就看看《BERT: Pre-training of Deep Bidirectional Transformers for Language Understanding》吧。</p><p>[第29篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E7%BC%96%E7%A8%8B%E7%AE%97%E6%B3%95/">编程算法</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/Deep-Learninng/">Deep Learninng</category>
      
      <category domain="http://raylei.space/tags/%E8%AE%BA%E6%96%87%E8%A7%A3%E8%AF%BB/">论文解读</category>
      
      <category domain="http://raylei.space/tags/NLP/">NLP</category>
      
      
      <comments>http://raylei.space/2023/07/02/29-Paperstudy_attention_is_all_you_need/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[编程算法]LeetCode算法题研究(一): 数组</title>
      <link>http://raylei.space/2023/06/18/28-Leetcode_algorithm_arrays/</link>
      <guid>http://raylei.space/2023/06/18/28-Leetcode_algorithm_arrays/</guid>
      <pubDate>Sun, 18 Jun 2023 14:23:54 GMT</pubDate>
      
      <description>[第28篇] 从本篇开始研究各种经典算法的Python解法，第一篇以数组开始。</description>
      
      
      
      <content:encoded><![CDATA[<h1>前言</h1><p>年初回家后到现在一篇新文章都没写，非常惭愧。最近面试发现对方问的最基本的算法问题都只能答上来个大概的思路，一操作就卡壳，意识到不刷刷算法题熟悉一下编程的基本功是很难找到工作了。所以打算在继续日语学习的同时每天抽点时间刷刷LeetCode算法题，&quot;程序员&quot;就得有点&quot;程序员&quot;的样子。</p><p>学习的目标是熟悉一下各种经典算法的Python解法，尤其是熟悉一下各种算法的基础写法，避免以后写出一些脱裤子放屁的代码贻笑大方。第一篇就以最经典的数组相关算法开始吧。</p><h1>正文</h1><h2 id="1-两数之和-font-color-00dd00-简单-font">1. 两数之和(<font color="#00dd00">简单</font>)</h2><p><strong>题目要求：</strong></p><p>给定一个整数数组 nums 和一个整数目标值 target，请你在该数组中找出 和为目标值 target  的那 两个 整数，并返回它们的数组下标。你可以假设每种输入只会对应一个答案。但是，数组中同一个元素在答案里不能重复出现。你可以按任意顺序返回答案。</p><p><strong>示例 1：</strong></p><p>输入：nums = [2,7,11,15], target = 9<br>输出：[0,1]<br>解释：因为 nums[0] + nums[1] == 9 ，返回 [0, 1] 。</p><p><strong>我的解答思路：(暴力破解)</strong></p><p>看到题目的第一反应是用target数去依次减num列表中的数并查看结果是否与该项之后的某个数字相同，如果相同返回这两个数字的下标。时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><msup><mi>N</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, 空间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">twoSum</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">for</span> i1,n1 <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">        <span class="keyword">for</span> i2,n2 <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums[i1+<span class="number">1</span>:],):<span class="comment"># 对于每个数，从它后面那个数开始遍历剩下的数</span></span><br><span class="line">            <span class="keyword">if</span> n2 == target - n1: <span class="comment"># 需要注意后面的数组的第0位是原数值的i1+1位，因此要加回</span></span><br><span class="line">                <span class="keyword">return</span> [i1, i1+i2+<span class="number">1</span>]</span><br></pre></td></tr></table></figure><p>执行用时：2348 ms, 在所有 Python3 提交中击败了36.38%的用户</p><p>内存消耗：16.8 MB, 在所有 Python3 提交中击败了22.35%的用户</p><p><strong>官方解法：(哈希表)</strong></p><p>创建一个哈希表，对于每一个 <code>x</code>，我们首先查询哈希表中是否存在 <code>target - x</code>，然后将 <code>x</code> 插入到哈希表中，即可保证不会让 <code>x</code> 和自己匹配。时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>， 空间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">twoSum</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    hashtable = <span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">        <span class="keyword">if</span> target - num <span class="keyword">in</span> hashtable:</span><br><span class="line">            <span class="keyword">return</span> [hashtable[target - num], i]</span><br><span class="line">        hashtable[nums[i]] = i <span class="comment"># 如果哈希表中没有结果，则将i的下标作为值存进这个键中</span></span><br><span class="line">    <span class="keyword">return</span> []</span><br></pre></td></tr></table></figure><p>执行用时：48 ms, 在所有 Python3 提交中击败了63.32%的用户</p><p>内存消耗：17.5 MB, 在所有 Python3 提交中击败了5.09%的用户</p><h2 id="26-删除有序数组中的重复项-font-color-00dd00-简单-font">26. 删除有序数组中的重复项(<font color="#00dd00">简单</font>)</h2><p><strong>题目要求：</strong></p><p>给你一个 升序排列 的数组 nums ，请你 原地 删除重复出现的元素，使每个元素 只出现一次 ，返回删除后数组的新长度。元素的 相对顺序 应该保持 一致 。然后返回 nums 中唯一元素的个数。考虑 nums 的唯一元素的数量为 k ，你需要做以下事情确保你的题解可以被通过：</p><ul><li>更改数组 nums ，使 nums 的前 k 个元素包含唯一元素，并按照它们最初在 nums 中出现的顺序排列。nums 的其余元素与 nums 的大小不重要。</li><li>返回 k 。</li></ul><p><strong>示例 1：</strong></p><p>输入：nums = [1,1,2]<br>输出：2, nums = [1,2,_]<br>解释：函数应该返回新的长度 2 ，并且原数组 nums 的前两个元素被修改为 1, 2 。不需要考虑数组中超出新长度后面的元素。</p><p><strong>我的解答思路：</strong></p><p>因为题目给定不需要考虑数组长度和k后面的元素，且数组为升序，因此只需要将数组遍历一次，依次将大于前数的元素放在数组的前k项即可。因为数组本身是升序排列，即使数组完全没有重复元素也不会出现大于当前元素的元素被提前覆盖的情况。时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>， 空间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">removeDuplicates</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    last_num = -inf</span><br><span class="line">    k = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">        <span class="keyword">if</span> num &gt; last_num:</span><br><span class="line">            nums[k] = num</span><br><span class="line">            last_num = num</span><br><span class="line">            k += <span class="number">1</span>     </span><br><span class="line">    <span class="keyword">return</span> k</span><br></pre></td></tr></table></figure><p>执行用时：52 ms, 在所有 Python3 提交中击败了35%的用户</p><p>内存消耗：17.3 MB, 在所有 Python3 提交中击败了28%的用户</p><p><strong>官方解法：(双指针)</strong></p><p>所谓的双指针就是用一快一慢两个指针记录上一个改变前的数和下一个要被比较的数，如果两数不同就给慢指针下一格赋上快指针的值，然后继续用快指针遍历数组。时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>， 空间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">removeDuplicates</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>]</span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    slow, fast = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> fast &lt; <span class="built_in">len</span>(nums):</span><br><span class="line">        <span class="keyword">if</span> nums[fast] != nums[slow]:</span><br><span class="line">            slow = slow + <span class="number">1</span></span><br><span class="line">            nums[slow] = nums[fast]</span><br><span class="line">        fast = fast + <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> slow + <span class="number">1</span></span><br></pre></td></tr></table></figure><p>执行用时：40 ms, 在所有 Python3 提交中击败了84.28%的用户</p><p>内存消耗：17.4 MB, 在所有 Python3 提交中击败了9.49%的用户</p><p><strong>对比研究之后发现我的解法和官方的双指针解法的主要速度差距在于<code>for循环</code>和<code>while循环</code>，在将<code>num</code>换成用<code>nums[i]</code>表示后，算法的表现就与双指针一致了。</strong></p><h2 id="35-搜索插入位置-font-color-00dd00-简单-font">35. 搜索插入位置(<font color="#00dd00">简单</font>)</h2><p><strong>题目要求：</strong></p><p>给定一个排序数组和一个目标值，在数组中找到目标值，并返回其索引。如果目标值不存在于数组中，返回它将会被按顺序插入的位置。请必须使用时间复杂度为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>的算法。</p><p><strong>示例 :</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输入: nums = [1,3,5,6], target = 5</span><br><span class="line">输出: 2</span><br><span class="line">输入: nums = [1,3,5,6], target = 2</span><br><span class="line">输出: 1</span><br><span class="line">输入: nums = [1,3,5,6], target = 7</span><br><span class="line">输出: 4</span><br></pre></td></tr></table></figure><p><strong>我的解答思路：</strong></p><p>对于已经排序的数组，找到插入位置非常简单，但我不知道什么样的算法算是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>的时间复杂度，因此我做题的时候没有管这个要求，也能通过。时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>， 空间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用while循环 执行40ms 超过60%</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">searchInsert</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> nums[-<span class="number">1</span>] &lt; target:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(nums)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">while</span> nums[i] &lt; target:</span><br><span class="line">            i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> i</span><br><span class="line"><span class="comment"># 用for循环 执行48ms 超过20%</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">searchInsert</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(nums):</span><br><span class="line">        <span class="keyword">if</span> num &gt;= target:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(nums)</span><br></pre></td></tr></table></figure><p><strong>官方解法：(二分法)</strong></p><p>看了官方题解才知道二分法可以更快找到插入位置，也是所谓的时间复杂度为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(\log N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>的算法。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">searchInsert</span>(<span class="params">self, nums: <span class="type">List</span>[<span class="built_in">int</span>], target: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    left, right = <span class="number">0</span>, <span class="built_in">len</span>(nums) - <span class="number">1</span> <span class="comment"># 将左右下标定义到列表的两端</span></span><br><span class="line">    <span class="keyword">while</span> left &lt;= right: </span><br><span class="line">        middle = left + (right - left) // <span class="number">2</span> <span class="comment"># 找到左右中间偏左的元素</span></span><br><span class="line">        <span class="keyword">if</span> nums[middle] == target: </span><br><span class="line">            <span class="keyword">return</span> middle</span><br><span class="line">        <span class="keyword">elif</span> nums[middle] &gt; target: <span class="comment"># 如果中间元素大于目标值，说明目标在左半边</span></span><br><span class="line">            right = middle - <span class="number">1</span> <span class="comment"># 中间值不是目标，因此可以把右边界-1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            left = middle + <span class="number">1</span></span><br><span class="line">    <span class="comment"># 如果nums[middle] &gt; target，元素应插入的位置是 middle，而循环结束时 left = middle</span></span><br><span class="line">    <span class="comment"># 如果nums[middle] &lt; target，元素应插入的位置是 middle+1，而循环结束时 left = middle +1</span></span><br><span class="line">    <span class="keyword">return</span> left </span><br></pre></td></tr></table></figure><p>执行用时：36 ms, 在所有 Python3 提交中击败了80.35%的用户</p><p>内存消耗：16.7 MB, 在所有 Python3 提交中击败了24.41%的用户</p><p>[第28篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E7%BC%96%E7%A8%8B%E7%AE%97%E6%B3%95/">编程算法</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/Python/">Python</category>
      
      <category domain="http://raylei.space/tags/LeetCode/">LeetCode</category>
      
      <category domain="http://raylei.space/tags/%E6%95%B0%E7%BB%84%E7%AE%97%E6%B3%95/">数组算法</category>
      
      
      <comments>http://raylei.space/2023/06/18/28-Leetcode_algorithm_arrays/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[博客维护]多电脑端同步更新博客</title>
      <link>http://raylei.space/2023/02/17/27-Blogging_on_multiple_devices/</link>
      <guid>http://raylei.space/2023/02/17/27-Blogging_on_multiple_devices/</guid>
      <pubDate>Fri, 17 Feb 2023 15:58:16 GMT</pubDate>
      
      <description>[第27篇] 本章为实现在多电脑端同步更新博客内容的实现方法。</description>
      
      
      
      <content:encoded><![CDATA[<h1>前言</h1><p>本篇是因为前段时间回内地过年，而平时博客更新是在香港的台式机上，所以网站的源文件都保存在台式机上，这导致我离开香港后将不能更新博客。于是在出发前我参考这位<a href="https://blog.csdn.net/qq_30105599/article/details/118302086" title="多台电脑同步更新Hexo博客">_tourist</a>的方法将源文件都同步在GitHub的远程仓库中，然后在我带回家的笔记本上克隆了这个仓库。以同时将Hexo生成的网站静态文件和源文件保存在GitHub远程仓库中的方法达到随时从各种设备同步更新网站的目的。</p><p>虽然我回去的两个月实际上玩得太嗨根本没有心思管网站，但这个东西本身还是对各位博主来说非常实用的。</p><h1>正文</h1><h2 id="同步原理">同步原理</h2><p><a href="https://blog.csdn.net/qq_30105599/article/details/118302086" title="多台电脑同步更新Hexo博客">_tourist</a>对网站同步更新的原理和方法讲得非常细致透彻，整个博客的文件夹就是当初安装hexo的文件夹，每次大家在该文件夹下使用<code>hexo g -d</code>指令，hexo就会将该文件夹中的文件各类文件用于生成网站的静态文件并存在<code>public</code>文件夹中推送到<code>Github Page</code>中，从而达到更新网站内容的结果。也就是说hexo文件夹中储存的就是网站的源文件，而推送到<code>Github</code>上的只有已经渲染过的网站结果。</p><p>那么我们想要达成多设备同时更新网站的目的，其实只需要将网站的源文件夹通过<code>git</code>推到远程仓库，每次需要更新时只需要从远程仓库把更新<code>pull</code>回来就可以接着另一台设备上的进度继续更新了。</p><p>操作上，我们初次创建网站的时候是将网站部署在<code>GitHub</code>仓库的<code>main</code>分支上，而这个设定是通过hexo的配置文件设置，因此我们其实可以再创建一个新的默认分支来存放网站的源文件，而同时在这个仓库中使用<code>hexo g -d</code>又可以把静态文件部署到<code>main</code>分支中。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20230223212047386.png" alt="_config.yml中设置的网站部署路径"></p><p>将远程仓库弄好之后，每次拿到新的设备都可以直接从这个仓库中<code>clone</code>一个新的本地仓库，而我们只需要按照之前的方法安装好hexo就可以在新设备上部署网页了。</p><h2 id="具体操作">具体操作</h2><p>_tourist把操作的具体步骤整理得非常详细，我就只简单记录一下：</p><h3 id="老电脑端">老电脑端</h3><ul><li>创建新的<code>Github分支</code>并且将其设置为默认分支。</li><li>将新建的分支仓库使用<code>git clone</code>命令克隆到本地。</li><li>克隆到本地的文件夹中只保留<code>.git</code>文件夹，然后将原本hexo文件夹中除了.deploy_git以外的文件都复制到克隆的本地仓库中。</li><li>需要注意的是<code>theme</code>文件夹需要特别注意，要将里面的<code>.git</code>删除，否则推去远程仓库的时候这个文件夹会是空的。</li><li>在上面的两个操作是在本地仓库中完成的，修改完成后使用下面的命令将文件推送到远程仓库的新分支中。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git add *</span><br><span class="line">git commit -m <span class="string">&quot;add_branch&quot;</span></span><br><span class="line">git push</span><br></pre></td></tr></table></figure><h3 id="新电脑端">新电脑端</h3><ul><li>按当时建网站的步骤，先新电脑生成的ssh key添加到GitHub账号上。</li><li>新电脑装好Node.js和git，找一个合适的位置把远程仓库克隆到新电脑上。</li><li>在克隆的文件夹下执行<code>npm install hexo, npm install, npm install hexo-deployer-git</code>指令来下载hexo和所需的依赖。</li><li>往后需要更新前建议先用git pull将远程仓库的最新修改同步到本地，然后再编辑。</li></ul><h1>最后</h1><p>到这里我们就完成了网站源代码通过<code>GitHub远程仓库</code>同步的操作，每次需要编辑更新网站的时候只需要随便找到一台设备，按上面新电脑端的操作将源文件下载到本地，然后更新后推送回远程仓库，同时使用hexo命令将更新的网站内容部署到原来的GitHub Page的分支上。</p><p>[第27篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E5%8D%9A%E5%AE%A2%E7%BB%B4%E6%8A%A4/">博客维护</category>
      
      
      <category domain="http://raylei.space/tags/git/">git</category>
      
      <category domain="http://raylei.space/tags/GitHub%EF%BC%8C%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">GitHub，日常学习</category>
      
      
      <comments>http://raylei.space/2023/02/17/27-Blogging_on_multiple_devices/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[日语学习] 《标准日本语》中级第一单元学习笔记</title>
      <link>http://raylei.space/2022/11/23/26-Japanese_Chapter_15/</link>
      <guid>http://raylei.space/2022/11/23/26-Japanese_Chapter_15/</guid>
      <pubDate>Wed, 23 Nov 2022 14:19:16 GMT</pubDate>
      
      <description>[第26篇] 本章为学习标准日本语中级第一单元的笔记。</description>
      
      
      
      <content:encoded><![CDATA[<h1>第1课</h1><h2 id="生词">生词</h2><h3 id="表1">表1</h3><ul><li><p>であい（出会い）：「名」偶遇，邂逅　<code>今朝会社への途中で昔の友人に出会いました。</code></p></li><li><p>であう（出会う）：「自动1」偶遇，邂逅　<code>彼と出会ったのは5年前でした。</code></p></li><li><p>たすかる（助かる）：「自动1」获得帮助，得救　<code>お医者さんのおかげで、命が助かった。</code></p></li><li><p>たすける（助ける）：「他动2」帮助，救助，助长　<code>父の仕事を助ける。</code></p></li><li><p>すっかり：「副词」完全，彻底　<code>故郷はすっかり変わりました。</code></p></li><li><p>まち（町・街）：「名」城镇・街道　<code>渋谷は若者の街と言われている。／私の生まれた町。</code></p></li><li><p>へんか（変化）：「名」变化　<code>朝晩の気温の変化が激（はげ）しい。</code></p></li><li><p>ついていく：「造语」跟上　<code>どこまでもついていく！</code></p></li><li><p>こうそう（高層）：「名」高层　<code>高層ビル</code></p></li><li><p>へん（辺）：「名」一带，附近，就近的事物 <code>昔この辺は農地でした。／そのことはこの辺にして次の問題に入りましょう。</code></p></li><li><p>かんじがします（感じがします）：感觉，觉得 <code>この景色を見ると、日本に来たという感じがします。</code></p></li><li><p>てんきんになる（転勤になる）：（公司内部）调动工作 <code>東京から上海に転勤になる。</code></p></li></ul><h3 id="表2">表2</h3><ul><li><p>ちょっと：「副」喂，稍微 <code>仕事は、もうちょっとで終わる。</code></p></li><li><p>めざましどけい（目覚まし時計）：「名」闹钟</p></li><li><p>ふしぎ（不思議）：「名·形2」不可思议，奇怪 <code>少年漫画の主人公は大体不思議な力を持っている。</code></p></li><li><p>えきべん（駅弁）：「名」 车站卖的盒饭</p></li><li><p>あめ（飴）：「名」 糖</p></li><li><p>なめる（舐める）：「他动2」舔，含 <code>飴を舐める。</code></p></li><li><p>なみだ（涙）：「名」眼泪，泪</p></li><li><p>ふた：「名」盖子 <code>ふたをする。／ふたを開ける。</code></p></li><li><p>ひろげる（広げる）：「他动2」展开，扩大 <code>新聞を広げて読み始めた。／自分の視野（しや）を広げたい。</code></p></li><li><p>わく（沸く）：「自动1」沸腾，烧开 <code>家に帰ると風呂が沸いている。</code></p></li><li><p>わかす（沸かす）：「他动1」烧热，使…沸腾 <code>素晴らしい演奏で会場（かいじょう）を沸かした。</code></p></li><li><p>かわかす（乾かす）：「他动1」弄干，晾干 <code>ドライヤーを使って髪の毛を乾かした。</code></p></li><li><p>かわく（乾く）：「自动1」干、干燥 <code>洗濯物が乾いた。</code></p></li></ul><h3 id="表3">表3</h3><ul><li><p>してつ（私鉄）：「名」私营铁路</p></li><li><p>こうえい（公営）：「名」公营</p></li><li><p>りゃく（略）：「名」简略，略，省略</p></li><li><p>ろせん（路線）：「名」路线（交通或政策）</p></li><li><p>しゅよう（主要）：「形2」主要</p></li><li><p>のびる（延びる）：「自动2」眼神，延长；延期 <code>地下鉄の路線が郊外に延びた。/雨のため出発が延びた。</code></p></li><li><p>けいえいする（経営する）：「他动3」经营 <code>小さな工場を経営する。</code></p></li><li><p>うんこう（運行）：「名」（交通工具或天体）运行</p></li><li><p>ほうこう（方向）：「名」方向 <code>入口の方向へ歩いていく。民営化の方向に進む。</code></p></li><li><p>あらわす（表す）：「他动1」表示，表现，表达 <code>喜びを顔に表す。</code></p></li><li><p>のぼり（上り）：「名」上，上行 <code>上り電車</code></p></li><li><p>くだり（下り）：「名」下，下行 <code>下り坂</code></p></li><li><p>なぞなぞ：「名」谜语 <code>なぞなぞ遊び</code></p></li><li><p>こたえ（答え）：「名」回答，答案 <code>答えが合（あ）っている。</code></p></li></ul><h3 id="表4">表4</h3><ul><li><p>とうがらし（唐辛子）：「名」辣椒</p></li><li><p>しょうがつ（正月）：「名」正月</p></li><li><p>おいわい（お祝い）：「名」庆贺，祝贺 <code>お正月を祝う。</code></p></li><li><p>おとずれる（訪れる）：「自动2」拜访，访问；到来，光临　<code>幸運というものはいつ訪れるか分かりません。</code></p></li><li><p>そだてる（育てる）：「他动2」养育，抚育，培养　<code>子どもを育てる。</code></p></li><li><p>ひも（紐）：「名」绳子　<code>靴の紐を結ぶ。</code></p></li><li><p>かんげき（感激）：「名」激动，感动　<code>涙が出るほど感激しました。</code></p></li><li><p>ながれる（流れる）：「自动2」流动、流淌；(音乐等) 播放；流产，中止　<code>大雨で運動会が流れてしまった。</code></p></li></ul><h2 id="语法">语法</h2><ol><li>～ば～ほど：越…越… <code>考えれば考えるほど、腹（はら）が立（た）つ。</code></li><li>「～のですか／～んですか」在知道前提的情况下 ，询问状况或事由　<code>＜发现对方没有吃饭＞どうして食べないんですか。</code></li><li>～とは：「～というのは」的省略形式，表示对某个主题加以说明。<code>JRとはジャパンレールウェイズの略です。</code></li><li>～と～を結（むす）ぶ：表示将两者连结。<code>都市と都市をむすぶ</code></li><li><code>どんどん</code> vs <code>だんだん</code>：前者表示某事进展十分顺利。 <code>山陽新幹線、東北新幹線、九州新幹線など、路線がどんどん延びています。</code>；后者表示某事正在渐渐发生。<code>佐藤さんの中国語はだんだん上手になってきています。</code></li><li><code>それで</code> vs <code>そこで</code>：两者都表示“于是”，前者注重表达客观因果关系；后者侧重表达在前项状况下采取何种对策。</li><li>こんな：「このような」的较随意的说法。指示词通常指示上文内容，而指示下文内容时，通常用「こ」系指示词，如「こんな」「このような」「この」「これらの」等。</li></ol><h2 id="例句">例句</h2><ol><li>所谓杰作，就是优秀的作品。 傑作<code>とは</code>、優れた作品のことです。</li><li>歌舞伎是日本传统演艺艺术之一。 歌舞伎は、日本の伝統的な芸能<code>の一つ</code>です。</li><li>日本动画片的人气不断地向世界蔓延。 日本のアニメの人気が<code>どんどん</code>世界に<code>広がって</code>います。</li><li>因为没订到飞机票，所以决定将出发延期一天。 飛行機が予約できなかったので、出発を1日<code>延ばす</code>ことにしました。</li><li>小陈中文当然不在话下，他还会说日语、韩语、英语。 陳さんは中国語は<code>もちろん</code>、日本語、韓国語、英語も話せます。</li><li>刚才总经理表扬这次的策划方案做得很好，我非常激动。 さっき社長から、今回の企画案がいいとほめられて、<code>大感激</code>です。</li><li>飞往北京的航班一天有8个。 北京<code>行き</code>の航空便は1日に8便あります。</li></ol><h1>第2课</h1><h2 id="生词-2">生词</h2><h3 id="表1-2">表1</h3><ul><li><p>ごぶさたする（ご無沙汰する）：「动3」好久不见，久疏问候（有歉意）</p></li><li><p>そのせつ（その節）：那时、那次</p></li></ul><h3 id="表2-2">表2</h3><ul><li><p>このあいだ（この間）　[名] 前些天，上次 <code>かれ、この間会った時、元気だったけど、いま病気なんだって。</code></p></li><li><p>こおる（凍る）　[自动1] 结冰，结冻 <code>わあ、寒い。手が凍ってるわ。</code></p></li><li><p>へいわ（平和）　[名・形2] 和平 <code>平和を守る。</code></p></li><li><p>きゅうか（休暇）　[名] 休假</p></li><li><p>ゆびわ（指輪）　[名] 戒指 <code>指輪をはめる/ はずす （戴上戒指/取下戒指）</code></p></li><li><p>じゅんちょう（順調）　[形2] 顺利 <code>お仕事はどうですか。順調です/ 順調に進んでいます。</code></p></li><li><p>なつかしい（懐かしい）　[形1] 怀念，令人想念的 <code>彼女と一緒に過ごした大学四年間は、なつかしい。</code></p></li><li><p>いや（嫌）　[形2] 讨厌，厌烦的 <code>一週間もしないうちに、わたしは仕事がいやになった。</code></p></li><li><p>ありがたい　[形1] 难得的，珍贵的，值得感谢的 <code>親の愛はありがたいものです。</code></p></li></ul><h3 id="表3-2">表3</h3><ul><li><p>れいぎ（礼儀）　[名] 礼仪，礼节</p></li><li><p>こし（腰）　[名] 腰</p></li><li><p>かたむける（傾ける）　[他动2] 倾斜，倾注 <code>体を前に傾ける。/耳を傾ける。</code></p></li><li><p>かくど（角度）　[名] 角度</p></li><li><p>まげる（曲げる）　[他动2] 弄弯，歪曲 <code>事実を曲げる。/道がまがる。</code></p></li><li><p>うけとる（受け取る）　[他动1] 接，接收，接受，理解 <code>先輩、これ、受け取ってください。</code></p></li><li><p>きまり（決まり）　[名] 规定，规矩，决定 <code>決まりを守る。</code></p></li><li><p>めうえ（目上）　[名] 尊者，长辈 <code>目上（の人）に敬語を使う。</code></p></li><li><p>いんしょう（印象）　[名] 印象</p></li><li><p>あたえる（与える）　[他动2] 给与，给予 <code>もう一度、わたしにチャンスを与えてください。</code></p></li><li><p>こもる　[自动1] 充满、包含 <code>手作りのお弁当には母の心がこもっている。</code></p></li><li><p>よそう（予想）　[名] 预料，预计</p></li><li><p>つたわる（伝わる）　[自动1] 传递，流传 <code>六世紀あたりに、仏教が日本に伝わった。</code></p></li></ul><h3 id="表4-2">表4</h3><ul><li><p>かたて（片手）　[名] 一只手</p></li><li><p>ゆずる（譲る）　[他動1]  让，让给；转让、出让 <code>電車でお年寄りに席を譲る。</code></p></li><li><p>およぶ（及ぶ）　[自動1] 达，及；匹敌、赶得上 <code>十年に及ぶサラリーマン生活に別れを告げ、外国へ行った。</code></p></li><li><p>あきれる（呆れる）　[自動2] 惊愕，目瞪口呆 <code>彼の過剰な自信にはあきれた。</code></p></li><li><p>かわいそう（可哀想 / 可哀相）　[形2] 可怜 <code>今の子供は、遊ぶ時間が全然ない。本当に可哀相だ。</code></p></li><li><p>たつ（経つ）　[自動1]  经过，流逝 <code>時間の経つのは早いものだ。</code></p></li><li><p>きぶんてんかん（気分転換） [名] 改变心情</p></li><li><p>あらゆる　[連体] 所有的 <code>あらゆる問題</code></p></li><li><p>しめす（示す）　[他動1] 显示，表示；出示 <code>彼女はなかなか立派な統率力（とうそつりょく）を示した。</code></p></li><li><p>むだづかい（無駄使い）　[名] 浪费、乱花钱 <code>（金の）無駄使いをする。</code></p></li><li><p>わずか（僅か）　[形2・名] 很少 <code>わずかなお金</code></p></li><li><p>なまける（怠ける）　[動2] 偷懒 <code>金曜日のせいか、講義を怠ける学生がけっこういた。</code></p></li></ul><h2 id="语法-2">语法</h2><ol><li><p>～よりも：＝～より的强化形式，表示比起…更…、跟前面这个相比更…。<code>日本人は、握手より（も）お辞儀をするのが一般的です。</code></p></li><li><p>お辞儀をし、～： <code>まずここにお金を入れて、それから1のボタンを押して、最後に2のボタンを押します。（口语） まずここにお金を入れ、次に1のボタンを押し、最後に2のボタンを押します。（书面语）</code></p></li><li><p>～か、～か、～： か：表示疑问，当在文章或句子中连续多次出现时，多表示并列。 没有疑问词用<code>「～かどうか」</code>， 有疑问词时直接用<code>「疑问词 / 带疑问词的小句+か」</code>的形式<code>結婚しているかどうか、給料はいくらか、年はいくつかなどは、普通は聞きません。</code></p></li><li><p>いくら～ても～：不管多么…也，无论怎么…也；「いくら」还可换成「いかに / どんなに / どれだけ」。「いかに」最为正式，多用于书面语。「いくら」多用于口语。</p></li><li><p>怖い顔をして：形容表情的形容词/表示情感的动词 + 顔をする。<code>彼女は私を見ると、びっくりしたような顔をしました。</code></p></li><li><p>～ては / ～では：表示假定条件，如果出现前项不良情况，就会出现后项的状态。后续的内容一般都是消极评价的内容。口语中：「ては」→「ちゃ」「では」→「じゃ」。<code>あんな人が教師では学生がかわいそうです。</code></p></li></ol><h2 id="例句-2">例句</h2><ol><li>今年的马拉松大会，从年轻人到老年人，有1万人以上的市民参加。<code>今年のマラソン大会には、若者からお年寄りまで、1万人以上の市民が参加しました。</code></li><li>我认为时不时转换一下心情，工作更能进展顺利。 <code>時々気分転換をしたほうが、仕事が進むと思います。</code></li><li>不管你再怎么爱对方，要是总是那样任性的话，对方也是会累的。 <code>いくら相手を愛していても、いつもそんなにわがままでは、相手もつかれるでしょう。</code></li><li>小孩子就是对所有事情都会表现出兴趣。  <code>子どもはあらゆることに興味を示すものです。</code></li><li>不能说别人的坏话。 <code>人の悪口を言うものではない。</code></li><li>记得大学时代经常跟前辈一起去喝酒。 <code>大学の時、よく先輩と一緒に飲みに行ったものです。</code></li></ol><h1>第3课</h1><h2 id="生词-3">生词</h2><h3 id="表1-3">表1</h3><ul><li><p>ししゃ（支社）　[名] 分公司，分社</p></li><li><p>ふくめる（含める）　[他动2] 包括，含有 <code>参加者は彼を含めて8人だ。/これは、消費税を含めた値段です。</code></p></li><li><p>おも（主）　[形2] 主要的 <code>主なメンバー/大学では主に経済を勉強した。</code></p></li><li><p>ふう（風）　[専] 风 <code>台風（たいふう）</code></p></li><li><p>くわわる（加わる）　[自动1] 参加，加入，添加，增添 <code>定価に消費税が加わると、ちょうど一万円になります。/李さんは、四月から開発チームに加わることになった。/暑さが加わるにつれて、体がだんだん弱くなっていった。</code></p></li><li><p>いまでも（今でも）　至今 <code>いまでもあの人を愛している。</code></p></li></ul><h3 id="表2-3">表2</h3><ul><li><p>スモモ　[名] 李子</p></li><li><p>しゅにん（主任）　[名] 主任</p></li><li><p>ヨット　[名] 游艇，帆船</p></li><li><p>ていいん（定員）　[名] 定员，编制</p></li><li><p>やくわり（役割）　[名] 任务，职责，角色，作用 <code>役割を果たす。</code></p></li><li><p>ふにんする（赴任する）　[自动3] 赴任  <code>来年支店長として大阪へ / に赴任する。</code></p></li><li><p>つらい（辛い）　[形1] 难受的，痛苦的；艰苦的；为难的 <code>朝起きるのがつらい。</code></p></li><li><p>けってい（決定）　[名] 决定 <code>社長の決定ですから、従（したが）わなければなりません。</code></p></li><li><p>ざっと　[副] 粗略地，大致地 <code>ざっと書類に目を通す。</code></p></li></ul><h3 id="表3-3">表3</h3><ul><li><p>さす（指す）　[动1] 指，指示 <code>時計は、午後二時を指している。</code></p></li><li><p>とうじ（当時）　[名] 当时 <code>当時私はまだ子どもだった。</code></p></li><li><p>ぶし（武士）　[名] 武士（范围更广）</p></li><li><p>さむらい（侍）　[名] 武士 （地位更高）</p></li><li><p>ひとびと（人々）　[名] 人们  <code>若い人々</code></p></li><li><p>ちけい（地形）　[名] 地形</p></li><li><p>はやし（林）　[名] 树林 <code>松（まつ）の林 → 松林（まつばやし）</code></p></li><li><p>たに（谷）　[名] 山谷 <code>人生は山があり、谷がある。</code></p></li><li><p>すぎ（杉）　[名] 杉树</p></li><li><p>かず（数）　[名] 数量，数目 <code>数が多い。</code></p></li><li><p>いっぽう（一方）　[连词] 另一方面（前后对比） <code>A社の業績はとてもいいです。一方、B社の業績はあまりよくありません。</code></p></li><li><p>～ちかく（～近く）　将近 <code>二百年近くの歴史</code></p></li><li><p>やく～（約～）　约～ <code>約一時間で到着</code></p></li></ul><h3 id="表4-3">表4</h3><ul><li>てら（寺）　[名] 寺庙  神社（じんじゃ）</li><li>へいてんする（閉店する）　[名、动3] 打烊；商店倒闭，关门</li><li>あきらめる（諦める）　[动2] 死心 <code>彼は経済的理由で、進学を諦めた。</code></li><li>むしする（無視する）　[名、动3] 忽视 <code>日本でも信号無視をしている通行人や自転車利用者がいる。</code></li><li>うわまわる（上回る）　[动1] 超过 <code>予想を上回る。</code></li><li>したまわる（下回る）　[动1] 不足，不够……水平 <code>1万円を下回る。</code></li><li>なくなる（亡くなる）　[自动1] 亡故 ＝「死ぬ」的委婉说法 <code>地震で多くの人が亡くなりました。</code></li><li>ぎょうせき（業績）　[名] 业绩 <code>会社の業績</code></li><li>ほぼ　大约，大致 <code>ほぼ不可能だ。</code></li><li>しんこく（深刻）　[形2] 严重 <code>病状は深刻だ。</code></li><li>ためす（試す）　[动1] 尝试，试 <code>体にいいと言われて試してみようと思い、飲み始めた。</code></li><li>こおり（氷）　[名] 冰</li><li>とける（溶ける）　[动2] 融化；消融；溶化；熔化 <code>春になると、雪が溶ける。/砂糖が水に溶ける。</code></li></ul><h2 id="语法-3">语法</h2><ol><li><p>～を含(ふく)めて：包含…在内。+【数量词】<code>私を含めて4名 → 4人</code> ～ほか：除…、还有… <code>わたしほか4名 → 5人</code></p></li><li><p>～にとって、～： 对…而言、对…来说 [人、组织、国家等名词] ＋ にとって&lt;后项多为判断、评价性的内容&gt; <code>私たちの会社にとって、今回のプロジェクトはとても大切です。</code></p></li><li><p>～として：作为…&lt;表示身份、立场、资格、种类、范畴等＞ <code>困っている人を助けるのは、人間として当然のことです。</code></p></li><li><p>多く：【名・副】① たくさん；② 大部分　一般而言，形容词可以直接修饰名词，但是「多い」较为特殊。 多い人（×） → 多くの人（〇） 类似：少ない、近い、遠い → 少しの、近くの、遠くの + 名　<code>あの人は少しのことですぐ怒る</code></p></li><li><p>[动－基本形／ない形] ＋ ～わけにはいきません（いかない）不能……&lt;表示根据社会常识或过往经验等而不能选择某项行为，与说话人的能力无关&gt;　<code>名字をつけないわけにはいきません。</code></p></li><li><p>理由倒装句　强调原因理由，可以置于句末，常用的句式有「～のは～からだ」「～のは～ためだ」，“之所以……是因为……”。　<code>多くの人が、地名や地形から名字をつけました。自然に関係する漢字が多いのは、そのためです。</code></p></li><li><p>～と言われている：表示一种普遍的认识、共识，“人们常说……”“普遍认为……”。<code>正しい敬語を使える人は本当に少ないといわれています。</code></p></li></ol><h2 id="例句-3">例句</h2><ol><li>看到科长跟年轻女性亲密地走在一起，但是不能告诉科长夫人。 <code>課長が若い女性と仲良く歩いているのを見ましたが、このことを奥さんに言うわけにはいきません</code>。</li><li>因为在店里试穿了很多套（衣服），所以不得不买下一套。 <code>店で何着も試したので、1着を買わないわけにはいきません。</code></li><li>普遍认为由于全球气候变暖的影响，北极的冰川将会融化。 <code>地球温暖化の影響で、北極の氷が溶けるといわれています。</code></li><li>日本的工薪族几乎每天都在加班，但即便如此工作还是完全干不完。 <code>日本のサラリーマンはほぼ毎日残業しています。それでも仕事は全然終わりません。</code></li><li>经济在急速地发展，另一方面，环境破坏却日益严重。<code>経済が急速に発展しています。一方、環境破壊は深刻化しています。</code></li></ol><h1>第4课</h1><h2 id="生词-4">生词</h2><h3 id="表1-4">表1</h3><ul><li><p>ようぼう（要望）　[名] 迫切要求、强烈期望 <code>お客様のご要望に応（こた）えるよう努力する。</code></p></li><li><p>すいせんする（推薦する）　[動3] 推荐 <code>娘はいま高校三年生でどこかの大学の推薦入学を受けると言っている。</code></p></li><li><p>じじょう（事情）　[名] 情况，缘由 <code>中国の事情に詳しい。</code></p></li><li><p>かまわない　不必介意，没关系 <code>静かな場所なら、多少駅から離れてもかまわない。</code></p></li><li><p>そのように　那样 <code>彼はどうしてそのように言ったのか、分からなかった。</code></p></li><li><p>かんけいがある（関係がある）　 与～有关系 <code>事件に関係がある。</code></p></li></ul><h3 id="表2-4">表2</h3><ul><li>まめ（豆）　[名] 豆子</li><li>けんちく（建築）　[名] 建筑</li><li>がっか（学科）　[名] 学科，专业，科目</li><li>しずむ（沈む）　[動1]  落山，沉没，消沉 <code>太陽が西に沈む。\不幸に沈む。</code></li><li>しんにゅうする（侵入する）　[動3] 闯入，入侵 <code>犯人は、窓から入って室内に侵入したようです。</code></li><li>がっかりする　[動3] 失望、灰心丧气 <code>試験に落ちてがっかりした。\彼が来ないことにがっかりしてしまった。</code></li><li>はげしい（激しい）　[形1] 激烈，剧烈，厉害 <code>雨が激しく降っている。</code></li><li>できあがる（出来上がる）　[自動1] 完成，做好 <code>出来上がったばかりのケーキはやっぱりおいしいですね。</code></li><li>ちゅうもん（注文）　[名] 订货，订购，点菜 <code>おなかがすいたので、適当な店にはいり、チャーハンを注文した。</code></li><li>くやしい（悔しい）　[形1] 懊恼，懊悔，遗憾 <code>どうして早く告白しなかったのか悔しい。</code></li></ul><h3 id="表3-4">表3</h3><ul><li>かつて（曾て）　 [副、名] 过去，以前，曾经 <code>かつては現在のように交通手段が発達していない。</code></li><li>どうにゅうする（導入する）　[動3] 引进，导入 <code>西洋の文明を導入する</code></li><li>へらす（減らす）　[他動1] 减少，减轻 <code>人員を30人減らした。</code></li><li>とりくみ（取り組み）　[名] 措施，举措，努力 <code>新しい研究に取り組む。(动词用法)</code></li><li>じっしする（実施する）　[動3] 实施，施行 <code>計画を実施する。</code></li><li>たいきん（退勤）　[名] 下班</li><li>もうける（設ける）　[動2] 制定，设置，设立；准备 <code>上海で事務所を設ける。</code></li><li>える（得る）　[動2] 得到，获得 → 得（う）る <code>去年四月、はじめて日本訪問の機会を得た。</code></li><li>しゅっせ（出世）　[名] 晋升， 出人头地，出息，发迹 <code>彼は部長にまで出世した。</code></li><li>さまたげ（妨げ）　[名] 妨害，障碍 <code>人の出世を妨げる。</code></li><li>くらべる（比べる）　[動2] 相比，比较，对比 <code>兄弟の身長を比べる。\今年は去年に比べて、ずっと寒い。</code></li><li>おう（追う）　[動1] 追，追求 <code>毎日仕事に追われて、休む暇もない。</code></li></ul><h3 id="表4-4">表4</h3><p>かって　[副] 过去，曾经（同「かつて」）</p><p>しょっき（食器）　[名] 餐具</p><p>あつかう（扱う）　 [他动1] 处理，对待（事物或人）；经营 <code>当店では、宅配便も扱っております。</code></p><p>ぞうかする（増加する）　[他自动3] 增加</p><p>きゅうげき（急激）　[形2] 急剧，急速 <code>急激な増加</code></p><p>さかん（盛ん）　[形2] 兴盛，热烈，繁荣 <code>工業が盛んな国\盛んな拍手\論議が盛んになる。</code></p><p>たもつ（保つ）　[他动1]  保持，维持 <code>温度を摂氏20度に保つ。</code></p><p>くずれる（崩れる）　[自动2] 崩溃，毁坏，变坏 <code>大雨で、裏山の一部が崩れた。</code></p><p>うしなう（失う）　[他动1] 失去，丧失 <code>自信を失う。</code></p><p>ちょくぜん（直前）　[名] 即将……之前；正前面</p><p>こまかい（細かい）　[形1] 细小，细致，琐碎 <code>細かいことは気にしないで。</code></p><p>かいめいする（解明する）　[他动3] 揭开，弄清楚 <code>脳の働き(除“工作”外也表示功能)は、今でもまだ十分に解明されていない。</code></p><p>せまる（迫る）　[动1] 接近，迫近，临近 <code>客観的に見なければ、事件の真実に迫ることは出来ない。</code></p><h2 id="语法-4">语法</h2><ol><li>実は：说出实情或提要求时，做开场白。用在句首，句末多用「の（ん）です」。 <code>実は、母が急病なので、明日の授業を休みたいんですが。</code></li><li>～てもらえませんか：能请（您）……吗？～てもらう：说话人请对方为自己做某事或承受对方所为带来的好处&lt;主语为说话人&gt; ～てくれる：对方为说话人做某事 &lt;主语为提供帮助的“他人”&gt;</li><li>名＋といえば：提出话题，后项列出由此联想到的代表性事物或展开叙述，“提起……、说到……”。 <code>中国といえば、ウーロン茶を連想します。</code></li><li>さらに：[副] 更加、愈发……；[接续] 连接句子或段落，表示在前项基础上并列地补充新内容，“而且，加之”。<code>この国では農業が盛んです。さらに、工業も発展しています。</code></li><li>～ではないか：表示意外、反问和惊讶，“这不是……吗？” ～のではないか：表示根据现有的情况来进行推测，“会不会……，是不是……”。 <code>出世の妨げとなるのではないかと考える人が多かったからです。</code></li><li>見られる：表示某种现象多起来或经常能观察到。 <code>携帯電話でインターネットを楽しむ人がよく見られます。</code></li></ol><p>[第26篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E6%97%A5%E8%AF%AD%E5%AD%A6%E4%B9%A0/">日语学习</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/%E6%A0%87%E5%87%86%E6%97%A5%E6%9C%AC%E8%AF%AD%E4%B8%AD%E7%BA%A7/">标准日本语中级</category>
      
      
      <comments>http://raylei.space/2022/11/23/26-Japanese_Chapter_15/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[金融分析] CFA一级《道德和职业标准》学习笔记</title>
      <link>http://raylei.space/2022/11/12/25-CFA-level1-ethical_professional_standards/</link>
      <guid>http://raylei.space/2022/11/12/25-CFA-level1-ethical_professional_standards/</guid>
      <pubDate>Sat, 12 Nov 2022 14:01:12 GMT</pubDate>
      
      <description>[第25篇] 本篇将包括CFA一级考试中道德和职业标准(Ethical and Professional Standards)科目的学习笔记。</description>
      
      
      
      <content:encoded><![CDATA[<h1>概览</h1><p>道德和职业标准只有1个Session共5个Reading，主要包括的内容是各个Reading的内容如下表：</p><table>    <tr>        <th>Sessions</th>        <th>Readings</th>        <th>Contents</th>    </tr>    <tr>        <td rowspan="4">SS1</td>        <td>R1</td>        <td>Ethics and Trusts in the Investment Profession</td>    </tr>    <tr>        <td>R2</td>        <td>Code of Ethics and Standards of Professional Conduct</td>    </tr>    <tr>        <td>R3</td>        <td>Guidance for Standards I-VII</td>    </tr>    <tr>        <td>R4-5</td>        <td>Global Investment Performance Standards</td>    </tr></table><h1>Reading 1  投资行业的道德和信任</h1><p>首先要明白的是Ethic(道德)、Code(准则)和Standard(细则)的包含意义和区别。Ethic是区别好坏的理念，Code是书面化的道德，Standard是具体化的Code。</p><h2 id="道德行为的挑战">道德行为的挑战</h2><p>对投资职业人士的道德行为的挑战/障碍主要有内外两类：</p><p>内部障碍主要是<code>过度自信(Overconfidence)</code>，过度自信会导致错误的决策，这种偏差会使决策者过度相信自己的直觉。</p><p><code>外部影响(Situational influences)</code>主要是追求短期利率。主要因素有四点：钱、晋升、权威性、对小团体的忠诚(受小团体环境影响)。</p><h2 id="道德和法条对比">道德和法条对比</h2><p>法律并不总是最好的解决方案：</p><ul><li>法律通常跟随市场操作变化，因此具有滞后性。</li><li>监管者需要花费大量的时间来研究和解决问题。</li><li>新法律可能太模糊、有矛盾、或者太狭隘。</li><li>不同的行政区域或国家之间的法律不同。</li><li>法律受限于主观的解读。</li></ul><p>道德在范围上广于法律，但在强制性上低于法律。</p><h2 id="符合道德准则决策的步骤">符合道德准则决策的步骤</h2><ul><li><code>确认问题(Identify)</code>：了解数据情况、利益相关人、权利和责任、道德原则、利益冲突。</li><li><code>考虑问题(Consider)</code>：考虑可能影响决策的因素、考虑监管指引和其他可能的行动方案。</li><li><code>决策并行动(Decide and act)</code></li><li><code>反馈(Reflect)</code>：结果是否与预期一致，为什么？</li></ul><h1>Reading 2 道德行为准则的实现</h1><h2 id="发现违规">发现违规</h2><ul><li>年度<code>自我称述(Professional Conduct Statements)</code>中的自我披露。如果被监管或执法机构调查需要在报告中披露；只需要陈述关于自己的情况。</li><li>协会收到<code>书面投诉(Written complaints)</code>。</li><li>协会通过<code>公开渠道(Public sources)</code>发现会员或成员的违规行为。</li><li>考官发现的考试作弊行为。</li></ul><h2 id="处理违规">处理违规</h2><p><code>准则审查委员会(Disciplinary Review Committee)</code>负责执行处理违规事件，DRC由CFA机构<code>理事会(Board of Governors)</code>监督。DRC在发现和确定违规后会对违规成员进行<code>纪律处分(Sanction)</code>：</p><ol><li>公开警告(public censure)</li><li>暂停会员资格(Suspension of membership and use of the CFA designation)</li><li>开除会员资格(Revocation of the CFA charter)</li><li>禁止参加未来考试(Suspended or prohibited from further participation in the CFA Program)</li></ol><p>被propose以上处分的会员可以接受或拒绝处分，如果选择拒绝则会由DRC成员组成<code>听证小组(Panel)</code>来再次判决，如果申诉失败处罚会加重。</p><h2 id="道德行为准则-Ethic-Professional-Standards">道德行为准则(Ethic&amp;Professional Standards)</h2><p>CFA道德行为准则规定对<code>6类对象(Public, Clients, Prospective clients, Employers, Employees, Colleagues)</code>坚持<code>5大准则(Integrity, Competence, Diligence, Respect, In an ethical manner)</code>。</p><h1>Reading 3 七大准则</h1><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20221112232903385.png" alt="七大准则"></p><h2 id="I-职业性-Professionalism">I.职业性(Professionalism)</h2><h3 id="I-A-Knowledge-of-the-law知法守法">I(A) Knowledge of the law知法守法</h3><h4 id="Content">Content</h4><ol><li>必须理解并遵守所有与工作相关的法律法规。</li><li>在法律法规发生冲突时，应该遵守最严格的规定。</li><li>不可以蓄意参与或支持任何违反法律法规的行为。</li><li>必须从任何违反法律法规的行为中<code>脱离(dissociate)</code>。</li></ol><h4 id="Guidance">Guidance</h4><ol><li>当发现违规行为时应该通过告知上司或法规部的方式告知雇主并以此制止该行为(如果不成功则应该脱离并记录甚至离职)。</li><li>当怀疑有违规行为时，应该向上司或法规咨询以获得<code>最清晰的指示(clear instruction)</code>并<code>判断(judge)</code>是否合理。</li><li>除非当地法律要求，否则CFA协会不要求会员一定要向监管部门报告违规行为。</li><li><code>不作为(Inaction)</code>会被视同与违规行为的协同。</li><li>成员在提供投资服务或产品时应该注意遵守当地的法律和社会习俗。</li><li>应该对负责分发产品或服务的<code>关联公司(associated firms)</code>是否符合法律法规做合理的审查。</li></ol><h3 id="I-B-Independence-and-objectivity独立和客观性">I(B) Independence and objectivity独立和客观性</h3><h4 id="Content-2">Content</h4><ol><li>会员要在职业活动中保持独立和客观。</li><li>不能提供或接受可能影响独立判断能力的礼品</li></ol><h4 id="Guidance-2">Guidance</h4><ol><li>最好完全拒绝任何礼物 ，但普通的不会影响独立性的礼物是可以接受的，吃饭不算礼物。。</li><li>礼物的价值是否会影响独立性不仅要看实际效果也应该看在客户眼中是否如此。</li><li>在完成业绩后收礼物属于小费，可以收贵重礼物但需要向雇主披露，建议先向雇主披露再收礼物。</li><li>买方客户可能对卖方分析师施压，双方都应该顶住压力保持独立客观。</li><li>选择第三方合作伙伴时(基金经理、托管银行)，以客户出发，不能被第三方影响。</li><li>投行内部(投行部和研发部)间必须存在防火墙以防止互相勾连：<code>Reporting structures</code>，即两个部门的直属上级不能是同一个人；<code>Compensation arrangement</code>，即研发部奖金不能挂钩投行部业绩，研发部奖金只能挂钩全公司业绩；<code>Location</code>，即地理隔离，研发部和投行部不能在同一地点。两个部门只有在合规部门的监控管理下可以进行合作。</li><li>业绩衡量和归因时，不能因为业绩压力影响独立客观性。<code>stray from their mandate</code>指背离客户的投资指令；<code>alter the construction of composite indices</code>指改变组合组的组成以隐藏较差的业绩。</li><li>上市公司可能影响分析师以获得利于他们的分析结果。</li><li><code>发行人付费的研报(Issuer-Paid research)</code>只能收取固定费用，且需要完全披露所有的利益冲突和收取的费用与形式。</li><li><code>旅行资金(Travel funding)</code>，最好只使用商业交通而不接受对方公司安排的付费交通，在没有公共交通的情况下可以接受一般的交通安排。</li><li>尽量不能参加对方公司组织的社交活动。</li></ol><h3 id="I©-Misrepresentation不当陈述">I© Misrepresentation不当陈述</h3><h4 id="Content-3">Content</h4><ol><li>不得故意做出不准确或不完整的投资分析、推荐、操作或其他职业活动。</li><li>一旦发现错误陈述(包括打印错误)，需要立即更正否则违反I©规定。</li></ol><h4 id="Guidance-3">Guidance</h4><ol><li><code>Omission(遗漏)</code>：故意遗漏糟糕的业绩；故意隐瞒风险、限制；或在场景分析中遗漏悲观场景。</li><li><code>Misleading(误导)</code>：对产品撒谎；对服务过度承诺；夸大个人经历；第三方提供的核心竞争力；未审核外部研报；选择不合适的市场指标(Benchmark)；估值方法不一致。</li><li><code>Copy(抄袭)</code>：抄袭观点(idea)，修改错误或作为草稿都属于抄袭；从国家统计局或广受认可的金融机构等权威机构获取的原数据可以不加引用，但二次加工过的数据或其他非权威机构的数据都需要加引用；参考他人研报时必须加以引用，除非内部研报可以不用引用，<code>引用时需要具名</code>；引用媒体报道消息时可以用原著或媒体名+原作者名。</li></ol><h3 id="I-D-Misconduct渎职">I(D) Misconduct渎职</h3><h4 id="Content-4">Content</h4><ol><li>不能蓄意欺骗、隐瞒或做出其他会对职业声誉、能力或正直造成负面影响的行为。</li></ol><h4 id="Guidance-4">Guidance</h4><ol><li>不能在没有合理原因的前提下做出推荐。</li><li>不应该进行可能对信任和能力产生影响的活动例如工作时间过度饮酒等。个人破产不属于渎职。</li></ol><h2 id="II-资本市场的诚信-Integrity-of-Capital-Markets">II.资本市场的诚信(Integrity of Capital Markets)</h2><h3 id="II-A-Material-nonpublic-information重大内幕消息">II(A) Material nonpublic information重大内幕消息</h3><h4 id="Content-5">Content</h4><ol><li>持有内幕消息的成员或会员不能利用或使他人利用该消息做操作。</li></ol><h4 id="Guidance-5">Guidance</h4><ol><li>来源可靠且对股价有清晰的影响的消息就叫做<code>重大(Material)</code>消息。来源于Insider或业务往来方既属于<code>来源可靠</code>。关系到公司的<code>盈利(或影响盈利的事件)</code>、<code>兼并收购</code>、资产变更、<code>产品革新或发现、新执照或专利等</code>、客户或供应商的变化、管理层变化、<code>审计结果变化</code>、发行证券、破产、重大法务过错、信用评级变化。</li><li>宏观经济指标、大额订单、知名分析师的判断意见、受限制的人群、竞争对手的估计都是内幕消息。</li><li>Mosaic Theory指可以使用<code>非公开的不重大信息</code>或<code>重大但公开的消息</code>进行市场操作，但一定要留档待查，否则违反V©。</li><li><code>例外情况</code>：<code>Market maker</code>在获取内幕消息时依然可以保持操作，但只能被动交易。<code>Risk-arbitrage trading</code>最好停止，如果不能停止必须要相应证明。</li></ol><h3 id="II-B-Market-manipulation市场操纵">II(B) Market manipulation市场操纵</h3><h4 id="Content-6">Content</h4><ol><li>市场操纵包括<code>释放错误的信息(Info-based)</code>及通过<code>虚增交易量(Transaction-based)</code>来扭曲市场信息。</li></ol><h4 id="Guidance-6">Guidance</h4><ol><li>为了增强<code>新合约</code>流动性，<code>期货交易所</code>和<code>会员单位</code>达成<code>协议(需要披露)</code>要求会员单位确保最低交易量，这种情况不属于市场操纵。</li><li>为了报税，公司将浮亏固定为亏损然后重新入仓不被称为市场操纵。</li><li>当使用Long-short策略发现价差套利时，也可以不被称为市场操纵。</li></ol><h2 id="III-对客户忠诚Duty-to-Clients">III.对客户忠诚Duty to Clients</h2><h3 id="III-A-Loyalty-pridence-and-care忠诚仔细审慎">III(A) Loyalty, pridence and care忠诚仔细审慎</h3><h4 id="Content-7">Content</h4><ol><li>对客户忠诚，仔细行动，审慎判断。</li><li>把客户利益置于雇主利益和自身利益之前。</li></ol><h4 id="Guidance-7">Guidance</h4><ol><li><code>受托职责(Fiduciary)</code>高于其他商业职责。</li><li>四类客户拥有的忠诚对象不同：<code>个人客户(Individual)</code>，投资经理管理个人客户的个人财产，因此客户是资产所有人；<code>投资公众(Investing public)</code>，分析员写研报时的客户主体是投资公众的整体；<code>投资指令(Mandate)</code>，应该忠诚于事先承诺的投资风格；<code>受益人(Beneficiary)</code>，忠诚于基金的受益人。</li><li>构建组合时要站在整体组合的角度考虑，而不是单个考虑。</li><li><code>Soft commission</code>是以非现金的形式返回的研究服务，只能谁付钱谁受益。该笔钱的使用可以由客户指导，购买服务或商品时遵循<code>最优执行(Best execution)</code>和<code>最优价格(Best price)</code>的原则，如果客户要求其他的执行方式必须获得书面同意。</li><li><code>代理投票权(Proxy Voting Policies)</code>，必须有且必须向客户披露，如有改变也必须披露。</li></ol><h3 id="III-B-Fair-dealing公平交易">III(B) Fair dealing公平交易</h3><h4 id="Content-8">Content</h4><ol><li>在提供投资分析、做出投资建议、进行投资操作或其他职业活动时，必须公平对待所有客户。</li></ol><h4 id="Guidance-8">Guidance</h4><ol><li><code>公平(fairly)</code>不等于<code>平等(equally)</code>。可以对不同的客户有不同待遇，但为VIP客户提供服务的时候不能损害一般客户的利益。</li><li>对于<code>投资建议(Recommendation)</code>，需要同步给出至所有客户，允许技术限制造成的延迟。如果投资建议有重大变化，必须通知所有客户，然后可以额外通知老客户，如果老客户操作与变更前的投资建议相同，需要向客户确认并获取书面确认。对于失联客户(每月三次联络不上)，可以不用负责。</li><li>对于<code>交易(Action)</code>，多笔交易的价格要以加权平均的方式以同样的价格给到所有客户，分配政策要向所有客户披露；客户下单的数量不能完全满足时，按客户<code>订单大小(order size)</code>的比例分配；IPO被<code>超额认购(oversubscribe)</code>时，员工不能参与。</li></ol><h3 id="III©-Suitability">III© Suitability</h3><h4 id="Content-9">Content</h4><ol><li>符合客户需求，对个人或小机构客户服从<code>IPS(Investment policy statement)</code>。对基金客户服从<code>Mandate(投资指令)</code>。对于IPS首先需要了解客户的<code>RRTTLLU(Risk objective, Return objective, Time horizon, Tax, Legal, Liquidity, Uniqueness)</code>。从总体组合的角度决定当前投资是否合适客户的财务状况，投资策略或限制。</li><li>对基金客户来说，管理时必须符合预先设定的投资策略。</li></ol><h4 id="Guidance-9">Guidance</h4><ol><li>IPS必须是为客户量身定做；必须至少每年(或有重大变化时)更新。</li><li>对于由<code>客户主动要求(Unsolicited)</code>的交易，如果符合IPS可以直接交易。如果不符合IPS则要判断是否有影响，如果没有影响也可以直接交易，但如果有影响则需要修改IPS，如果客户愿意修改IPS则可以继续交易，否则要将帐户分开，让客户自己管理部分帐户。</li></ol><h3 id="III-D-Performance-presentation业绩陈述">III(D) Performance presentation业绩陈述</h3><h4 id="Content-10">Content</h4><ol><li>谈论投资表现时，必须尽最大可能保证其陈述公平、准确、完整。</li></ol><h4 id="Guidance-10">Guidance</h4><ol><li>必须在描述过去业绩时加上<code>过往不代表未来(Not state or imply to obtain what was achieved in the past)</code>。</li><li>构建<code>组合组(composite)</code>中被关闭的<code>投资组合(portofolio)</code>表现也必须被包含在组合组中。</li><li>以加权平均的方式计算整个组合组的表现。</li><li>模拟盘表现或原雇主处的 投资表现等业绩结果的获得方法应该被完整陈述并披露。</li></ol><h3 id="III-E-Preservation-of-confidentiality保持保密">III(E) Preservation of confidentiality保持保密</h3><h4 id="Content-11">Content</h4><ol><li>必须保证当前、以前以及潜在合格客户的信息保密，除非：客户涉及违法行为；披露行为是法律所要求的；客户或潜在合格客户允许披露信息；如果当地法律允许，协会要求披露信息时。</li></ol><h4 id="Guidance-11">Guidance</h4><ol><li>电子信息安全，许多雇主有非常严格的保密政策，不能在社交媒体上披露信息。</li><li>如果两方都是为同一个客户服务，那么这被授权的两方之间可以沟通关于该客户的信息。</li></ol><h2 id="IV-对雇主的责任-Duty-to-Employers">IV.对雇主的责任(Duty to Employers)</h2><h3 id="IV-A-Loyalty忠诚">IV(A) Loyalty忠诚</h3><h4 id="Content-12">Content</h4><ol><li>必须以雇主的利益行动，不能剥夺雇主的竞争优势(能力、技能、声誉、机密信息等)或做其他伤害雇主的行为。</li></ol><h4 id="Guidance-12">Guidance</h4><ol><li><code>竞争性行为(Independent Practice)</code>。在<code>工作期间</code>的下班时间的业余活动不可以与本职工作时间冲突，不可以伤害雇主利益，如果在下班时间筹备开新公司的任何准备工作都是允许的，但不能<code>实际开业solicit client</code>；</li><li>在<code>离职</code>前不允许带走客户名单，不允许有客户姓名+任何联系方式。不允许带走公司模型。只有通过公开渠道获取数据，或获得雇主(不是上司)许可可以豁免。若没有签<code>非竞业条款(Non-compete agreement)</code>或以上两种情况，才可以联系在职时的客户。</li><li><code>社交平台(social platform)</code>，最好区分个人ID和商业ID，离职前要与雇主讨论如何处理。</li><li><code>在职揭发(Whistleblowing)</code>，在职揭发必须是根据当地法律进行，动机只能是为了客户利益或为了资本市场诚信。</li><li>全职、兼职或实习生，甚至口头协议达成的事实雇佣关系都属于雇佣行为。</li></ol><h3 id="IV-B-Additional-compensation-arrangements额外报酬">IV(B) Additional compensation arrangements额外报酬</h3><h4 id="Content-13">Content</h4><ol><li><code>基于本职工作</code>且<code>由非雇主提供</code>的好处既属于额外报酬，此时需要获得双方的书面许可。</li></ol><h4 id="Guidance-13">Guidance</h4><ol><li><code>好处</code>可以是钱、补偿、福利、优惠、机会等，不包括吃饭。</li></ol><h3 id="IV©-Responsibility-of-superviors身为上司的责任">IV© Responsibility of superviors身为上司的责任</h3><h4 id="Content-14">Content</h4><ol><li>作为上司，必须尽合理的努力防止下属违规。</li></ol><h4 id="Guidance-14">Guidance</h4><ol><li>违规指违反法律、规则、监管要求、公司政策以及协会规章制度。可以授权，但责任依然由本人承担。</li><li>事前需要有合理有效(effective)的内控流程或制度：根据公司规模、业务复杂程度制定合适且及时更新的内控制度。</li><li>存在<code>监测系统(Detection system)</code>，能够发现潜在的违规行为。</li><li>对所有员工进行培训。</li><li>对财务指标和道德行为的达标进行奖励。</li><li>如果公司没有完善的内控制度，作为上司应该马上建立内控制度或在上任前书面拒绝领导岗位直到公司完成内控程序的建设后再履职。</li><li>一旦发现潜在的违规行为，首先<code>启动调查程序(不能领导调查)</code>，然后加强对涉事员工的监控。</li></ol><h2 id="V-投资-Investment">V.投资(Investment)</h2><h3 id="V-A-Diligence-and-reasonable-basis尽职尽责">V(A) Diligence and reasonable basis尽职尽责</h3><h4 id="Content-15">Content</h4><ol><li>给出投资建议时必须有合理充分的研究基础。</li></ol><h4 id="Guidance-15">Guidance</h4><ol><li>至上而下的研究分析，考虑宏观经济、行业周期、公司表现、细化到各种策略、指标等。不能从热门股出发。</li><li>使用第三方信息时必须尽职调查考虑是否可以引用，要检查<code>假设</code>、<code>分析严谨性</code>、<code>数据时效性</code>、<code>作者是否客观独立</code>等。</li><li>使用量化模型时，需要知道模型中的<code>参数</code>如何计算和解释，需要知道模型的<code>假设</code>和<code>局限性</code>。</li><li>开发量化模型时，需要使用样本外数据测试，使用情景分析时必须要包含悲观情景，对模块和模型都要进行检测。</li><li>选择外部合作伙伴时，需要首先审查对方已建立的道德规范；其次检查对方合规和内控制度是否完善；然后评估对方已有数据的质量如何；最后检查对方行为是否与其宣称相符。</li><li>团队研究中，只要同意研究过程合理就可以签字，不一定要对结果同意。</li></ol><h3 id="V-B-Communication-with-clients与客户沟通">V(B) Communication with clients与客户沟通</h3><h4 id="Content-16">Content</h4><ol><li>在投资过程中需要与客户进行沟通的情况主要是<code>市场(重大风险和限制)</code>或<code>自身(关键人事、模型、业务范围、投资策略)</code>发生巨大变化。</li><li>区分<code>事实(fact)</code>和<code>观点(opinion)</code>，使用陈述的语气表达事实，使用推测的语气表达观点。</li></ol><h4 id="Guidance-16">Guidance</h4><ol><li>使用杠杆、复杂金融工具或衍生品等高风险工具时应该告知客户。</li><li>需要披露的限制主要是<code>流动性(Liquidity)</code>和<code>承载性(Capacity)</code>限制。</li><li>交流可以通过详细信息交流也可以通过<code>简报(brief/ capsule form)</code>的方式交流。</li></ol><h3 id="V©-Record-retention记录保存">V© Record retention记录保存</h3><h4 id="Content-17">Content</h4><ol><li>要将交易记录模型等的支持材料保存。</li></ol><h4 id="Guidance-17">Guidance</h4><ol><li>保存形式可以是电子版或纸质。</li><li>如果当地法律对保存时间有要求，则根据当地法律执行；如果当地法律没有要求，记录应该保存至少<code>七年</code>。</li><li>非法获得的支持材料视同没有。</li></ol><h2 id="VI-利益冲突-Conflicts-of-Interest">VI. 利益冲突(Conflicts of Interest)</h2><h3 id="VI-A-Disclosure-of-conflicts利益冲突的披露">VI(A) Disclosure of conflicts利益冲突的披露</h3><h4 id="Content-18">Content</h4><ol><li>必须要完整公允地披露所有可能被合理怀疑影响他们对客户雇主责任的独立客观性的事项。</li></ol><h4 id="Guidance-18">Guidance</h4><ol><li>分析师被要求分析公司股票时继承了该公司股份，此时若要继续完成研报则必须披露，最好的办法是将此研报交给其他分析员完成。</li><li>必须向雇主披露的信息：个人的持仓报告，其他公司的董事会席位。</li><li>必须向客户披露的信息：与标的公司关系的信息，持有标的公司的股票，标的公司董事会席位，个人关系(友谊或感情)。</li></ol><h3 id="VI-B-Priority-of-transaction交易优先权">VI(B) Priority of transaction交易优先权</h3><h4 id="Content-19">Content</h4><ol><li>投资交易在客户和雇主之间必须有优先权。</li></ol><h4 id="Guidance-19">Guidance</h4><ol><li>客户&gt;雇主&gt;自己，交易之间必须留有充足的时间(最少一周)让客户对你的推荐进行反应。</li><li>有些情况下客户希望机构与自己有<code>共同利益(aligned interest)</code>，此时如果交易高流动性股票，可以同时交易。但如果交易低流动性股票，必须客户先交易。</li><li>在家庭账户中，本人有收益权因此作为分析师个人账户，必须最后交易。但如果作为信托基金中的一部分，则应该当做一般客户账户交易，以保护基金中其他客户的利益。</li></ol><h3 id="VI©-Referral-fees-推荐费">VI© Referral fees 推荐费</h3><h4 id="Content-20">Content</h4><ol><li>必须向雇主、客户、潜在合格客户披露所有为推荐产品或服务收到或者给出的任何好处。</li></ol><h4 id="Guidance-20">Guidance</h4><ol><li>披露好处可以让客户了解推荐服务的总成本。</li></ol><h2 id="VII-会员职责-Responsibility-as-Members">VII. 会员职责(Responsibility as Members)</h2><h3 id="VII-A-Conduct-as-members-and-candidate会员和考生职责">VII(A) Conduct as members and candidate会员和考生职责</h3><h4 id="Content-21">Content</h4><ol><li>不能有任何损害CFA协会诚信和声誉的行为。</li></ol><h4 id="Guidance-21">Guidance</h4><ol><li>禁止任何可能对CFA证书公信力产生影响的行为。</li><li>禁止泄露任何与考试相关的信息和知识点，可以表达意见但不能透露具体信息。</li></ol><h3 id="VII-B-Reference-to-institute-designation-program称号使用">VII(B) Reference to institute, designation, program称号使用</h3><h4 id="Content-22">Content</h4><ol><li>会员或考生不能错误陈述或夸大CFA成员、考生、会员的身份。</li></ol><h4 id="Guidance-22">Guidance</h4><ol><li>考生(Candidate)：身份在考试注册成功到拿到当次考试成绩为止。</li><li>会员(member)：通过CFA一级考试后即可成为CFA会员。</li><li>持证人(Charterholder)：通过CFA三级考试，有36个月工作经验，每年缴纳会费即可成为CFA持证人。</li><li>CFA是形容词不是名词；CFA只能大写；不可以使用CFA level I这样的表述；CFA是注册商标，不可以被更改或用于造词；不可以加在公司名中；CFA字体大小不能大于人名大小。</li><li>不可以预计自己什么时候成为持证人，通过三级考试不代表成为持证人。</li><li>成为CFA会员后必须每年完成<code>Professional Conduct Statement</code>并付会员费，否则会自动失去会员资格。</li><li>可以陈述自己CFA考试成绩较好，但不能用考试成绩作为业绩保障的关联或承诺。</li></ol><h1>Reading 4 Introduction to GIPS</h1><ul><li>需要GIPS的原因是便于对比全球投资回报业绩。</li><li>GIPS是自愿遵守而非强制。</li><li>只有实际运营客户资产的资产管理公司才可以称自己使用GIPS标准。</li><li>一旦宣称遵守GIPS就一定要全公司遵守GIPS的全部条款。</li><li>遵守GIPS标准是公司层面的，不能说某个投资组合遵守GIPS。</li><li>验证GIPS需要找<code>独立外部验证人(Independent external verifier)</code>，用于验证资产管理公司在构建组合组、计算陈述业绩时是否符合GIPS标准，而不会验证数据的准确性。最后对公司出具验证报告。</li></ul><h1>Reading 5 Global Investment Performance Standards(GIPS)</h1><p>GIPS一共有0-8九个主要部分，协会一共给出过3版GIPS，其中2000年的第一版只包括0-5共六个部分，主要涵盖传统投资领域，2005年更新的第二版GIPS增加了6-8三个部分，分别是房地产、私募、SMA Portfolios等。主要考点：</p><ul><li><code>公司(Firms)</code>是指独立运营的商业主体。只要组织结构上是独立部门，功能上独立那就是独立的商业主体。</li><li>公司宣称使用GIPS标准的当年必须按要求将至少<code>过去五年</code>的数据按GIPS调整，此后每年增加当年数据至少需要将十年的数据用GIPS展示。不满五年的按开业时间开始计算即可。</li><li>当GIPS要求与当地法律产生冲突，必须遵守当地法律且披露该冲突。</li><li>管理的公司资产中，由客户自行管理的资产不能被展示在组合组表现中，付费组合必须被包括进组合组中，肺付费组合则可以选择是否展示在组合组中。但在展示公司资产规模时，必须包含所有资产。</li><li>从第三版GIPS开始，公司资产规模以公允价值来估计。</li><li>如果公司结构发生变化，组合组的历史业绩也不能更改，即历史业绩依然要留在之前的组合组中。</li><li>两家公司联合运营时，必须明确清晰陈述哪家公司遵守GIPS，哪家没有遵守。</li></ul><p>[第25篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E9%87%91%E8%9E%8D%E5%88%86%E6%9E%90/">金融分析</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/CFA%E4%B8%80%E7%BA%A7/">CFA一级</category>
      
      <category domain="http://raylei.space/tags/%E9%81%93%E5%BE%B7%E5%92%8C%E8%81%8C%E4%B8%9A%E6%A0%87%E5%87%86/">道德和职业标准</category>
      
      
      <comments>http://raylei.space/2022/11/12/25-CFA-level1-ethical_professional_standards/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[金融分析] CFA一级《固定收益》学习笔记</title>
      <link>http://raylei.space/2022/09/21/24-CFA-level1-fixed_income/</link>
      <guid>http://raylei.space/2022/09/21/24-CFA-level1-fixed_income/</guid>
      <pubDate>Wed, 21 Sep 2022 15:53:15 GMT</pubDate>
      
      <description>[第24篇] 本篇将包括CFA一级考试中固定收益(Fixed income)科目的学习笔记。</description>
      
      
      
      <content:encoded><![CDATA[<h1>概览</h1><p>固定收益一共包括2个Session的6个Reading，主要包括的内容是各个Reading的内容如下表：</p><table>    <tr>        <th>Sessions</th>        <th>Readings</th>        <th>Contents</th>    </tr>    <tr>        <td rowspan="4">SS14</td>        <td>R42</td>        <td>Fixed-Income Securities: Defining Elements</td>    </tr>    <tr>        <td>R43</td>        <td>Fixed-Income Markets: Issuance, Trading, and Funding</td>    </tr>    <tr>        <td>R44</td>        <td>Introduction to Fixed-Income Valuation</td>    </tr>    <tr>        <td>R45</td>        <td>Introduction to Asset-Backed Securities</td>    </tr>    <tr>        <td rowspan="2">SS15</td>        <td>R46</td>        <td>Understanding Fixed-Income Risk and Return</td>    </tr>    <tr>        <td>R47</td>        <td>Dundamentals of Credit Analysis</td>    </tr></table><h1>Session 14</h1><h2 id="Reading-42-固收证券：定义">Reading 42 固收证券：定义</h2><h3 id="债券特征">债券特征</h3><p>债券的主要特征有<code>发行人(Issuer)</code>、<code>到期日(maturity)</code>、<code>面值(par value/principal value)</code>、<code>息票率(Coupon rate)</code>、<code>币种(Currency)</code>。</p><h4 id="发行人">发行人</h4><ul><li><code>超国家组织(Supranational organizations)</code>：由世界银行、欧洲投资银行、国际货币基金组织等国际组织发行。</li><li><code>国家(Sovereign governments)</code>：由主权国家的财政部发行。</li><li><code>地方政府(Non-sovereign governments)</code>:由地方政府发行。</li><li><code>准政府(Quasi-government entities)</code>：例如联邦全国抵押协会：房利美</li><li><code>公司(Companies)</code></li><li><code>特殊目的企业(SPE/SPV)</code></li></ul><h4 id="到期日">到期日</h4><p>到期日是指债券的本金被返还的日期。<code>Term to maturity(tenor)</code>是指从现在到到期日的时间。到期日小于一年的债券叫做<code>货币市场债券(Money market security)</code>，到期日大于一年的叫做<code>资本市场债券(Capital market securities)</code>，没有固定到期日的债券叫<code>永续债券(Perpetual bonds)</code>。</p><h4 id="面值">面值</h4><p>债券的面值通常是100或1000。</p><h4 id="息票率">息票率</h4><p><code>普通债券(Vanilla bond)</code>是指固定利率的债券，<code>零息债券(Zero-coupon bond)</code>是指不付利息的债券。</p><h4 id="币种">币种</h4><p><code>双币债券(Dual-currency bond)</code>是指付息和偿还本金分别使用两种不同币种的债券。<code>可选币种债券(Currency option bond)</code>是债券持有人可以选择两种货币中的一种来获得支付。</p><h3 id="债券市场">债券市场</h3><p>债券市场分为四种：当债券发行地与发行货币相同时，债券属于<code>national bond</code>。这时如果发行人属于发行地则债券为<code>domestic bond</code>；如果发行人不属于发行地，则债券为<code>foreign bond</code>。当发行地与发行货币不相符时，发行的债券叫<code>Eurobond</code>；如果债券即在本地发行又在其他国家发行，则属于<code>global bond</code>。</p><p>其中Eurobond又分两类，分别是实名登记的<code>Registered bonds</code>和见票即付的<code>Bearer bonds</code>。</p><h3 id="债券合约-Bond-indenture-Trust-deed">债券合约(Bond indenture/Trust deed)</h3><p>对债权人来说债券合约中比较需要关注的概念有<code>发行主体(Legal information)</code>、<code>还款来源(The source of repayment)</code>、<code>抵押品(Collaterals)</code>、<code>信用增级(Credit enhancements)</code>、<code>条款(Convenants)</code>、<code>税(Taxation)</code>。</p><h4 id="还款来源">还款来源</h4><table><thead><tr><th>Type of bond</th><th>Source of repayment</th></tr></thead><tbody><tr><td>超国家组织</td><td>借新债还旧债<br />各个成员国所缴会费</td></tr><tr><td>国债</td><td>税收收入<br />发行货币</td></tr><tr><td>地方政府</td><td>税收收入<br />基建收入(路桥费等)</td></tr><tr><td>公司债</td><td>运营收入</td></tr><tr><td>资产证券化产品</td><td>标的资产</td></tr></tbody></table><h4 id="信用增级">信用增级</h4><p>信用增级的方法分为内部和外部，其中内部方法包括<code>过度抵押(Overcollateralization)</code>、<code>保证金(Reserved fund)</code>、<code>瀑布结构(Waterfall structure)</code>。外部方法主要是担保，例如<code>保险担保(Surety bond)</code>、<code>银行担保(Bank guarantee)</code>、<code>信用证(Letter of credit)</code>。外部方法最大的问题在于<code>第三方风险(third-party/counterparty risk)</code>，即来自于担保人本身的风险，处理该风险的一个可能方法是<code>Cash collateral account</code>，即将债券所借的一部分资金存入CCA账户以抵消一部分违约风险。</p><h4 id="条款">条款</h4><p>条款分为<code>肯定性条款(Affirmative covenants)</code>和<code>否定性条款(Negative convenants)</code>。</p><p>肯定性条款更多管理性质：要求按时按量偿还本金利息；要求遵守相关法律法规；要求保持现有业务不变；要求保持资产不变并支付税款等。肯定性条款不会带来额外成本，也不会有重大限制。</p><p>否定性条款往往有成本，且有重大限制：限制发行过多债务； 不应发行级别比已有债券更高的债券；之前没有被抵押的资产不能被作为抵押品；限制给股东发行过多股利；限制处置过多固定资产；限制过多风险投资；限制兼并收购。</p><h3 id="债券息票支付">债券息票支付</h3><p>息票的支付有多种方式: <code>Credit-linked coupon bond</code>是票息会随发券人的信用评级变化的债券(信用越高票息越低)；<code>Pay-in-kind bond</code>是发券人以支付更多债券的方式支付票息的债券；<code>Index-linked bond</code>是票息与某种指标(如通货膨胀率等)联系的债券。例如美国的<code>Treasury Inflation-Protected Securities(TIPS)</code>是美国抗通胀国债，半年付息，其息票率不变，本金会根据通胀率调整，因此票息会有所变化，但本金不会因为通货紧缩而变少。</p><h3 id="含权债券">含权债券</h3><p><code>Callable bond</code>指债券发行人有权将债券赎回，通常当市场利率下降时，发行人会倾向于将债券赎回以避免支付高于市场利率的债券票息，对债券发行人有利。该债券有一个<code>递延期(deferment period)</code>，递延期间发行人不能将债券赎回。 <code>Make-whole call provision</code>的赎回价格不固定，其赎回价格为未来现金流的现值，当利率不断下降时其赎回价格没有上限。</p><p><code>Putable bond</code>指债券持有人有权将债券回售，通常当市场利率上升时，债券持有人会倾向于将债券回售以获得资金投资赚取更高的市场利率，对债券持有人有利。</p><p><code>Convertible bond</code>可以将债券转换为普通股股票，对债券持有人有利。可转债的<code>转换价值(Conversion value)</code>是可转换的股票市值，<code>转换价格(Conversion price)</code>是债券可以转换为股票的股价，当转换价值大于转换价格时属于<code>Above parity</code>，应该转换；反之为<code>Below parity</code>，不应该转换。公司愿意发行可转债的原因是1.降低利息费用(转换后不再需要支付利息) 2.降低杠杆率(转换后债务转为资本)。</p><p><code>Warrant</code>可以给予债券持有人以某价格购买股票的权利。</p><h2 id="Reading-43-固收交易市场">Reading 43 固收交易市场</h2><h3 id="债券投资方">债券投资方</h3><ul><li><code>中央银行(Central banks)</code>：中央银行通过买卖债券的公开市场操作实行其货币政策。</li><li><code>机构投资者(Institutional investors)</code>：包括保险公司、对冲基金等使用债券来匹配其债务。</li><li><code>主权财富基金(Sovereign wealth funds)</code>：目标为长线投资的国有投资基金。</li><li><code>散户(Retail investors)</code>：散户投资固收产品通常是追求稳定的价格和收入。</li></ul><h3 id="一级市场-2">一级市场</h3><ul><li><code>公开发行(Public offering)</code>：与股票发行相似，有<code>包销(Underwritten offering)</code>、<code>代销(Best efforts offering)</code>、<code>拍卖(Auction)</code>和<code>上架注册(Shelf registration)</code>。包销风险由投行承担，代销投行主要挣取佣金，拍卖用于发现价格，上架注册特点是一次注册多次发行。</li><li><code>定向增发(Private placement)</code>：向某个符合资质的投资者单独发行债券。</li></ul><h3 id="二级市场-2">二级市场</h3><ul><li><code>交易所市场(Exchange market)</code>：交易双方必须服从交易所规定交易。</li><li><code>柜台市场(OTC dealer market)</code>：充当dealer的角色提供流动性，是债券二级市场的主要交易场所。<code>买卖价差(bid-ask spread)</code>越大，流动性越差。</li></ul><h3 id="回购协议-Repurchase-Agreement">回购协议(Repurchase Agreement)</h3><p>一间机构将债券以某个价格卖给另一间机构并约定未来某个时间将该债券以特定价格购回。<code>回购价格(Repurchase Price)</code>通常大于售价并且包含买家收取的利息。<code>Repo rate</code>是回购协议中的利率，当回购时间更短、抵押债券信用更高、抵押品交割给借出方、其他融资渠道利率低<code>(借出方风险更小)</code>时Repo rate都会更低。<code>Repo margin/haircut</code>是指计算卖价时对抵押品打的折扣率，也即债券市场价值与回购售价的差值，Repo margin与Repo rate相同，当借出方风险更小时，repo margin也会更小。</p><h3 id="结构化产品-Structured-financial-instruments">结构化产品(Structured financial instruments)</h3><ul><li><code>资本保护债券(Capital protected instruments)</code>：购买零息债券，然后将省下的资本投资购买期权，若期权可以收益则在到期日可以获得高于期初本金的收益，若期权无收益也至少可以在到期日获得债券本金。</li><li><code>收益增强工具(Yield enhancement instruments)</code>：以更高风险的代价获取更高的期望收益。<code>信用联结票据(Credit-linked Notes)</code>就是一种收益增强工具，信用评级越低的债券票息越高。</li><li><code>参与性工具(Participation instruments)</code>：这种债券使投资者可以参与到某个资产的回报率。<code>浮动利率债券(Floating-rate bonds)</code>就是一种参与性工具， 其票息率与LIBOR挂钩，该工具不提供本金保护。</li><li><code>带杠杆的工具(Leveraged instruments)</code>：用于放大收益的工具，可以以小博大。</li></ul><h2 id="Reading-44-固收估值">Reading 44 固收估值</h2><p>对于固收产品的估值的常规手段就是对未来现金流求现值，其难点主要包括估计现金流，决定合适的折现率。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mfrac><msub><mi>C</mi><mi>t</mi></msub><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>r</mi><msup><mo stretchy="false">)</mo><mi>t</mi></msup></mrow></mfrac><mo>+</mo><mfrac><mi>B</mi><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>r</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">P=\sum^n_{t=1}\frac{C_t}{(1+r)^t}+\frac{B}{(1+r)^n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9185em;vertical-align:-1.2671em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8829em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2671em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7196em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5904em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h3 id="债券价格与YTM的关系">债券价格与YTM的关系</h3><p>如下图所示，当YTM与债券票息相等时债券价格等于票面价值，关系为YTM越高债券价格越低的凸函数。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20221027204210133.png" alt="不含权债券价格随收益率YTM的变化关系"></p><h3 id="债券价格与时间的关系">债券价格与时间的关系</h3><p>如下图所示，在债券到期日当天，债券价格与票面价值相等，其关系为随时间接近票面价值的凹函数，变化速度越来越快。</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20221027215200986.png" alt="时间越接近到期日，价格越接近票面价值"></p><h3 id="用即期利率-Spot-rate-定价">用即期利率(Spot rate)定价</h3><p><code>即期利率(Spot rate)</code>指能直接在市场上观察到的利率，与之相对的<code>远期利率(Forward rate)</code>指从未来的某个时间点开始的利率。使用即期利率估值是因为不同时间用于折现的利率不相等，但最后算出的债券价格应该与用YTM计算的价格相等。</p><h3 id="平价，应计利息，全价">平价，应计利息，全价</h3><p><code>应计利息(Accrued interest)</code>是指交易日至前一个付息日应该给到卖方的票息；<code>净价(Clean price)</code>是市场上的债券报价；净价加上应计利息就是<code>全价(Full price/ dirty price)</code>。</p><h3 id="矩阵估值法-Matrix-pricing">矩阵估值法(Matrix pricing)</h3><p>矩阵估值法主要被用于对一些交易量不高的债券估值，因为交易量不够因此这些债券通常报价不准确。具体方法是基于其他交易量比较活跃的可比较债券，使用<code>线性插补法(Linear interpolation)</code>计算结果。</p><h3 id="等效年化利率">等效年化利率</h3><p>计息频率不同的债券之间的回报率不能被直接比较，因此若要比较则需先使用下方公式将各个债券计息频率转化为相同然后比较其回报率：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mi>f</mi><mi>f</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mtext> </mtext><mi>a</mi><mi>n</mi><mi>n</mi><mi>u</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>Y</mi><mi>T</mi><mi>M</mi></mrow><mi>m</mi></mfrac><msup><mo stretchy="false">)</mo><mi>m</mi></msup><mo>−</mo><mn>1</mn><mspace linebreak="newline"></mspace><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>A</mi><mi>P</mi><msub><mi>R</mi><mi>m</mi></msub></mrow><mi>m</mi></mfrac><msup><mo stretchy="false">)</mo><mi>m</mi></msup><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>A</mi><mi>P</mi><msub><mi>R</mi><mi>n</mi></msub></mrow><mi>n</mi></mfrac><msup><mo stretchy="false">)</mo><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">Effective\ annual\ rate =(1+\frac{YTM}{m})^m-1\\(1+\frac{APR_m}{m})^m=(1+\frac{APR_n}{n})^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.10764em;">ff</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">ann</span><span class="mord mathnormal">u</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal" style="margin-right:0.10903em;">TM</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0077em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7144em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="固定利率债券收益衡量">固定利率债券收益衡量</h3><p>债券在遇到假期或周末时会延迟付出现金流，因此在实际操作中债券的现金流付出时间会被理论上的有所推迟。</p><p><code>Street convention yield</code>是忽略假期或周末影响的收益率；<code>True yield</code>是需要考虑假期或周末影响的收益率；同一个债券的前者因少计算现金流递延的时间价值影响，收益率会大于后者。</p><p><code>Current yield</code>是将一年中所有收入的票息除以债券价格计算；<code>Simple yield</code>是将所有票息收入加上其直线摊销的收益或损失后除以债券价格。</p><p><code>Yield to call(put)</code>的计算方法与计算YTM的方法一样，不过需要将至到期日的计息次数换为赎回(回售)日的计息次数，将赎回(回售)价格换为到期价值。<code>yield to worst</code>是<code>yield to call(put)</code>和<code>YTM</code>中最差的收益。<code>option-adjusted yield</code>指去除可赎回(卖回)债券的期权影响后的市场期望回报率，可赎回债券的OAY小于YTM，可卖回债券的OAY大于YTM。</p><h3 id="浮动利率债券收益衡量">浮动利率债券收益衡量</h3><p>浮动利率债券的票息率为<code>LIBOR+Quoted margin</code>，折现率为<code>LIBOR+Discount margin</code>。若折现率高于票息率则债券为折价债券；若折现率低于票息率则债券为溢价债券。</p><h3 id="货币市场的债券收益率">货币市场的债券收益率</h3><p><code>Discount yield</code>是<code>美国短期国债(U.S. Treasury bills)</code>和<code>商业票据(Commercial paper)</code>的回报率计算方法；<code>Add-on yield</code>是LIBOR、银行大额存单利率以及BEY的计算方法。二者差别在于分母为FV或PV，其公式分别为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>R</mi><mo>=</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><mrow><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow></mfrac><mo>×</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>F</mi><mi>V</mi><mo>−</mo><mi>P</mi><mi>V</mi></mrow><mrow><mi>F</mi><mi>V</mi></mrow></mfrac><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mspace linebreak="newline"></mspace><mi>A</mi><mi>O</mi><mi>R</mi><mo>=</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>Y</mi><mi>e</mi><mi>a</mi><mi>r</mi></mrow><mrow><mi>D</mi><mi>a</mi><mi>y</mi><mi>s</mi></mrow></mfrac><mo>×</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>F</mi><mi>V</mi><mo>−</mo><mi>P</mi><mi>V</mi></mrow><mrow><mi>P</mi><mi>V</mi></mrow></mfrac><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">DR = (\frac{Year}{Days}\times(\frac{FV-PV}{FV}))\\AOR = (\frac{Year}{Days}\times(\frac{FV-PV}{PV}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">))</span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.00773em;">OR</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">a</span><span class="mord mathnormal">ys</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">Y</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">))</span></span></span></span></span></p><h3 id="Forward-rate-v-s-Spot-rate">Forward rate v.s. Spot rate</h3><p><code>远期利率(forward rate)</code>与<code>即期利率(Spot rate)</code>的关系是一定时间内的即期利率折现与当时的即期利率组合折现的效果相同，即：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>S</mi><mi>T</mi></msub><msup><mo stretchy="false">)</mo><mi>T</mi></msup><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>1</mn><mi>y</mi><mn>1</mn><mi>y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mi>T</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>y</mi><mn>1</mn><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">(1+S_T)^T=(1+S_1)(1+1y1y)...(1+(T-1)y1y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1413em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord">...</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></p><p>使用远期利率为债券估值时可以将每期的现金流按当个现金流的一年期远期利率折现，即：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>b</mi><mi>o</mi><mi>n</mi><mi>d</mi><mtext> </mtext><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mi>C</mi><msub><mi>F</mi><mn>1</mn></msub></mrow><mrow><mn>1</mn><mo>+</mo><msub><mi>S</mi><mn>1</mn></msub></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>C</mi><msub><mi>F</mi><mn>2</mn></msub></mrow><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>1</mn><mi>y</mi><mn>1</mn><mi>y</mi><mo stretchy="false">)</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>C</mi><msub><mi>F</mi><mi>n</mi></msub></mrow><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><msub><mi>S</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mn>1</mn><mi>y</mi><mn>1</mn><mi>y</mi><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mo stretchy="false">(</mo><mi>T</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mi>y</mi><mn>1</mn><mi>y</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">bond\ value=\frac{CF_1}{1+S_1}+\frac{CF_2}{(1+S_1)(1+1y1y)}+\frac{CF_n}{(1+S_1)(1+1y1y)...(1+(T-1)y1y)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mord">...</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">1</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h3 id="Yield-spread">Yield spread</h3><p>固定收益中的<code>Yield spread</code>就是某只固收债券的收益率与美国短期国债收益率的溢价部分，即<code>Risk premium</code>。CFA考试中较为重要的几个spread有下面几个：</p><p><code>G-spread</code>： 公司债YTM减国债YTM，需要期限一致。</p><p><code>Zero-volatility spread</code>：公司债Spot rate减国债Spot rate，需要期限一致。该spread中包含有流动性风险，信用风险，以及对于相对于含权债券来说期权的风险补偿。</p><p><code>Option-adjusted spread(OAS)</code>：OAS对比Z-spread剔除了期权的风险补偿，也即Z-spread相比OAS多包含了期权的风险溢价。因此同样的含权债券，Callable的Z-spread大于OAS，Putable的Z-spread小于OAS。</p><h2 id="Reading-45-Asset-Backed-Security">Reading 45 Asset-Backed Security</h2><h3 id="资产证券化-Securitization">资产证券化(Securitization)</h3><p>以买方为例，当市场上的买房人无法全款买房时，他们会向商业银行贷款，银行作为贷出方会消耗流动性，这时银行可以将与买房人的贷款合同出售给SPE/SPV机构，发行Asset-Backed Security，然后卖出给投资者重新获取流动性。资产证券化的过程中的主要参与方有作为<code>Originator</code>的商业银行和作为<code>Issuer</code>的SPE/SPV。其他参与资产证券化的参与者都属于第三方。</p><p>资产证券化的最大好处是增加流动性，且降低或移除了最终投资者与房贷风险提供者之间的隔离。投资者可以直接投资房贷风险。</p><h3 id="住房贷款-Residential-Mortgage">住房贷款(Residential Mortgage)</h3><p>房贷债券分为<code>RMBS(住房贷款债券)</code>和<code>CMBS(商业地产债券)</code>两种，其中RMBS又分为MPS和CMO两种。美国房贷的特点是固定利率(fixed-rate)、等额等息(level payment)、完全摊销(fully amortized)。几个重要的概念如下：</p><ul><li><code>Loan-to-value ratio(LTV)</code>是贷款金额与房价的比值，LTV越高贷款人风险越高。</li><li><code>Foreclosure</code>是追索权，若贷款是<code>Recourse loan</code>则有追索权，出售房产金额不够偿还未还贷款的部分可以向借方追索；<code>Nonrecourse loan</code>则没有追索权。</li><li><code>Strategic default</code>：当房价低于未还贷款部分时可能产生战略性违约的情况。</li><li><code>Interest-only mortgage</code>：某几年中不需要偿还本金的房贷。</li><li><code>Conforming mortgage</code>：符合一定承销标准的贷款，即优质贷款；其次还有风险更高的<code>Non-conforming mortgage</code>。</li></ul><h3 id="Mortgage-passthrough-securities-抵押转手证券">Mortgage passthrough securities(抵押转手证券)</h3><p>MPS即转手证券，所有贷款被放入一个池中并以份额的形式卖给所有投资者，没有风险分层。MPS属于债券产品，因此也有票息，被称为<code>Pass-through rate</code>。关于MPS需要计算的概念有：</p><ul><li><code>Weighted average maturity(WAM)</code>：贷款池中每个贷款未还贷金额与整个贷款池的比为这个贷款的份额权重，将每份贷款的剩余还贷期数加权平均既是该池的WAM。</li><li><code>Weighted average coupon(WAC)</code>：与WAM相似，将贷款池中贷款的Mortgage rate加权平均就是贷款池的WAC。</li></ul><h4 id="Prepayment-risk-提前偿还风险">Prepayment risk(提前偿还风险)</h4><p>提前偿还风险主要包括<code>收缩风险(COntraction risk)</code>和<code>扩张风险(Extension risk)</code>，前者通常由于市场利率下降，贷款人可以从市场上获取更便宜的资金用于偿还房贷，因此会出现更多提前偿还，导致收缩风险。反之市场利率上升导致扩张风险。</p><h4 id="Prepament-rate-提前还款率">Prepament rate(提前还款率)</h4><p><code>conditional prepayment rate(CPR)</code>是贷款池中的未还贷款被提前还款的年化率(年化提前还款率)。<code>Public Securities Association(PSA)</code>prepayment benchmark在100%的情况下首月CPR为0.2%，且以每个月上升0.2%的速度升至30个月时的6%，且维持CPR为6%至360个月。不同百分比的PSA在100%的情况下乘以变化的倍数，CPR越高提前还款率就越高。</p><p>另外每月的提前还款率为<code>single monthly mortality rate(SMM)</code>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>S</mi><mi>M</mi><mi>M</mi><mo>=</mo><mfrac><mtext>本月提前还款</mtext><mrow><mtext>月初本金余额</mtext><mo>−</mo><mtext>本月应还本金</mtext></mrow></mfrac><mspace linebreak="newline"></mspace><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>C</mi><mi>P</mi><mi>R</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>S</mi><mi>M</mi><mi>M</mi><msup><mo stretchy="false">)</mo><mn>12</mn></msup></mrow><annotation encoding="application/x-tex">SMM=\frac{本月提前还款}{月初本金余额-本月应还本金}\\(1-CPR)=(1-SMM)^{12}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">SMM</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">月初本金余额</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord cjk_fallback">本月应还本金</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord cjk_fallback">本月提前还款</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">CPR</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">SMM</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span></span></span></span></span></span></span></span></span></p><h3 id="Collateralized-mortgage-obligations-担保式抵押契约">Collateralized mortgage obligations(担保式抵押契约)</h3><p>CMO是将贷款池中的风险分层卖给不同投资者，有两种主要的契约形式：</p><h4 id="Sequential-Pay-tranches">Sequential Pay tranches</h4><p>顾名思义，该类契约按顺序还款，假设将贷款池分为ABC三种风险池，还款现金流进入后的流程如下：</p><ol><li>先满足ABC的利息部分</li><li>多余现金流先还A的本金，然后剩下的还B的现金流，以此类推</li><li>若还款甚至无法满足ABC利息，利息部分先满足A再满足B并以此类推</li></ol><p>C部分贷款还款速度最慢，拥有最大拓张风险，A部分拥有最大收缩风险。</p><h4 id="Planned-amortization-class-PAC-CMO">Planned amortization class(PAC) CMO</h4><p>PACCMO中分为PAC和Support两部分，其中PAC部分就是Sequential Pay的结构，而Support部分则是在偿还所有利息后先偿还该部分本金，或在现金流不足时不偿还该部分。因此Support部分同时拥有最大的扩张风险和收缩风险，而有Support支撑的PAC部分则有相对稳定的现金流，average life相对稳定。</p><h3 id="CMBS-商业地产贷款债券">CMBS(商业地产贷款债券)</h3><p>住房楼、写字楼、仓库、商场、酒店、医院等都属于商业地产范畴，商业地产都是有限责任主体，因此都是无追索权贷款(Non-recourse loans)，反映商业地产贷款风险的两个主要指标：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>e</mi><mi>b</mi><mi>t</mi><mo>−</mo><mi>t</mi><mi>o</mi><mo>−</mo><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>i</mi><mi>c</mi><mi>e</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mo>=</mo><mfrac><mrow><mi>n</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>o</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>n</mi><mi>g</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>c</mi><mi>o</mi><mi>m</mi><mi>e</mi></mrow><mrow><mi>d</mi><mi>e</mi><mi>b</mi><mi>t</mi><mtext> </mtext><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></mfrac><mspace linebreak="newline"></mspace><mi>L</mi><mi>o</mi><mi>a</mi><mi>n</mi><mo>−</mo><mi>t</mi><mi>o</mi><mo>−</mo><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext> </mtext><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mo>=</mo><mfrac><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>r</mi><mi>t</mi><mi>g</mi><mi>a</mi><mi>g</mi><mi>e</mi><mtext> </mtext><mi>a</mi><mi>m</mi><mi>o</mi><mi>u</mi><mi>n</mi><mi>t</mi></mrow><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mtext> </mtext><mi>a</mi><mi>p</mi><mi>p</mi><mi>r</mi><mi>a</mi><mi>i</mi><mi>s</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Debt-to-service\ coverage\ ratio=\frac{net\ operating\ income}{debt\ service}\\Loan-to-value\ ratio=\frac{current\ mortgage\ amount}{current\ appraised\ value}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7778em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">De</span><span class="mord mathnormal">b</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0225em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3365em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">b</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">co</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">o</span><span class="mord mathnormal">an</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6984em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1725em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.2921em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">rre</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">ai</span><span class="mord mathnormal">se</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">rre</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">am</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>前者为租金与月供的比值，比值越高风险越低。后者为贷款与房价的比值，比值越高风险越高。</p><h4 id="赎回保护-Call-protection">赎回保护(Call protection)</h4><p>债券购买者通常不希望发债人提前偿还债券，因此CMBS一般会设置赎回保护，用以减少提前偿还对债券持有人造成的风险。主要的手段有下面四种：</p><p>Prepayment lockout：合约规定禁止还款的时间段。</p><p>Defeasance：使用国债组合复制被提前还款的缺失现金流而对冲风险。</p><p>Prepayment penalty points：对提前还款收取额外的违约金。</p><p>Yield maintenance charges(make-whole charge)：提前还款需要将未来的现金流以一定值折现还款。</p><h3 id="Non-mortgage-asset-backed-securities">Non-mortgage asset-backed securities</h3><p>非房产债券的主要代表有<code>汽车贷款债券(Auto loan ABS)</code>和<code>信用卡应收账款债券(Credit Card Receivable ABS)</code>。需要注意的点有：</p><ul><li>汽车贷款的提前偿还主要是汽车的二手出售和损毁的情况下，车主会将获得的现金流用于偿还车贷。</li><li>信用卡应收账款池中的现金流主要包括信用卡利息费用、信用卡费用和本金的提前偿还等。</li><li>信用卡应收账款债券的Lockout periods是指ABS持有人在锁定期内不能受到提前还款的本金和利息。</li></ul><h3 id="Collateralized-Debt-Obligations">Collateralized Debt Obligations</h3><p>CDO是将垃圾债券收集成池后分层卖出给投资者的产品。分层后<code>最高的评级(Senior tranche)</code>至少要达到A级,中间BBB级但不低于B级的分层叫做<code>Mezzanie tranche</code>，最低的分层叫<code>Subordinate/equity tranche</code>，通常由投行自留。CDO与ABS的区别在于CDO需要资金经理主动管理。</p><p>CDO在卖出给投资者时是浮动利率债券，但池中的垃圾债券可能有些付出固定利率，因此CDO的基金经理通常需要使用利率Swap将固定利率交换为浮动利率，从而解决利率错配的风险问题。</p><h2 id="Reading-46-固收风险和收益">Reading 46 固收风险和收益</h2><p>固收产品的主要收益来源有三个，<code>本金和票息收入</code>、<code>票息收入的再投资</code>、<code>债券到期前卖出的资本盈亏</code>。总收益是票息及其再投资收益和售价的未来总价值。使用总收益可以计算年化持有期间收益率：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>A</mi><mi>n</mi><mi>n</mi><mi>u</mi><mi>a</mi><mi>l</mi><mi>i</mi><mi>z</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>h</mi><mi>o</mi><mi>l</mi><mi>d</mi><mi>i</mi><mi>n</mi><mi>g</mi><mtext> </mtext><mi>p</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>d</mi><mtext> </mtext><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi><mo>=</mo><mo stretchy="false">(</mo><mfrac><mrow><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>r</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>n</mi></mrow><mrow><mi>b</mi><mi>o</mi><mi>n</mi><mi>d</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow></mfrac><msup><mo stretchy="false">)</mo><mfrac><mn>1</mn><mi>n</mi></mfrac></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Annualized\ holding\ period\ return=(\frac{total\ return}{bond\ price})^\frac{1}{n}-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal">nn</span><span class="mord mathnormal">u</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">h</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">re</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.004em;"><span style="top:-3.413em;margin-right:0.05em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8443em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line mtight" style="border-bottom-width:0.049em;"></span></span><span style="top:-3.384em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span></p><h3 id="利率风险">利率风险</h3><p>广义的利率风险主要是<code>票息的再投资风险</code>和<code>市场价格变化风险</code>两种，而对债券来说狭义的利率风险主要是后者，即利率变化对债券价格的影响。利率变化对这两者的影响是可以一定程度地相互抵消的，在短期时利率变化的价格风险影响会大于再投资风险(利率上升导致损失)，在长期时则是相反再投资风险占据主导(利率上升导致收益)。</p><h4 id="Duration-Gap">Duration Gap</h4><p>要计算Duration Gap首先要知道<code>麦考利久期(Macaulay Duration)</code>，麦考利久期就是以折现现金流作为权重的现金流平均回流时间。而Duration Gap = Macaulay Duration - Investment horizon。</p><p>当Duration Gap大于0时(即麦考利久期大于投资期限时)，投资是属于短期，利率的价格风险大于再投资风险；Duration Gap等于0时，利率变化的两种风险刚好抵消；Duration Gap小于0时，投资属于长期，再投资风险大于价格风险。</p><h4 id="Modified-duration">Modified duration</h4><p><code>修正久期(Modified duration)</code>计算债券价格对利率变化的敏感程度：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mfrac><mrow><mi>M</mi><mi>a</mi><mi>c</mi><mi>a</mi><mi>u</mi><mi>l</mi><mi>a</mi><mi>y</mi><mtext> </mtext><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><mrow><mn>1</mn><mo>+</mo><mi>p</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>c</mi><mtext> </mtext><mi>m</mi><mi>a</mi><mi>r</mi><mi>k</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>y</mi><mi>i</mi><mi>e</mi><mi>l</mi><mi>d</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Modified\ duration=\frac{Macaulay\ duration}{1+periodic\ market\ yield}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mspace"> </span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>由于修正久期只考虑债券价格与利率变化的线性变化关系，因此在利率变化较小的时候比较准确。</p><h4 id="Effective-duration">Effective duration</h4><p>当利率减少或增加固定的值时导致的债券价格增加和减少的区别就是Effective duration，有效久期是衡量含权债券最有效的久期：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mi>f</mi><mi>f</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mtext> </mtext><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mfrac><mrow><msub><mi>V</mi><mo>−</mo></msub><mo>−</mo><msub><mi>V</mi><mo>+</mo></msub></mrow><mrow><mn>2</mn><mo>×</mo><msub><mi>V</mi><mn>0</mn></msub><mo>×</mo><mi mathvariant="normal">Δ</mi><mi>c</mi><mi>u</mi><mi>r</mi><mi>v</mi><mi>e</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Effective\ duration=\frac{V_--V_+}{2\times V_0\times \Delta curve}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal" style="margin-right:0.10764em;">ff</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1963em;vertical-align:-0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">Δ</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.836em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h4 id="Dollar-duration">Dollar duration</h4><p>当利率变化1%时，具体的债券价格变化：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>a</mi><mi>r</mi><mtext> </mtext><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>M</mi><mi>o</mi><mi>d</mi><mi>i</mi><mi>f</mi><mi>i</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>d</mi><mi>u</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>×</mo><mi>P</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Dollar\ duration=Modified\ duration\times Price</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">Do</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">d</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span></span></p><h3 id="影响久期的特殊因素">影响久期的特殊因素</h3><ul><li>债券期限越长，久期越大</li><li>票息越低，久期越大</li><li>市场利率越低，久期越大</li><li>含权债券的久期更短</li></ul><h3 id="组合久期">组合久期</h3><p>计算债券投资组合的久期主要有两种方法：</p><ol><li>将组合现金流直接加权平均计算麦考利久期，缺点是实践中难以确定现金流，因此难以在实践中应用。</li><li>将组合中不同的债券按<code>市值(而不是价格)</code>作为权重计算他们的久期的加权平均数。</li></ol><h3 id="凸性-Convexity">凸性(Convexity)</h3><p>久期(Duration)是债券价格对利率的一阶导，而凸性则是价格对利率的二阶导，也就是久期随利率变化的敏感度。凸性部分需要掌握的公式有两个，其一是凸性的计算公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>e</mi><mi>f</mi><mi>f</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>v</mi><mi>e</mi><mtext> </mtext><mi>c</mi><mi>o</mi><mi>n</mi><mi>v</mi><mi>e</mi><mi>x</mi><mi>i</mi><mi>t</mi><mi>y</mi><mo>=</mo><mfrac><mrow><msub><mi>V</mi><mo>−</mo></msub><mo>+</mo><msub><mi>V</mi><mo>−</mo></msub><mo>−</mo><mn>2</mn><msub><mi>V</mi><mn>0</mn></msub></mrow><mrow><mo stretchy="false">(</mo><mi mathvariant="normal">Δ</mi><mi>c</mi><mi>u</mi><mi>r</mi><mi>v</mi><mi>e</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><msub><mi>V</mi><mn>0</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">effective\ convexity=\frac{V_-+V_--2V_0}{(\Delta curve)^2V_0}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.10764em;">ff</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">co</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2963em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">e</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">2</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>其二则是凸性调整后的久期：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mfrac><mrow><mi mathvariant="normal">Δ</mi><mi>P</mi></mrow><mi>P</mi></mfrac><mo>=</mo><mo stretchy="false">[</mo><mo>−</mo><mi>M</mi><mi>D</mi><mo>×</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Δ</mi><mi>y</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo>+</mo><mo stretchy="false">[</mo><mn>0.5</mn><mo>×</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>v</mi><mo>×</mo><mo stretchy="false">(</mo><mi mathvariant="normal">Δ</mi><mi>y</mi><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\frac{\Delta P}{P}=[-MD\times (\Delta y)]+[0.5\times Conv\times (\Delta y)^2]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.0463em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord">0.5</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">Δ</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></span></p><h4 id="含权债券的凸性">含权债券的凸性</h4><p>对于Callable bond来说，利率下降会导致债券价格接近但不会超过call price。对于Putable bond来说，利率上升会使债券价格不断接近但不会低于Put price的价格底。</p><h2 id="Reading-47-信用分析基础">Reading 47 信用分析基础</h2><p>信用风险是指当债券发行人无法足额或及时支付利息或本金的风险，一般分为<code>违约风险(Default risk)</code>和<code>损失严重性(Loss severity)</code>两个维度，两个维度相乘可以得到<code>预期损失(Expected Loss)</code>，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mtext>损失严重性</mtext><mo>=</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>y</mi><mtext> </mtext><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">1-损失严重性=Recovery\ rate</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">损失严重性</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">eco</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.03588em;">ery</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span></span></span></span>。另外债券的<code>Spread risk</code>也会随着发行人的信用降级而增加。</p><h3 id="求偿顺序-Seniority-ranking">求偿顺序(Seniority ranking)</h3><p><code>有抵押品债券(Secured bond)</code>优先度高于<code>无抵押品债券(Unsecured bond)</code>，同等级的债权人都同等对待，不管这些债券的其他性质如何(Pari Passu)。</p><h3 id="评级">评级</h3><p>评级机构会对<code>债券发行人评级(Issuer credit rating)</code>、<code>产品评级(Issue rating)</code>。同一发行人发行的产品可能有不同的评级，这种现象叫做<code>Notching</code>，越差的发行人出现notching现象的可能性越高(发行人发行的<code>Senior unsecured debt</code>的评级通常与公司评级相同)。</p><p><code>交叉违约条款(Corss default provision)</code>下，当债券发行人的某个产品发生违约事件时，该发行人发行的其他产品债权人可以发起求偿。<code>结构性从属(Structural suborination)</code>条款规定子公司在付齐应付的的债券利息和本金前不可以向母公司输送利润。</p><p>有四个理由投资者不能只依靠信用评级来衡量风险：</p><ol><li>信用评级是动态变化的。</li><li>评级机构不是永远不会犯错的。</li><li>有一些突然事件导致的风险(Idiosyncratic or event risk)是很难被信用评级捕捉的。</li><li>评级通常滞后于市场。</li></ol><h4 id="4C法评级">4C法评级</h4><p>评级机构通常根据<code>能力(Capacity)</code>、<code>抵押品(Collateral)</code>、<code>条款(Covenants)</code>和<code>意愿(Character)</code>四个方面对债券进行评级。</p><ul><li>能力：使用<code>Porter's five force model</code>进行行业分析，行业基本面(周期或非周期、行业成长前景、公布的行业数据等)，公司基本面(竞争位置、经营历史、管理层策略和执行、财务比率等)，发行人流动性分析(现金、营运资金、经营性现金流、银行授信额度、近期是否有大量资本支出等)。</li><li>抵押品：<code>专利权(Patents)</code>是高质量的无形资产；<code>声誉(Goodwill)</code>不是高质量无形资产；折旧费用较高标志着资产利用率较低；股票市值低于公司账面价值说明公司资产质量较低；人力资源较难估计。</li><li>条款：主要关于肯定性条款和否定性条款的规定和应用。</li><li>意愿：公司战略的可靠性；业绩记录；会计政策和税务政策；欺骗和欺诈记录；对债权人的历史记录。</li></ul><p>[第24篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E9%87%91%E8%9E%8D%E5%88%86%E6%9E%90/">金融分析</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/CFA%E4%B8%80%E7%BA%A7/">CFA一级</category>
      
      <category domain="http://raylei.space/tags/%E5%9B%BA%E5%AE%9A%E6%94%B6%E7%9B%8A/">固定收益</category>
      
      
      <comments>http://raylei.space/2022/09/21/24-CFA-level1-fixed_income/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[金融分析] CFA一级《股权投资》学习笔记</title>
      <link>http://raylei.space/2022/08/29/23-CFA-level1-equity-investment/</link>
      <guid>http://raylei.space/2022/08/29/23-CFA-level1-equity-investment/</guid>
      <pubDate>Mon, 29 Aug 2022 13:30:32 GMT</pubDate>
      
      <description>[第23篇] 本篇将包括CFA一级考试中股权投资(Equity investment)科目的学习笔记。</description>
      
      
      
      <content:encoded><![CDATA[<h1>概览</h1><p>股权投资一共包括2个Session的6个Reading，主要包括的内容是各个Reading的内容如下表：</p><table>    <tr>        <th>Sessions</th>        <th>Readings</th>        <th>Contents</th>    </tr>    <tr>        <td rowspan="3">SS12</td>        <td>R36</td>        <td>Market Organization and Structure</td>    </tr>    <tr>        <td>R37</td>        <td>Security Market Indexes</td>    </tr>    <tr>        <td>R38</td>        <td>Market Efficiency</td>    </tr>    <tr>        <td rowspan="3">SS13</td>        <td>R39</td>        <td>Overview of Equity Securities</td>    </tr>    <tr>        <td>R40</td>        <td>Introduction to Industry and Company Analysis</td>    </tr>    <tr>        <td>R41</td>        <td>Equity Valuation: Concepts and Basic Tools</td>    </tr></table><h1>Session 12</h1><h2 id="Reading-36-金融市场组织和结构">Reading 36 金融市场组织和结构</h2><h3 id="金融市场的主要功能">金融市场的主要功能</h3><ul><li>满足不同投资者的不同需求：存储、借贷、股权发行、风险管理、交换资产、信息兑现。</li><li>决定市场利率：金融市场的市场利率由贷款和借款的数量决定。</li><li>资金最有效配置：市场中的资产被最有效地分配到需要他们的人手上，每个人都获得更高收益。</li></ul><h3 id="正常运行的金融市场">正常运行的金融市场</h3><p>正常运行的金融市场应该具有以下特性：</p><ul><li>完整市场(Complete market)：可以满足不同投资者的不同金融需求。</li><li>经营效率(Operational efficiency)：交易成本低。</li><li>信息有效性(Informational efficiency)：新信息在价格上的反映迅速。</li><li>资源配置有效性(Allocational efficiency)：资金被分配到可以最高效运动它的人手中。</li></ul><p>金融监管机构的主要职责包含：</p><ul><li>最小化代理人冲突</li><li>保证金融市场公平公正运行</li><li>防止内幕交易</li><li>防止违约和金融欺诈</li><li>保证负债应该被资产覆盖</li></ul><h3 id="金融市场参与者-Intermediaries-of-Financial-Market">金融市场参与者(Intermediaries of Financial Market)</h3><p>金融市场的主要参与者包括Brokers, Dealers and Exchange/ Securitizers/ Depositor Institutions/ Insurance Companies/ Arbitrageurs/ Clearinghouses and Custodians。其中Broker和Insurance Company是这一部分的主要考点。</p><ul><li>经纪人(Brokers)：经纪人的主要功能是撮合希望交易的双方并从中获取佣金。</li><li>Dealers：与经纪人不同，Dealers会实际作为交易对手方，参与买卖并赚取<code>买卖价差(bid-ask spread)</code>。</li><li>Block Brokers：主要是负责<code>大宗商品交易</code>的经纪人。</li><li>Broker-dealers：指市场上一些既做经纪人又做Dealer的交易方。</li><li>交易所(Exchanges)：为交易提供场所，主要发挥监管职能。</li><li>保险公司：保险公司面临的风险主要有三个，道德风险(Moral hazard)指被保险人可能因为被保险而使风险上升；逆向选择(Adverse selection)指购买保险的人群往往比普通大众更加处在被保风险之中；诈骗(fraud)指虚构索赔等骗保行为。</li></ul><h3 id="资产分类">资产分类</h3><p>金融资产的分分类有很多，大多会在其他科目中学习，需要着重注意的有下面几个：</p><h4 id="集合融资产品-Pooled-investment-Vehicles">集合融资产品(Pooled investment Vehicles)</h4><p>集合融资产品的本质就是<code>基金(Funds)</code>，基金中包括购买上市公司股票的<code>公募基金(Mutual Funds)</code>；购买非上市公司股票的<code>私募基金(Private Equity)</code>；购买房地产的<code>房地产金融投资(REITS)</code>；购买金融衍生品的<code>对冲基金(Hedge Funds)</code>。所有的这些基金种类统称为集合融资产品。</p><h4 id="公募基金-Mutual-Funds">公募基金(Mutual Funds)</h4><p>公募基金主要分为<code>开放基金(open-ended)</code>和<code>封闭基金(close-ended)</code>。其中开放基金的申购和赎回都可以随时向基金公司申请，以<code>基金净值交易(Net Asset Value, NVA)</code>，但由于需要应对赎回情况，开放基金通常需要配置部分高流动性资产，而被<code>影响收益率(Cash drag)</code>；封闭基金则是在认购期外不能直接与基金公司交易的基金，但可以在二级市场以市场价格交易，市场价格通常对比基金净值有折扣(因为提供了额外流动性)。</p><h4 id="交易性开放式指数基金-Exchange-traded-fund">交易性开放式指数基金(Exchange traded fund)</h4><p>ETF往往挂钩指数，融合了开放基金和封闭基金各自的优势，因为其既可以在二级市场以市场价格交易，又可以与基金公司以基金净值交易。</p><h3 id="金融市场分类">金融市场分类</h3><p>金融市场的分类有三个标准：货币(money)市场对资本(capital)市场；传统(traditional)市场对另类(alternative)投资市场；一级(primary)市场对二级(secondary)市场。这其中最重要的是一级市场与二级市场的分类。</p><p><code>货币市场与资本市场</code>：货币市场主要以短期借贷产品为主，以利息为主要收入；资本市场主要以长期投资为主，以资本收益为主要收入。</p><p><code>传统市场与另类投资市场</code>：投资范围为股票、债券、现金的是传统市场；其他的市场例如对冲基金、股权基金、大宗商品、房地产等市场都是另类市场。</p><p><code>一级市场与二级市场</code>：一级市场就是融资市场，主要售卖<code>新发行</code>的证券产品，IPO或股票增发都属于一级市场范畴；二级市场是交易市场。如果交易的目的是融资则是一级市场，否则是二级市场。</p><h4 id="一级市场">一级市场</h4><p>股票的公开发行主要有两种方式：</p><ol><li><code>包销(Underwritten Offering)</code>：包销指投资银行销售公司新股，投行有买下未卖出新股份额的责任，这种情况下投行可能会尽量压低股票发行价，与上市公司存在利益冲突。</li><li><code>代销(Best Efforts)</code>：代销指发行股票并尽量销售更多新股，投行收入按融资金额的比例计算佣金，因此该情况下投行可能会尽量抬高发行价。</li></ol><p>股票发行途中还有一个<code>询价环节(Indications of interest)</code>，通过向潜在投资者询问投资意愿来确定发行价格区间，询价的过程被称为<code>账簿建立(Book buiding)</code>。</p><p>除了公开发售以外，一级市场还有私下发售以及其他交易方式发行股票(<code>前两种较为重要</code>)：</p><ul><li><code>定向增发(Private placement)</code>：已经上市的公司向少数合格的投资者定向发售股票（以折扣价格），通常需要投行协助。</li><li><code>配股认购权(Right Offering)</code>：上市公司给予<code>已经持有公司股票的股东</code>以所持股票数量的比例，以折扣价格购买公司新发股票的权利。如果股东不认购可能由于股权稀释导致损失。</li><li><code>注册发行(Shelf Registration)</code>：主要是债券的注册发行，一次注册后可分多次自行发售。</li><li><code>股利再融资计划(Dividend Reinvestment Plan)</code>：上市公司允许持股股东使用股利以折扣价格购买公司新股。</li></ul><h4 id="二级市场">二级市场</h4><p>二级市场提供两个主要功能，<code>流动性(Liquidity)</code>和<code>价格发现(Price discovery)</code>。前者主要表现为股东提供将股票兑换为其他证券或现金的流动性；后者主要表现为为一级市场的发售价格做价格参考。</p><p>二级市场有两种分类方法：</p><p><code>集合竞价(Call Market)与连续竞价(Continuous Markets)</code>：前者是所有的买单和卖单被在一段时间内收集后，在<code>某个特定时间</code>以能满足最多买单和买单的价格作为成交价；后者是在<code>任何时候</code>买卖双方可以达成交易时发生。</p><p><code>订单驱动型(Order-Driven)</code>市场<code>报价驱动型(Quote-Driven)</code>市场：前者是市场价格由买单或卖单数量驱动的市场，例如A股市场，该类市场撮合交易的原则是价格优先，时间优先；后者又称Dealer Market，每个Dealers通过自己买入或卖出股票为所有投资者提供流动性。</p><p><code>中介市场(Brokered Markets)</code>是指由中介商撮合买卖双方的市场，通常适用于流动性较差的商品，如艺术品、房地产等。</p><h3 id="头寸与杠杆-Positions-and-Leverage">头寸与杠杆(Positions and Leverage)</h3><p>金融市场中有三种<code>头寸(Positions)</code>：<code>多头头寸(Long position)</code>指买入；<code>空头头寸(Short Position)</code>指卖出；<code>融资杠杆(Leveraged Position)</code>指投资者向经纪人借钱投资。</p><h4 id="空头头寸">空头头寸</h4><ul><li>若借入的股票分红，分红属于股票借出方，但做空方在借入股票后已经将股票卖掉，因此该笔分红要由做空方补偿给股票借出方。</li><li>初做空时获得的现金要存在经纪人处，不可以去除，且除此之外做空方还需要支付额外<code>保证金(Margin)</code>避免其违约。</li><li>做空方存在经纪人处的现金和保证金会被用于做短期投资，收益归做空方，被称为<code>做空回扣(Short Rebate Rate)</code>，该笔收益可能不够抵扣经纪人服务费，导致做空回扣为负。</li></ul><h4 id="融资杠杆">融资杠杆</h4><ul><li><code>初始保证金(Initial Margin)</code>指首次杠杆时的自有资金数额；<code>维持保证金(Maintenance Margin)</code>指账户中所需的自由资金数额；<code>保证金催收电话(Margin Call)</code>指当保证金账户中自由资金的数额低于维持保证金后，经纪人会向投资者电话通知其在某个时间点前补交保证金至维持保证金水平，否则将被强制平仓。金融衍生品交易中由于通常杠杆较高，催收电话会要求补交至初始保证金水平。</li><li>按下放公式计算触发保证金催收电话的股票价格：</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>P</mi><mi>L</mi></msub><mo>=</mo><msub><mi>P</mi><mn>0</mn></msub><mo stretchy="false">(</mo><mfrac><mrow><mn>1</mn><mo>−</mo><mi>I</mi><mi>M</mi></mrow><mrow><mn>1</mn><mo>−</mo><mi>M</mi><mi>M</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P_L = P_0(\frac{1-IM}{1-MM})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.1297em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">MM</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">P_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>是买股票时的股价，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">IM</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span>指初始保证金比率(自由资金占比)，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mi>M</mi></mrow><annotation encoding="application/x-tex">MM</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">MM</span></span></span></span>指维持保证金比率(自由资金占比)。</p><h3 id="交易订单-Order-Execution-and-Validity">交易订单(Order Execution and Validity)</h3><h4 id="订单类型">订单类型</h4><p>订单主要分为三种类型：<code>执行指令(Execution instructions)</code>明确订单如何被执行；<code>有效性指令(Validity instructions)</code>明确何时生效；<code>清算指令(Clearing instruction)</code>明确如何清算。</p><h5 id="执行指令">执行指令</h5><ul><li><code>市价指令(Market order)</code>即以当前市场的最优价格买卖证券，执行快但成本不可控；</li><li><code>限价指令(Limited order)</code>即以某个限制的价格买卖股票，成本可控但成交速度慢。</li><li><code>All-or-nothing order</code>即仅有当所有交易都能满足时才可成交，不能部分成交；</li><li><code>隐藏指令(Hidden orders)</code>指只有中介人或交易所能看见交易量的指令，为了避免其他交易者看见大量交易而采取某些行动，其他交易指令在价格相同时以时间排先后，隐藏指令交易时只以价格优先，不看时间；</li><li><code>冰山指令(Iceberg orders)</code>与隐藏指令相似，交易者可以仅使部分交易指令在市场上可见。</li></ul><p>其中在<code>限价指令</code>中，不同的限价也有不同的称呼：</p><ul><li><code>make the market</code>：指以市场上已有的最优单价下单。</li><li><code>make the new market</code>：指以优于当前市场上最优单价的价格下单。</li><li><code>behind the market</code>：指以差于当前市场上最优单价的价格下单。</li><li><code>far from the market</code>：指以远远差于当前市场上的最优单价的价格下单。</li><li><code>take the market/ marketable order</code>：指以市场上可以成交的价格下单。</li></ul><h5 id="有效性指令">有效性指令</h5><ul><li><code>日内指令(Day orders)</code>：指令若未在当日成交，则会失效。</li><li><code>GTC(Good-till-cancelled orders)</code>：订单只有被取消或成交才会失效。</li><li><code>Immediate or cancel orders/ fill or kill orders</code>：只成交立即成交的订单，其他即刻失效，允许部分成交。</li><li><code>good-on-close</code>或<code>good-on-open orders</code>：只在闭市前或开市后的短时间内生效的订单。</li><li><code>止损指令(Stop orders)</code>：分为<code>Stop sell</code>或<code>Stop buy</code>两种类型，前者以卖出的方式止损，后者以买入的方式止损。</li></ul><h2 id="Reading-37-证券指数">Reading 37 证券指数</h2><p>股票指数是“一篮子”满足特定条件的股票，指数可以帮助投资者快速了解某个市场或行业在过去一段时间内的平均表现。股票的编制方法主要有两种：</p><ul><li><code>价格指数(Price index)</code>：价格指数只考虑<code>资本利得(Capital Gain)</code>对股票带来的影响，即只计算股票的价格。</li><li><code>回报指数(Return index)</code>：回报指数除了考虑资本利得以外还考虑股票带来的<code>分红(dividend)</code>的影响。</li></ul><h3 id="股票加权方法-Weighting-schemes-for-stock-indexes">股票加权方法(Weighting schemes for stock indexes)</h3><h4 id="价格加权指数-Price-Weighted-index">价格加权指数(Price-Weighted index)</h4><p>价格加权计算不同时间点的所有股票价格<code>相同股份数</code>的平均数，并以某个基期的指数计算点数增长。这种方法计算的指数数值<code>易受高价股影响</code>，且<code>股票有分红或分叉时需要调整分母</code>。两个著名的价格加权指数是<code>道琼斯指数(Dow Jones Industrial Average)</code>和<code>日经指数(Nikkei Dow Jones Stock Average)</code>。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mo>−</mo><mi>w</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mo>=</mo><mfrac><mrow><mi>S</mi><mi>u</mi><mi>m</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mtext> </mtext><mi>p</mi><mi>r</mi><mi>i</mi><mi>c</mi><mi>e</mi><mi>s</mi></mrow><mrow><mi>N</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>s</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext> </mtext><mi>a</mi><mi>d</mi><mi>j</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>d</mi><mtext> </mtext><mi>f</mi><mi>o</mi><mi>r</mi><mtext> </mtext><mi>s</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>s</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Price-weighted\ index= \frac{Sum\ of\ stock\ prices}{Number\ of\ stocks\ in\ index\ adjusted\ for\ splits}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mord mathnormal">u</span><span class="mord mathnormal">mb</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">s</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace"> </span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">u</span><span class="mord mathnormal">m</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mspace"> </span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ces</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><h4 id="等权指数-Equal-Weighted-Index">等权指数(Equal-Weighted Index)</h4><p>等权指数将<code>所有股票的收益以相同的权重计算指数</code>，即每只股票购买的金额相等并以此来<code>消除价格加权指数易受高价股影响的弊端</code>。但该指数依旧易受小盘股影响(小市值股票的波动性会大于大盘股但该方法中小盘股与大盘股权重相同)。</p><h4 id="按市值加权指数-Market-Capitalization-Weighted-Index">按市值加权指数(Market Capitalization-Weighted Index)</h4><p>按市值加权指数将股票价格按股票市值加权平均。该方法可以<code>移除等权指数易受小盘股影响的缺点</code>但同时又<code>易受大盘股影响</code>。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>C</mi><mi>u</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext> </mtext><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mo>=</mo><mfrac><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi><mi>e</mi><mi>n</mi><mi>t</mi><mtext> </mtext><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>m</mi><mi>a</mi><mi>r</mi><mi>k</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext> </mtext><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>s</mi></mrow><mrow><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mtext> </mtext><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mtext> </mtext><mi>t</mi><mi>o</mi><mi>t</mi><mi>a</mi><mi>l</mi><mtext> </mtext><mi>m</mi><mi>a</mi><mi>r</mi><mi>k</mi><mi>e</mi><mi>t</mi><mtext> </mtext><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi><mtext> </mtext><mi>o</mi><mi>f</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext> </mtext><mi>s</mi><mi>t</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>s</mi></mrow></mfrac><mo>×</mo><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mtext> </mtext><mi>y</mi><mi>e</mi><mi>a</mi><mi>r</mi><mtext> </mtext><mi>i</mi><mi>n</mi><mi>d</mi><mi>e</mi><mi>x</mi><mtext> </mtext><mi>v</mi><mi>a</mi><mi>l</mi><mi>u</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Current\ index\ value=\frac{current\ total\ market\ value\ of\ index\ stocks}{base\ year\ total\ market\ value\ of\ index\ stocks}\times base\ year\ index\ value</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">u</span><span class="mord mathnormal">rre</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2519em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">ba</span><span class="mord mathnormal">se</span><span class="mspace"> </span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace"> </span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">s</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">rre</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord mathnormal">t</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace"> </span><span class="mord mathnormal">ma</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">t</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span><span class="mspace"> </span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace"> </span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">oc</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">ba</span><span class="mord mathnormal">se</span><span class="mspace"> </span><span class="mord mathnormal">ye</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace"> </span><span class="mord mathnormal">in</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">x</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">u</span><span class="mord mathnormal">e</span></span></span></span></span></p><h4 id="经浮动调整后的按市值加权指数-A-Float-Adjusted-Market-Capitalization-Weighted-Index">经浮动调整后的按市值加权指数(A Float-Adjusted Market Capitalization-Weighted Index)</h4><p>经浮动调整后的按市值加权指数是在按市值加权指数的基础上<code>不计算非流通股的市值</code>的权重。</p><h4 id="基本面加权指数-Fundamental-weighting">基本面加权指数(Fundamental weighting)</h4><p>顾名思义该指数以股票的基本面(收入、分红、净资产、P/E值等)为权重计算股票的加权平均数。可以<code>剔除易受大盘股影响的缺点</code>，但同时<code>易受价值型股票影响</code>。</p><h3 id="指数权重和构成调整-Rebalancing-and-Reconstruction">指数权重和构成调整(Rebalancing and Reconstruction)</h3><h4 id="调权重-Rebalancing">调权重(Rebalancing)</h4><p>假设指数使用<code>等权方法</code>计算，指数组合中的各股票金额相同，因此当股票价格变化时需要调整其权重以重新使其权重相同，通常每个固定时间段后会调整一次权重(通常是一个季度)。即为迎合指数加权方法调整权重至其目标权重的过程称为<code>Rebalancing</code>。</p><h4 id="调构成-Reconstitution">调构成(Reconstitution)</h4><p>调构成的目的是为了满足指数的<code>构成标准(Index criteria)</code>。例如道琼斯指数为反映美国民生的股票组合，其曾经因为通用汽车和花旗银行的股票市值骤降而将其移出指数。<code>按市值加权方法</code>计算的指数受到调构成的影响最大。</p><h3 id="指数的作用">指数的作用</h3><p>指数的计算有以下用法：</p><ul><li>反映投资者对市场的信心</li><li>基金经理的业绩表现的标准</li><li>衡量整个市场的收益和风险</li><li>计算beta和risk-adjusted return</li><li>构建指数基金</li></ul><h3 id="指数的类型">指数的类型</h3><h4 id="股票指数">股票指数</h4><p><code>全市场指数(Broad Market index)</code>：全市场指数是通常包括全市场超过90%价值的股票，如上证综指，用于衡量权市场的整体表现。</p><p><code>跨市场指数(Multi-market index)</code>：以不同国家的市场指数构建指数。</p><p><code>行业指数(Sector index)</code>：行业指数通常包含该行业主要股票，用于反映行业表现并可用于基金经理的业绩归因。</p><p><code>风格指数(Style index)</code>：通过市值(大盘股或小盘股)或类型(价值型或成长型)归类构建指数。</p><h4 id="固收指数">固收指数</h4><p>固收指数与股票指数的主要区别在于：</p><ol><li>债券指数的数量与体量通常都比股票更大，且其不仅由公司发行，还有政府与政府代理也会发行。</li><li>债券指数的<code>变动率(Turnover)</code>通常较大，因为债券到期后就会被替换，而股票只有被重构时才会被替换。</li><li>债券指数是交易商市场，且交易量与股票相比较小，因此复制债券指数的收益难度较高。</li></ol><h4 id="大宗商品指数-Commodity-indexes">大宗商品指数(Commodity indexes)</h4><p>大宗商品指数通常由大宗商品的<code>期货(Future)</code>价格影响，因为大宗商品的报价季节性较高。</p><h2 id="Reading-38-市场有效性">Reading 38 市场有效性</h2><p>一个<code>信息有效的资本市场</code>是指股票的当前市场价格已经全面、迅速、且理性地反映了市场上所有的已有信息。有效的资本市场上的证券价格会根据新信息快速调整，已被完全预测的信息出现不会影响股票价格。<code>市场价值(Market value)</code>是资产当前的价格，<code>内在价值(Intrinsic value)</code>是一个掌握所有信息的理性投资者愿意为购买该资本付出的价格。在完全有效市场中我们认为资产的市场价值是趋向于其内在价值的，市场有效性越高，信息反映在价格上的速度越快。</p><h3 id="影响市场有效性的因素">影响市场有效性的因素</h3><ul><li>市场参与者的人数：市场参与人数越多，市场的有效性越高。</li><li>信息可得性：市场上信息可得性越高，市场的有效性越高。</li><li>交易限制：市场对交易的限制越少，市场的有效性越高。</li><li>交易与信息成本：信息、分析、以及交易的成本越低，市场的有效性越高。</li></ul><h3 id="三大有效市场">三大有效市场</h3><p>由于现实情况中很难出现完全有效市场，我们将市场按有效分为三类：</p><p><code>弱有效市场(Weak-Form Efficiency)</code>：如果市场的资产价格反映所有<code>市场信息(Market information)</code>如价格、成交量等，该市场满足弱式有效，此时技术分析(价量分析)不能获得超额收益。</p><p><code>半强有效市场(Semi-Strong Efficiency)</code>：如果市场的资产价格反映所有<code>公开信息(Public Information)</code>，即同时反映价量信息与基本面信息，该市场满足半强有效性，此时基本面分析和技术分析都不能获得超额收益。</p><p><code>弱有效市场(Strong-Form Efficiency)</code>：如果市场的资产价格反映所有公开和<code>内幕信息(Private information)</code>，该市场则是强式有效，此时内幕信息都不能获得超额收益，此时投资策略是被动(Passive)投资，以获得市场收益。</p><h3 id="市场异常-Market-Anomalies">市场异常(Market Anomalies)</h3><p>CFA协会对市场异常理论的态度是不支持，认为其以偶然做必然。常见的市场异常有五个：</p><ol><li><code>日历效应(Calendar anomalies)</code>：又称一月效应，即有研究者发现美国股市每年十二月份会出现股票大幅下跌，同时一月份会出现股票大幅上升，可能的解释有<code>避税(Tax-loss selling)</code>，基金经理在年底将浮亏股票通过卖出将其变为实际亏损以避税，而在来年一月重新买回股票，造成一月效益；<code>窗口效应(Window dressing)</code>则是由于基金经理希望在年终财报中避免报出高风险小盘股，因此会在十二月卖出然后再在第二年一月买入。</li><li><code>过度反应(Overreaction effect)</code>：指由于市场投资者对某些利空信息过度反应，导致其股票价格下跌到低于其内在价值，这时可能反而是入场时机。</li><li><code>动量效应(Momentum anomalies)</code>：如果某只股票涨势较好，那么很大可能他在之后的一段时间内也会继续上涨。</li><li><code>小市值效应(Size effect)</code>：小盘股的回报率通常高于市场回报率。</li><li><code>价值效应(Value effect)</code>：价值型公司回报率通常高于成长型公司。</li></ol><h3 id="行为金融学-Behavior-Finance">行为金融学(Behavior Finance)</h3><p>传统金融认为所有投资者都是完全理性，而行为金融学则认为投资者认知都有限制。一些著名的偏差包括：</p><ol><li><code>代表性偏差(Representativeness)</code>：投资者倾向于认为好的公司或市场就是好的投资。</li><li><code>心理账户(Mental accounting)</code>：投资者对不同的投资有不同的心理账户，例如对待同样的十万元钱，辛苦赚来的钱与彩票中奖的钱花法完全不同。</li><li><code>框架依赖(Narrow framing)</code>：同一件事的不同表达方式给人的感觉可能完全不同。</li><li><code>保守性(Conservatism)</code>：投资者对改变的反应较慢，倾向于维持原有观点。</li><li><code>损失憎恶(Risk aversion)</code>：相对于收获来说，人们更讨厌损失，同等数额的收获与损失给人感觉上的比重不同。</li><li><code>过度自信(Overconfidence)</code>：人们倾向于高估自己的能力。</li><li><code>羊群效应(Herding effect)</code>：聚群交易不一定是由于信息导致的，可能是羊群效应。</li><li><code>信息衰退(Information Cascades)</code>：第一个选择影响后面的所有选择。</li></ol><h1>Session 13</h1><h2 id="Reading-39-股票证券总览">Reading 39 股票证券总览</h2><h3 id="上市公司股权">上市公司股权</h3><ul><li><code>普通股(Common shares)</code>：普通股是最常见的股票类型，拥有投票权，公司破产清算时偿债权排在债权人和优先股股东后。股东行使投票权时有两种投票系统，其中<code>法定投票系统(Statutory voting system)</code>是一股一票；而<code>累积投票(Cumulative voting)</code>是每股可以为多个候选人投一票，该方法更可以保护中小股东利益。</li><li><code>可赎回普通股(Callable common shares)</code>：当股票价格上涨到一定数额时，股票发行公司有权购回股票，投资者获得固定金额。此类股票对发行公司有利，对投资者风险较高。</li><li><code>可回售普通股(Putable common shares)</code>：当股票价格下跌到一定数额时，投资者可以选择将股票以固定金额回售给公司。此类股票对投资者风险小，因此对公司来说可以更快完成股票认购，加速融资。</li><li><code>优先股(Preference shares)</code>：优先股同时拥有普通股和债权的优点，即不会到期，且会获得固定股利，但通常没有投票权。</li><li><code>累计优先股(Cumulative preference shares)</code>：累计优先股在无法付出股利的情况下，盈利后需要补回此前年度未付的优先股利。</li><li><code>参与优先股(Participating preference shares)</code>：参与优先股可以在公司获得额外利润时可以获得额外股利。</li><li><code>可转换优先股(Convertible preference shares)</code>：可转换优先股可以转换为普通股。</li></ul><h3 id="非上市公司股权-Private-Equity-Securities">非上市公司股权(Private Equity Securities)</h3><p>非上市公司股权(私募股权)相较上市公司股权有以下特点：</p><ol><li>流动性较上市公司股权更低。</li><li>非上市公司股价估值是投资者与公司协商得出，非市场价格。</li><li>因为没有监管规定或交易所要求，所以非上市公司不需要披露公司财务状况。</li><li>因为没有披露要求，因此报告成本较低。</li><li>非上市公司通常公司治理较差。</li><li>投资非上市公司通常关注长期表现。</li><li>投资非上市公司的潜在回报率会更高。</li></ol><p>非上市公司的两种主要股权投资方法是：</p><ul><li><code>风险投资(Venture capital)</code>：风险投资的目标公司通常较为早期，获取收益的风险很大，通常投资多个公司 只有少数能够获得回报，但回报率会非常高。</li><li><code>杠杆收购(Leveraged buyout)</code>：投资者以贷款杠杆买下公司的所有股权，通常发生在公司发展的中后期，以杠杆的形式放大回报率。</li></ul><h3 id="海外投资-Non-domestic-Equity-Securities">海外投资(Non-domestic Equity Securities)</h3><p>参与海外投资的方法有几种：</p><ul><li><p><code>直接投资(Direct investing)</code>：直接从海外市场购买海外公司股票，但该方法限制较多。</p></li><li><p><code>全球注册融资(Global registered shares)</code>：购买在全球多地上市的公司的股票。</p></li><li><p><code>存托凭证(Depository receipts)</code>：当公司需要在海外融资时，他们可以去海外寻找存托银行，发行存托凭证，此时美国投资者可以以美元购买存托凭证，拥有该凭证相当于购买了该公司股票，存托凭证多数以美元计价。当股票价格与存托凭证价格存在差异时，<code>有套利机会</code>。</p><p>存托凭证<code>按地域划分</code>有美国的ADR，中国的CDR，伦敦交易所发行的GDR。按<code>资助形式划分</code>可以分为Sponsored DR和Unsponsored DR，两者主要区别在于前者由公司发起融资，股票的投票权属于投资者；后者由存托银行发起，投票权属于存托银行。按<code>等级划分</code>可以分为一至三级，第三级存托凭证为公开交易的，前两级CFA一级不涉及。</p><p>通过存托凭证投资海外股票时存在汇率风险，但没有太大流动性风险。</p></li></ul><h2 id="Reading-40-行业与公司分析">Reading 40 行业与公司分析</h2><p>通常行业分析都是<code>自上而下分析法(Top-Down approach)</code>的一步，通常分析步骤是1. 根据宏观经济找到受益于宏观经济发展的行业大类资产配置；2. 从看好的大类资产或行业中再进一步分析较好的公司进行投资。</p><h3 id="行业分类">行业分类</h3><ul><li><code>Peer Group</code>：根据公司的产品和服务类型分类</li><li>根据与经济周期的影响分类。<code>汽车</code>等受经济周期影响较大的公司叫做<code>周期性公司(Cyclical firm)</code>，该类公司盈利波动大，经营性杠杆较高。<code>非周期性公司(Non-cyclical firm)</code>中则有<code>防御性行业(Defensive industries)</code>和<code>成长性行业(Growth industries)</code>，前者如医药、食品等受经济周期影响小的行业，后期如早年的互联网企业等不受经济周期影响长期成长的行业。</li><li>根据统计学方法如<code>聚类分析</code>等分类。</li><li>商业与政府分类。由各证券公司分类的公司就是商业分类，只针对上市公司，且分类以利润为目的；由证监会分类的公司就是政府分类，针对上市和非上市公司，分类有盈利和非盈利。</li><li>根据行业生命周期分类。一个行业的生命周期中有五个阶段，分别是Embryonic stage(新兴行业增速慢，产品价格高，需要大量投资，失败风险高)、Growth stage(快速成长期成长速度快，竞争不大，价格下降，盈利能力增加)、Shakeout stage(增速下降，竞争激烈，行业产能过剩，盈利能力下降，失败风险上升)、Mature stage(成熟期增速缓慢，形成寡头垄断，产品价格稳定，领先公司获得高于行业的成长)、Decline stage(衰退期增速为负，产品定价下降，失败企业退出市场或被收购)。</li></ul><h3 id="行业分析方法">行业分析方法</h3><h4 id="麦克波特五力模型-Michael-Porter-delineates-five-forces">麦克波特五力模型(Michael Porter delineates five forces)</h4><ol><li>行业内部竞争压力</li><li>行业面对新进入者的压力</li><li>行业面对替代产品的压力</li><li>行业面对下游购买者的竞价压力</li><li>行业面对上游供应商的竞价压力</li></ol><h4 id="定价能力-Pricing-power">定价能力(Pricing power)</h4><ol><li><code>进入壁垒(Barriers to entry)</code>：进入壁垒低时定价能力低；进入壁垒高时不一定意味着定价能力高(有些产业如钢铁企业退出壁垒也高)；退出壁垒低时可能导致高定价能力。</li><li><code>行业集中度(Industry concentration)</code>：行业集中度高时公司定价能力通常较高，但也不能保证。</li><li><code>产能(Industry capacity)</code>：行业产能不足时定价能力较高，资本回报率较高；行业产能过剩时定价能力较低，资本回报率较低。</li><li><code>市场份额稳定性(Market share stability)</code>：更稳定的市场份额可能说明行业竞争性较低，可能说明定价能力较高。</li></ol><h4 id="外部影响">外部影响</h4><p>除了行业内部原因外，还有一些外部的影响行业成长、盈利能力和风险的因素：</p><ul><li><code>宏观经济指标(Macroeconomic factors)</code>，例如GDP增长率等。</li><li><code>科技(Technology)</code>，科技是劳动效率的乘数。</li><li><code>人口(Demographics)</code>，人口越高总产出越高。</li><li><code>政府(Governments)</code>，政府政策也会影响经济。</li><li><code>社会文化(Social influence)</code>,例如日本女性大多会成为全职太太，导致社会劳动参与率不高，从而影响经济增长。</li></ul><h3 id="公司分析">公司分析</h3><p>公司竞争策略分为三种类型：</p><ol><li><code>成本领先(Cost leadership)</code>：以更低的成本产出性价比更高的产品。</li><li><code>差异化(Differentiation)</code>：以同样的成本生产其他公司没有提供的产品优势。</li><li><code>专注(Focus)</code>：专注某个领域产品。</li></ol><h2 id="Reading-41-股票定量分析">Reading 41 股票定量分析</h2><p>股票的定量分析就是为股票估值，估值是估算其<code>内在价值(Intrinsic value)</code>。若内在价值大于其市场价格，则说明股票被低估，反之亦然。</p><h3 id="绝对估值法">绝对估值法</h3><p><code>未来现金流折现法(Discounted Cash Flow Models)</code>是将公司股票现金流折现后的数值，可以直接作为对比使用，因此属于绝对估值法。</p><h4 id="股利支付时间表-美股">股利支付时间表(美股)</h4><p>以时间先后排序，股利支付有四个重要日期：<code>宣告日(Declaration date)</code>、<code>除息日(Ex-dividend date)</code>、<code>登记日(Holder-of-record date)</code>、<code>发放日(Payment date)</code>。<code>宣告日</code>是公司宣布发放股利的日期，<code>除息日</code>是当天股票价格被调整为减去分红数额，两个工作日后的<code>登记日</code>时所有登记在册的股东都会在<code>发放日</code>获得股利。</p><p>需要特别注意的几点是：1. 通过购买股票获得股利的最后一天是除息日的前一天，在除息日当日购买的股票价格已经被除去了股利。2. 美国市场确认登记需要三个工作日，也即买卖股票后实际转移在三天后发生，这也是登记日在除息日两个工作日后的原因。</p><h4 id="股利折现模型-2">股利折现模型</h4><p>模型假设<code>公司永续经营</code>，这时卖出股票的价格被折现无穷多年，可以忽略不计，因此直接将未来无穷股利折现计算即是股票内在价值的估计，此处股利假设<code>每年以g的速度永续增长</code>，g为可持续增长率，数值为<code>ROE(NI/Equity)</code>乘留存率b。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mi>o</mi><mi>l</mi><mi>d</mi><mi>e</mi><mi>n</mi><mtext> </mtext><mi>g</mi><mi>r</mi><mi>o</mi><mi>s</mi><mi>s</mi><mtext> </mtext><mi>m</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi><mo>:</mo><mtext> </mtext><msub><mi>V</mi><mn>0</mn></msub><mo>=</mo><mfrac><msub><mi>D</mi><mn>1</mn></msub><mrow><mi>r</mi><mo>−</mo><mi>g</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">Golden\ gross\ model:\ V_0=\frac{D_1}{r-g}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">G</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mspace"> </span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">ross</span><span class="mspace"> </span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">:</span><span class="mspace"> </span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.2222em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2408em;vertical-align:-0.8804em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3603em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>此处<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span>为股东要求回报率，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span></span></span></span>为可持续增长率。</p><p>该模型的缺点有三个：</p><ol><li>公式计算结果对<code>要求回报率r</code>和可持续增长率g的估值要求十分严格，对其变动非常敏感。</li><li>无股利股票难以以此模型估值，但可以使用<code>股东自由现金ECFE</code>流代替股利计算，使用该值计算出的股票价值是该模型可以计算的最乐观价值。</li><li>公司增长速度不可预测的公司也难以以此模型估值，但依然可以使用<code>多阶段GGM(multi-stage model)</code>计算。</li></ol><h4 id="多阶段GGM">多阶段GGM</h4><p>若公司有多个增长阶段，即不同阶段增长率g不同，则使用GGM模型先算出最后一个阶段在该阶段开始时的价值，然后将所有前面的价值依次折现至现时。</p><h3 id="相对估值法">相对估值法</h3><p><code>倍数法(Multiplier Models)</code>是对比两间公司估值的方法，简单来说就是用股票价格与一些指标的倍数来对比两个价格的内涵价值高低。主要的对比方式有时间序列法(即与历史对比，一般用于指数估值)和横截面方法(即与同行业其他公司对比)。</p><h4 id="P-E-市盈率Price-Earning-Ratio">P/E(市盈率Price Earning Ratio)</h4><p>市盈率的计算方法是股票价格除以每股净收益，即每份净收益的标价，该标价越低说明该股票越被低估。但市盈率指标忽略了公司的增长率，而增长率会使市盈率逐年快速减少。</p><h4 id="其他指标">其他指标</h4><p>如果公司没有盈利，使用相对估值法就不可以使用市盈率对比，而可以转而使用<code>市销率(Price to Sales)</code>，或者连销售额都没有时可以使用每单位公司价值(公司净值、现金流、点击率等)的股价来作为对比指标。</p><p>另外需要掌握的一个指标是<code>EV/EBITDA</code>。其中EV指<code>公司价值(Enterprise value)</code>，即<code>股票的市场价值+债务的市场价值-现金</code>；EBITDA指<code>息税折旧及摊销前利润</code>，通常题目中会给定。使用该指标的主要原因是：1. 适用于财务杠杆水平不同的公司比较；2. 适用于对比资产密集型公司(没有计算折旧摊销)；3.  该指标通常为正值；4. 税率不同也能对比。该指标有一个缺点是债务的市场价格通常难以获得。</p><h3 id="基于资产的估值模型">基于资产的估值模型</h3><p>将公司的所有资产的公允价值减去其负债的公允价值即可得到公司股权的公允价值，也即得到公司股票的内在价值估值。当公司有大量无形资产/国家处于恶性通货膨胀时(资产的公允价值难以判定)，不适合使用该方法估值。该方法估值方法比较保守，适用于非上市公司的估值。</p><p>[第23篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E9%87%91%E8%9E%8D%E5%88%86%E6%9E%90/">金融分析</category>
      
      
      <category domain="http://raylei.space/tags/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0/">日常学习</category>
      
      <category domain="http://raylei.space/tags/CFA%E4%B8%80%E7%BA%A7/">CFA一级</category>
      
      <category domain="http://raylei.space/tags/%E8%82%A1%E6%9D%83%E6%8A%95%E8%B5%84/">股权投资</category>
      
      
      <comments>http://raylei.space/2022/08/29/23-CFA-level1-equity-investment/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>[编程算法]自动报价机器人的GUI开发记录</title>
      <link>http://raylei.space/2022/08/23/22-Automated_Website_Logging_Robot_GUI/</link>
      <guid>http://raylei.space/2022/08/23/22-Automated_Website_Logging_Robot_GUI/</guid>
      <pubDate>Tue, 23 Aug 2022 14:05:16 GMT</pubDate>
      
      <description>[第22篇]本篇记录了22篇中的报价机器人的GUI设计以及一些功能的实现方法。</description>
      
      
      
      <content:encoded><![CDATA[<h1>序言</h1><p>这一篇文章与第4篇和第21篇其实是同一个项目，就是将公司的一些填写网页的机械重复劳动使用Python将其自动化，从而达到减少人工成本，增加公司报价效率的结果。这一篇之所以与前两篇分开是因为本篇主要记录的是这个报价工具的用户界面逻辑，虽然是同一个项目但在逻辑上与前两篇是分开的。这篇中主要会涵盖我使用Python内置的<code>tkinter包</code>给这个小程序做的GUI界面，并记录如何将各个功能实现或链接。</p><h1>正文</h1><h2 id="界面设计">界面设计</h2><p>首先要明确软件本身就是为了加速用户处理报价的速度，而实际业务的输入都可以在Excel模板中调整规范，因此我们的软件界面本身可以尽可能的简介易用，我最终的第一版界面就如下图所示：</p><p><img src="https://cdn.jsdelivr.net/gh/0Rayhlei0/Pics@latest/post_img/image-20220830204919666.png" alt="软件界面"></p><p>最上方两个<code>输入框(Entry)</code>用来收集登录网站要用的用户名和密码；一个开始<code>按钮(Button)</code>简洁易懂；往下第二层是选择报价的险种的<code>单选按钮(Radio Button)</code>，根据这个按钮的选项程序会切换不同报价的业务逻辑，第一版还只有私家车险的自动报价；再往下是一个巨大的<code>文本框(Text)</code>，程序在这里向用户展示必要的反馈信息；最后是展示报价进度的<code>进度条(Process Bar)</code>和<code>标签(Label)</code>。</p><p>简单来讲用户在输入必要信息后点击开始按钮，程序就会开始运行并反馈信息直到整个报价过程完成。</p><h2 id="程序结构">程序结构</h2><p>整个程序一共包括三个<code>py文件</code>，分别负责私家车险报价功能实现，主程序界面，和一个图标文件。</p><ul><li>报价功能文件中主要是程序从检查Excel文件到最后获取报价单号的全流程公式集，每个公式获取一个行号并以此操作Excel文件中相应行数的数据；以后如果增加不同险种的报价逻辑，只需要再增加相应的<code>py文件</code>即可。</li><li>在读取数据的主程序界面文件中包括一个主界面的类，其中定义了程序界面的控件和对应函数，同时以POP的方法定义了按键后程序的运行；</li><li>最后的图标文件是为了将图标的图片一并打包到最后的exe文件中而将<code>ico文件</code>转码为<code>py文件</code>，运行程序时再自动解码为<code>ico文件</code>的而存在的，本篇也会讲解如何转码解码。</li></ul><h2 id="程序主界面">程序主界面</h2><p>首先是以OOP方法定义的主界面，实现上方界面的代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> tkinter</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tkinter <span class="keyword">import</span> ttk</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Qnect_Quoter</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># the main window</span></span><br><span class="line">        self.root = tkinter.Tk()</span><br><span class="line">        <span class="comment"># Title of the tool</span></span><br><span class="line">        self.root.title(<span class="string">&quot;Qnect Quoter&quot;</span>)</span><br><span class="line">        <span class="comment"># add ico from the icon.py file and delete the file after</span></span><br><span class="line">        picture = <span class="built_in">open</span>(<span class="string">&quot;picture.ico&quot;</span>, <span class="string">&quot;wb+&quot;</span>)</span><br><span class="line">        picture.write(base64.b64decode(img))</span><br><span class="line">        picture.close()</span><br><span class="line">        self.root.iconbitmap(<span class="string">&quot;picture.ico&quot;</span>)</span><br><span class="line">        os.remove(<span class="string">&quot;picture.ico&quot;</span>)</span><br><span class="line">        <span class="comment"># mainwindow size</span></span><br><span class="line">        self.root.geometry(<span class="string">&quot;725x605&quot;</span>)</span><br><span class="line">        self.root.resizable(<span class="literal">False</span>, <span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Main Page frame</span></span><br><span class="line">        self.input_frame = ttk.Frame(self.root)</span><br><span class="line">        self.selection_frame = ttk.LabelFrame(self.root, text=<span class="string">&quot;Quoting Cover&quot;</span>)</span><br><span class="line">        self.textbox_frame = ttk.Frame(self.root)</span><br><span class="line">        self.pb_frame = ttk.Frame(self.root)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create input cells for Qnect acount and passwords</span></span><br><span class="line">        self.account_label = ttk.Label(self.input_frame, text=<span class="string">&quot;Qnect Account: &quot;</span>)</span><br><span class="line">        self.account_input = ttk.Entry(self.input_frame, width=<span class="number">20</span>)</span><br><span class="line">        self.password_label = ttk.Label(self.input_frame, text=<span class="string">&quot;Password: &quot;</span>)</span><br><span class="line">        self.password_input = ttk.Entry(self.input_frame, width=<span class="number">20</span>)</span><br><span class="line">        <span class="comment"># The button to start quoting</span></span><br><span class="line">        self.start_button = tkinter.Button(self.input_frame, command=self.start_quote, text=<span class="string">&quot;Start Quoting&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create radio buttons for selection of quoting coverages</span></span><br><span class="line">        self.alignment_var = StringVar()</span><br><span class="line">        self.alignments = [<span class="string">&quot;Private Car&quot;</span>]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Display textbox and scrollbar for information</span></span><br><span class="line">        self.info_text = tkinter.Text(self.textbox_frame, width=<span class="number">85</span>, height=<span class="number">28</span>)</span><br><span class="line">        self.scrollbar = ttk.Scrollbar(self.textbox_frame, orient=<span class="string">&quot;vertical&quot;</span>, command=self.info_text.yview)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add a process bar to the window</span></span><br><span class="line">        self.pb = ttk.Progressbar(self.pb_frame, orient=<span class="string">&quot;horizontal&quot;</span>, mode=<span class="string">&quot;determinate&quot;</span>, length=<span class="number">700</span>)</span><br><span class="line">        self.pb_label = ttk.Label(self.pb_frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gui_arrang</span>(<span class="params">self</span>):</span><br><span class="line">        self.input_frame.grid(padx=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.selection_frame.grid(padx=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.textbox_frame.grid(padx=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.pb_frame.grid(padx=<span class="number">10</span>, pady=<span class="number">10</span>, sticky=EW)</span><br><span class="line">        self.account_label.grid(row=<span class="number">0</span>, column=<span class="number">0</span>, padx=<span class="number">5</span>, pady=<span class="number">10</span>, sticky=W)</span><br><span class="line">        self.account_input.grid(row=<span class="number">0</span>, column=<span class="number">1</span>, padx=<span class="number">5</span>, sticky=W)</span><br><span class="line">        self.password_label.grid(row=<span class="number">0</span>, column=<span class="number">2</span>, padx=<span class="number">5</span>, sticky=W)</span><br><span class="line">        self.password_input.grid(row=<span class="number">0</span>, column=<span class="number">3</span>, padx=<span class="number">5</span>, sticky=W)</span><br><span class="line">        self.start_button.grid(row=<span class="number">0</span>, column=<span class="number">4</span>, padx=<span class="number">30</span>, sticky=E)</span><br><span class="line">        radio_column = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> alignment <span class="keyword">in</span> self.alignments:</span><br><span class="line">            radio = ttk.Radiobutton(self.selection_frame, text=alignment, value=alignment, variable=self.alignment_var)</span><br><span class="line">            radio.grid(column=radio_column, row=<span class="number">0</span>, ipadx=<span class="number">10</span>, ipady=<span class="number">10</span>)</span><br><span class="line">            radio_column += <span class="number">1</span></span><br><span class="line">        self.info_text.grid(row=<span class="number">1</span>, column=<span class="number">0</span>)</span><br><span class="line">        self.scrollbar.grid(row=<span class="number">1</span>, column=<span class="number">1</span>, sticky=NS)</span><br><span class="line">        self.info_text[<span class="string">&quot;yscrollcommand&quot;</span>] = self.scrollbar.<span class="built_in">set</span></span><br><span class="line">        self.pb.grid(row=<span class="number">0</span>, sticky=EW)</span><br><span class="line">        self.pb_label.grid(row=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_quote</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">global</span> completed, listening</span><br><span class="line">        login_thread = threading.Thread(target=LoginValidate)</span><br><span class="line">        login_thread.start()</span><br><span class="line">        completed = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># make sure there is only one Waiting_for_login() loop going on, otherwise will create several loops each click.</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> listening:</span><br><span class="line">            Waiting_for_login()</span><br><span class="line">            listening = <span class="literal">True</span></span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">global</span> main_window</span><br><span class="line">    main_window = Qnect_Quoter()</span><br><span class="line">    main_window.gui_arrang()</span><br><span class="line">    logging.basicConfig(filename=<span class="string">&quot;Run.log&quot;</span>, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s %(message)s&#x27;</span>, filemode=<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">    logger = logging.getLogger()</span><br><span class="line">    logger.setLevel(logging.ERROR)</span><br><span class="line">    tkinter.mainloop()</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>上面代码中值得注意的主要有几点，<code>Tkinter</code>各控件的详细使用方法与示例参考<a href="https://www.pythontutorial.net/tkinter/" title="Python Tutorial Tkinter">这个网站</a>：</p><ol><li>导入<code>tkinter包</code>时的<code>tk</code>使用的是1991年引入的经典控件，而使用<code>tkinter</code>中的<code>ttk module</code>创建的控件则是2007年新的控件风格。另外<code>from tkinter import *</code>语句的意义是为了导入<code>tkinter包</code>中表示方位的字符&quot;E&quot;“EW”&quot;N&quot;等，这些字符可以在<code>grid方法</code>中表示控件偏向某个方向，或向哪个方向延申。</li><li><code>__init__</code>中定义各个控件的初始化信息，以及主程序窗口的设置参数，从上至下初始化输入框，选择框，信息框，以及进度条框四个<code>框架(Frame)</code>。</li><li><code>gui_arrang(self)</code>函数中使用<code>grid函数</code>将不同控件与框架在主窗口中分别排列，这个方法比<code>pack方法</code>自由度更高，比<code>place方法</code>需要的成本更低，排版更漂亮。</li><li><code>self.start_button</code>按钮绑定的程序是<code>start_quote(self)</code>，而该程序会在运行后开始一个新的线程并在主程序的循环外同步运行<code>LoginValidate</code>，这个函数会验证并通过报价模块的函数获取其从Excel文件中提取的<code>pandas数据框对象</code>与打开的<code>webdriver对象</code>。与此同时程序会开始一个等待<code>LoginValidate</code>函数完成的监听过程<code>Waiting_for_login</code>，该监听过程会在判断前一个线程的目标完成后开启新线程运行相应的报价程序。</li><li>在<code>main()函数</code>中，实例化一个主界面，并使其进入<code>mainloop()</code>，同时在loop之前加入一个记录报错信息的<code>logger</code>。这个logger会记录运行中的错误信息与时间并写入log文件中以便debug。</li></ol><h2 id="链接功能模块">链接功能模块</h2><p>接上节内容，<code>main.py文件</code>中除了主界面的元素等内容外，还有几个函数，用来调用协调主界面元素与实际报价的功能模块。我就按顺序首先讲讲<code>start_quote(self)</code>中新线程运行的<code>LoginValidate()</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">LoginValidate</span>():</span><br><span class="line">    <span class="comment"># initiate the process bar</span></span><br><span class="line">    main_window.pb[<span class="string">&quot;value&quot;</span>] = <span class="number">0</span></span><br><span class="line">    main_window.pb_label[<span class="string">&quot;text&quot;</span>] = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">global</span> completed</span><br><span class="line">    <span class="comment"># get the inputs from the UI</span></span><br><span class="line">    username = <span class="built_in">str</span>(main_window.account_input.get())</span><br><span class="line">    password = <span class="built_in">str</span>(main_window.password_input.get())</span><br><span class="line">    covername = <span class="built_in">str</span>(main_window.alignment_var.get())</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>([<span class="keyword">not</span> username, <span class="keyword">not</span> password, <span class="keyword">not</span> covername]):</span><br><span class="line">        update_info_text(<span class="string">&quot;Please input QNECT username, password and select a cover you wish to quote.\n&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">global</span> data_record, driver</span><br><span class="line">    <span class="comment"># validating the input file</span></span><br><span class="line">    update_info_text(<span class="string">&quot;Loading File...\n&quot;</span>)</span><br><span class="line">    load_file = PrivateCarQuoting.load_data(Filename)</span><br><span class="line">    <span class="keyword">if</span> load_file[<span class="number">0</span>] != <span class="number">0</span>:</span><br><span class="line">        update_info_text(load_file[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        update_info_text(<span class="string">&quot;File loaded!\n&quot;</span>)</span><br><span class="line">        data_record = load_file[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Login to Qnect</span></span><br><span class="line">    update_info_text(<span class="string">&quot;Connecting to Qnect...\n&quot;</span>)</span><br><span class="line">    login_qnect = PrivateCarQuoting.Login(username, password)</span><br><span class="line">    <span class="keyword">if</span> login_qnect[<span class="number">0</span>] != <span class="number">0</span>:</span><br><span class="line">        update_info_text(login_qnect[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            driver = login_qnect[<span class="number">1</span>]</span><br><span class="line">            driver.quit()</span><br><span class="line">        <span class="keyword">except</span>: <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        update_info_text(<span class="string">&quot;Log in Success!\n&quot;</span>)</span><br><span class="line">        driver = login_qnect[<span class="number">1</span>]</span><br><span class="line">        completed = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">update_info_text</span>(<span class="params">text</span>):</span><br><span class="line">    main_window.info_text.insert(END, text)</span><br><span class="line">    main_window.info_text.see(END)</span><br></pre></td></tr></table></figure><p>上面这个函数主要需要完成的是验证数据并通过主界面实例将结果动态反馈至主界面，并在成功收集数据，打开webdriver对象后返回这两个对象以供后面的程序使用。特别需要注意的是其中的<code>complete</code>变量，这是一个<code>布尔变量</code>，只有在所有验证成功完成后这个变量才会被标记为<code>真</code>。在这个变量被标记为真后另一个线程中正在监听<code>complete</code>结果的函数<code>Waiting_for_login()</code>才会开始执行：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">listening = <span class="literal">False</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Waiting_for_login</span>():</span><br><span class="line">    <span class="keyword">global</span> completed, listening</span><br><span class="line">    <span class="keyword">if</span> completed:</span><br><span class="line">        listening = <span class="literal">False</span></span><br><span class="line">        update_info_text(<span class="string">&quot;Start Quoting...\n\n&quot;</span>)</span><br><span class="line">        quoting_thread = threading.Thread(target=PrivateCarQuote)</span><br><span class="line">        quoting_thread.start()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        main_window.root.after(<span class="number">100</span>, Waiting_for_login)</span><br></pre></td></tr></table></figure><p>这里需要注意的一点主要是<code>listening</code>这个变量在这里的意义是为了控制同时发起的线程，因为在<code>start_quote(self)</code>按钮的函数中会直接调用<code>Waiting_for_login()</code>函数，而每一个被运行的<code>Waiting_for_login()</code>函数又会在得到<code>complete</code>变量之前，每100毫秒循环运行自己，这会导致如果程序一直不能<code>complete</code>时，如果用户一直点击按钮，就会创建多个线程运行同一个函数，而在<code>complete</code>被完成时，所有的多个函数被同时执行。因此这里以一个<code>listening</code>变量控制，只有在<code>listening</code>为<code>假</code>时，按按钮才会运行新的<code>Waiting_for_login()</code>函数。</p><p>到这里，我这个第一版的报价工具用户界面就已经基本完成了，上方这个<code>Waiting_for_login()</code>函数在以后增加不同的险种报价功能后还应该改成输入一个单选按钮的结果，在线程中运行对应报价流程的函数，但目前还没有这个功能的需求，单选按钮就当是占位符了。</p><h2 id="ico文件转码">ico文件转码</h2><p>运行下面这段代码将<code>ico文件</code>编码为<code>py文件</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">open_icon = <span class="built_in">open</span>(<span class="string">&quot;QBE_Vertical_White_RGB.ico&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">b64str = base64.b64encode(open_icon.read())</span><br><span class="line">open_icon.close()</span><br><span class="line">write_data = <span class="string">&quot;img = %s&quot;</span> % b64str</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;icon.py&quot;</span>, <span class="string">&quot;w+&quot;</span>)</span><br><span class="line">f.write(write_data)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>然后在主程序中加入下面这些代码从而将上面生成的<code>icon.py</code>文件中的内容重新解码为<code>ico文件</code>：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add ico from the icon.py file and delete the file after</span></span><br><span class="line">picture = <span class="built_in">open</span>(<span class="string">&quot;picture.ico&quot;</span>, <span class="string">&quot;wb+&quot;</span>)</span><br><span class="line">picture.write(base64.b64decode(img))</span><br><span class="line">picture.close()</span><br><span class="line">self.root.iconbitmap(<span class="string">&quot;picture.ico&quot;</span>)</span><br><span class="line">os.remove(<span class="string">&quot;picture.ico&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="Webdriver-manager-SSL验证">Webdriver manager SSL验证</h2><p>在最后将文件打包为exe文件后还遇到一个关于<code>Webdriver manager</code>的奇怪BUG，为了避免每次运行<code>webdriver</code>时都要去下载最新的<code>chrome driver</code>， 我使用了<code>webdriver manager包</code>，它会自动检测当前缓存中的<code>webdriver</code>版本并对比当前最新版本，如果本机不是最新版本则会自动去官网下载并打开，只需要一句代码：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> webdriver_manager.chrome <span class="keyword">import</span> ChromeDriverManager</span><br><span class="line"></span><br><span class="line">driver = webdriver.Chrome(ChromeDriverManager().install())</span><br></pre></td></tr></table></figure><p>这句话在<code>Pycharm</code>中运行非常顺畅，但当我把文件打包成exe文件后再运行就会在这句报错，说SSL未验证，我最后也没有找到原因，只能根据<code>webdriver manager</code>官方文档的指导通过修改os环境参数<code>WDM_SSL_VERIFY</code>来跳过SSL验证。</p><blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.environ[<span class="string">&#x27;WDM_SSL_VERIFY&#x27;</span>] = <span class="string">&#x27;0&#x27;</span></span><br></pre></td></tr></table></figure></blockquote><h1>最后</h1><p>以上就是整个自动报价机器人的操作界面的记录，到这里我就算是独立完成了一个可以大幅减少公司重复劳动工作的RPA程序，到我写完这篇文章的时候这个报价工具已经同时完成了向两个不同渠道的400余个报价案件的测试，在4小时内完成了普通一个人人手需要十几个工作日才能完成的报价量，之后这个软件的升级或改进如果有意义的话我会再开一篇。</p><p>[第22篇]</p>]]></content:encoded>
      
      
      <category domain="http://raylei.space/categories/%E7%BC%96%E7%A8%8B%E7%AE%97%E6%B3%95/">编程算法</category>
      
      
      <category domain="http://raylei.space/tags/%E5%B7%A5%E4%BD%9C%E5%AD%A6%E4%B9%A0/">工作学习</category>
      
      <category domain="http://raylei.space/tags/Python/">Python</category>
      
      <category domain="http://raylei.space/tags/RPA/">RPA</category>
      
      <category domain="http://raylei.space/tags/GUI/">GUI</category>
      
      
      <comments>http://raylei.space/2022/08/23/22-Automated_Website_Logging_Robot_GUI/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
